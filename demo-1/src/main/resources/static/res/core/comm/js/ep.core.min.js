(function(){$(document).off("keydown").on("keydown",function(f){var h=false;var g=f.srcElement||f.target;if(f.keyCode===8){if((g.tagName.toUpperCase()==="INPUT"&&(g.type.toUpperCase()==="TEXT"||g.type.toUpperCase()==="PASSWORD"||g.type.toUpperCase()==="FILE"))||g.tagName.toUpperCase()==="TEXTAREA"){h=g.readOnly||g.disabled;}else{h=true;}}if(f.keyCode===13){if(g.tagName.toUpperCase()==="INPUT"){h=true;}}if(h){f.preventDefault();}});var b=$ep.log,a=function(g){if(typeof g.then!=="function"){return false;}var e=String($.Deferred().then);var f=String(g.then);return e===f;},d={ajax:function(e){return $.ajax(e);},blockUI:function c(f,h){var j=$('<iframe class="ep-ui-block-iframe" src="about:blank" frameborder="0" /><div class="ep-ui-block ep-ui-blockUI" />').appendTo(document.body),i=null,e=0;if(f&&typeof f.message!=="undefined"){i=j.filter(".ep-ui-block.ep-ui-blockUI").after('<div class="ep-ui-block ep-ui-blockUI-message" style="display:none;">'+(typeof f.message=="string"?f.message:typeof f.message=="object"?f.message.text?f.message.text:"":"")+"</div>").next().fadeIn();typeof f.message=="object"?f.message.css?i.css(f.message.css):"":"";typeof f.message=="object"?f.message.classes?i.addClass(f.message.classes):"":"";}if(d.isMobile.Any()){f.css={opacity:"0",filter:"alpha(opacity=0)"};}var g={unblock:function(){if(e){clearTimeout(e);}$(j).add($(i)).fadeOut().remove();j=null;i=null;f&&typeof f.success=="function"?f.success():"";}};f&&f.css&&j.css(f.css);f&&f.classes&&j.addClass(f.classes);f&&f.hide&&$.isNumeric(f.hide)&&(f.hide=parseInt(f.hide,10));if(f&&f.hide){switch(typeof f.hide){case"string":$(j).add($(i)).on(f.hide,g.unblock);break;case"number":e=setTimeout(function(){g.unblock();},f.hide);break;case"object":typeof f.hide.event==="string"?$(j).add($(i)).on(f.hide.event,g.unblock):"";typeof f.hide.delay==="number"?e=setTimeout(function(){g.unblock();},f.hide.delay):"";break;}}return g;},toast:function(h,e,i,f){if($(".ep-ui-toast").size()>0){return;}var g=f||{};d.blockUI({message:{text:h,classes:"ep-ui-toast",css:g},success:typeof e==="function"?e:typeof i==="function"?i:undefined,hide:(typeof e=="undefined"||typeof e=="function")?1300:e,css:{background:"#fff",opacity:"0"}});},loadPage:function(i,g,l){var m=this,h=new $.Deferred(),k=$ep.urlVersion(g),f=false,o=$(i);function n(){var e=m.delay();if(o.size()>0){o.empty();e.run(function(){o.html('<div class="ep-progress box-size"><span class="ep-loading">'+$ep.LangPatternString("{TEXT.LOADING}")+"</span></div>");},300);o.data("page_href",k);if(o.is("iframe")){f=true;}}m.ajax({url:k,type:"get",async:true,success:function(q,s,r){function p(t){e.clear();!f&&o.size()>0&&o.html(t);f&&(function(){var v=o[0];var u=(v.contentWindow)?v.contentWindow:(v.contentDocument.document)?v.contentDocument.document:v.contentDocument;u.document.open();u.document.write(t);u.document.close();u.document.parentIFrameElement=o[0];})();if(f){return;}h.resolve(t,s);if(l&&o.size()){if(typeof l.after==="function"){l.after(o,s,r);}}}if(!(l&&typeof l.before==="function")){p(q);return;}$.when(l.before(q,s,r)).done(function(u){var t=u;if(t===false){return h.resolve(s,"cancel");}if(t!==true&&t!==undefined){u=t;}p(u);});},error:function(q,r,p){e.clear();o.empty();o.html('<div class="errormessage"><p class="warning">'+$ep.LangString("ERROR.RESPONSE_PAGE_EXCEPTION")+"</p></div>");if(l){if(typeof l.after==="function"){if(l.after(p,r,q)===false){return h.resolve(r,p);}}}h.resolve(r,p);}});}if(o.size()>0){var j=$.Event("beforedestroy");$("form",o).trigger(j);if(j.result){if(j.result===false){return;}if(a(j.result)){j.result.done(function(e){if(e===false){return;}n();});}else{n();}}else{n();}}else{n();}return h.promise();},expression:function(i,k,g){var j=i;if(!k){return;}while(j.match(/\{([a-zA-Z0-9\.\$\@]+)\}/g)){var e=RegExp.$1,l=new RegExp("\\{"+e+"\\}","g"),h=e.split("."),f=k;$.each(h,function(m,n){f=f[n];if(!f){return false;}});if(!f){f=g===true?"-null-":"";}j=j.replace(l,f);}return j;},tagReplace:function(e,i,f,g){var h=new RegExp("(<"+i+".*?>)([\\s\\S]*?)(</"+i+">)|<"+i+".*?[/]?>","gi");return g===true?e.replace(h,"$1"+f+"$3"):e.replace(h,f);},removeTag:function(f,h,e){var g=new RegExp("(<"+h+".*?>)([\\s\\S]*?)(</"+h+">)|<"+h+".*?[/]?>","gi");return e===false?f.replace(g,"$2"):f.replace(g,"");},patternCompletion:function(k,j,f){var g=k;while(g.match(/\[([\w\s\{\}\=\-\(\)\/\:\"\'\&\#\;\%\+]+)\]/g)){var h=RegExp.$1,e=d.expression(h,j,true),i=new RegExp("\\["+h.replace(/\(/g,"\\(").replace(/\)/,"\\)")+"\\]","g");g=g.replace(i,e.match(/-null-/g)?f?f:"":e);}return d.expression(g,j);},CURI:$.CURI,browser:{msie:/MSIE|rv:11\.0/i.test(navigator.userAgent),ie8:/MSIE 8/i.test(navigator.userAgent),ie9:/MSIE 9/i.test(navigator.userAgent),ie10:/MSIE 10/i.test(navigator.userAgent),ie11:/rv:11\.0/i.test(navigator.userAgent),chrome:/Chrome/i.test(navigator.userAgent)},isMobile:{Android:function(){return navigator.userAgent.match(/Android/i)==null?false:true;},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)==null?false:true;},IOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)==null?false:true;},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)==null?false:true;},Windows:function(){return navigator.userAgent.match(/IEMobile/i)==null?false:true;},Any:function(){return(d.isMobile.Android()||d.isMobile.BlackBerry()||d.isMobile.IOS()||d.isMobile.Opera()||d.isMobile.Windows());}},getApp:function(g,m,f,l){if(!g){return null;}var n=this,j=null,o=typeof m=="function"?m:f,k=typeof m=="string"?m:$ep.user.companycode(),i=typeof f!="function"&&typeof l=="undefined"?f:l,e=(k?k+".":"")+g;if(!k){b("companycode is empty.",arguments);return;}if($ep.cache.app[e]){o&&o($ep.cache.app[e]);return $ep.cache.app[e];}var h=$.CURI("/ngw/core/profile.nsf/api/data/collections/name/profilecode",{category:e});d.ajax($.extend({url:h.url,async:true,success:function(r,p,s){if(typeof r!="object"||r.length==0){o&&o(j);return;}$ep.cache.app[r[0]["_companycode"]+"."+r[0]["_syscode"]]=j={company:r[0]["_company"],companycode:r[0]["_companycode"],name:r[0]["_sysname"],title:r[0]["_title"],noteid:r[0]["@noteid"],syscode:r[0]["_syscode"],sysdir:r[0]["_sysdir"]&&("/"+r[0]["_sysdir"].replace("\\","/")),langprefix:r[0]["_langprefix"].toUpperCase(),languagepack:r[0]["_languagepack"],ismastercompute:r[0]["_mailmasterhost"]=="1"?true:false};function q(t){j.leftframe=(function(w,u){if(!w){return"";}var v=w.match(/^\//g)?w:(j.sysdir.match(/^\//g)?"":"/")+j.sysdir+(j.sysdir.match(/\/$/g)?w:"/"+w);return t?d.patternCompletion(v,t):v;})(r[0]["_leftframe"],t);j.contentframe=(function(w,u){if(!w){return"";}var v=w.match(/^\//g)?w:(j.sysdir.match(/^\//g)?"":"/")+j.sysdir+(j.sysdir.match(/\/$/g)?w:"/"+w);return t?d.patternCompletion(v,t):v;})(r[0]["_contentframe"],t);o&&o(j);return;}if(j.ismastercompute){n.getMasterHost(function(t){q(t?t:null);});}else{q();}return;}},i));return j;},getMasterHost:function(h,g,e){var f=$.CURI("/ngw/core/lib.nsf/mailmasterhost?readform",{id:g});if($ep.cache.master[g]){h($ep.cache.master[g]);return;}d.ajax({url:f.url,success:function(j,i,l){if(!j||!j.mailmasterhost){h&&h(null);return;}var k=j;$ep.cache.master[k.id]=k;h&&h(k);}});},objectFilter:function(i,g){if(!i){return null;}var h=null,f=g?$ep.Array(g).isArray()?g:g.split($$.SEPERATE.field):null;if($ep.Array(i).isArray()){h=$ep.Array(i).datafilter(function(k,j){return d.objectFilter(j,f);});}else{h={};for(var e=0;f.length>e;e++){h[f[e]]=i[f[e]]?i[f[e]]:null;}}return h;},objectToString:function(f,j,m){var l="",i=j?$ep.Array(j).isArray()?j:j.split($ep._CONST.SEPERATE.col):$ep._CONST.ORG_DEF_MASK,g=m?m:$ep._CONST.SEPERATE.col;if($ep.Array(f).isArray()){for(var k=0;f.length>k;k++){l+=(l?$ep._CONST.SEPERATE.record:"")+d.objectToString(f[k],i,g);}return l;}if(i){for(var e=0;i.length>e;e++){var h=i[e];l+=(l?g:"")+(f[h]?f[h]:"");}}else{$.each(f,function(n,o){l+=(l?g:"")+o;});}return l;},stringToObject:function(h,f,g,j){if(!h){return;}var e=[],i=$ep.Array(h).isArray()?h:h.split(j?j:$ep._CONST.SEPERATE.field),k=f?f.split($ep._CONST.SEPERATE.col):$ep._CONST.ORG_DEF_MASK.split($ep._CONST.SEPERATE.col);$ep.Array(i).datafilter(function(l,n){var m=n.ltrim().rtrim().split(g?g:$ep._CONST.SEPERATE.col),o=null;if(m.length==0){return;}if(m.length==1&&m[0]==""){return;}$ep.Array(k).datafilter(function(p,q){if(!o){o={};}o[q]=m[p]?m[p]:"";});if(o){e.push(o);}});return e;},delay:function(){return(function(){var f=0,e={clear:function(){clearTimeout(f);return this;},run:function(h,g){this.clear();f=setTimeout(h,g);}};return e;})();},keepObject:function(){return(function(){var f=$("body object:visible"),e={hide:function(){return f&&f.hide();},show:function(){return f&&f.show();},clear:function(){f=null;}};return e;})();},cleanAwareness:function(){var e=$ep.cache.awareness;$.each(e,function(){if(this.unusedtime()>10){this.destroy();}});},directURL:function(g,e,f){var i=$.CURI(g,e);i.setArgv({_ver:""});var h=$.CURI("/ngw/core/lib.nsf/undock.html?readform",f);h.setParam({url:encodeURIComponent(i.url)});return h;},openPage:function(g,e,i,f){var h=this.directURL(g,e,f);var j=i?i:{};return $.winOpen(h.url,"_blank",$.extend({scrollbars:"yes"},j));},windowTitle:function(e){document.title=$.type(e)=="function"?e.call(this,e):e;},abc:{status:0,live:0,alive:false,lock:false,repeatlimit:10,_repeat:0,delayRefresh:10000,delayConnection:60000,req:function(f,g){var e=this;return d.ajax($.extend({url:$ep._CONST.ABC.REQUESTURL,dataType:"jsonp",timeout:1500,data:f},g));},_onLineCheck:function(){var e=this;e.alive=true;return this.req({reqType:"typeChat",subType:"none"}).always(function(h,f,g){if(f=="timeout"){e.status=0;e._repeat++;setTimeout(function(){if(e.repeatlimit!=0&&e.repeatlimit<e._repeat){e.alive=false;return;}e._onLineCheck();},e.delayConnection);return;}e._repeat=0;e.status=1;e.vitalize();});},chat:function(h){if(window.ePortalConfig&&window.ePortalConfig.username){if(!this.abc_login_id||(this.abc_login_id!=window.ePortalConfig.username)){return $.Deferred().reject("");}}else{if(window.$ep&&$ep.cache&&$ep.cache.master){var j="";for(var e in $ep.cache.master){if($ep.cache.master[e].id){j=$ep.cache.master[e].id;break;}}if(!this.abc_login_user||(j&&j!=this.abc_login_user.replace(/\,/g,"/"))){return $.Deferred().reject("");}}}var f=this.abc_login_user.replace(/,/,"/");for(var g=h.length-1;g>=0;g--){if(h[g].replace(/,/,"/")==f){h.splice(g,1);break;}}if(h.length==0){return $.Deferred().reject("");}return this.req({reqType:"typeChat",subType:"chat",param1:$.isArray(h)?h.join("|"):h});},phone:function(g){if(window.ePortalConfig&&window.ePortalConfig.username){if(!this.abc_login_id||(this.abc_login_id!=window.ePortalConfig.username)){return $.Deferred().reject("");}}else{if(window.$ep&&$ep.cache&&$ep.cache.master){var f="";for(var e in $ep.cache.master){if($ep.cache.master[e].id){f=$ep.cache.master[e].id;break;}}if(!this.abc_login_user||(f&&f!=this.abc_login_user.replace(/\,/g,"/"))){return $.Deferred().reject("");}}}return this.req({reqType:"typeChat",subType:"phone",param1:g});},awareness:function(e){return this.req({reqType:"typeAW",subType:"getStatus",param1:$.isArray(e)?e.join("|"):e});},cacheRefresh:function(){var e=new $.Deferred();d.cleanAwareness();var f=$ep.cache.awareness,g=[];$.each(f,function(h){g.push(h);});if(g.length==0){e.resolve("none");return e.promise();}return this.awareness(g).done(function(h){if(!h||!h.buddyState){return;}$.each(h.buddyState,function(j,k){var i=f[k.uid];if(!i){return;}if(i.ipt.status!=k.ipt){i.iptUpdateStatus(k.ipt);}});}).fail(function(){$.each(f,function(i,h){h.iptUpdateStatus(14);});});},vitalize:function(){return;var e=this;if(this.lock==true){b("locked");return;}e.lock=true;e.alive=true;e.cacheRefresh().always(function(g,f){if(f=="timeout"){e.devitalize();e._onLineCheck();return;}if(g=="none"&&e.status==0){e._onLineCheck();e.lock=false;return;}e.lock=false;e.live=setTimeout(function(){e.live!=0&&e.vitalize();},e.delayRefresh);});},devitalize:function(){clearTimeout(this.live);this.live=0;this.alive=false;this.lock=false;}},stproxy:{chat:function(e){var f=$.isArray(e)?e:[e];if($ep.util.abc.status==1){$ep.util.abc.chat(f).fail(function(){});return;}}},connUserID:function(f,h){var g="",e=h;if(!f){return g;}return this.ajax({url:"/profiles/atom/profile.do",async:true,dataType:"xml",data:{email:f}}).always(function(i,j){if(j=="success"){g=$(i).find("contributor").children("snx\\:userid").text();}e&&e(g);});}};$ep.util=d;})();