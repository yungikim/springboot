/* kmslab_editor 3.0.1 */

window.txEval=function(a,b){return"function"==typeof a?a.call(b||this):"string"==typeof a?b?b.eval(a):this.eval(a):void 0};try{EditorJSLoader.readyState="loading"}catch(a){}var Trex={__WORD_JOINER:"\ufeff",__WORD_JOINER_REGEXP:/\ufeff/g,__KEY:{ENTER:"13",DELETE:"46",SPACE:"32",BACKSPACE:"8",TAB:"9",PASTE:"86",CUT:"88"},I:{},X:{},define:function(a,b){return Object.extend(a,b)},available:function(a,b){return $tx("tx_"+b)&&a?a.use==_FALSE?_FALSE:_TRUE:_FALSE}};try{EditorJSLoader.getOption("i18n")&&(Trex._I18N_=window[EditorJSLoader.getOption("i18n")]),Trex._I18N={g:function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);var c=a.pop();return Trex._I18N_&&Trex._I18N_.words[a[0]]?Trex._I18N_.get.apply(Trex._I18N_,a):c},w:function(){document.write(Trex._I18N.g.apply(Trex._I18N,arguments))}},Trex._JS_MIN=EditorJSLoader.getOption("js_min")}catch(a){}Trex._getDisplayFileSize=function(a){var b="Kb",c=a/1024;return c>1024&&(c/=1024,b="Mb"),(c=Math.round(100*c)/100)+b},Trex.KEditor={_clipboardProcess:function(a,b){try{var c=b.clipboardData;if(window.FormData&&c&&c.items&&c.items[0]){for(var d=c.items,e=null,f=[],g=[],h=null,i=null,j=null,k=null,l=null,m=0;m<d.length;m++)if("file"!=d[m].kind||-1==d[m].type.search(/image/i)||$tx.os_mac)"string"==d[m].kind&&-1!=d[m].type.search(/text\/html/i)?h=d[m]:"string"==d[m].kind&&-1!=d[m].type.search(/text\/plain/i)&&(i=d[m]);else{e=d[m],f.push(d[m]);var n=e.getAsFile(),o=a.config.imageLimitSize||0;n.size&&0!=o&&o<n.size?g.push({error:"LIMIT",limit:o,size:n.size}):(g.push(Trex.KEditor.blobUpload(a,n)),null!=g[m]&&(g[m].size=n.size,g[m]&&g[m].img_src||(g[m]=null)))}if(h&&(j=c.getData("text/html")),i&&(k=c.getData("text/plain")),null!=e&&"file"==e.kind&&-1!=e.type.search(/image/i)){var p=e.getAsFile(),o=a.config.imageLimitSize||0;p.size&&0!=o&&o<p.size?l={error:"LIMIT",limit:o,size:p.size}:null==(l=Trex.KEditor.blobUpload(a,p))||(l.size=p.size,l&&l.img_src||(l=null))}var q=a.editor.getCanvas(),r=q.getProcessor().getSelectionRange(a.editor.getCanvas());if(j&&l&&"LIMIT"!=l.error){var s=a.config.pasteOption||"layer";if("html"==s)return Trex.KEditor._pasteClipboardHtml(a,j,r);if("image"==s)return"LIMIT"==l.error?Trex.Image._SUPPORT_JPEG_QUALITY?alert(Trex._I18N.g("image.upload_limit_canvas",Trex._getDisplayFileSize(l.size),Trex._getDisplayFileSize(l.limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(l.limit)+").\n이미지 첨부의 JPEG 품질 기능을 사용하여 이미지를 첨부해 주세요.")):alert(Trex._I18N.g("image.upload_limit",Trex._getDisplayFileSize(l.size),Trex._getDisplayFileSize(l.limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(l.limit)+").")):a.editor.getCanvas().execute(function(b){var c=b.win.img({src:l.img_src,border:"0",className:""});b.pasteNodeCustom(c,a.editor.getCanvas(),r)}),!0;return a.editor.getImagePasteLayer(a).showPopup(null,{image:function(b){var c=a.editor.getCanvas();c.focus(),c.execute(function(a){var d=a.win.img({src:b.src?b.src:l.img_src,border:"0",className:""});null!=b.width&&(d.width=b.width,d.style.width=b.width+"px"),null!=b.height&&(d.height=b.height,d.style.height=b.height+"px"),b.border&&(d.style.border=b.border);var e=a.pasteNodeCustom(d,c,r);if(b.align&&e){var f=$tom.find(e,"%paragraph");f&&(f.style.textAlign=b.align)}})},html:function(b){a.editor.getCanvas().focus(),Trex.KEditor._pasteClipboardHtml(a,b,r)},plain:k?function(b){var c=a.editor.getCanvas();c.focus(),c.execute(function(a){a.pasteHtml(b,c,r)})}:null},{src:l.img_src},j,k,l.size),!0}if(j)return Trex.KEditor._pasteClipboardHtml(a,j,r);if(g.length>0){for(var m=0;m<g.length;m++)"LIMIT"==g[m].error?Trex.Image._SUPPORT_JPEG_QUALITY?alert(Trex._I18N.g("image.upload_limit_canvas",Trex._getDisplayFileSize(g[m].size),Trex._getDisplayFileSize(g[m].limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(g[m].limit)+").\n이미지 첨부의 JPEG 품질 기능을 사용하여 이미지를 첨부해 주세요.")):alert(Trex._I18N.g("image.upload_limit",Trex._getDisplayFileSize(g[m].size),Trex._getDisplayFileSize(g[m].limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(g[m].limit)+").")):q.execute(function(a){var b=a.win.img({src:g[m].img_src,border:"0",className:""});a.pasteNodeCustom(b,q,r)});return!0}return!1}if((c=window.clipboardData)&&c.files&&c.files[0]&&$tx.msie&&11==$tx.msie_ver){var q=a.editor.getCanvas(),r=q.getProcessor().getSelectionRange(a.editor.getCanvas());if(null!=c.getData("text"))return!1;var t=c.files[0];if(t.type.indexOf("image")>-1){var p=t,o=a.config.imageLimitSize||0;if(p.size&&0!=o&&o<p.size?l={error:"LIMIT",limit:o,size:p.size}:(l=Trex.KEditor.blobUpload(a,p),l.size=p.size,l&&l.img_src||(l=null)),l)return"LIMIT"==l.error?Trex.Image._SUPPORT_JPEG_QUALITY?alert(Trex._I18N.g("image.upload_limit_canvas",Trex._getDisplayFileSize(l.size),Trex._getDisplayFileSize(l.limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(l.limit)+").\n이미지 첨부의 JPEG 품질 기능을 사용하여 이미지를 첨부해 주세요.")):alert(Trex._I18N.g("image.upload_limit",Trex._getDisplayFileSize(l.size),Trex._getDisplayFileSize(l.limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(l.limit)+").")):a.editor.getCanvas().execute(function(b){var c=b.win.img({src:l.img_src,border:"0",className:""});b.pasteNodeCustom(c,a.editor.getCanvas(),r)}),!0}}}catch(a){return!1}},_pasteClipboardHtml:function(a,b,c){var d=!1,e=/<html[\S\s]*?office:excel[\S\s]*?>/gi,f=e.test(b);if(-1!=b.search(/<\!--StartFragment-->([\S\s]*?)<\!--EndFragment-->/i)){var g=b.match(/<\!--StartFragment-->([\S\s]*?)<\!--EndFragment-->/i)[1];if(-1==g.search(/<[a-zA-Z]+[^>]*?>/))return!1}b=b.replace(/(<v:shape(?:>|\s+[^>]*>))([\S*\s*]*?)<\/v:shape>/g,function(a,b,c){if(-1!=c.search(/<v:imagedata/)){var e=c.match(/<v:imagedata(?:>|\s+[^>]*>)/)[0],f=(e.match(/src\s*=\s*(?:'[^']*'|"[^"]*"|[^\s>]*)/)||[""])[0],g=(b.match(/style\s*=\s*(?:'[^']*'|"[^"]*"|[^\s>]*)/)||[""])[0];return d=!0,"<img "+f+" "+g+">"}return a}),b=b.replace(/>&#13;</gi,">&#xFEFF;<");var h=/(<\!--\[if\s+(gte\s+|lte\s*|lt\s+|gt\s+|\!)(mso|vml)(\s+\d+|\s*)\]>(((?:[^<])*(?:<(?!\!\[endif\]\s*-->)[^>]*>)[^<]*)*)<\!\[endif\]\s*-->|<\!--\[if\s*\!mso\s*\&\s*vml\]>[\S\s]*?<\!\[endif]-->|<\!--\s*\[if\s+\!vml\]\s*-->|<\!--\s*\[endif\]\s*-->|<\!\[if\s+\![a-zA-Z]+\]>|<\!--\s*\[if\s+[\!a-zA-Z]+\]\s*-->|<\!\[endif\]>)/g;h.test(b)&&(d=!0,b=b.replace(h,"")),h=/<(\/?)form/gi,h.test(b)&&(d=!0,b=b.replace(h,"<$1x-form")),h=/<\/?[a-zA-Z]+\:[a-zA-Z]+[^>]*>/gi,h.test(b)&&(d=!0,b=b.replace(h,"")),h=/(<style(?:>|\s+[^>]*>))(((?:[^<])*(?:<(?!\/style>)[^>]*>)[^<]*)*)<\/style>/g,h.test(b)&&(d=!0,b=b.replace(h,function(a){return a.replace(/([:\s]0?)\.5pt/g,"$11px")})),h=/[\S\s]+?(<html)/i,b.toLowerCase().indexOf("<html")>0&&h.test(b)&&(b=b.replace(h,"$1"));var i=Trex.KEditor._getStyles(b);if(-1!=b.search(/<\!--StartFragment-->([\S\s]*?)<\!--EndFragment-->/)){var g=b.match(/<\!--StartFragment-->([\S\s]*?)<\!--EndFragment-->/i)[1];-1==g.search(/<\/?(?!a|abbr|address|b|br|cite|code|em|font|i|img|label|p|span|strike|strong|sub|sup|tt|u)[a-zA-Z]/i)&&(d=!0,b=g),-1!=b.search(/<table/i)&&-1==g.search(/<\/?(tr|td|th)/i)&&(b=b.replace(/<table([\S\s]*?)<\!--StartFragment-->/i,"\x3c!--StartFragment--\x3e"),b=b.replace(/<\!--EndFragment-->([\S\s]*?)<\/table[^>]*>/i,"\x3c!--EndFragment--\x3e")),-1!=b.search(/<\!--StartFragment-->\s*<table/i)&&-1!=b.search(/<\/table\s*>\s*<\!--EndFragment-->/i)&&(b=b.replace(/(<body[\S\s]*?>)([\S\s]*?)(<\!--StartFragment-->)/i,"$1$3"),b=b.replace(/(<\!--EndFragment-->)([\S\s]*?)(<\/body[\S\s]*?>)/i,"$1$3"))}f&&-1!=b.search(/<col[^>]*>/gi)&&(d=!0,b=b.replace(/<col[^>]*>/gi,"")),b=b.replace(/(<\!--StartFragment-->|<\!--EndFragment-->)/gi,""),-1!=b.search(/<body[^>]*>([\S\s]*)<\/body/i)&&(b=b.match(/<body[^>]*>([\S\s]*)<\/body/i)[1]);var j=Trex.KEditor._regexpHasStyleProps(a.config.removeStyleProps);if(!(i||j&&j.match.test(b)||d||a.imageUploader&&a.imageUploader.isLoadComplete()&&-1==b.search(/src\s*\=\s*["']*(file:|[a-zA-Z]:)/i)))return!1;b=b.replace(/(\r\n){1,}/g,"\r\n").replace(/(\n){1,}/g,"\n").replace(/(\r){1,}/g,"\r");var k=a.editor.getCanvas();return-1!=b.search(/\s*<table/i)&&(b="<br>"+b+"<br>"),-1!=b.search(/<table/i)&&(b=b.replace(/(<td[^>]*>[\S\s]*?<p[^>]*>)(.*)(<\/p>[\S\s]*?<\/td>)/gi,function(a,b,c,d){return""==c&&(c="<br/>"),b+c+d}),b=b.replace(/(<td[^>]*>)([\S\s]*?)(<\/td>)/gi,function(a,b,c,d){return""==c&&(c="<p><br/></p>"),b+c+d})),a.imageUploader&&a.imageUploader.isLoadComplete()?a.imageUploader.uploadImage_async(a,b,i,c):(b=Trex.KEditor.cleanupHTML(b),b=Trex.KEditor.inlineStyle(i,b,a.config.removeStyleProps),a.editor.getCanvas().execute(function(a){a.pasteHtml(b,k,c)})),!0},_getStyles:function(a){var b=null;return-1!=a.search(/<style/i)&&(b=a.match(/<style[^>]*>[\S\s]*?<\/style>/gi)),b},_controlClipboardProcess:function(kEditor,data){var json=null;if(!data)return!1;try{json=eval("("+data+")")}catch(a){return!1}if("multi"==json.type&&json.data.html&&json.data.image){var _html=json.data.html;-1!=_html.search(/urn\:schemas\-microsoft\-com\:office\:word/i)&&(json.data.image=null)}var limit=kEditor.config.imageLimitSize||0;if(0!=limit&&("image"==json.type||"multi"==json.type&&json.data.image))for(var _data="multi"==json.type?json.data.image:json.data,i=0;i<_data.length;i++)_data[i].size&&limit<_data[i].size&&(_data[i].error="LIMIT");var _canvas=kEditor.editor.getCanvas(),range=_canvas.getProcessor().getSelectionRange(kEditor.editor.getCanvas());if("plain"==json.type)return!1;if("multi"==json.type&&json.data.html&&json.data.image&&json.data.image[0]&&"LIMIT"!=json.data.image[0].error){var _layer=kEditor.editor.getImagePasteLayer(),_img={img_src:json.data.image[0].dataURL,size:json.data.image[0].size},_html=json.data.html,_plain=json.data.plain;return _layer.showPopup(null,{image:function(a){var b=kEditor.editor.getCanvas();b.focus(),b.execute(function(c){var d=c.win.img({src:a.src?a.src:_img.img_src,border:"0",className:""});null!=a.width&&(d.width=a.width,d.style.width=a.width+"px"),null!=a.height&&(d.height=a.height,d.style.height=a.height+"px"),a.border&&(d.style.border=a.border);var e=null;if(e=c.pasteNodeCustom(d,b,range),a.align&&e){var f=$tom.find(e,"%paragraph");f&&(f.style.textAlign=a.align)}})},html:function(a){kEditor.editor.getCanvas().focus(),Trex.KEditor._pasteClipboardHtml(kEditor,a,range)},plain:_plain?function(a){var b=kEditor.editor.getCanvas();b.focus(),b.execute(function(c){c.pasteHtml(a,b,range)})}:null},{src:_img.img_src},_html,_plain,_img.size),!0}if("multi"==json.type&&json.data.html)return Trex.KEditor._pasteClipboardHtml(kEditor,json.data.html,range);if("html"==json.type){var html=json.data;return Trex.KEditor._pasteClipboardHtml(kEditor,html,range)}if("image"==json.type||"multi"==json.type&&json.data.image){try{if("image"==json.type&&$tx.msie&&11==$tx.msie_ver&&json.data&&1==json.data.length&&json.data[0].dataURL)return!1}catch(a){}for(var html="",doc=kEditor.getDom(),_data="multi"==json.type?json.data.image:json.data,hasLimit=!1,limitSize="",i=0;i<_data.length;i++)if("LIMIT"==_data[i].error)hasLimit=!0,limitSize=_data[i].size;else{var width=_data[i].width;html+="<img "+(width?' width="'+width+'"':"")+'src="file:///'+_data[i].path.replace(/"/g,"&qout;").replace(/\\/g,"/")+'">'}return!html&&hasLimit?(Trex.Image._SUPPORT_JPEG_QUALITY?alert(Trex._I18N.g("image.upload_limit_canvas",Trex._getDisplayFileSize(limitSize),Trex._getDisplayFileSize(limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(limit)+").\n이미지 첨부의 JPEG 품질 기능을 사용하여 이미지를 첨부해 주세요.")):alert(Trex._I18N.g("image.upload_limit",Trex._getDisplayFileSize(limitSize),Trex._getDisplayFileSize(limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(limit)+").")),!0):!!html&&(html=Trex.KEditor.htmlLocalImageUpload(kEditor,html),kEditor.editor.getCanvas().execute(function(a){a.pasteHtml(html,_canvas,range)}),!0)}},htmlLocalImageUpload:function(a,b){if(!a.imageUploader||!a.imageUploader.isLoadComplete())return b;var c=$("<div>"+b+"</div>");return c=Trex.KEditor._controlLocalImageUpload(a,c),null!=c?c.html():b},_controlLocalImageUpload:function(a,b){if(a.imageUploader&&a.imageUploader.isLoadComplete())return a.imageUploader.uploadImage(a,b)},eventDrop:function(a,b){var c=b.target.files||b.dataTransfer.files;if(c.length>0)for(var d=0;d<c.length;d++){var e=c[d];if(null!=e&&-1!=e.type.search(/image/i)){var f=new FileReader;f.addEventListener("load",function(){var b=f.result.substring(f.result.indexOf(",")+1),c=e.size,d=Trex.KEditor.base64ToBlob(b,e.type),g=a.config.imageLimitSize||0,h=a.editor.getCanvas().getProcessor().getSelectionRange(a.editor.getCanvas()),i=null;c&&0!=g&&g<c?i={error:"LIMIT",limit:g,size:c}:(i=Trex.KEditor.blobUpload(a,d),i.size=c,i&&i.img_src||(i.img_src=f.result)),"LIMIT"==i.error?alert(Trex._I18N.g("image.upload_limit",Trex._getDisplayFileSize(i.size),Trex._getDisplayFileSize(i.limit),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(i.limit)+").")):a.editor.getCanvas().execute(function(b){var c=b.win.img({src:i.img_src,border:"0",className:""});b.pasteNodeCustom(c,a.editor.getCanvas(),h)})}),f.readAsDataURL(e)}}b.preventDefault(),b.stopPropagation()},eventPaste:function(a,b,c){var d=this;c?(d.pasteCtrlV&&(clearTimeout(d.pasteCtrlV),d.pasteCtrlV=null),d.__eventPaste(a,b,c)):function(a,b,c){d.pasteCtrlV=setTimeout(function(){d.__eventPaste(a,b,c)},50)}(a,b,c)},__eventPaste:function(a,b,c){if(Trex.KEditor._clipboardProcess(a,b))b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0;else{var d=b.clipboardData;if(window.FormData&&d&&d.items&&d.items[0])for(var e=d.items,f=!0,g=0;g<e.length;g++)"file"==e[g].kind&&"string"==e[g].kind&&-1!=e[g].type.search(/text\/html/i)&&(f=!1);if(a.imageUploader&&a.imageUploader.isLoadComplete()&&!f){var h=a.imageUploader.getClipboardData();Trex.KEditor._controlClipboardProcess(a,h)&&(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}}},base64ImageUpload:function(a){var b=$.Deferred();try{if(null!=window.Blob&&null!=window.atob&&null!=window.FormData&&null!=window.Uint8Array){var c=a.getDom(),d=/data\:(image\/[^;]+)\;base64\,/i;$.each($("img[src]",c),function(b,c){var e=c.src;if(d.test(e)){var f=e.substring(0,e.indexOf(",")),g=e.substring(e.indexOf(",")+1),h=f.split(":")[1].split(";")[0],i=Trex.KEditor.base64ToBlob(g,h),j=Trex.KEditor.blobUpload(a,i);j&&j.img_src&&(c.src=j.img_src);try{g="",g=null,delete i,i=null,delete j,j=null}catch(a){}}})}b.resolve(!0,null)}catch(a){b.resolve(!1,a)}return b.promise()},externalImageUpload:function(a){var b=$.Deferred();try{var c=a.getDom();if(null!=window.Blob&&null!=window.atob&&null!=window.FormData&&null!=window.Uint8Array){var d={},e=!1;$.each($("img[src]",c),function(b,c){var f=c.src;a._checkExternalImage(f)?(null==d[f]&&(d[f]=[]),d[f].push(c),e=!0):(c.width=c.width,c.height=c.height)}),e?Trex.KEditor._externalImageUpload(a,d,b):b.resolve(!0,null)}else a.imageUploader&&a.imageUploader.isLoadComplete()?(a.imageUploader.uploadImage(a,c),b.resolve(!0,null)):b.resolve(!1,null)}catch(a){b.resolve(!1,a)}return b.promise()},_externalImageUpload:function(a,b,c){var d=[],e={},f={};for(var g in b){var h=Trex.KEditor._getBlob(g).then(function(c,d){var g=null;try{g=Trex.KEditor.blobUpload(a,c)}catch(a){}if(g)try{var h=b[d];if(e[g.imageName]=h,null!=h)for(var i=0;i<h.length;i++)f[g.imageName]=g.img_src}catch(a){}return $.Deferred().resolve()},function(a,b){return $.Deferred().resolve()});d.push(h)}$.when.apply($,d).always(function(){try{var a={uploadedImage:f,uploadId:e};for(var b in a.uploadedImage){var d=a.uploadId[b];if(null!=d)for(var g=0;g<d.length;g++)d[g].removeAttribute("id"),d[g].src=a.uploadedImage[b]}c.resolve(!0,null)}catch(a){c.resolve(!1,a)}})},_getBlob:function(a){var b=$.Deferred();try{var c=new XMLHttpRequest;c.onload=function(){4==c.readyState&&200==c.status?b.resolve(c.response,a):b.reject(null)},c.onerror=function(c){b.reject(c,a)},c.open("GET",a.replace(/\:\/\/[^\/]+\//,"://"+document.location.host+"/"),!0),c.responseType="blob",c.send()}catch(c){b.reject(c,a)}return b.promise()},blobUpload:function(a,b){var c=(b.type.split("/")[1]||"").toLowerCase(),d="gif";"gif"==c?d="gif":"jpg"==c||"jpeg"==c?d="jpg":"png"==c?d="png":""!=c&&(d=c);var e=a._getUploadImageInfo("",b.type,d,"blob");e.postdata||(e.postdata={}),e.type||e.type,e.fieldname||(e.fieldname="%%File");var f=(e.cid,e.name),g=e.url;if(""==g)return null;var h=(e.host,new FormData);"domino"==e.type&&(h.append("__Click","0"),h.append("%%PostCharset","UTF-8"),h.append("Body",""));for(var i in e.postdata)h.append(i,e.postdata[i]);h.append(e.fieldname,b,f);var j=g,k=new XMLHttpRequest;k.open("POST",j,!1),document.location.hostname&&"local.k-portal.co.kr"==document.location.hostname&&(k.withCredentials=!0);var l=null;return k.onreadystatechange=function(b){if(4===k.readyState)if(200===k.status){var c=k.responseText;l=a._parseUploadResponse(c,e,"blob")}else l={}},k.send(h),l},base64ToBlob:function(a,b,c){b=b||"",c=c||1024;for(var d=atob(a),e=[],f=0;f<d.length;f+=c){for(var g=d.slice(f,f+c),h=new Array(g.length),i=0;i<g.length;i++)h[i]=g.charCodeAt(i);var j=new Uint8Array(h);e.push(j);try{delete h,h=null,delete j,j=null}catch(a){}}var k=new Blob(e,{type:b});try{delete e,e=null,delete d,d=null,a="",a=null}catch(a){}return k},_regexps:{},_regexpHasStyleProps:function(a){var b=null;if(a&&a.join){var c=(a.join("\\s*:\\s*(\"[^\"]*\"|'[^']*'|[^;'\">]*)+?;?|")+"\\s*:\\s*(\"[^\"]*\"|'[^']*'|[^;'\">]*)+?;?").toLowerCase(),d=(a.join("\\s*:\\s*(\"[^\"]*\"|'[^']*'|[^;]*)+?;?|")+"\\s*:\\s*(\"[^\"]*\"|'[^']*'|[^;]*)+?;?").toLowerCase();b=Trex.KEditor._regexps["styleprops_"+c]?Trex.KEditor._regexps["styleprops_"+c]:Trex.KEditor._regexps["styleprops_"+c]={match:new RegExp("<[a-zA-Z]+\\s+[^>]*("+c+")[^>]*?>","ig"),replace:new RegExp("("+c+")","ig"),replace_prop:new RegExp("("+d+")","ig")}}return b},inlineStyle:function(a,b,c,d){var e=null;if(c&&c.join&&(e=Trex.KEditor._regexpHasStyleProps(c)),null==a&&null==e)return b;var f=null,g="";if(a){var h=/<style[^>]*>([\S*\s*]*?)<\/style[^>]*>/i,i=/<style[^>]*>([\S*\s*]*?)<\/style[^>]*>/gi,j=/[^\{\}]+\{([^\{\}]+\{[^\}]*?\})*\}/g,k=/([^\{\}]+)\{([^}]*?)\}/g,l=/([^\{\}]+)\{([^\}]*?)\}/i,m="",n=[];b=b.replace(i,"");for(var o=0;o<a.length;o++){var p=a[o].match(h);p&&(m+=p[1].replace(/<!--/g,"").replace(/-->/g,""))}m=m.replace(j,""),m=m.replace(/hairline/gi,"dotted"),m=m.replace(/\/\*[\S\s]*?\*\//gi,"");var q=m.match(k);if(null!=q)for(var o=0;o<q.length;o++){var r=q[o].match(l),s=r[1],t=r[2],u=s.split(/,/);try{e&&(t=t.replace(e.replace_prop,""))}catch(a){}if(t&&t.trim())for(var v=0;v<u.length;v++){var w=u[v].replace(/^\s+/g,"").replace(/\s+$/g,"");if("@"!=w.charAt(0)){var x=w.split(/\s/);x=x[x.length-1];var y=0;y=-1==x.indexOf(".")?"#"==x.charAt(0)?9e5:0:"#"==x.charAt(0)?91e4:1e5+1e3*(x.split(".").length-1),n.push({selector:w,css:t,weight:y}),d&&w&&"body"==w.toLowerCase()&&(g+=(g?";":"")+t)}}}f=$("<div>"+b+"</div>");for(var o=0;o<n.length;o++){var z=n[o],A=null;try{A=$(z.selector,f)}catch(a){A=null}A&&$.each(A,function(){var a=$(this);a.addClass("_inline_style");var b=a.data("__style")||[];b.push(z),a.data("__style",b)})}if($.each($("._inline_style",f),function(){for(var a=$(this),b=a.attr("style")||"",c=a.data("__style"),d=c.sort(function(a,b){return a.weight>b.weight?1:a.weight==b.weight?0:-1}),e="",f=0;f<d.length;f++)e+=(e?";":"")+d[f].css;-1!=e.indexOf("border")&&-1!=b.search(/border\s*:\s*currentColor\s*;?/gi)&&(b=b.replace(/border\s*:\s*currentColor\s*;?/gi,"")),e+=(e?";":"")+b,e=e.replace(/;;/g,";"),e=e.replace(/; ;/g,";").replace(/\"/g,"&quot;");var g=e.split(";"),h=new Object;for(f=0;f<g.length;f++){var i=g[f].split(":");""!=i[0]&&void 0!=i[1]&&(h[$.trim(i[0])]=$.trim(i[0])+":"+i[1])}e=Object.keys(h).map(function(a){return h[a]}).join(";"),a.attr("style",e)}),g){for(var B=g.replace(/\s*;\s*;\s*/g,";").split(";"),o=0;o<B.length;o++)-1!=B[o].search(/(margin|padding|float\s*:|position|clear|height\s*:|width\s*:|left\s*:|right\s*:|bottom\s*:|top\s*:|overflow|display\s*:|visibility\s*:)/i)&&(B[o]="");g=B.join(";").replace(/;;/g,";")+";margin:0;padding:0"}g&&1==f.children().length&&(f.children().each(function(){var a=g+";"+$(this).css("cssText");a=a.replace(/;;/g,";"),$(this).attr("style",a)}),g="")}return f&&($("[class], [id]",f).removeAttr("class").removeAttr("id"),b=f.html()),e&&e.match.test(b)&&(b=b.replace(e.match,function(a){return a.replace(e.replace,"")})),g&&(b='<div style="'+g.replace(/"/g,"")+'">'+b+"</div>"),b},cleanupHTML:function(html,removeEmptyTag,reReq){var _html=html,hasRemoveTag=0;if(!1!==removeEmptyTag)for(var emptyTags=/<(p|span|strike|u|i|em|b|strong|font)[^>a-zA-Z]*?><\/\1[^>a-zA-Z]*?>/gi,limit_empty=10;-1!=_html.search(emptyTags)&&!(--limit_empty<0);)_html=_html.replace(emptyTags,"");var attrKey="REMOVE_TAG"+(new Date).getTime().toString(16),__compact=_html.replace(/((<(span[^>]*?>|strike>|u>|i>|em>|b>|strong>|(strike|u|i|em|b|strong)\s+[^>]*?>)\s*){2,}|((<div>|<div\s+[^>]*?>)\s*){2,})/gi,function(a,b){var c=b.split(">"),d=c.pop();c[c.length-1]+=">";for(var e=0;e<c.length-1;e++)c[e]+=" "+attrKey,c[e]+=">",hasRemoveTag++;return c.join("")+d}),needRecheck=!1;if(hasRemoveTag>0){var _compact=$("<div></div>");_compact.html(__compact);for(var _m=$("["+attrKey+"]",_compact),ii=_m.length-1;ii>=0;ii--){var _item=_m[ii];if(1==_item.nodeType&&_item.childNodes&&1==_item.childNodes.length)if(("SPAN"!=_item.childNodes[0].nodeName||"DIV"==_item.nodeName)&&"DIV"!=_item.childNodes[0].nodeName||"STRIKE"==_item.nodeName||"U"==_item.nodeName||"I"==_item.nodeName||"EM"==_item.nodeName||""!=_item.style.position&&""!=_item.childNodes[0].style.position){if("STRIKE"==_item.nodeName||"U"==_item.nodeName||"I"==_item.nodeName||"EM"==_item.nodeName||"B"==_item.nodeName||"STRONG"==_item.nodeName){for(var _loop=_item.childNodes[0],_limit_l=10,_dupl=!1;_loop&&!(--_limit_l<0);){var _work=_loop;if(_work.nodeName==_item.nodeName){_dupl=!0;break}1==_work.childNodes.length&&(_loop=_work.childNodes[0])}if(_dupl){for(var _parent=_item.parentNode;_item.firstChild;)_parent.insertBefore(_item.firstChild,_item);_parent.removeChild(_item)}}}else{_item.childNodes[0].style.cssText=("B"==_item.nodeName||"STRONG"==_item.nodeName?"font-weight:bold":_item.style.cssText)+";"+_item.childNodes[0].style.cssText;for(var _parent=_item.parentNode;_item.firstChild;)_parent.insertBefore(_item.firstChild,_item);_parent.removeChild(_item)}}var replaceAttrKey=eval("/"+attrKey+'(="")?/gi');_html=_compact.html().replace(replaceAttrKey,"")}return _html}},Trex.KEditor.ImageResizeCtrl=function(a,b){var c=this;this.editor=a,this.canvas=b,this.isActive=!1,this.isResize=!1,this.resizeType="",this.pos={x:0,y:0},this.origin={width:0,height:0},this.work={width:0,height:0},this.activeElement=null,this.wrapper=null,this.htmlBody=this.canvas.panels.html.el.contentWindow.document.body,$tx.msie&&this.htmlBody.addEventListener("mscontrolselect",function(a){"IMG"==$tx.element(a).tagName&&null==c.enableControl&&a.preventDefault()}),b.observeJob(Trex.Ev.__CANVAS_PANEL_KEYDOWN,function(a){c.keyDown(a)}),b.observeJob(Trex.Ev.__CANVAS_PANEL_KEYUP,function(a){c.keyUp(a)}),b.observeJob(Trex.Ev.__CANVAS_PANEL_CLICK,function(a){c.mouseClick(a)}),b.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEDOWN,function(a){c.mouseDown(a)}),b.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEMOVE,function(a){c.mouseMove(a)}),b.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEUP,function(a){c.mouseUp(a)}),b.observeJob(Trex.Ev.__CANVAS_PANEL_BLUR,function(a){c.blur(a)})},Trex.KEditor.ImageResizeCtrl.prototype={mouseClick:function(a){var b=$tx.element(a),c=b&&b.tagName?b.tagName.toLowerCase():"";if("img"==c){if(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,this.isActive&&this.activeElement!==b&&this.clearWrapper(this.activeElement),this.isActive||this.wrapping(b),this.isActive,$tx.chrome){var d=this.htmlBody.ownerDocument.getSelection();d.removeAllRanges()}}else"div"==c&&$(b).is(".ke-img.drag")||("div"==c&&($(b).is(".ke-img.inner-wrapper")||$(b).is(".ke-img.inner-comment"))?(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0):this.isActive&&this.activeElement!==b&&this.clearWrapper(this.activeElement))},mouseDown:function(a){var b=$tx.element(a);if("div"==(b&&b.tagName?b.tagName.toLowerCase():"")&&$(b).is(".ke-img.drag"))try{this.activeElement,this.pos.x=a.clientX,this.pos.y=a.clientY,this.resizeType=b.getAttribute("keType")||"tl",this.isResize=!0,this.wrapper.addClass("resize").removeClass("tl tc tr lm rm bl bc br").addClass(this.resizeType),this._size_offset=this["_size_"+this.resizeType]}catch(a){return void this.clearAll()}},_size:function(a,b,c){var d,e,f=this._size_offset(a,b,c);return d=this.work.width-0+f.x,e=this.work.height-0+f.y,d<0?(this.pos.x=a.clientX-d*f.ox,d=0):this.pos.x=a.clientX,e<0?(this.pos.y=a.clientY-e*f.oy,e=0):this.pos.y=a.clientY,c&&(d>e?e="":d=""),this.work.width=d,this.work.height=e,{w:d,h:e}},_size_tl:function(a,b,c){var d=0,e=0;return d=this.pos.x-a.clientX,e=this.pos.y-a.clientY,{x:d,y:e,ox:-1,oy:-1}},_size_tc:function(a,b,c){var d=0,e=0;return d=0,e=this.pos.y-a.clientY,{x:d,y:e,ox:1,oy:-1}},_size_tr:function(a,b,c){var d=0,e=0;return d=a.clientX-this.pos.x,e=this.pos.y-a.clientY,{x:d,y:e,ox:1,oy:-1}},_size_lm:function(a,b,c){var d=0,e=0;return d=this.pos.x-a.clientX,e=0,{x:d,y:e,ox:-1,oy:1}},_size_rm:function(a,b,c){var d=0,e=0;return d=a.clientX-this.pos.x,e=0,{x:d,y:e,ox:1,oy:1}},_size_bl:function(a,b,c){var d=0,e=0;return d=this.pos.x-a.clientX,e=a.clientY-this.pos.y,{x:d,y:e,ox:-1,oy:1}},_size_bc:function(a,b,c){var d=0,e=0;return d=0,e=a.clientY-this.pos.y,{x:d,y:e,ox:1,oy:1}},_size_br:function(a,b,c){var d=0,e=0;return d=a.clientX-this.pos.x,e=a.clientY-this.pos.y,{x:d,y:e,ox:1,oy:1}},mouseMove:function(a){if(this.isActive&&this.isResize){var b=this;if("1"!=a.buttons)return void b.mouseUp();try{var c=b.activeElement,d=b._size(a,c,a.shiftKey);b._resize(c,d)}catch(a){return void b.clearAll()}}},_resize:function(a,b){""===b.w?a.removeAttribute("width"):a.width=b.w,""===b.h?a.removeAttribute("height"):a.height=b.h,a.width=a.width,a.height=a.height,this.wrapper.css={width:a.width+"px",height:a.height+"px"},this._hasResize=!0,this.displaySize()},mouseUp:function(){if(this.isActive&&this.isResize){if(this.isResize=!1,this.wrapper.removeClass("resize").removeClass("tl tc tr lm rm bl bc br"),this._hasResize){var a=this.activeElement;this.clearWrapper(this.activeElement),(""!==this.work.width&&this.work.width<10||""!==this.work.height&&this.work.height<10)&&this._resize(a,{w:""!==this.work.width&&this.work.width<10?10:this.work.width,h:""!==this.work.height&&this.work.height<10?10:this.work.height}),this.canvas.history.saveHistory(),this.wrapping(a)}this._hasResize=!1}},keyDown:function(a){function b(a){var b=c.activeElement;if(c.clearWrapper(c.activeElement),c.enableControl=b,$tx.msie){var d=c.htmlBody.createControlRange();d.add(b),d.select()}else{var d=c.htmlBody.ownerDocument.createRange();d.selectNode(b);var e=c.htmlBody.ownerDocument.getSelection();e.removeAllRanges(),e.addRange(d)}!1===a&&(c.enableControl=null)}if(this.isActive){var c=this;if(this.activeElement){var d=this.activeElement;38==a.keyCode?a.altKey?(this._resize(this.activeElement,{w:a.shiftKey?"":d.width-0,h:d.height-0-1}),a.preventDefault?a.preventDefault():a.returnValue=!1):b(!1):40==a.keyCode?a.altKey?(this._resize(this.activeElement,{w:a.shiftKey?"":d.width-0,h:d.height-0+1}),a.preventDefault?a.preventDefault():a.returnValue=!1):b(!1):37==a.keyCode?a.altKey?(this._resize(this.activeElement,{w:d.width-0-1,h:a.shiftKey?"":d.height-0}),a.preventDefault?a.preventDefault():a.returnValue=!1):b(!1):39==a.keyCode?a.altKey?(this._resize(this.activeElement,{w:d.width-0+1,h:a.shiftKey?"":d.height-0}),a.preventDefault?a.preventDefault():a.returnValue=!1):b(!1):16==a.keyCode||a.shiftKey||(a.keyCode==Trex.__KEY.DELETE?this.clearWrapper(this.activeElement,!0):a.ctrlKey?b():a.altKey||this.clearWrapper(this.activeElement))}}},keyUp:function(a){if(this.enableControl){var b=this.enableControl;if(this.enableControl=null,this.htmlBody.focus(),this.wrapping(b),b.focus(),$tx.chrome){this.htmlBody.ownerDocument.getSelection().removeAllRanges()}}},blur:function(a){this.activeElement&&this.clearWrapper(this.activeElement)},changeMode:function(){this.activeElement&&this.clearWrapper(this.activeElement)},displaySize:function(a){$(".ke-img.inner-comment",this.wrapper).html(this.activeElement.width+"x"+this.activeElement.height)},wrapping:function(a){var b=this.canvas.panels.html.wysiwygDoc,c=b.body,d=c.parentNode,e=c.scrollWidth==d.scrollLeft+d.offsetWidth,f=this.activeElement=a;this.work.width=this.origin.width=f.width=f.width,this.work.height=this.origin.height=f.height=f.height,f.style.width=null,f.style.height=null,this.isActive=!0;var g=$(f)[0],h=g.style.cssText;$(f).wrap('<div class="ke-img wrapper" contenteditable="false" unselectable="on"></div>'),this.wrapper=$(this.activeElement).parent(),this.wrapper[0].style.cssText=h,this.wrapper.css={width:this.origin.width+"px",height:this.origin.height+"px"},this.wrapper[0].setCSS="true",g.style.cssText="",this.wrapper.append('<div class="ke-img drag tl" keType="tl" unselectable="on"></div><div class="ke-img drag tc" keType="tc" unselectable="on"></div><div class="ke-img drag tr" keType="tr" unselectable="on"></div><div class="ke-img drag lm" keType="lm" unselectable="on"></div><div class="ke-img drag rm" keType="rm" unselectable="on"></div><div class="ke-img drag bl" keType="bl" unselectable="on"></div><div class="ke-img drag bc" keType="bc" unselectable="on"></div><div class="ke-img drag br" keType="br" unselectable="on"></div><div class="ke-img inner-comment" unselectable="on"></div>'),this.displaySize(),e&&(d.scrollLeft=c.scrollWidth)},clearAll:function(){var a=this.editor.getCanvas().getPanel("html").getDocument(),b=this;$(".ke-img.wrapper img",a).each(function(a,c){b.clearWrapper(c)})},clearWrapper:function(a,b){$(a).parent().is("div.ke-img.wrapper")&&("true"==this.wrapper[0].setCSS&&(a.style.cssText=this.wrapper[0].style.cssText),$("div.ke-img",this.wrapper).remove(),a&&$(a).unwrap(),b&&$(this.activeElement).remove(),this.wrapper=null,this.activeElement=null,this.isActive=!1)}},function(a){function b(a){for(var b=a;b.$reference;)b=b.$reference;return b}function c(a){var c=a.constructor.superclass;if(c){var d=c.prototype.initialize;c.prototype.initialize=function(){this.$reference=a};var e=new c;c.prototype.initialize=d;var f={};for(var g in e)"$"!=g.charAt(0)&&"function"==typeof e[g]&&(f[g]=function(c){return e[c]?function(){var d=arguments,f=b(a),g=f.$super;f.$super=e.$super;var h=e[c].apply(f,d);return f.$super=g,h}:_NULL}(g));a.$super=f}}a.Class={create:function(b){var d=function(){var a=this.constructor.prototype;for(var b in a)a[b]&&"object"==typeof a[b]&&(a[b].constructor==Array?this[b]=[].concat(a[b]):this[b]=Object.extend({},a[b]));c(this);var d=arguments;this.initialize.apply(this,d)};return a.Class.draft(b,d)},draft:function(a,b){var d=b||function(){c(this)};if(a.$const&&Object.extend(d,a.$const),a.$extend&&(Object.extend(d.prototype,a.$extend.prototype),d.superclass=a.$extend),a.$mixins){$A(a.$mixins).each(function(a){Object.extend(d.prototype,a)})}for(var e in a)"$"!=e.charAt(0)&&(d.prototype[e]=a[e]);return d},overwrite:function(a,b){return a.prototype&&Object.extend(a.prototype,b),a}},a.Mixin=a.Faculty={create:function(a){var b={};for(var c in a)a[c]&&"object"==typeof a[c]?a[c].constructor==Array?b[c]=[].concat(a[c]):b[c]=Object.extend({},a[c]):b[c]=a[c];return b},toClass:function(b,c){return a.Class.create(Object.extend({initialize:c||function(){}},b))}}}(Trex),function(a){Object.extend(a,{installs:[],registers:[],modules:[],modulesX:[],install:function(b,c){c.desc="[install] "+b,a.installs.push(c)},register:function(b,c){c.desc="[register] "+b,a.registers.push(c)},module:function(b,c){c.desc="[module] "+b,a.modules.push(c)},moduleX:function(b,c){c.desc="[moduleX] "+b,a.modulesX.push(c)},invoke:function(a,b,c,d,e,f){for(var g=0,h=a.length;g<h;g++){(0,a[g])(b,c,d,e,f)}},
invokeInstallation:function(b,c,d,e,f){a.invoke(a.installs,b,c,d,e,f)},invokeRegisters:function(b,c,d,e,f){a.invoke(a.registers,b,c,d,e,f)},invokeModules:function(b,c,d,e,f){a.invoke(a.modules,b,c,d,e,f)},group:function(){},groupEnd:function(){}})}(Trex),_WIN.Trex=Trex,function(a){a.Ev={__EDITOR_PANEL_MOUSEDOWN:"editor.panel.mousedown",__EDITOR_LOAD_DATA_BEGIN:"editor.load.data.begin",__EDITOR_LOAD_DATA_END:"editor.load.data.end",__CANVAS_PANEL_KEYDOWN:"canvas.panel.keydown",__CANVAS_PANEL_KEYUP:"canvas.panel.keyup",__CANVAS_PANEL_MOUSEDOWN:"canvas.panel.mousedown",__CANVAS_PANEL_MOUSEUP:"canvas.panel.mouseup",__CANVAS_PANEL_MOUSEOVER:"canvas.panel.mouseover",__CANVAS_PANEL_MOUSEOUT:"canvas.panel.mouseout",__CANVAS_PANEL_BLUR:"canvas.panel.blur",__CANVAS_PANEL_MOUSEMOVE:"canvas.panel.mousemove",__CANVAS_PANEL_CLICK:"canvas.panel.click",__CANVAS_PANEL_DBLCLICK:"canvas.panel.dbclick",__CANVAS_PANEL_PASTE:"canvas.panel.paste",__CANVAS_PANEL_PASTE_CUSTOM:"canvas.panel.paste.custom",__CANVAS_PANEL_PASTE_CUSTOM_KEY:"canvas.panel.paste.custom.key",__CANVAS_PANEL_DROP:"canvas.panel.drop",__CANVAS_PANEL_FOCUS:"canvas.panel.focus",__CANVAS_PANEL_SCROLLING:"canvas.panel.scrolling",__IFRAME_LOAD_COMPLETE:"iframe.load.complete",__IFRAME_LOADING_TIME:"iframe.loading.time",__CANVAS_SOURCE_PANEL_CLICK:"canvas.source.panel.click",__CANVAS_SOURCE_PANEL_KEYDOWN:"canvas.source.panel.mousedown",__CANVAS_SOURCE_PANEL_MOUSEDOWN:"canvas.source.panel.mousedown",__CANVAS_TEXT_PANEL_CLICK:"canvas.text.panel.click",__CANVAS_MODE_CHANGE:"canvas.mode.change",__CANVAS_FULL_SCREEN_CHANGE:"canvas.fullscreen.change",__CANVAS_NORMAL_SCREEN_CHANGE:"canvas.normalscreen.change",__CANVAS_CONTEXTMENU_SHOW:"canvas.contextmenu.show",__TOOL_CLICK:"toolbar.button.click",__TOOL_SHORTCUT_KEY:"toolbar.shortcut",__CONTEXTMENU_CLICK:"contextmenu.click",__ON_SUBMIT:"editor.submit",__CANVAS_WRAP_WIDTH_CHANGE:"canvas.wrap.width.change",__CANVAS_HEIGHT_CHANGE:"canvas.height.change",__CANVAS_PANEL_QUERY_STATUS:"canvas.panel.style.change",__CANVAS_PANEL_DELETE_SOMETHING:"canvas.panel.delkey.press",__ENTRYBOX_ENTRY_ADDED:"entrybox.entryadded",__CANVAS_PANEL_BACKSPACE_TABLE:"canvas.panel.backspace.table",__ENTRYBOX_ENTRY_MODIFIED:"entrybox.entrymodified",__ENTRYBOX_ENTRY_REMOVED:"entrybox.entryremoved",__ENTRYBOX_ALL_ENTRY_REMOVED:"entrybox.removed.all.perfectly",__ENTRYBOX_CAPACITY_UPDATE:"entrybox.capacity.update",__ATTACHBOX_SHOW:"attachbox.show",__ATTACHBOX_HIDE:"attachbox.hide",__ATTACHBOX_FULLSCREEN_SHOW:"attachbox.fullscreen.show",__ATTACHBOX_FULLSCREEN_HIDE:"attachbox.fullscreen.hide",__CANVAS_BEFORE_UNLOAD:"canvas.unload",__CANVAS_ENTRY_ADDED:"canvas.entry.added",__COMMAND_NODE_ADDED:"cmd.entry.added",__CMD_ALIGN_LEFT:"align.left",__CMD_ALIGN_CENTER:"align.center",__CMD_ALIGN_RIGHT:"align.right",__CMD_ALIGN_FULL:"align.full",__CMD_ALIGN_IMG_LEFT:"align.img.left",__CMD_ALIGN_IMG_CENTER:"align.img.center",__CMD_ALIGN_IMG_FLOAT_LEFT:"align.img.floatleft",__CMD_ALIGN_IMG_FLOAT_RIGHT:"align.img.floatright",__CMD_ADVANCED_FOLD:"toolbar.advanced.fold",__CMD_ADVANCED_SPREAD:"toolbar.advanced.spread",__TOOL_CELL_LINE_CHANGE:"tool.cell.line.change",__CANVAS_MODE_INITIALIZE:"canvas.mode.initialize",__CANVAS_DATA_INITIALIZE:"canvas.load.data",__ENTRYBOX_ENTRY_REFRESH:"entrybox.entryrefresh",__PASTE_SEARCHRESULT:"trex.paste.info",__RUNTIME_EXCEPTION:"editor.runtime.exception",__REPORT_TO_MAGPIE:"editor.report.magpie",__SHOULD_CLOSE_MENUS:"editor.shouldclosemenus",__CANVAS_IMAGE_PLACEHOLDER_DBLCLICK:"canvas.image.placeholder.dbclick",__MENU_LAYER_SHOW:"menu.layer.show",__MENU_LAYER_HIDE:"menu.layer.hide",__MENU_LAYER_CHANGE_SIZE:"menu.layer.change.size"}}(Trex);var TrexEvent={fire:function(a,b){if(a&&a.tagName){var c=b[a.tagName.toLowerCase()];c?c(a,b):TrexEvent.propagateToParent(a,b)}},propagateToParent:function(a,b){var c=a.parentNode;if(c&&c.tagName&&c.tagName.toLowerCase){var d=b[c.tagName.toLowerCase()];d?d(c,b):TrexEvent.propagateToParent(c,b)}},stopPropagation:function(){}},textboxOption=function(a,b,c,d){return{data:a,style:{padding:b,backgroundColor:c,border:d}}};Trex.__CONFIG_COMMON={thumbs:{options:[{color:"#FF0000"},{color:"#FF5E00"},{color:"#FFBB00"},{color:"#FFE400"},{color:"#ABF200"},{color:"#1FDA11"},{color:"#00D8FF"},{color:"#0055FF"},{color:"#0900FF"},{color:"#6600FF"},{color:"#FF00DD"},{color:"#FF007F"},{color:"#000000"},{color:"#FFFFFF"},{color:"#FFD8D8"},{color:"#FAE0D4"},{color:"#FAECC5"},{color:"#FAF4C0"},{color:"#E4F7BA"},{color:"#CEFBC9"},{color:"#D4F4FA"},{color:"#D9E5FF"},{color:"#DAD9FF"},{color:"#E8D9FF"},{color:"#FFD9FA"},{color:"#FFD9EC"},{color:"#F6F6F6"},{color:"#EAEAEA"},{color:"#FFA7A7"},{color:"#FFC19E"},{color:"#FFE08C"},{color:"#FAED7D"},{color:"#CEF279"},{color:"#B7F0B1"},{color:"#B2EBF4"},{color:"#B2CCFF"},{color:"#B5B2FF"},{color:"#D1B2FF"},{color:"#FFB2F5"},{color:"#FFB2D9"},{color:"#D5D5D5"},{color:"#BDBDBD"},{color:"#F15F5F"},{color:"#F29661"},{color:"#F2CB61"},{color:"#E5D85C"},{color:"#BCE55C"},{color:"#86E57F"},{color:"#5CD1E5"},{color:"#6699FF"},{color:"#6B66FF"},{color:"#A366FF"},{color:"#F261DF"},{color:"#F261AA"},{color:"#A6A6A6"},{color:"#8C8C8C"},{color:"#CC3D3D"},{color:"#CC723D"},{color:"#CCA63D"},{color:"#C4B73B"},{color:"#9FC93C"},{color:"#47C83E"},{color:"#3DB7CC"},{color:"#4174D9"},{color:"#4641D9"},{color:"#7E41D9"},{color:"#D941C5"},{color:"#D9418D"},{color:"#747474"},{color:"#5D5D5D"},{color:"#980000"},{color:"#993800"},{color:"#997000"},{color:"#998A00"},{color:"#6B9900"},{color:"#2F9D27"},{color:"#008299"},{color:"#003399"},{color:"#050099"},{color:"#3D0099"},{color:"#990085"},{color:"#99004C"},{color:"#4C4C4C"},{color:"#353535"},{color:"#670000"},{color:"#662500"},{color:"#664B00"},{color:"#665C00"},{color:"#476600"},{color:"#22741C"},{color:"#005766"},{color:"#002266"},{color:"#030066"},{color:"#290066"},{color:"#660058"},{color:"#660033"},{color:"#212121"},{color:"#000000"}],transparent:{color:"transparent",border:"#999999",image:"#iconpath/ic_transparent4.gif?open&v=2",thumb:"#iconpath/txt_transparent.gif?open&v=2",thumbImage:"#iconpath/color_transparent_prev.gif?open&v=2"}},textbox:{options:[textboxOption("txc-textbox1","10px","#ffffff","1px solid #f7f7f7"),textboxOption("txc-textbox2","10px","#eeeeee","1px solid #eeeeee"),textboxOption("txc-textbox3","10px","#fefeb8","1px solid #fefeb8"),textboxOption("txc-textbox4","10px","#fedec7","1px solid #fedec7"),textboxOption("txc-textbox5","10px","#e7fdb5","1px solid #e7fdb5"),textboxOption("txc-textbox6","10px","#dbe8fb","1px solid #dbe8fb"),textboxOption("txc-textbox7","10px","#ffffff","1px dashed #cbcbcb"),textboxOption("txc-textbox8","10px","#eeeeee","1px dashed #c1c1c1"),textboxOption("txc-textbox9","10px","#fefeb8","1px dashed #f3c534"),textboxOption("txc-textbox10","10px","#fedec7","1px dashed #fe8943"),textboxOption("txc-textbox11","10px","#e7fdb5","1px dashed #9fd331"),textboxOption("txc-textbox12","10px","#dbe8fb","1px dashed #79a5e4"),textboxOption("txc-textbox13","10px","#ffffff","1px solid #cbcbcb"),textboxOption("txc-textbox14","10px","#eeeeee","1px solid #c1c1c1"),textboxOption("txc-textbox15","10px","#fefeb8","1px solid #f3c534"),textboxOption("txc-textbox16","10px","#fedec7","1px solid #fe8943"),textboxOption("txc-textbox17","10px","#e7fdb5","1px solid #9fd331"),textboxOption("txc-textbox18","10px","#dbe8fb","1px solid #79a5e4"),textboxOption("txc-textbox19","10px","#ffffff","3px double #cbcbcb"),textboxOption("txc-textbox20","10px","#eeeeee","3px double #c1c1c1"),textboxOption("txc-textbox21","10px","#fefeb8","3px double #f3c534"),textboxOption("txc-textbox22","10px","#fedec7","3px double #fe8943"),textboxOption("txc-textbox23","10px","#e7fdb5","3px double #9fd331"),textboxOption("txc-textbox24","10px","#dbe8fb","3px double #79a5e4")]}};var TrexConfig=function(){var a=_FALSE,b=[],c={},d={wrapper:"tx_trex_container",form:"tx_editor_form",txIconPath:"images/icon/editor/",txDecoPath:"images/deco/contents/",params:[],events:{preventUnload:_TRUE,useHotKey:_TRUE},save:{},adaptor:{},toolbar:{},sidebar:{attachbox:{},embeder:{},attacher:{},searcher:{}},contextmenu:{},plugin:{}},e=function(b,d){if(a)throw new Error("configure is already setup (addParameter)");c[b]=d},f={getUrl:function(a,b){if("string"!=typeof a)return a;var e=_WIN.EditorJSLoader||opener&&opener.EditorJSLoader||PopupUtil&&PopupUtil.getOpener().EditorJSLoader;a=a.replace(/#host#path\/pages\//g,e.getPageBasePath()),a=a.replace(/#host/g,d.txHost),a=a.replace(/#path\/?/g,d.txPath),a=a.replace(/#imageeditorpath/g,d.imageEditorPath);for(var f in c)a=a.replace(new RegExp("#".concat(f),"g"),d[c[f]]);if(b)for(var g in b)a=a.replace(new RegExp("#".concat(g),"g"),b[g]);return a},getPopFeatures:function(a){if(a==_NULL)return _NULL;if("string"==typeof a)return a;var b=[];return["toolbar","location","directories","menubar"].each(function(c){b.push(c+"="+(a[c]||"no"))}),["scrollbars","resizable"].each(function(c){b.push(c+"="+(a[c]||"yes"))}),["width","height"].each(function(c){b.push(c+"="+(a[c]||"500"))}),["left","top"].each(function(c){b.push(c+"="+(a[c]||"100"))}),b.join(",")},getDecoPath:function(a){return a.replace(/#decopath\/?/,this.getUrl(d.txDecoPath))},getIconPath:function(a){return a.replace(/#iconpath\/?/,this.getUrl(d.txIconPath))},setup:function(c){$tx.deepcopy(d,c),d.params.each(function(a){e(a,a)}),b.each(function(a){a(d)}),a=_TRUE,this.setupVersion();var f={};return $tx.deepcopy(f,d),f},setupVersion:function(){d.txVersion=Editor.version},addParameter:function(a,b){e(a,b)},clone:function(a){return $tx.deepcopy({},a)},merge:function(){var a={};return $A(arguments).each(function(b){$tx.deepcopy(a,b)}),a}};f.add=function(c,e){if(a)throw new Error("configure is already setup (mergeConfig)");$tx.deepcopy(d,c),e&&b.push(e)},f.get=function(a){return d[a]};var g=function(c,d,e){if(a)throw new Error("configure is already setup (mergeConfig)");this[c]=this[c]||{},$tx.deepcopy(this[c],d),e&&b.push(e)},h=function(a){return this[a]},i=function(){return{Tool:d.toolbar,Sidebar:d.sidebar,Plugin:d.plugin,Adaptor:d.adaptor,Save:d.save,Attacher:d.sidebar.attacher,Embeder:d.sidebar.embeder,Searcher:d.sidebar.searcher,ContextMenu:d.contextmenu}}();for(var j in i)f["add"+j]=g.bind(i[j]),f["get"+j]=h.bind(i[j]);return f}();_WIN.TrexConfig=TrexConfig;var TrexMessage=function(){function a(a){return a.indexOf("#iconpath")>-1?TrexConfig.getIconPath(a):a}function b(a){return a.indexOf("#decopath")>-1?TrexConfig.getDecoPath(a):a}var c={};return{getMsg:function(d){return a(b(c[d]||""))},addMsg:function(a){$tx.deepcopy(c,a)},printAll:function(){for(var a in c)c.hasOwnProperty(a)}}}();_WIN.TXMSG=TrexMessage.getMsg,_WIN.TrexMessage=TrexMessage;var EditorConfigBuilder=function(a){this.config=a||{}};EditorConfigBuilder.prototype.set=function(a,b){for(var c=a.split("."),d=c[c.length-1],e=this.config,f=0;f<c.length-1;f++){var g=c[f];e[g]||(e[g]={}),e=e[g]}$tx.isPrimitiveType(b)?e[d]=b:(e[d]||(e[d]={}),$tx.deepcopy(e[d],b))},EditorConfigBuilder.prototype.getConfig=function(){return this.config},_WIN.EditorConfigBuilder=EditorConfigBuilder,Trex.MarkupTemplate={},function(){var a={};Trex.define(Trex.MarkupTemplate,{add:function(b,c){a[b]=c},get:function(b){if(!a[b])return{evaluate:function(){return""},evaluateToDom:function(){return""}};if("string"==typeof a[b]){var c=a[b].replace(/@[\w\.]+/g,function(a){return TXMSG(a)});a[b]=new Template(c)}return a[b]},splitList:function(a,b,c){for(var d={row:[]},e=c.length,f=d.row,g=0;g<a;g++){f.push({col:[]});for(var h=f.last().col,i=0;i<b;i++){var j={image:"",data:"&nbsp;",klass:""};g*b+i<e&&("string"==typeof c[g*b+i]?j.data=c[g*b+i]:j=Object.extend(j,c[g*b+i])),h.push(j)}}return d}})}();var $tom={};!function(){function a(a){var b={};return a.split(",").each(function(a){if(c[a])for(var d in c[a])b[d]=_TRUE;else b[a]=_TRUE}),b}var b={"%body":["body"],"%text":["#text","br"],"%element":["#element"],"%control":["img","object","hr","table","button","iframe"],"%inline":["span","font","u","i","b","em","strong","big","small","a","sub","sup","span"],"%block":["p","div","ul","ol","h1","h2","h3","h4","h5","h6","pre","dl","hr","table","button"],"%paragraph":["p","li","dd","dt","h1","h2","h3","h4","h5","h6","td","th","div","caption"],"%wrapper":["div","ul","ol","dl","pre","xmp","table","button","blockquote"],"%innergroup":["li","dd","dt","td","th"],"%outergroup":["ul","ol","dl","tr","tbody","thead","tfoot","table"],"%tablegroup":["td","th","tr","tbody","thead","tfoot","table"],"%listgroup":["li","ul","ol"],"%datagroup":["dd","dt","dl"],"%listhead":["ul","ol"]},c={};for(var d in b)c[d]={},b[d]&&$A(b[d]).each(function(a){c[d][a]=_TRUE});var e=Trex.Class.create({initialize:function(b){this.patterns=b,this.map=a(b)},hasParts:function(){return this.patterns.length>0},include:function(b){var c=a(b);for(var d in c)if(this.map[d])return _TRUE;return _FALSE},memberOf:function(b){var c=a(b);for(var d in this.map)if(c[d])return _TRUE;return _FALSE},extract:function(b){var c=a(b),d=[];for(var e in this.map)c[e]&&d.push(e);return $tom.translate(d.join(","))},getExpression:function(){if(!this.exprs){var a=[];for(var b in this.map)a.push(b);this.exprs=a.join(",")}return this.exprs}}),f={};Object.extend($tom,{translate:function(a){return f[a]||(f[a]=new e(a)),f[a]}})}(),Object.extend($tom,{__POSITION:{__START_OF_TEXT:-1,__MIDDLE_OF_TEXT:0,__END_OF_TEXT:1,__EMPTY_TEXT:-2}}),Object.extend($tom,{isElement:function(a){return a&&1==a.nodeType},isBody:function(a){return $tom.isElement(a)&&"BODY"==a.tagName},isBlock:function(a){return $tom.kindOf(a,"%block")},isParagraph:function(a){return $tom.kindOf(a,"%paragraph")},isText:function(a){return $tom.kindOf(a,"%text")},isControl:function(a){return $tom.kindOf(a,"%control")},isTagName:function(a,b){return b=b.toUpperCase(),a&&a.tagName===b},getOwnerDocument:function(a){return a.ownerDocument||a.document},getName:function(a){return a&&1==a.nodeType?a.nodeName.toLowerCase():""},getText:function(a){return a.textContent||a.text||a.innerText||""},getLength:function(a){return a?1==a.nodeType?a.childNodes.length:3==a.nodeType?a.nodeValue.length:0:0},indexOf:function(a){if(!a)return-1;for(var b=a.parentNode,c=0,d=b.childNodes.length,e=b.childNodes;c<d;c++)if(e[c]==a)return c;return-1},hasContent:function(a,b){if(!a||3!=a.nodeType)return _TRUE;var c=$tom.removeMeaninglessSpace(a.nodeValue);return b&&(c=c.replace(Trex.__WORD_JOINER_REGEXP,"")),""!=c},removeEmptyTextNode:function(a){a&&3==a.nodeType&&!a.nodeValue&&$tom.remove(a)},hasUsefulChildren:function(a,b){if(!a)return _FALSE;var c=$tom.removeMeaninglessSpace(a.innerHTML);return b&&(c=c.replace(Trex.__WORD_JOINER_REGEXP,"")),c?c.stripTags()?_TRUE:c.search(/<(img|br|hr)\s?[^>]*>/i)>-1?_TRUE:c.search(/<span\sid="?tx_(start|end)_marker"?><\/span>/i)>-1?_TRUE:_FALSE:_FALSE},hasData:function(a,b){if(!a)return _FALSE;var c="";return c=1==a.nodeType?a.innerHTML:a.nodeValue,c=$tom.removeMeaninglessSpace(c),""==c.trim()?_FALSE:""!=c.stripTags()?_TRUE:b?_FALSE:c.search(/<br\s?\/?>/i)>-1?_TRUE:_FALSE},removeMeaninglessSpace:function(a){return a.replace(/(^[\f\n\r\t\v\u2028\u2029]*)|([\f\n\r\t\v\u2028\u2029]*$)/g,"")}}),Object.extend($tom,{search:function(a,b,c){var d=1==a.length?_DOC:a[0],e=a[a.length-1];return e&&d&&d.nodeType&&"string"==typeof e?b(d,$tom.translate(e).getExpression()):c},find:function(){return this.search(arguments,dFindy,_NULL)},collect:function(){return this.search(arguments,dGetty,_NULL)},collectAll:function(){return this.search(arguments,dGetties,[])}}),function(){function a(a){if(a){if("function"==typeof a)return a;var b=$tom.translate(a);return function(a){return 1==a.nodeType?b.include("#element")?_TRUE:dChecky(a,b.getExpression()):b.include("#text")}}return _NULL}function b(a){if(a=a||"#element,#text",c[a])return c[a];var b=new d(a);return c[a]=b,b}var c={},d=Trex.Class.create({initialize:function(a){this.pattern=a,this.translator=$tom.translate(a),this.hasClassPattern=a.indexOf(".")>=0,this.hasIdPattern=a.indexOf("#")>=0,this.matchesText=this.translator.include("#text"),this.matchesElement=this.translator.include("#element")},test:function(a){var b=a.nodeType,c=this.translator.map;if(1==b){if(this.matchesElement)return _TRUE;var d=a.tagName.toLowerCase();if(c[d])return _TRUE;var e=[];if(this.hasClassPattern&&a.className&&a.className.split(/\s/).each(function(a){e.push("."+a),e.push(d+"."+a)}),this.hasIdPattern&&a.id){var f=a.id;e.push("#"+f),e.push(d+"#"+f)}for(var g=0;g<e.length;g++)if(c[e[g]])return _TRUE;return _FALSE}if(3==b)return this.matchesText}});Object.extend($tom,{tagName:function(a,b){return a?a.tagName:_NULL},kindOf:function(a,c){return a&&c?b(c).test(a):_FALSE},kindOf_old:function(b,c){return b&&c?a(c)(b):_FALSE},ancestor:function(a,c){if(!a||!a.parentNode)return _NULL;for(var d=b(c),e=a.parentNode;e;){if($tom.isBody(e))return _NULL;if(d.test(e))break;e=e.parentNode}return e},findAncestor:function(a,b,c){for(;!c(a);){if(b(a))return a;a=a.parentNode}return _NULL},descendant:function(a,b){var c=$tom.descendants(a,b,_TRUE);return 0==c.length?_NULL:c[0]},descendants:function(a,c,d){if(d=d||_FALSE,!a||!a.firstChild)return[];var e=_FALSE,f=b(c),g=[],h=function(a){if((!d||!e)&&$tom.first(a))for(var b=$tom.children(a),c=0,i=b.length;c<i;c++)f.test(b[c])?(g.push(b[c]),e=_TRUE):h(b[c])};return h(a),g},children:function(a,c){var d=[];if(!a||!a.firstChild)return d;for(var e=b(c),f=$tom.first(a);f;)e.test(f)&&d.push(f),f=f.nextSibling;return d},next:function(a,c){if(!a||!a.nextSibling)return _NULL;for(var d=b(c),e=a.nextSibling;e&&(!$tom.hasContent(e)||!d.test(e));)e=e.nextSibling;return e},previous:function(a,c){if(!a||!a.previousSibling)return _NULL;for(var d=b(c),e=a.previousSibling;e&&(!$tom.hasContent(e)||!d.test(e));)e=e.previousSibling;return e},first:function(a,c){if(!a||!a.firstChild)return _NULL;for(var d=b(c),e=a.firstChild;e&&(!$tom.hasContent(e)||!d.test(e));)e=e.nextSibling;return e},last:function(a,c){if(!a||!a.lastChild)return _NULL;for(var d=b(c),e=a.lastChild;e&&(!$tom.hasContent(e)||!d.test(e));)e=e.previousSibling;return e},extract:function(a,c,d){var e=[];if(!a||!c||!d)return e;for(var f=b(d),g=_FALSE,h=a.firstChild;h;){if($tom.include(h,c)&&(g=_TRUE),f.test(h))e.push(h);else{if(g)break;e=[]}h=h.nextSibling}return g?e:[]},parent:function(a){return a&&a.parentNode?a.parentNode:_NULL},body:function(a){if(!a||!a.parentNode)return _NULL;for(var b=a.parentNode;b;){if($tom.isBody(b))return b;b=b.parentNode}return _NULL},top:function(a,b){b=b||_FALSE;for(var c=a;$tom.first(c);)c=$tom.first(c);return b?c:($tom.kindOf(c,"#tx_start_marker,#tx_end_marker")?c=c.nextSibling||c.parentNode:$tom.kindOf(c,"%control")&&(c=c.parentNode),c)},bottom:function(a,b){b=b||_FALSE;for(var c=a;$tom.last(c);)c=$tom.last(c);return b?c:($tom.kindOf(c,"#tx_start_marker,#tx_end_marker")?c=c.previousSibling||c.parentNode:$tom.kindOf(c,"%control")&&(c=c.parentNode),c)},include:function(a,b){if(!a||!b)return _FALSE;if(a==b)return _TRUE;for(var c=b;c;){if($tom.isBody(c))return _FALSE;if(c==a)return _TRUE;c=c.parentNode}return _FALSE},prevNodeUntilTagName:function(a,b,c){for(c=c.toUpperCase(),a=0===b?a.previousSibling:a.childNodes[b-1];a&&a.lastChild&&a.tagName!==c;)a=a.lastChild;return a},nextContent:function(a,b){do{var c=$tom.next(a,b);if(c)return c;a=$tom.parent(a)}while(a&&!$tom.isBody(a));return null}})}(),Object.extend($tom,{insertFirst:function(a,b){if(a&&b)return a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b),b},insertAt:function(a,b){if(a&&b)return b.parentNode.insertBefore(a,b),a},insertNext:function(a,b){if(a&&b){var c=b.nextSibling;return c?c.parentNode.insertBefore(a,c):b.parentNode.appendChild(a),a}},append:function(a,b){if(a&&b)return a.appendChild(b),b},remove:function(a){a&&(a.parentNode&&a.parentNode.removeChild(a),a=_NULL)},html:function(a,b){if(a)return a.innerHTML=b||"",a},clean:function(a){return $tom.html(a)},stuff:function(a,b){if(!a)return a;if($tom.hasUsefulChildren(a,_TRUE))return a;if(a.lastChild){for(var c=a;c.lastChild;)c=c.lastChild;$tom.insertNext(b,c)}else $tom.append(a,b);return a}}),Object.extend($tom,{removeListIfEmpty:function(a){for(;$tom.kindOf(a,"%listhead")&&1==a.childNodes.length&&$tom.kindOf(a.firstChild,"%listhead");)a=a.firstChild;for(;$tom.kindOf(a,"%listhead")&&0==a.childNodes.length;){var b=a.parentNode;$tom.remove(a),a=b}}}),Object.extend($tom,{moveChild:function(a,b,c,d){if(a&&b&&(c=Math.min(Math.max(c||0),a.childNodes.length),d=Math.min(Math.max(d||a.childNodes.length),a.childNodes.length),!(c>=d)))for(var e=c;e++<d&&c<a.childNodes.length;)b.appendChild(a.childNodes[c])},moveChildToParent:function(a){if(a)for(;a.firstChild;)a.parentNode.insertBefore(a.firstChild,a)}}),Object.extend($tom,{replace:function(a,b){if(!a||!b)return _NULL;if($tom.getName(a)==$tom.getName(b))return $tom.remove(b),a;for(var c=[],d=a.childNodes,e=d.length,f=0;f<e;f++)c.push(d[f]);for(f=0;f<e;f++){var g=c[f];if(g.lastChild===a){var h=$tom.clone(g);$tom.moveChild(g,h),g.innerHTML="",b.appendChild(h)}else b.appendChild(g)}return $tom.insertAt(b,a),$tom.remove(a),b},clone:function(a,b){var c=a.cloneNode(!!b);return 1==a.nodeType&&c.removeAttribute("id"),c}}),Object.extend($tom,{wrap:function(a,b){return a&&b?(b instanceof Array==_FALSE&&(b=[].concat(b)),$tom.insertAt(a,b[0]),b.each(function(b){$tom.append(a,b)}),a):_NULL},unwrap:function(a){if(!a)return _NULL;var b=$tom.first(a);return $tx.msie_nonstd?a.removeNode():($tom.moveChildToParent(a),$tom.remove(a)),b}}),Object.extend($tom,{divideText:function(a,b){if(!$tom.isText(a))return a;if(b<=0||b>=a.length)return a;var c=a.cloneNode(_FALSE);return a.deleteData(b,a.length-b),c.deleteData(0,b),$tom.insertNext(c,a),c},divideNode:function(a,b){if(!$tom.isElement(a))return _NULL;for(var c=a.childNodes.length-b,d=a.cloneNode(_FALSE),e=0;e<c;e++)$tom.insertFirst(d,a.lastChild);return $tom.insertNext(d,a),d},splitAt:function(a,b){if($tom.isElement(a)){var c=$tom.clone(a);return $tom.moveChild(a,c,b+1,a.childNodes.length),$tom.insertNext(c,a),c}},divideTree:function(a,b){var c,d,e=b;do{d=e.parentNode,c=$tom.indexOf(e),e=$tom.divideNode(d,c)}while(e.previousSibling!=a);return e},divideParagraph:function(a){for(var b=a,c=$tom.indexOf(a),d=b;b&&!$tom.isBody(b)&&!$tom.kindOf(b,"td,th,%wrapper,%outergroup");){if($tom.kindOf(b,"#tx_start_marker,#tx_end_marker"))c=$tom.indexOf(b);else if($tom.isControl(b))c=$tom.indexOf(b);else if($tom.isText(b))b=$tom.divideText(b,c),c=$tom.indexOf(b);else if(b=$tom.divideNode(b,c),c=$tom.indexOf(b),d=b,$tom.kindOf(b,"p,li,dd,dt,h1,h2,h3,h4,h5,h6"))break;b=b.parentNode}return d},wrapInlinesWithP:function(a,b){var c=$tom.getOwnerDocument(a),d=$tom.extract(b||c.body,a,"%text,%inline,%control");if(this.hasOnlySavedCaret(d,a))return _NULL;var e=c.createElement("p");return $tom.wrap(e,d),e},hasOnlySavedCaret:function(a,b){var c=a.findAll(function(a){return 3!=a.nodeType||""!=a.nodeValue.trim()});return this.isGoogRangeCaret(b)&&1==c.length&&c[0]==b},isGoogRangeCaret:function(a){return a&&/goog_[0-9]+/.test(a.id)}}),Object.extend($tom,{paragraphOf:function(a){if(!a)return"p";var b=$tom.translate(a);return b.memberOf("ul,ol")?"li":b.memberOf("dl")?"dd":b.memberOf("tr,tbody,thead,tfoot,table")?"td":"p"},inlineOf:function(){return"span"},outerOf:function(a){if(!a)return"span";var b=$tom.translate(a);return b.memberOf("li")?"ol":b.memberOf("dd,dt")?"dl":b.memberOf("td,th,tr")?"table":"p"}}),function(){var a=Trex.Class.create({$const:{__FONT_SIZE_BASIS:9,__REG_EXT_NUMBER:new RegExp("[0-9.]+"),__REG_EXT_UNIT:new RegExp("px|pt|em")},initialize:function(){this.unitConverter={px2em:1/12,px2pt:.75,em2px:12,em2pt:9,pt2px:12/9,pt2em:1/9}},calculate:function(a,b){a!=_NULL&&0!=a.length||(a="0em"),b!=_NULL&&0!=b.length||(b="0em");var c=this.extractSign(b),d=this.extractUnit(a),e=this.extractUnit(b),f=this.extractNumber(a).toNumber(),g=this.extractNumber(b).toNumber();d!=e&&this.unitConverter[d+"2"+e]&&(f*=this.unitConverter[d+"2"+e]);var h=0;return h="-"==c?Math.max(f-g,0):f+g,h=Math.round(10*h)/10,0==h?_NULL:h+e},needCalculation:function(a){return a==_NULL||"string"!=typeof a?_FALSE:"+"==a.charAt(0)||"-"==a.charAt(0)},extractSign:function(a){var b="+";return"+"!=a.charAt(0)&&"-"!=a.charAt(0)||(b=a.charAt(0)),b},extractNumber:function(b){var c,d=0;return(c=b.match(a.__REG_EXT_NUMBER))!=_NULL&&(d=c[0]),b.indexOf("%")>-1&&(d/=100),d},extractUnit:function(b){var c,d="em";return(c=b.match(a.__REG_EXT_UNIT))!=_NULL&&(d=c[0]),d}}),b=new a,c={colspan:"colSpan",rowspan:"rowSpan",valign:"vAlign",datetime:"dateTime",accesskey:"accessKey",tabindex:"tabIndex",enctype:"encType",maxlength:"maxLength",readonly:"readOnly",longdesc:"longDesc",cellPadding:"cellPadding",cellSpacing:"cellSpacing",more:"more",less:"less",style:"style"};Object.extend($tom,{applyAttributes:function(a,b){if($tom.isElement(a))for(var c in b)"style"==c?$tom.applyStyles(a,b[c]):$tom.setAttribute(a,c,b[c])},removeAttributes:function(a,b){if($tom.isElement(a))for(var c in b)"style"==c?$tom.removeStyles(b[c]):a.removeAttribute(c,0)},getAttribute:function(a,b){return $tom.isElement(a)&&a&&a.getAttribute?a.getAttribute(c[b]||b):_NULL},setAttribute:function(a,b,d){if($tom.isElement(a))if(d==_NULL||0==d.length||0==d)a.removeAttribute(b,0);else if(c[b])a.setAttribute(c[b],d);else try{a[b]=d}catch(e){a.setAttribute(c[b]||b,d)}},setStyles:function(a,c,d){var e,f=a.style.cssText,g=Object.extend({},c);g.font&&(d?a.style.font=g.font:-1==a.style.cssText.indexOf("font:")&&(a.style.cssText="font: "+g.font+"; "+a.style.cssText),delete g.font);for(var h in g){var i;i=b.needCalculation(g[h])?b.calculate(a.style[h],g[h]):g[h],i==_NULL&&(i=""),"float"==h&&(h=$tx.msie?"styleFloat":"cssFloat"),e=!a.style[h]&&(0!=h.indexOf("font")||-1==f.indexOf("font:"))||d;var j="textDecoration"==h&&!a.style[h].include(i);e?a.style[h]=i:j&&(a.style[h]+=" "+i)}$tom._clearUselessStyle(a)},applyStyles:function(a,b){this.setStyles(a,b,_TRUE)},addStyles:function(a,b){this.setStyles(a,b,_FALSE)},removeStyles:function(a,b){var c=a.style.cssText,d=c;for(var e in b)e=e.replace(/([A-Z])/g,"-$1"),c=c.replace(new RegExp("(^| )"+e+"\\s*:[^;]+;? ?","ig"),"");d!=c&&(a.style.cssText=c,$tom._clearUselessStyle(a))},_clearUselessStyle:function(a){$tom.getAttribute(a,"style")||a.removeAttribute("style",0)},getStyleText:function(a){return a.style.cssText},setStyleText:function(a,b){a.style.cssText=b,!b&&$tom._clearUselessStyle(a)}})}(),Object.extend($tom,{goInto:function(a,b){a&&a.scrollIntoView&&a.scrollIntoView(b)},getWindow:function(a){return a.defaultView||a.parentWindow},getScrollTop:function(a){if(!a)return 0;var b=this.getWindow(a);return"pageYOffset"in b?b.pageYOffset:a.documentElement.scrollTop||a.body.scrollTop||0},setScrollTop:function(a,b){a&&(a.documentElement.scrollTop?a.documentElement.scrollTop=b:a.body.scrollTop=b)},getScrollLeft:function(a){return a?a.documentElement.scrollLeft||a.body.scrollLeft:0},setScrollLeft:function(a,b){a&&(a.documentElement.scrollLeft?a.documentElement.scrollLeft=b:a.body.scrollLeft=b)},getPosition:function(a,b){if(!a)return{x:0,y:0,width:0,height:0};b=!!b,a=$tx(a);var c,d=b?$tx.cumulativeOffset(a):$tx.positionedOffset(a),e=a.style.display;if("none"!=e&&e!=_NULL)c={width:a.offsetWidth,height:a.offsetHeight};else{var f=a.style,g=f.visibility,h=f.position,i=f.display;f.visibility="hidden",f.position="absolute",f.display="block";var j=a.clientWidth,k=a.clientHeight;f.display=i,f.position=h,f.visibility=g,c={width:j,height:k}}return{x:d[0],y:d[1],width:c.width,height:c.height}},getWidth:function(a){var b=a.style.width;return b.isPx()?b.parsePx():a.offsetWidth},setWidth:function(a,b){$tom.applyStyles(a,{width:b})},getHeight:function(a){var b=a.style.height;return b.isPx()?b.parsePx():a.offsetHeight},setHeight:function(a,b){$tom.applyStyles(a,{height:b})},replacePngPath:function(a){if($tx.msie6){if(_DOC.location.href.indexOf("http://")>-1)return;try{var b=$tx.getStyle(a,"filter"),c=/src='([^']+)'/.exec(b)[1];if(!c||"none"==c)return;if(c.indexOf("http://")>-1)return;var d=_DOC.location.href.split("/");d.push("css"),d.pop(),c=c.replace(/\.\.\//g,function(){return d.pop(),""});var e=d.join("/")+"/"+c;a.style.filter=b.replace(/src='([^']+)'/,"src='"+e+"'")}catch(a){alert(a)}}}}),Object.extend($tom,{EMPTY_BOGUS:$tx.msie_quirks||$tx.msie&&$tx.msie_ver<11?"&nbsp;":"<br>"}),Object.extend($tom,{EMPTY_PARAGRAPH_HTML:"<p>"+$tom.EMPTY_BOGUS+"</p>"}),_WIN.$tom=$tom,function(a){function b(a){return TrexConfig.getIconPath(a)+""}a.Util={_dispElIds:[],getDispElId:function(){var b;do{b="tx_entry_"+(Math.floor(9e4*Math.random())+1e4)+"_"}while(a.Util._dispElIds.contains(b));return a.Util._dispElIds.push(b),b},generateKey:function(){return parseInt(1e8*Math.random())},toStyleString:function(a){var b=[];for(var c in a)a[c]&&(b.push(c.replace(/([A-Z])/g,"-$1").toLowerCase()),b.push(":"),b.push(a[c]),b.push(";"));return b.join("")},toAttrString:function(a){var b=[];for(var c in a)a[c]&&b.push(" "+c+'="'+a[c]+'"');return b.join("")},getMatchValue:function(a,b,c){var d;return(d=a.exec(b))!=_NULL?d[c]:_NULL},getAttachmentType:function(a){return a=(a||"").toLowerCase(),["image/jpg","image/jpeg","image/png","image/tiff","image/gif","image/bmp","image/x-jg","image/ief","image/pict","jpg","bmp","gif","png"].contains(a)?"image":"file"},thumburl:function(a){switch(a=(a||"").toLowerCase()){case"doc":case"docx":return b("#iconpath/pn_word.gif");case"xls":case"xlsx":return b("#iconpath/pn_xls.gif");case"ppt":case"pptx":return b("#iconpath/pn_ppt.gif");case"pdf":return b("#iconpath/pn_pdf.gif");case"txt":return b("#iconpath/pn_txt.gif");case"hwp":return b("#iconpath/pn_hwp.gif");case"zip":case"alz":return b("#iconpath/pn_zip.gif");case"mp3":case"wav":case"ogg":case"wma":case"mp4":case"ape":case"ra":case"ram":return b("#iconpath/pn_mp3.gif");case"avi":case"mpeg":case"wmv":case"asf":return b("#iconpath/pn_movie.gif");case"swf":return b("#iconpath/pn_swf.gif");case"htm":case"html":return b("#iconpath/pn_html.gif");case"jpg":case"gif":case"png":case"bmp":default:return b("#iconpath/pn_etc.gif")}},prevurl:function(a){switch(a=(a||"").toLowerCase()){case"doc":case"docx":return b("#iconpath/p_word_s.gif");case"xls":case"xlsx":return b("#iconpath/p_xls_s.gif");case"ppt":case"pptx":return b("#iconpath/p_ppt_s.gif");case"pdf":return b("#iconpath/p_pdf_s.gif");case"txt":return b("#iconpath/p_txt_s.gif");case"hwp":return b("#iconpath/p_hwp_s.gif");case"zip":case"alz":return b("#iconpath/p_zip_s.gif");case"mp3":case"wav":case"ogg":case"wma":case"opus":case"flac":case"weba":case"mid":case"aiff":case"au":case"ape":case"ra":case"ram":return b("#iconpath/p_mp3_s.gif");case"avi":case"mpeg":case"wmv":case"asf":case"mp4":case"m4v":case"ogm":case"ogv":case"mpg":case"webm":case"mov":return b("#iconpath/p_movie_s.gif");case"swf":return b("#iconpath/p_swf_s.gif");case"htm":case"html":return b("#iconpath/p_html_s.gif");case"jpg":return b("#iconpath/p_jpg_s.gif");case"gif":return b("#iconpath/p_gif_s.gif");case"png":case"bmp":return b("#iconpath/p_png_s.gif");default:return b("#iconpath/p_etc_s.gif")}},getMatchedClassName:function(a,b){for(var c=_FALSE,d="",e=0;e<b.length;e++)if(d=b[e],$tx.hasClassName(a,d)){c=d;break}return c},getAllAttributesFromEmbed:function(a){var b={};a=a.replace(/<embed|>/gi,"");try{for(var c,d=/(\w+)=((?:\")[^\"]+(?:\"|$)|(?:')[^']+(?:'|$)|(?:[^\"'][^ \n]+($| |\n)))/gi;(c=d.exec(a))!=_NULL;)b[c[1].trim().toLowerCase()]=c[2].replace(/^(\"|')/i,"").replace(/(\"|')$/i,"").trim()}catch(a){}return b},getAllAttributes:function(a){for(var b,c={},d=/style="(?:\s*|(?:[^"]*(?:;\s*)))width\s*:\s*([0-9]+)px[^"]*"/gi;(b=d.exec(a))!=_NULL;)c.width=b[1];for(d=/style="(?:\s*|(?:[^"]*(?:;\s*)))height\s*:\s*([0-9]+)px[^"]*"/gi;(b=d.exec(a))!=_NULL;)c.height=b[1];for(d=new RegExp('\\s+([a-zA-Z-]+)="([^"]*)"',"g");(b=d.exec(a))!=_NULL;)c[b[1].toLowerCase()]||(c[b[1].toLowerCase()]=b[2]);for(d=new RegExp("\\s+([a-zA-Z-]+)='([^']*)'","g");(b=d.exec(a))!=_NULL;)c[b[1].toLowerCase()]||(c[b[1].toLowerCase()]=b[2]);for(d=new RegExp("\\s+([a-zA-Z-]+)=([^\\s>]*)","g");(b=d.exec(a))!=_NULL;)c[b[1].toLowerCase()]||(c[b[1].toLowerCase()]=b[2])
;return c}},a.HtmlCreator={createTableMarkup:function(a,b,c){var d=[];d.push('<table unselectable="on">'),d.push("<tbody>");for(var e,f=c.length,g=0;g<a;g++){d.push("<tr>");for(var h=0;h<b;h++)if(g*b+h<f)if(e=c[g*b+h],e.image){var i=TrexConfig.getIconPath(e.image);d.push('<td class="tx-menu-list-item"><a href="javascript:;"><span class="'+(e.klass||"")+'"><img src="'+i+'" data="'+e.data+'"/></span></a></td>')}else d.push('<td class="tx-menu-list-item"><a href="javascript:;"><span class="'+(e.klass||"")+'">'+e.data+"</span></a></td>");else d.push('<td class="tx-menu-list-item"><a href="javascript:;"><span class="">&nbsp;</span></a></td>');d.push("</tr>")}return d.push("</tbody>"),d.push("</table>"),d.join("\n")}},a.String={escapeQuot:function(a){return a.replace(new RegExp('"',"g"),"&quot;").replace(new RegExp("'","g"),"&#39;")},unescapeQuot:function(a){return a.replace(new RegExp("&quot;","gi"),'"').replace(new RegExp("&#39;","g"),"'")},htmlspecialchars:function(b){return a.String.escapeQuot(b.replace(new RegExp("&","g"),"&amp;").replace(new RegExp("<","g"),"&lt;").replace(new RegExp(">","g"),"&gt;"))},unHtmlspecialchars:function(b){return a.String.unescapeQuot(b.replace(new RegExp("&amp;","gi"),"&").replace(new RegExp("&lt;","gi"),"<").replace(new RegExp("&gt;","gi"),">"))},parseAttribute:function(a,b){var c,d=new RegExp("(^|\\W)"+b+'="([^"]*)"',"gi"),e=new RegExp("(^|\\W)"+b+"='([^']*)'","gi"),f=new RegExp("(^|\\W)"+b+"=([^\\s>]*)","gi");return(c=d.exec(a))?c[2]:(c=e.exec(a))?c[2]:(c=f.exec(a))?c[2]:""},changeAttribute:function(a,b,c,d){var e=new RegExp("(^|\\W)("+b+'=")'+c+'(")',"gi"),f=new RegExp("(^|\\W)("+b+"=')"+c+"(')","gi"),g=new RegExp("(^|\\W)("+b+"=)"+c,"gi"),h=new RegExp("<([\\w]+\\s*)","gi"),i=_FALSE;return a.search(e)>-1&&(i=_TRUE,a=a.replace(e,"$1$2"+d+"$3")),a.search(f)>-1&&(i=_TRUE,a=a.replace(f,"$1$2"+d+"$3")),a.search(g)>-1&&(i=_TRUE,a=a.replace(g,"$1$2"+d)),i||(a=a.replace(h,"<$1"+b+"="+d+" ")),a}},a.Validator=a.Class.create({initialize:function(){},strip:function(b){return b.stripTags().replace(/&nbsp;/g,"").replace(a.__WORD_JOINER_REGEXP,"").trim()},exists:function(a){return a?""==this.strip(a)&&a.search(/<(img|iframe|object|embed|table|hr|script|TXDB)/i)<0?_FALSE:_TRUE:_FALSE},equals:function(a,b){return a&&b&&a.search(/<(img|iframe|object|embed|table|hr|script|TXDB)/i)<0&&this.strip(a)==this.strip(b)?_TRUE:_FALSE}}),a.Repeater=a.Class.create({initialize:function(a){this.execHandler=a},start:function(a){this.tItv&&this.clear(),this.tItv=_WIN.setInterval(this.onTimer.bind(this),a)},clear:function(){_WIN.clearInterval(this.tItv),this.tItv=_NULL},onTimer:function(){this.execHandler!=_NULL&&this.execHandler()}}),a.Timer=a.Class.create({initialize:function(a){this.execHandler=a},start:function(a){_WIN.setTimeout(this.onTimer.bind(this),a)},onTimer:function(){this.execHandler!=_NULL&&this.execHandler()}}),a.Paging=a.Class.create({$const:{DEFAULT_PAGE_SIZE:5,DEFAULT_BLOCK_SIZE:10},initialize:function(b,c){this.data=b,this.currentpage=c.initPage||1,this.totalrow=c.totalrow||this.getTotalRow(),this.pagesize=c.pagesize||a.Paging.DEFAULT_PAGE_SIZE,this.blocksize=c.blocksize||a.Paging.DEFAULT_PAGE_SIZE,this.totalpage=Math.ceil(this.totalrow/this.pagesize),this.totalblock=Math.ceil(this.totalpage/this.blocksize)},getNextPage:function(){return this.currentpage<this.totalpage?this.currentpage+1:0},getPrevPage:function(){return this.currentpage>1?this.currentpage-1:0},getNextBlock:function(){var a=Math.ceil(this.currentpage/this.blocksize);return a<this.totalblock?a*this.blocksize+1:0},getPrevBlock:function(){var a=Math.ceil(this.currentpage/this.blocksize);return a>1?(a-2)*this.blocksize+1:0},getPageList:function(){for(var a=[],b=Math.ceil(this.currentpage/this.blocksize)-1,c=b*this.blocksize+1,d=Math.min(this.totalpage,c+this.blocksize-1),e=c;e<=d;e++)a.push(e);return a},movePage:function(a){this.currentpage=a||this.currentpage},getOnePageData:function(){for(var a=[],b=(this.currentpage-1)*this.pagesize,c=Math.min(this.currentpage*this.pagesize,this.totalrow),d=b;d<c;d++)a.push(this.data[d]);return a},getTotalRow:function(){return this.data.length}}),a.Slidebar=a.Class.create({initialize:function(a){this.elContext=a.el,this.knobWidth=a.knobWidth,this.isDisabled=_FALSE,this.handler=function(b){this.isDisabled||"function"!=typeof a.handler||a.handler(b)},this.logicObj={interval:a.interval||5,min:a.min||0,max:a.max||100},this.physicObj={min:0,width:a.barSize||100},this.physicObj.max=this.physicObj.width-this.knobWidth,this.physicObj.interval=this.logicObj.interval*this.physicObj.max/this.logicObj.max,this.startPos=0,this.startX=0,this.isDrag=_FALSE,this.result=0;var b=$tom.collect(this.elContext,"dd.tx-slide");$tom.collect(b,"span.tx-slide-min").innerHTML="",$tom.collect(b,"span.tx-slide-max").innerHTML="",this.bindEvent(),this.setKnobPosition(a.defaultValue||a.min||0)},regenerate:function(a){a=parseInt(a*this.physicObj.width/this.logicObj.max),this.setKnobPosition(a)},bindEvent:function(){var a=$tom.collect(this.elContext,"dd.tx-slide"),b=$tom.collect(a,"a.tx-slide-prev"),c=$tom.collect(a,"a.tx-slide-next"),d=$tom.collect(a,"div.tx-slide-bar"),e=this.elKnob=$tom.collect(a,"div.tx-slide-knob");$tx.observe(e,"mousedown",function(a){this.isDrag=_TRUE,this.startPos=this.getKnobPosition(),this.startX=a.clientX,$tx.stop(a)}.bind(this)),$tx.observe(e,"mouseup",function(){this.isDrag=_FALSE}.bind(this)),$tx.observe(this.elContext,"mousemove",function(a){this.isDrag&&(this.setKnobPosition(this.startPos+a.clientX-this.startX),$tx.stop(a),this.handler(this.result))}.bind(this)),$tx.observe(b,"click",function(a){var b=Math.round(this.physicObj.interval)-1,c=this,d=function(){var a=c.getKnobPosition();c.setKnobPosition(a-1),b-- >0?setTimeout(d,10):c.handler(c.result)};d(),$tx.stop(a)}.bind(this)),$tx.observe(c,"click",function(a){var b=Math.round(this.physicObj.interval),c=this,d=function(){var a=c.getKnobPosition();c.setKnobPosition(a+1),--b>0?setTimeout(d,10):c.handler(c.result)};d(),$tx.stop(a)}.bind(this)),$tx.observe(this.elContext,"mouseup",function(){this.isDrag&&(this.isDrag=_FALSE)}.bind(this)),$tx.observe(e,"click",function(a){$tx.stop(a)}.bind(this)),$tx.observe(d,"click",function(a){if(!this.isDrag){var b=a.layerX||a.x;this.setKnobPosition(b-this.knobWidth/2),this.handler(this.result)}}.bind(this))},getKnobPosition:function(){return $tx.getStyle(this.elKnob,"left").parsePx()},setKnobPosition:function(a){a=a<this.physicObj.max?a:this.physicObj.max,a=a>this.physicObj.min?a:this.physicObj.min,$tx.setStyle(this.elKnob,{left:a.toPx()}),this.result=Math.round(a*this.logicObj.interval/this.physicObj.interval)},setDisable:function(){this.isDisabled=_TRUE},setEnable:function(){this.isDisabled=_FALSE},getDisabled:function(){return this.isDisabled}}),a.DynamicSizer=a.Class.create({initialize:function(b){this.config=b,this.wrapper=b.el,this.elEventContext=tx.div({className:"tx-dynamic-sizer-context"}),this.currentSize={row:0,col:0},this.dynamicSizingEnabled=_TRUE,b.moveHandler||(b.moveHandler=function(){}),b.clickHandler||(b.clickHandler=function(){}),this.wrapper.appendChild(this.elEventContext),this.previewTable=new a.DynamicSizer.PreviewTable({parentEl:this.elEventContext,mouseOverHandler:this.changeSize.bind(this),mouseClickHandler:this.selectSize.bind(this)})},clear:function(){this.dynamicSizingEnabled=_TRUE,this.changeSize(0,0)},changeSize:function(a,b){this.dynamicSizingEnabled&&(this.currentSize.row=a,this.currentSize.col=b,this._changeSelectionSize(a,b),this.config.moveHandler(a,b))},_changeSelectionSize:function(a,b){this.previewTable.moveSelectionPos(a,b)},toggleDynamicSizing:function(){this.dynamicSizingEnabled=!this.dynamicSizingEnabled,this.dynamicSizingEnabled?this.selection.enableResize():this.selection.disableResize()},selectSize:function(a){this.config.clickHandler(a,this.currentSize)},getCurruentSize:function(){return this.currentSize}}),a.DynamicSizer.PreviewTable=a.Class.create({$const:{DEFAULT_TD_STYLE:{},DEFAULT_TABLE_PROPERTY:{cellpadding:"0",cellspacing:"1"},MAX_SIZE:{COL:10,ROW:10}},initialize:function(b){this.config=b,this.elTable=_NULL,this.elTable=this.generateTable("tx-event"),this.elSelection=tx.div({className:"tx-selection"},this.generateTable("tx-selection"));var c=this.generateTable("tx-panel");this.eventBinding(),b.parentEl.appendChild(this.elTable),b.parentEl.appendChild(this.elSelection),b.parentEl.appendChild(c);var d=$tom.getPosition(this.elTable),e=a.DynamicSizer.PreviewTable.MAX_SIZE;this.cellSize={width:Math.round((d.width-d.x)/e.COL),height:(d.height-d.y)/e.ROW}},generateTable:function(b){for(var c=tx.tbody(),d=a.DynamicSizer.PreviewTable,e=0;e<d.MAX_SIZE.ROW;e++){for(var f=tx.tr(),g=0;g<d.MAX_SIZE.COL;g++){var h=tx.td(tx.div({style:d.DEFAULT_TD_STYLE}));h=this.setCoordToAttr(h,g+1,e+1),f.appendChild(h)}c.appendChild(f)}var i=tx.table(d.DEFAULT_TABLE_PROPERTY);return $tx.addClassName(i,b||""),i.appendChild(c),i},moveSelectionPos:function(a,b){var c=(b*this.cellSize.width).toPx(),d=(a*this.cellSize.height).toPx();$tx.setStyle(this.elSelection,{width:c,height:d})},setCoordToAttr:function(a,b,c){return a.setAttribute("col",b),a.setAttribute("row",c),a},getCoordFromAttr:function(a){return{col:a.getAttribute("col")||0,row:a.getAttribute("row")||0}},eventBinding:function(){this.mouseOverHandler=this.config.mouseOverHandler,this.mouseClickHandler=this.config.mouseClickHandler;var a=this,b=function(b){var c=$tx.element(b)||{},d=(c.tagName||"").toUpperCase();if(c&&"TD"==d){var e=a.getCoordFromAttr(c);a.mouseOverHandler(e.row,e.col)}$tx.stop(b)},c=function(b){a.mouseClickHandler(b)};$tx.observe(this.elTable,"mouseover",b),$tx.observe(this.elTable,"click",c)}}),a.ImageScale=a.Class.create({initialize:function(a,b){if(a.imageurl&&!a.actualwidth){var c=function(c,d){a.actualwidth=c,a.actualheight=d,b&&b(c,d)};setTimeout(function(){var b=new Image;b.onerror=function(){b=_NULL},b.onreadystatechange?b.onreadystatechange=function(){"complete"==this.readyState&&(c(this.width,this.height),b=_NULL)}:b.onload=function(){c(this.width,this.height),b=_NULL},b.src=a.imageurl},10)}}})}(Trex),Trex.ImageResizer=Trex.Class.create({initialize:function(a,b){function c(a,b){var c,g,i=a.width,j=a.height;i==e&&j==f?(g=e,c=f):i<e&&j<f?(g=i,c=j):(c=f,(g=Math.floor(f*(i/j)))>e&&(g=e,c=Math.floor(e*(j/i)))),d.width=g,d.height=c,d.src=b,h(g,c)}var d=a,e=b.maxWidth||200,f=b.maxHeight||200,g=b.defImgUrl,h=b.onComplete||function(){};this.execResize=function(a){var b=new Image;b.onerror=function(){d.width=e,d.height=f,d.src=g,b=_NULL},b.onreadystatechange?b.onreadystatechange=function(){"complete"==this.readyState&&c(b,a)}:b.onload=function(){c(b,a)},b.src=a}}}),Trex.TableUtil={isDaumTable:function(a){return $tx.hasClassName(a,"txc-table")},cloneNodeForEmptyTd:function(a){var b;return b=a.cloneNode(_FALSE),Trex.TableUtil.emptyTd(b),b},emptyTd:function(a){a.innerHTML=$tom.EMPTY_PARAGRAPH_HTML},splitWidthByColSpan:function(a){var b;1<a.colSpan&&a.style.width&&(b=parseInt(a.style.width,10),$tom.setStyles(a,{width:Math.floor(b/a.colSpan)+"px"},_TRUE))},splitHeightByRowSpan:function(a){var b;1<a.rowSpan&&a.style.height&&(b=parseInt(a.style.height,10),$tom.setStyles(a,{height:Math.floor(b/a.rowSpan)+"px"},_TRUE))},collapseCaret:function(a,b){var c;try{c=a.getProcessor().createGoogRangeFromNodes(b,0,b,0),c.select()}catch(a){}},collapseLastCaret:function(a,b){var c;try{var d=b.length?b.length:b.childNodes.length;c=a.getProcessor().createGoogRangeFromNodes(b,d,b,d),c.select()}catch(a){}},getClosestByTagNames:function(a,b){var c;return b&&"string"==typeof b.tagName&&"body"!==(c=b.tagName.toLowerCase())?a.contains(c)?b:arguments.callee(a,b.parentNode):_NULL},getTableIndexerFromTd:function(a){var b;return b=Trex.TableUtil.getClosestByTagNames(["table"],a),new Trex.TableUtil.Indexer(b)}},Trex.TableUtil.Boundary=Trex.Class.create({initialize:function(a){this.top=-1,this.left=-1,this.bottom=-1,this.right=-1,a&&this.set(a)},getTop:function(){return this.top},getLeft:function(){return this.left},getBottom:function(){return this.bottom},getRight:function(){return this.right},setTop:function(a){this.top=a},setLeft:function(a){this.left=a},setBottom:function(a){this.bottom=a},setRight:function(a){this.right=a},set:function(a){"top"in a&&this.setTop(a.top),"left"in a&&this.setLeft(a.left),"bottom"in a&&this.setBottom(a.bottom),"right"in a&&this.setRight(a.right)},isValid:function(){return-1===this.top?_FALSE:-1===this.left?_FALSE:-1===this.bottom?_FALSE:-1===this.right?_FALSE:_TRUE},addBoundary:function(a,b){var c,d;return c=this.addStartBoundary(a,b),d=this.addEndBoundary(a,b),c||d},merge:function(a){var b,c;return b=this.addStartBoundary(a.top,a.left),c=this.addEndBoundary(a.bottom,a.right),b||c},addStartBoundary:function(a,b){var c;return c=_FALSE,(-1===this.top||a<this.top)&&(this.top=a,c=_TRUE),(-1===this.left||b<this.left)&&(this.left=b,c=_TRUE),c},addEndBoundary:function(a,b){var c;return c=_FALSE,(-1===this.bottom||this.bottom<a)&&(this.bottom=a,c=_TRUE),(-1===this.right||this.right<b)&&(this.right=b,c=_TRUE),c}}),Trex.TableUtil.Indexer=Trex.Class.create({initialize:function(a){this.indexData=_NULL,this.customIndexData=_NULL,this.table=_NULL,this.resetIndex(),this.setTable(a),this.makeIndex()},getRowSize:function(){return this.indexData.length},getColSize:function(){return 0<this.indexData.length?this.indexData[0].length:0},getTd:function(a,b){return this.indexData[a]&&this.indexData[a][b]?this.indexData[a][b]:_NULL},getTdArr:function(a){var b,c,d,e;for(b=[],c=a.top;c<=a.bottom;){for(d=this.indexData[c],e=a.left;e<=a.right;)b.contains(d[e])===_FALSE&&b.push(d[e]),e+=1;c+=1}return b},getTrArr:function(a,b){var c,d,e,f=[],g=null;for(b&&(g=this.getAllTrArr()),c=a.top;c<=a.bottom;){d=b?g[c].cells:this.indexData[c],e=a.left;for(var h=[];e<=a.right;){var i=d[e];h.push({index:e,cell:i}),e+=1}h.length>0&&f.push({index:c,cells:h}),c+=1}return{selectedTr:f,allTr:g}},getAllTrArr:function(){if(this.customIndexData)return this.customIndexData;for(var a,b=[],c=0;c<this.indexData.length;c++){a=this.indexData[c];for(var d=[],e=0;e<a.length;e++){var f=a[e];d.push(f?{index:e,rowIndex:c,colSpan:f.colSpan||1,rowSpan:f.rowSpan||1,cColSpan:f.colSpan||1,cell:f}:null)}b.push({index:c,cells:d})}for(var c=0;c<b.length;c++)for(var e=0;e<b[c].cells.length;e++)if(null!=b[c].cells[e]){for(var g=b[c].cells[e].colSpan,h=b[c].cells[e].rowSpan,i=0;i<h;i++)for(var j=0==i?1:0;j<g;j++)b[c+i].cells[e+j]=null;if(0==c&&g>1){for(var k=!0,l=0;l<b.length;l++){if(!b[l].cells[e]||b[l].cells[e].colSpan!=g){k=!1;break}l+=(b[l].cells[e].rowSpan||1)-1}if(k)for(var l=0;l<b.length;l++)b[l].cells[e]&&(b[l].cells[e].cColSpan=1)}}return this.customIndexData=b},getTdArrHasTop:function(a){var b,c,d,e,f;for(b=[],e=this.getColSize(),f=0;f<e;f+=1)c=this.getTd(a,f),d=this.getTd(a-1,f),this.uniquePushWhenDifferent(b,c,d);return b},getTdArrHasBottom:function(a){var b,c,d,e,f;for(b=[],e=this.getColSize(),f=0;f<e;f+=1)c=this.getTd(a,f),d=this.getTd(a+1,f),this.uniquePushWhenDifferent(b,c,d);return b},getTdArrHasLeft:function(a){var b,c,d,e,f;for(b=[],e=this.getRowSize(),f=0;f<e;f+=1)c=this.getTd(f,a),d=this.getTd(f,a-1),this.uniquePushWhenDifferent(b,c,d);return b},getTdArrHasRight:function(a){var b,c,d,e,f;for(b=[],e=this.getRowSize(),f=0;f<e;f+=1)c=this.getTd(f,a),d=this.getTd(f,a+1),this.uniquePushWhenDifferent(b,c,d);return b},getBoundary:function(a){var b,c,d,e,f,g,h;for(b=new Trex.TableUtil.Boundary,c=this.indexData,d=c.length,e=0;e<d;e+=1)if(f=c[e])for(g=f.length,h=0;h<g;h+=1)f[h]===a&&b.addBoundary(e,h);return b},reload:function(){this.resetIndex(),this.makeIndex()},uniquePushWhenDifferent:function(a,b,c){b!==c&&a.contains(b)===_FALSE&&a.push(b)},resetIndex:function(){this.indexData=[],this.customIndexData=_NULL},setTable:function(a){this.table=a},makeIndex:function(){var a,b,c,d,e,f,g,h;for(a=this.table.rows,b=a.length,c=0;c<b;c+=1)for(d=a[c],e=d.cells,f=e.length,g=0;g<f;g+=1)h=e[g],this.addCellIndex(c,h)},addCellIndex:function(a,b){var c,d,e,f,g,h;for(c=this.getNextCellIndex(this.indexData[a]),e=b.rowSpan,d=0;d<e;d+=1)for(f=a+d,this.indexData[f]||(this.indexData[f]=[]),h=b.colSpan,g=0;g<h;g+=1)this.indexData[f][c+g]=b},getNextCellIndex:function(a){var b,c;if(!a)return 0;for(c=a.length,b=0;b<c&&a[b];b+=1);return b}}),Trex.I.XHRequester=Trex.Faculty.create({createXMLHttp:function(){var a=_NULL;try{return _WIN.XMLHttpRequest?a=new XMLHttpRequest:_WIN.ActiveXObject&&((a=new ActiveXObject("Msxml2.XMLHTTP"))||(a=new ActiveXObject("Microsoft.XMLHTTP"))),a}catch(a){return _NULL}},sendRequest:function(a,b,c,d,e,f){if(b==_NULL&&""!=b)return _NULL;var g=_NULL,h=this.createXMLHttp();if(h==_NULL)return _NULL;var i=function(){g=200==h.status?e("HEAD"==a.toUpperCase()?h.getAllResponseHeaders():h.responseText):f(h.status),h=_NULL};try{return d&&(h.onreadystatechange=function(){4==h.readyState&&i()}),"POST"==a.toUpperCase()?(h.open("POST",b,d),h.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c)):(c&&c.length>0&&(b=b+(b.indexOf("?")>-1?"&":"?")+c),h.open(a.toUpperCase(),b,d),h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(_NULL)),d||i(),g}catch(a){return _NULL}}}),Trex.Responder={callbacks:{},process:function(){},newKey:function(){var a="exe_"+Math.floor(1e5*Math.random());return this[a]?this.newKey():a},register:function(a){var b=this.newKey();return this.callbacks[b]=function(c){a.apply(this,Array.prototype.slice.call(arguments,0)),this.callbacks[b]=_NULL}.bind(this),b}},Trex.I.JSRequester=Trex.Faculty.create({importScript:function(a,b,c,d){if(a==_NULL&&""!=a)return _NULL;b=b||"utf-8",c=c||_DOC;try{var e=c.getElementsByTagName("head")[0]||c.documentElement,f=c.createElement("script");f.type="text/javascript",f.charset=b,f.src=a;var g=_FALSE;f.onload=f.onreadystatechange=function(){g||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(g=_TRUE,d&&d(),f.onload=f.onreadystatechange=_NULL,e&&f.parentNode&&e.removeChild(f))},e.insertBefore(f,e.firstChild)}catch(a){}}}),_WIN.$stop={},_WIN.$propagate={},Trex.I.JobObservable=Trex.Faculty.create({jobObservers:{},observeJob:function(a,b){this.jobObservers[a]||(this.jobObservers[a]=[]),this.jobObservers[a].push(b)},reserveJob:function(a,b,c){c=c||500,this.jobObservers[a]||(this.jobObservers[a]=[]);var d=this;this.jobObservers[a].push(function(){var a=$A(arguments);setTimeout(function(){b.apply(d,a)},c)})},removeJob:function(a,b){if(this.jobObservers[a])if(b)for(var c=0;c<this.jobObservers[a].length;c++)this.jobObservers[a][c]===b&&this.jobObservers[a].splice(c,1);else this.jobObservers[a].length=0},fireJobs:function(a){var b=this,c=$A(arguments).slice(1);if(this.jobObservers[a])if(_WIN.DEBUG)this.jobObservers[a].each(function(a){a.apply(b,c)});else try{this.jobObservers[a].each(function(a){a.apply(b,c)})}catch(a){if(a!=$stop)throw a}}}),Trex.I.KeyObservable=Trex.Faculty.create({keyObservers:{},observeKey:function(a,b){var c=function(a){return(a.ctrlKey?"T":"F")+(a.altKey?"T":"F")+(a.shiftKey?"T":"F")+"_"+a.keyCode}(a);this.keyObservers[c]||(this.keyObservers[c]=[]),this.keyObservers[c].push(b)},fireKeys:function(a,b){var c=function(a){return(a.ctrlKey?"T":"F")+(a.altKey?"T":"F")+(a.shiftKey?"T":"F")+"_"+a.keyCode}(a);if(this.keyObservers[c]){var d=this,e=_FALSE,f=function(){e||($tx.stop(a),e=_TRUE)};this.keyObservers[c].each(function(c){try{c.apply(d,[a]),b||f()}catch(a){a===$stop?f():$propagate}})}},registerKeyEvent:function(a){try{$tx.observe(a,"keydown",this.fireKeys.bind(this),_TRUE)}catch(a){}}}),Trex.I.ElementObservable=Trex.Faculty.create({elementObservers:{},observeElement:function(a,b){if(a==_NULL)this.observeElement({tag:"*tx-final-body*"},b);else if(a.length)for(var c=0;c<a.length;c++){var d=a[c];this.observeElement(d,b)}else this.elementObservers[a.tag]||(this.elementObservers[a.tag]={}),a.klass||(a.klass="*tx-all-class*"),this.elementObservers[a.tag][a.klass]||(this.elementObservers[a.tag][a.klass]=[]),this.elementObservers[a.tag][a.klass].push(b)},fireElements:function(a){if(a){var b=a,c=$A(arguments).slice(1),d=this;try{var e;if($tom.kindOf(b,"img,hr,table,button,iframe"))(e=this.collectObserverByElement(b.nodeName.toLowerCase(),b.className))&&e.each(function(a){a.apply(d,[b].concat(c))});else for(;b&&(e=this.collectObserverByElement(b.nodeName.toLowerCase(),b.className),e&&e.each(function(a){a.apply(d,[b].concat(c))}),!$tom.isBody(b));)b=$tom.parent(b)}catch(a){if(a!=$stop)throw a}this.fireFinally()}},fireFinally:function(){var a=this,b=$A(arguments).slice(1),c=this.collectObserverByElement("*tx-final-body*");c&&c.each(function(c){c.apply(a,[_NULL].concat(b))})},collectObserverByElement:function(a,b){if(!this.elementObservers[a])return _NULL;var c=[];if(""!=(b=b||"")){var d=b.split(" ");for(var e in this.elementObservers[a])d.contains(e)&&c.push(this.elementObservers[a][e])}return this.elementObservers[a]["*tx-all-class*"]&&c.push(this.elementObservers[a]["*tx-all-class*"]),c.flatten()}}),Trex.I.MouseoverObservable=Trex.Faculty.create({mouseoverObservers:{},observeMouseover:function(a,b,c){this.mouseoverObservers[a]||(this.mouseoverObservers[a]={success:[],fail:[],flag:_FALSE}),this.mouseoverObservers[a].success.push(b),c&&this.mouseoverObservers[a].fail.push(c)},fireMouseover:function(a){if(a){var b=a,c=this;try{for(var d in this.mouseoverObservers)this.mouseoverObservers[d].flag=_FALSE;for(;b;){var e=this.collectMouseoverObserver(b);if(e.length>0){var f=this.getPositionByNode(b);e.each(function(a){a.apply(c,[b,f])})}if($tom.isBody(b))break;b=$tom.parent(b)}}catch(a){if(a!=$stop)throw a}this.runMouseoverFailHandler()}},runMouseoverFailHandler:function(){var a=[];for(var b in this.mouseoverObservers)this.mouseoverObservers[b].flag||a.push(this.mouseoverObservers[b].fail);a.flatten().each(function(a){a()})},collectMouseoverObserver:function(a){var b=[],c=a.className||"",d=a.tagName;if(d&&(d=d.toLowerCase(),this.mouseoverObservers[d]&&(b.push(this.mouseoverObservers[d].success),this.mouseoverObservers[d].flag=_TRUE)),""!=c)for(var e=c.split(" "),f=0,g=e.length;f<g;f++){var h=d+"."+e[f];this.mouseoverObservers[h]&&(b.push(this.mouseoverObservers[h].success),this.mouseoverObservers[h].flag=_TRUE)}return b.flatten()}}),Trex.I.Runnable=Trex.Faculty.create({isRunning:_FALSE,repeater:_NULL,threads:[],startThread:function(a){this.repeater?this.repeater.clear():this.repeater=new Trex.Repeater(this.runThread.bind(this)),this.repeater.start(a)},stopThread:function(){this.repeater.clear()},runThread:function(){this.isRunning||this.threads.length>0&&(this.isRunning=_TRUE,this.threads.shift()(),this.isRunning=_FALSE)},putThread:function(a,b){b?this.threads.unshift(a):this.threads.push(a)}}),TrexMessage.addMsg({"@menu.pallete.revert":Trex._I18N.g("menu.pallete.revert","기본색으로"),"@adoptor.label":Trex._I18N.g("adoptor.label","가나다"),"@adoptor.transparent":Trex._I18N.g("adoptor.transparent","투명")}),Trex.MarkupTemplate.add("menu.colorpallete.text",'#{for:items}<li class="tx-menu-list-item" style="background-color:#{color}"><a unselectable="on" style="color:#{text}">#{label}</a></li>#{/for:items}'),Trex.MarkupTemplate.add("menu.colorpallete.thumb",'#{for:items}<li class="tx-menu-list-item" unselectable="on" style="background-color:#{color};border:none;#{if:image!=null}background-image:url(#{image})#{/if:image};"></li>#{/for:items}'),Trex.MarkupTemplate.add("menu.colorpallete.revert",'<p class="tx-pallete-revert"><a unselectable="on" href="javascript:;" title="@menu.pallete.revert">@menu.pallete.revert</a></p>'),Trex.I.ColorPallete=Trex.Faculty.create({isGradeInit:_FALSE,isPickerDisplayed:_FALSE,onregenerated:function(a,b){this.setColorValueAtInputbox(b)},setColorValueAtInputbox:function(a){if(a){"string"!=typeof a&&a.toString&&(a=a.toString());var b=a.split("|")[0];Trex.Color.getValidColor(b)||(b="#000000");var c=$tom.collect(this.elInner,"p.tx-pallete-input input"),d=$tom.collect(this.elInner,"p.tx-pallete-input span");a&&c&&d&&(c.value=b,d.style.backgroundColor=b)}},hookEvent:function(a){var b=this.elMenu,c=this.elInner=$tom.collect(b,"div.tx-menu-inner"),d=$tom.collect(c,"ul.tx-pallete-text-list");if(a.texts){var e=a.texts.options;Trex.MarkupTemplate.get("menu.colorpallete.text").evaluateToDom({items:e},d);var f=$tom.collectAll(d,"li");this.addColorClickEvent(f,e)}else c.removeChild(d),d=_NULL;if(a.thumbs){var g=!!a.needTrans,h=[].concat(a.thumbs.options);g&&(h.pop(),h.push(Object.extend({},a.thumbs.transparent)));var i=$tom.collect(c,"ul.tx-pallete-thumb-list");Trex.MarkupTemplate.get("menu.colorpallete.thumb").evaluateToDom({items:h},i);var j=$tom.collectAll(i,"li");this.addColorClickEvent(j,h)}this.elPicker=$tom.collect(c,"div.tx-pallete-picker");var k=$tom.collect(c,"div.tx-pallete-buttons"),l=this.elMore=$tom.collect(k,"p.tx-pallete-more a");$tx.observe(l,"click",this.togglePicker.bind(this)),a.needRevert&&($tom.insertFirst(k,Trex.MarkupTemplate.get("menu.colorpallete.revert").evaluateAsDom({})),$tx.observe($tom.collect(k,"p.tx-pallete-revert a"),"click",function(a){this.onSelect(a,_NULL),this.hide()}.bind(this)));var m=$tom.collect(this.elInner,"p.tx-pallete-input");this.elPreview=$tom.collect(m,"span");var n=this.elInput=$tom.collect(m,"input"),o=this.elEnter=$tom.collect(m,"a"),p=this;$tx.observe(n,"blur",function(){p.lastValue=n.value}),$tx.observe(o,"click",this.onColorEnter.bind(this))},addColorClickEvent:function(a,b){for(var c=0,d=a.length;c<d;c++){var e=a[c],f=b[c];$tx.observe(e,"click",this.onSelect.bindAsEventListener(this,f.color+(f.text?"|"+f.text:"")))}},_generatePicker:function(){var a=this.elPicker,b=$tom.collect(a,"div.tx-pallete-pickerbox");$tx.observe(b,"mouseout",this.onMouseOut.bind(this));var c=this.elChromaBar=$tom.collect(b,"div.tx-chromabar");$tom.replacePngPath(c),$tx.observe(c,"mousedown",this.onChromDown.bindAsEventListener(this)),$tx.observe(c,"mousemove",this.onChromMove.bindAsEventListener(this)),$tx.observe(c,"mouseup",this.onChromUp.bindAsEventListener(this)),this.elHueBar=$tom.collect(b,"div.tx-huebar");var d=this.elHueBar;this.hueDownHandler=this.onHueDown.bindAsEventListener(this),this.hueMoveHandler=this.onHueMove.bindAsEventListener(this),this.hueUpHandler=this.onHueUp.bindAsEventListener(this),this.hueClickHandler=this.onHueClick.bindAsEventListener(this),$tx.observe(d,"mousedown",this.hueDownHandler),$tx.observe(d,"click",this.hueClickHandler),this.nColWidth=150,this.nColHeight=120,this.nHueHeight=120,this.mRGB={r:0,g:0,b:0},this.mHSV={h:0,s:100,v:100},this.setHueColor("FF0000")},reinitGrade:function(){var a=$tx.cumulativeOffset(this.elMenu),b=$tx.positionedOffset(this.elChromaBar);this.iChromPos={x:a[0]+b[0],y:a[1]+b[1]},b=$tx.positionedOffset(this.elHueBar),this.iHuePos={x:a[0]+b[0],y:a[1]+b[1]}},onColorEnter:function(a){var b;b=this.elInput.value==TXMSG("@adoptor.transparent")?"transparent":Trex.Color.getValidColor(this.elInput.value),b!==_NULL&&this.onSelect(a,b),this.hide()},previewColor:function(a){this.changeColor(a)},onMouseOut:function(){this.lastValue!==_NULL&&this.lastValue!==_UNDEFINED&&this.mousedownDetected&&this.changeColor(this.lastValue)},changeColor:function(a){a=Trex.Color.getHexColor(a),this.elPreview.style.backgroundColor=a,this.elInput.value="transparent"==a?TXMSG("@adoptor.transparent"):a},enterColor:function(){if(this.elInput.value==TXMSG("@adoptor.transparent"))this.changeColor("transparent");else if(7==this.elInput.value.length){var a=Trex.Color.getValidColor(this.elInput.value);a!==_NULL&&this.changeColor(a)}},togglePicker:function(a){var b=this.elMore,c=this.elPicker;this.isPickerDisplayed?(b.className="tx-more-down",$tx.hide(c)):(b.className="tx-more-up",$tx.show(c),$tx.msie6&&(c.style.padding="1px",setTimeout(function(){c.style.padding="0px"},0)),this.isGradeInit||(this._generatePicker(),this.isGradeInit=_TRUE,this.reinitGrade())),this.isPickerDisplayed=!this.isPickerDisplayed,$tx.stop(a)},getChromCoords:function(a){var b=a.clientX-this.iChromPos.x+_DOC_EL.scrollLeft,c=a.clientY-this.iChromPos.y+_DOC_EL.scrollTop;return b=Math.min(this.nColWidth,Math.max(0,b)),c=Math.min(this.nColHeight,Math.max(0,c)),{x:b,y:c}},getHueCoords:function(a){var b=a.offsetY||a.layerY;return Math.min(this.nHueHeight,Math.max(0,b))},getColorByEvent:function(a,b){var c=a/this.nColWidth*100,d=100*(1-b/this.nColHeight);return c=Math.floor(Math.min(Math.max(c,0),100)),c<3?c=0:c>97&&(c=100),d=Math.floor(Math.min(Math.max(d,0),100)),d<3?d=0:d>97&&(d=100),this.mHSV.s=c,this.mHSV.v=d,this.mRGB=this.hsv2rgb(this.mHSV.h,this.mHSV.s,this.mHSV.v),this.rgb2hex(this.mRGB.r,this.mRGB.g,this.mRGB.b)},onChromDown:function(){this.mousedownDetected=_TRUE},onChromMove:function(a){if(this.mousedownDetected){var b=this.getChromCoords(a),c=this.getColorByEvent(b.x,b.y);this.previewColor(c)}},onChromUp:function(a){var b=this.getChromCoords(a),c=this.getColorByEvent(b.x,b.y);this.previewColor(c),this.lastValue=c,this.mousedownDetected=_FALSE},getHueByEvent:function(a){var b=parseInt(a/this.nHueHeight*360);this.mHSV.h=Math.floor(Math.min(Math.max(b,0),360));var c=this.hsv2rgb(this.mHSV.h,100,100);return this.rgb2hex(c.r,c.g,c.b)},setHueColor:function(a){this.elChromaBar.style.backgroundColor=a},onHueDown:function(){$tx.observe(_DOC,"mousemove",this.hueMoveHandler),$tx.observe(_DOC,"mouseup",this.hueUpHandler)},onHueMove:function(a){var b=this.getHueCoords(a),c=this.getHueByEvent(b);this.setHueColor(c)},onHueClick:function(a){var b=this.getHueCoords(a),c=this.getHueByEvent(b);this.setHueColor(c)},onHueUp:function(){$tx.stopObserving(_DOC,"mousemove",this.hueMoveHandler),$tx.stopObserving(_DOC,"mouseup",this.hueUpHandler)},hex2rgb:function(a){return this.mRGB.r=16*this.toDec(a.substr(0,1))+this.toDec(a.substr(1,1)),this.mRGB.g=16*this.toDec(a.substr(2,1))+this.toDec(a.substr(3,1)),this.mRGB.b=16*this.toDec(a.substr(4,1))+this.toDec(a.substr(5,1)),this.mRGB},toDec:function(a){return"0123456789ABCDEF".indexOf(a.toUpperCase())},rgb2hex:function(a,b,c){return a=a.toString(16),1==a.length&&(a="0"+a),b=b.toString(16),1==b.length&&(b="0"+b),c=c.toString(16),1==c.length&&(c="0"+c),"#"+a+b+c},hsv2rgb:function(a,b,c){a%=360,b/=100,c/=100;var d=0,e=0,f=0;if(0===b)d=Math.floor(255*c),e=Math.floor(255*c),f=Math.floor(255*c);else{var g=a/60,h=Math.floor(g),i=c*(1-b),j=c*(1-b*(g-h)),k=c*(1-b*(1-(g-h))),l=0,m=0,n=0;0===h?(l=c,m=k,n=i):1==h?(l=j,m=c,n=i):2==h?(l=i,m=c,n=k):3==h?(l=i,m=j,n=c):4==h?(l=k,m=i,n=c):5==h&&(l=c,m=i,n=j),d=Math.floor(255*l),e=Math.floor(255*m),f=Math.floor(255*n)}return{r:d,g:e,b:f}},rgb2hsv:function(a,b,c){var d=a/255,e=b/255,f=c/255,g=0,h=0,i=0,j=Math.min(d,e,f),k=Math.max(d,e,f),l=k-j;if(i=l,0===l)g=0,h=0;else{h=l/k;var m=((k-d)/6+l/2)/l,n=((k-e)/6+l/2)/l,o=((k-f)/6+l/2)/l;d==k?g=o-n:e==k?g=1/3+m-o:f==k&&(g=2/3+n-m),g<0&&(g+=1),g>1&&(g-=1)}return{h:g,s:h,v:i}}}),Trex.Color={getHexColor:function(a){if(a=a.trim(),a.indexOf("rgb")<0)return a.length>0&&(a.indexOf("-moz-use")>-1||"transparent"==a)?"transparent":a;if(/rgba\s?\((0,\s?){3}0\)/i.test(a))return"transparent";var b=a.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*\d*\)/i);if(!b)return a;if(b.shift(),b.length<3)return a;for(var c,d="#",e=0;e<3;e++)c=parseInt(b[e].trim()).toString(16).toUpperCase(),d=1==c.length?d.concat("0"+c):c.length>2?d.concat("FF"):d.concat(""+c);return d},getValidColor:function(a){if(a===_NULL||"transparent"==a)return"transparent";var b=a.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return b===_NULL||a.length>8?_NULL:3==b[1].length?"#"+b[1]+b[1]:"#"+b[1]},getOptColor:function(a,b){if(!a||7!=a.length||"#"!=a.charAt(0))return"#e5e5e5";a=a.substring(1,7).toLowerCase(),b=isNaN(b)?100:b;for(var c,d,e="#",f=0;f<3;f++)c=parseInt(a.substr(2*f,2),16),d=Math.round(Math.floor((255-c)*(1-.01*b)+c*(.02*b))).toString(16),1==d.length?e+="0"+d:d.length>2?e+="ff":e+=d;return e}},Trex.I.CookieBaker=Trex.Faculty.create({cookieName:_NULL,cookieValue:_NULL,initCookie:function(a,b){this.cookieName=a,this.cookieValue=function(){for(var b=_DOC.cookie.split(";"),c=0;c<b.length;c++){var d=b[c].replace(/^\s+/,"")
;if(0==d.indexOf(a+"="))return d.substring(a.length+1)}return _NULL}()||"",this.maxCnt=b||3},writeCookie:function(a,b){var c,d=this.cookieName;if(b){var e=new Date;e.setTime((new Date).getTime()+24*b*60*60*1e3),c="; expires="+e.toGMTString()}else c="";a===_NULL&&(a=""),_DOC.cookie=d+"="+a+c+"; path=/",this.cookieValue=a},readCookie:function(){return this.cookieValue===_NULL+""?_NULL:this.cookieValue},eraseCookie:function(){var a=this.cookieName;this.writeCookie(a,"",-1)},extractOptions:function(a,b){var c=a.toMap("data"),d=[];return b.split("|").compact().each(function(a){c[a]&&d.push(c[a])}.bind(this)),d},mergeValues:function(a,b){var c=a.split("|").compact();return c.contains(b)?a:(c.length>=this.maxCnt&&c.pop(),c.unshift(b),c.join("|"))}}),Trex.MarkupTemplate.add("button.itsnew",'<em class="tx-itsnew" title="new">new</em>'),Trex.MarkupTemplate.add("button.select.text","<span>#{data}</span>"),Trex.Button=Trex.Class.create({$const:{__borderClasses:{"tx-btn-trans":_TRUE,"tx-btn-lbg":_TRUE,"tx-btn-bg":_TRUE,"tx-btn-rbg":_TRUE,"tx-btn-lrbg":_TRUE,"tx-slt-tlbg":_TRUE,"tx-slt-tbg":_TRUE,"tx-slt-trbg":_TRUE,"tx-slt-blbg":_TRUE,"tx-slt-bbg":_TRUE,"tx-slt-brbg":_TRUE,"tx-slt-31bg":_TRUE,"tx-slt-31lbg":_TRUE,"tx-slt-31rbg":_TRUE,"tx-slt-70lbg":_TRUE,"tx-slt-70bg":_TRUE,"tx-slt-59bg":_TRUE,"tx-slt-42bg":_TRUE,"tx-slt-56bg":_TRUE,"tx-btn-nlrbg":_TRUE,"tx-btn-43lrbg":_TRUE,"tx-btn-52lrbg":_TRUE,"tx-btn-57lrbg":_TRUE,"tx-btn-71lrbg":_TRUE,"tx-btn-48lbg":_TRUE,"tx-btn-48rbg":_TRUE,"tx-btn-30lrbg":_TRUE,"tx-btn-46lrbg":_TRUE,"tx-btn-67lrbg":_TRUE,"tx-btn-49lbg":_TRUE,"tx-btn-58bg":_TRUE,"tx-btn-46bg":_TRUE,"tx-btn-49rbg":_TRUE,"tx-btn-widget":_TRUE,"tx-btn-widget-tbg":_TRUE,"tx-btn-widget-brbg":_TRUE},addBorderClass:function(a){Trex.Button.__borderClasses[a]=_TRUE},getBorderClass:function(a){for(var b=$tx.classNames(a),c=0;c<b.length;c++){var d=b[c];if(Trex.Button.__borderClasses[d])return d}}},hasState:_NULL,isDisabled:_NULL,lastValue:_NULL,lastText:_NULL,elButton:_NULL,elIcon:_NULL,borderClass:_NULL,_command:function(){},setCommand:function(a){this._command=a},initialize:function(a){var b=this.config=a;if(b.borderClass&&Trex.Button.addBorderClass(b.borderClass),this.itsNew=!!b.itsnew,this.hasState=!!b.status,this.isDisabled=_FALSE,this.lastValue=b.selectedValue||_NULL,a.el)this.elButton=a.el;else{var c=b.id||"tx_"+b.identity;this.elButton=$must(c+(b.initializedId||""))}var d=this.elButton,e=this.elIcon=$tom.collect(d,"a");if(!e)throw new Error("[Exception]Trex.Button : can't find elIcon for button '"+c+"'");this.borderClass=Trex.Button.getBorderClass(d),this.oninitialized&&this.oninitialized.bind(this)(b),this.generate(),this.itsNew&&$tom.append(e,Trex.MarkupTemplate.get("button.itsnew").evaluateAsDom({})),b.selectedValue&&this.setValue&&this.setValue(b.selectedValue),b.selectedText&&this.setText&&this.setText(b.selectedText),b.selectedState&&this.setState&&this.setState(b.selectedState)},generate:function(){var a=this.elIcon;this.hdlMouseDown=this.onMouseDown.bindAsEventListener(this),this.hdlMouseOver=this.onMouseOver.bindAsEventListener(this),this.hdlMouseOut=this.onMouseOut.bindAsEventListener(this),this.hdlKeydown=this.onKeyDown.bindAsEventListener(this),this.hdlClick=this.onClick.bindAsEventListener(this),$tx.observe(a,"mousedown",this.hdlMouseDown),$tx.observe(a,"mouseover",this.hdlMouseOver),$tx.observe(a,"mouseout",this.hdlMouseOut),$tx.observe(a,"keydown",this.hdlKeydown),$tx.observe(a,"click",this.hdlClick),this.ongenerated&&this.ongenerated.bind(this)(this.config)},removeHandler:function(){if(this.hdlMouseDown){var a=this.elIcon;$tx.stopObserving(a,"mousedown",this.hdlMouseDown),$tx.stopObserving(a,"mouseover",this.hdlMouseOver),$tx.stopObserving(a,"mouseout",this.hdlMouseOut),$tx.stopObserving(a,"keydown",this.hdlKeydown),$tx.stopObserving(a,"click",this.hdlClick)}},getCurrentBorderClass:function(a){for(var b=$tx.classNames(a),c=0;c<b.length;c++){var d=b[c];if(-1!=d.indexOf(this.borderClass))return d}return _UNDEFINED+""},normalState:function(){var a=this.getCurrentBorderClass(this.elButton);a!=this.borderClass&&($tx.removeClassName(this.elButton,a),$tx.addClassName(this.elButton,this.borderClass))},hoveredState:function(){var a=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,a),$tx.addClassName(this.elButton,this.borderClass+"-hovered"),this.decreaseZindex()},pushedState:function(){var a=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,a),$tx.addClassName(this.elButton,this.borderClass+"-pushed")},currentState:function(){var a=this.getCurrentBorderClass(this.elButton),b="normal";return-1!=a.indexOf("-pushed")?b="pushed":-1!=a.indexOf("-hovered")&&(b="hovered"),b},isPushed:function(){return"pushed"==this.currentState()},hasMenu:function(){return this.tool?!!this.tool.menu:_FALSE},onMouseDown:function(a){if(a&&$tx.stop(a),!this.isDisabled){if(this.hasMenu()||this.hasState){if(this._command(a)===_FALSE)return}else this.evsessionstarted=_TRUE;this.isPushed()?this.normalState():this.pushedState()}},onMouseOver:function(){this.isDisabled||this.isPushed()||this.hoveredState()},onMouseOut:function(){this.evsessionstarted&&(this.normalState(),this.evsessionstarted=_FALSE),this.isDisabled||this.isPushed()||this.normalState()},onClick:function(a){a&&$tx.stop(a),this.isDisabled||this.hasState||(this._event=a,this._command(),this.normalState(),this.evsessionstarted=_FALSE)},onKeyDown:function(a){13===a.keyCode&&(this.onMouseDown(a),this.onClick(a))},updateAfterCommand:function(a,b){this.setValueAndText(a,b),this.normalState()},setValueAndText:function(a,b){this.setValue(a),this.setText(b)},setValue:function(a){a&&(this.lastValue=a)},setText:function(a){this.lastText=a},getValue:function(){return this.lastValue},getText:function(){return this.lastText},setState:function(a){a?this.pushedState():this.normalState()},setClassName:function(a){this.elIcon.className=a},disable:function(){this.elButton&&(this.isDisabled=_TRUE,$tx.addClassName(this.elButton,"tx-disable"))},enable:function(){this.elButton&&!this._btnAlwaysDisabled&&(this.isDisabled=_FALSE,$tx.removeClassName(this.elButton,"tx-disable"))},release:function(){this.isDisabled||!this.hasMenu()&&this.hasState||this.normalState()},increaseZindex:function(){$tom.parent(this.elButton)&&$tx.setStyle($tom.parent(this.elButton),{zIndex:10})},decreaseZindex:function(){$tom.parent(this.elButton)&&$tx.setStyle($tom.parent(this.elButton),{zIndex:4})}}),Trex.Button.Select=Trex.Class.create({$extend:Trex.Button,ongenerated:function(){Trex.MarkupTemplate.get("button.select.text").evaluateToDom({data:$tom.getText(this.elIcon)},this.elIcon),this.elText=$tom.collect(this.elIcon,"span");var a=$tom.collect(this.elButton,"a.tx-arrow");a&&($tx.observe(a,"mousedown",this.onMouseDown.bindAsEventListener(this)),$tx.observe(a,"mouseover",this.onArrowMouseOver.bindAsEventListener(this)),$tx.observe(a,"mouseout",this.onArrowMouseOut.bindAsEventListener(this)),$tx.observe(a,"click",this.onClick.bindAsEventListener(this)))},setText:function(a){this.customLabelStyle&&this.customLabelStyle(),this.elText.innerText=a},onArrowMouseOver:function(){this.isDisabled||this.isPushed()||this.hoveredState()},onArrowMouseOut:function(){this.isDisabled||this.isPushed()||this.normalState()}}),Trex.Button.Splits=Trex.Class.create({$extend:Trex.Button,ongenerated:function(){var a=this.elButton,b=this.elArrow=$tom.collect(a,"a.tx-arrow");if(!b)throw new Error("[Exception]Trex.Button.Splits : not exist element(a.tx-arrow)");$tx.observe(b,"mousedown",this.onArrowMouseDown.bindAsEventListener(this)),$tx.observe(b,"mouseover",this.onArrowMouseOver.bindAsEventListener(this)),$tx.observe(b,"mouseout",this.onArrowMouseOut.bindAsEventListener(this)),$tx.observe(b,"click",this.onArrowClick.bindAsEventListener(this))},arrowHoveredState:function(){var a=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,a),$tx.addClassName(this.elButton,this.borderClass+"-arrow-hovered")},arrowPushedState:function(){var a=this.getCurrentBorderClass(this.elButton);$tx.removeClassName(this.elButton,a),$tx.addClassName(this.elButton,this.borderClass+"-arrow-pushed")},onMouseDown:function(){this.isDisabled||(this.isPushed()?(this._command(),this.normalState(),this.commandexecuted=_TRUE):(this.pushedState(),this.commandexecuted=_FALSE,this.evsessionstarted=_TRUE))},onClick:function(a){a&&$tx.stop(a),this.isDisabled||(this.commandexecuted?this.commandexecuted=_FALSE:(this.tool.execute(this.lastValue,this.lastText),this.evsessionstarted=_FALSE),this.normalState())},onArrowMouseDown:function(){this.isDisabled||this._command()!==_FALSE&&(this.isPushed()?this.normalState():this.arrowPushedState())},onArrowClick:function(a){a&&$tx.stop(a),this.isDisabled},onArrowMouseOver:function(){this.isDisabled||this.isPushed()||this.arrowHoveredState()},onArrowMouseOut:function(){this.isDisabled||this.isPushed()||(this.commandexecuted&&(this.commandexecuted=_FALSE),this.normalState())}}),Trex.Button.Toggle=Trex.Class.create({$extend:Trex.Button,setValue:function(a){a?this.pushedState():this.normalState()}}),Trex.Button.Widget=Trex.Class.create({$extend:Trex.Button.Select,setText:function(a){this.elIcon.innerText=a,this.lastText&&$tx.removeClassName(this.elIcon,this.lastText),$tx.addClassName(this.elIcon,a),this.lastText=a},setMenu:function(a,b){this.hasState=_TRUE;var c=this;a.setCommand(function(){var a=b.apply(this,arguments);return c.updateAfterCommand.apply(c,arguments),a}),c.setCommand(function(){if(c.isPushed())a.hide();else{var b=c.getValue();a.show(b)}return _TRUE})}}),Trex.Button.ColorWidget=Trex.Class.create({$extend:Trex.Button.Widget,setValue:function(a){$tx.setStyle(this.elIcon.parentNode,{backgroundColor:a}),this.lastValue=a},setText:function(){}}),TrexMessage.addMsg({"@menu.pallete.enter":Trex._I18N.g("menu.pallete.enter","입력"),"@menu.pallete.more":Trex._I18N.g("menu.pallete.more","더보기")}),Trex.Menu=Trex.Class.create({$mixins:[Trex.I.JobObservable],isInit:_FALSE,isDisplayed:_FALSE,_command:function(){},setCommand:function(a){this._command=a},initialize:function(a){var b,c=this.config=a,d=c.initializedId?c.initializedId:"";if(c.el){if(!(b=c.el))throw new Error("[Exception]Trex.Menu : not exist element("+c.el+")")}else{var e=c.id;if(!e){if(!c.identity)throw new Error("[Exception]Trex.Menu : not exist config - id");e="tx_"+c.identity+"_menu"}if(!(b=$tx(e+d)))throw new Error("[Exception]Trex.Menu : not exist element("+e+")")}this.elMenu=b,this.elPopupMenu=$tx("tx_popup_menu"+d),c.top&&(b.style.top=c.top+"px"),c.left&&(b.style.left=c.left+"px"),this.oninitialized&&this.oninitialized.bind(this)(a),this.ongenerated&&(this.generateHandler=this.ongenerated.bind(this)),this.onregenerated&&(this.regenerateHandler=this.onregenerated.bind(this))},generate:function(a){if(this.generateHandler){var b=this.config;this.generateHandler(b,a)}},regenerate:function(a){if(this.initHandler&&this.initHandler(),this.regenerateHandler){var b=this.config;this.regenerateHandler(b,a)}},getValidOptions:function(a){return a.options.findAll(function(a){return!a.expired})},onSelect:function(){var a=$A(arguments),b=a.shift();this._command.apply(this,a),this.hide(),b&&$tx.stop(b)},onCancel:function(){this.cancelHandler&&this.cancelHandler(),this.hide()},visible:function(){return this.isDisplayed},show:function(a){$tx.show(this.elMenu),this.isInit?this.regenerate(a):this.config.listseturl?this.lazyGenerate(a):(this.generate(a),this.isInit=_TRUE,this.regenerate(a)),this.showSpecial&&this.showSpecial();var b=$(this.elMenu),c=null,d=null;b.closest("li");if(b.closest("li").length>0&&(c=b.closest("li").position().left,d=b.closest(".tx-toolbar")),null!=c&&null!=d)if(c+b.outerWidth()>d.position().left+d.outerWidth()){var e=d.position().left+d.outerWidth()-(c+b.outerWidth()+10);b.css("left",e+"px")}else b.css("left","0");this.isDisplayed=_TRUE,this.fireJobs(Trex.Ev.__MENU_LAYER_SHOW,{detail:{menu:this}})},lazyGenerate:function(a){var b=this;new(Trex.Class.create({$mixins:[Trex.I.JSRequester],initialize:function(){this.importScript(b.config.listseturl,"utf-8",_DOC,function(){b.generate(),b.isInit=_TRUE,b.regenerate(a)})}}))},hide:function(){$tx.hide(this.elMenu),this.isDisplayed=_FALSE,this.fireJobs(Trex.Ev.__MENU_LAYER_HIDE,{detail:{menu:this}})},toggle:function(){this.isDisplayed?this.hide():this.show()},release:function(a){this.isInit&&this.hide(a)}}),Trex.MarkupTemplate.add("menu.select",'<ul class="tx-menu-list" unselectable="on">#{items}</ul>'),Trex.MarkupTemplate.add("menu.select.item",'<li class="tx-menu-list-item"><a class="#{klass}" href="javascript:;" unselectable="on">#{label}</a></li>'),Trex.Menu.Select=Trex.Class.create({$extend:Trex.Menu,generate:function(){var a=this.config,b=this.getValidOptions(a),c=this.generateList(b);$tom.insertFirst(this.elMenu,c),this.generateHandler&&this.generateHandler(a),this.ongeneratedList&&(this.generateList=this.ongeneratedList.bind(this)),this.ongeneratedListItem&&(this.generateListItem=this.ongeneratedListItem.bind(this))},generateList:function(a){for(var b=Trex.MarkupTemplate.get("menu.select").evaluateAsDom({items:this.generateListItem(a)}),c=$tom.collectAll(b,"li a"),d=0;d<a.length;d++){var e=a[d],f=c[d];$tx.observe(f,"click",this.onSelect.bindAsEventListener(this,e.data,e.title))}return b},generateListItem:function(a){for(var b=[],c=0;c<a.length;c++)b.push(Trex.MarkupTemplate.get("menu.select.item").evaluate(a[c]));return b.join("")},onSelect:function(){var a=$A(arguments),b=a.shift();this._command.apply(this,a),this.hide(),b&&$tx.stop(b)}}),Trex.MarkupTemplate.add("menu.items",['<table unselectable="on"><tbody>',"\t#{for:row}<tr>",'\t\t#{for:col}<td class="tx-menu-list-item">','<a href="javascript:;"><span class="#{klass}">','#{if:image!=""}<img src="#{image}" data="#{data}"/>#{/if:image}','#{if:image=""}#{data}#{/if:image}',"</span></a>","\t\t</td>#{/for:col}","\t</tr>#{/for:row}","</tbody></table>"].join("")),Trex.MarkupTemplate.add("menu.list",['<div class="tx-menu-inner">','\t<div class="tx-menu-list">',"   \t#{items}","    </div>","</div>"].join("")),Trex.Menu.List=Trex.Class.create({$extend:Trex.Menu,generate:function(){var a=this.config,b=this.getValidOptions(a);this.cols=a.cols||1,this.rows=a.rows||b.length;var c=this.generateList(b);$tom.insertFirst(this.elMenu,c),this.ongeneratedList&&(this.generateList=this.ongeneratedList.bind(this)),this.ongeneratedListItem&&(this.generateListItem=this.ongeneratedListItem.bind(this)),this.generateHandler&&this.generateHandler(a)},generateList:function(a){var b=Trex.MarkupTemplate.splitList(this.rows,this.cols,a),c=Trex.MarkupTemplate.get("menu.list").evaluateAsDom({items:Trex.MarkupTemplate.get("menu.items").evaluate(b)});return $tx.observe(c,"click",this.onSelect.bindAsEventListener(this)),$tx.observe(c,"mouseover",this.onItemMouseOver.bindAsEventListener(this)),$tx.observe(c,"mouseout",this.onItemMouseOut.bindAsEventListener(this)),c},onItemMouseOver:function(a){var b=$tx.findElement(a,"span");b.tagName&&"span"==b.tagName.toLowerCase()&&$tx.addClassName(b,"tx-item-hovered"),$tx.stop(a)},onItemMouseOut:function(a){var b=$tx.findElement(a,"span");b.tagName&&"span"==b.tagName.toLowerCase()&&$tx.removeClassName(b,"tx-item-hovered"),$tx.stop(a)},onSelect:function(a){var b=$tx.findElement(a,"span");if(b.tagName&&"span"==b.tagName.toLowerCase()){var c;c=b.firstChild&&1==b.firstChild.nodeType&&"img"==b.firstChild.tagName.toLowerCase()?$tom.getAttribute(b.firstChild,"data")||"":b.innerText,this._command(c),this.hide()}$tx.stop(a)}}),Trex.MarkupTemplate.add("menu.matrix",['<div class="tx-menu-inner">','\t<ul class="tx-menu-matrix-title">','\t\t#{for:matrices}<li class=""><a href="javascript:;" class="tx-menu-matrix-title-item">#{title}</a></li>#{/for:matrices}',"\t</ul>",'\t<div class="tx-menu-matrix-listset">','   \t#{for:matrices}<div class="tx-menu-matrix-list #{klass}">',"       \t#{items}","\t\t</div>#{/for:matrices}","    </div>","</div>"].join("")),Trex.Menu.Matrix=Trex.Class.create({$extend:Trex.Menu,generate:function(){var a=this.config,b=this.matrices=a.matrices.findAll(function(a){return!a.onlyIE||$tx.msie});this.cols=a.cols||10,this.rows=a.rows||5;var c=this.generateMatrix(b);$tom.insertFirst(this.elMenu,c),this.ongeneratedList&&(this.generateList=this.ongeneratedList.bind(this)),this.ongeneratedListItem&&(this.generateListItem=this.ongeneratedListItem.bind(this)),this.generateHandler&&this.generateHandler(a),this.showTab()},regenerate:function(){if(this.showTab(),this.regenerateHandler){var a=this.config;this.regenerateHandler(a)}},showTab:function(){var a=this.lastElList,b=this.lastElTitleItem;(!a||!b)&&(a=this.defaultElListItem,b=this.defaultElTitleItem),this.onTitleClick(_NULL,b,a)},generateMatrix:function(a){var b=this,c=this.cols,d=this.rows;a.each(function(a){var b=Trex.MarkupTemplate.splitList(d,c,a.options);a.items=Trex.MarkupTemplate.get("menu.items").evaluate(b)});var e=Trex.MarkupTemplate.get("menu.matrix").evaluateAsDom({matrices:a}),f=$tom.collectAll(e,"div.tx-menu-matrix-listset div.tx-menu-matrix-list"),g=$tom.collectAll(e,"ul.tx-menu-matrix-title li"),h=function(){for(var b=0,c=a.length;b<c;b++)if(a[b].defaultshow)return b;return 0}();this.defaultElListItem=f[h],this.defaultElTitleItem=g[h];for(var i=0;i<a.length;i++){var j=f[i];$tx.observe(j,"click",b.onSelect.bindAsEventListener(b)),$tx.observe(j,"mouseover",b.onItemMouseOver.bindAsEventListener(b)),$tx.observe(j,"mouseout",b.onItemMouseOut.bindAsEventListener(b));var k=g[i];$tx.observe(k,"click",b.onTitleClick.bindAsEventListener(b,k,j))}return e},onTitleClick:function(a,b,c){this.lastElList!=c&&($tx.show(c),this.lastElList&&$tx.hide(this.lastElList),this.lastElList=c,this.lastElTitleItem&&$tx.removeClassName(this.lastElTitleItem,"tx-selected"),$tx.addClassName(b,"tx-selected"),this.lastElTitleItem=b),a&&$tx.stop(a)},onItemMouseOver:function(a){var b=$tx.findElement(a,"span");b.tagName&&"span"==b.tagName.toLowerCase()&&$tx.addClassName(b,"tx-item-hovered"),$tx.stop(a)},onItemMouseOut:function(a){var b=$tx.findElement(a,"span");b.tagName&&"span"==b.tagName.toLowerCase()&&$tx.removeClassName(b,"tx-item-hovered"),$tx.stop(a)},onSelect:function(a){var b=$tx.findElement(a,"span");b.tagName&&"span"==b.tagName.toLowerCase()&&(this._command(b.innerText),this.hide()),$tx.stop(a)}}),Trex.MarkupTemplate.add("menu.colorPallete",['<div class="tx-menu-inner">','<ul class="tx-pallete-text-list"></ul>','<ul class="tx-pallete-thumb-list"></ul>','<p class="tx-pallete-input"><span style="background-color: rgb(7, 3, 3);"></span><input type="text" class="tx-color-value"/><a class="'+Trex._I18N.g("tx-enter","tx-enter")+'">@menu.pallete.enter</a></p>','<div class="tx-pallete-buttons">','\t<p class="tx-pallete-more"><a class="tx-more-down" href="javascript:;">@menu.pallete.more</a></p>',"</div>",'<div class="tx-pallete-picker">','\t<div class="tx-pallete-pickerbox">','\t\t<div class="tx-chromabar" style="background-color: rgb(255, 0, 0);"></div><div class="tx-huebar"></div>',"\t</div>","</div>","</div>"].join("")),Trex.Menu.ColorPallete=Trex.Class.create({$extend:Trex.Menu,$mixins:[Trex.I.ColorPallete],generate:function(){var a=this.config,b=this.elMenu;Trex.MarkupTemplate.get("menu.colorPallete").evaluateToDom({},b),a.colorInputHidden&&$(b).find(".tx-pallete-input").hide();var c=a.thumbs.transparent;if(a.thumbs.transparent=Object.extend(a.thumbs.transparent,{image:TrexConfig.getIconPath(c.image),thumb:TrexConfig.getIconPath(c.thumb),thumbImage:TrexConfig.getIconPath(c.thumbImage)}),!this.hookEvent)throw new Error("[Exception]Trex.Menu.ColorPallete : not implement function(hookEvent)");this.hookEvent(a),this.generateHandler&&this.generateHandler(a),this.bindEvents()},onSelect:function(){var a=$A(arguments),b=a.shift();this._command.apply(this,a),this.remainColor(a),this.hide(),b&&$tx.stop(b)},remainColor:function(a){a&&this.setColorValueAtInputbox(a)},bindEvents:function(){var a=this;$tx.observe(this.elMore,"click",function(b){a.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,{detail:{menu:a}})})}}),$tx.msie&&Trex.module("add menu layer shield for IE flash object",function(a,b,c,d){function e(a){var b;try{b=a.config.id?a.config.id+a.config.initializedId:a.config.el.className}catch(a){b="unknown"}return b}Trex.MarkupTemplate.add("menu.shield",['<div class="tx-menu-back" style="overflow:hidden;position:absolute;border:0;">','<iframe src="about:blank" width="100%" height="100%" frameborder="0"></iframe>',"</div>"].join(""));var f=Trex.Class.create({initialize:function(a,b){this.id=a,this.menuEl=b,this.shieldEl=Trex.MarkupTemplate.get("menu.shield").evaluateAsDom({})},show:function(){this.update(),$tom.insertAt(this.shieldEl,this.menuEl),$tx.show(this.shieldEl)},hide:function(){$tx.hide(this.shieldEl),$tom.remove(this.shieldEl)},update:function(){var a={width:this.menuEl.offsetWidth.toPx(),height:this.menuEl.offsetHeight.toPx(),left:$tx.getStyle(this.menuEl,"left"),top:$tx.getStyle(this.menuEl,"top")};$tx.setStyle(this.shieldEl,a)},destroy:function(){this.id=_NULL,this.menuEl=_NULL,this.shieldEl=_NULL}}),g=Trex.Class.create({initialize:function(){this.entry={}},show:function(a,b){var c=this.entry[a];if(!c){var d=new f(a,b);this.entry[a]=c=d}c.show()},hide:function(a){var b=this.entry[a];b&&(b.hide(),b.destroy(),delete this.entry[a])},updateAll:function(){var a=this.entry;setTimeout(function(){for(var b in a)a.hasOwnProperty(b)&&a[b].update()},1)}}),h=new g;b.observeJob(Trex.Ev.__MENU_LAYER_SHOW,function(a){var b=a.detail.menu;h.show(e(b),b.elMenu)}),b.observeJob(Trex.Ev.__MENU_LAYER_HIDE,function(a){var b=a.detail.menu;h.hide(e(b))}),b.observeJob(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,function(a){h.updateAll()})}),Trex.Editor=Trex.Class.create({$mixins:[Trex.I.JobObservable,Trex.I.KeyObservable],toolbar:_NULL,sidebar:_NULL,canvas:_NULL,config:_NULL,initialConfig:_NULL,initialize:function(a){function b(){if(l.is(":visible")){try{o.body.innerHTML=""}catch(a){}l.hide()}}this.initialConfig=a;var c=this,d=this.config=TrexConfig.setup(a),e=this.canvas=new Trex.Canvas(c,d),f=this.toolbar=new Trex.Toolbar(c,d),g=this.sidebar=new Trex.Sidebar(c,d);Trex.invokeInstallation(c,f,g,e,d);var h=d.events,i=function(a){h.useHotKey&&c.fireKeys(a)};$tx.observe(_DOC,"keydown",i.bindAsEventListener(this),_FALSE),c.observeJob(Trex.Ev.__IFRAME_LOADING_TIME,function(a){}),e.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var b=(new Date).getTime(),d=Math.round((b-Editor.initStartTime)/100)/10;c.fireJobs(Trex.Ev.__IFRAME_LOADING_TIME,d);var f=c.getInitializedId(),g=$tx("tx_loading"+f);g&&(e.mode!=Trex.Canvas.__WYSIWYG_MODE&&e.fireJobs(Trex.Ev.__CANVAS_MODE_INITIALIZE,Trex.Canvas.__WYSIWYG_MODE,e.mode),($tx.chrome||$tx.msie&&11==$tx.msie_ver)&&(c._imageResizeCtrl=new Trex.KEditor.ImageResizeCtrl(c,e)),a.deferred&&a.initializedId?Editor.__MULTI_LIST[a.initializedId]?($tx.hide(g),a.deferred.resolve(c)):(c.waitEventCnt=0,c.waitEvent=setInterval(function(){Editor.__MULTI_LIST[a.initializedId]&&($tx.hide(g),a.deferred.resolve(c))},100)):$tx.hide(g))}),e.observeJob(Trex.Ev.__CANVAS_PANEL_PASTE_CUSTOM_KEY,function(a){c.kEditor&&Trex.KEditor.eventPaste(c.kEditor,a,!1)}),e.observeJob(Trex.Ev.__CANVAS_PANEL_PASTE_CUSTOM,function(a){c.kEditor&&Trex.KEditor.eventPaste(c.kEditor,a,!0)}),e.observeJob(Trex.Ev.__CANVAS_PANEL_DROP,function(a){c.kEditor&&(c.kEditor._eventDrop?1!=c.kEditor._eventDrop(a)&&Trex.KEditor.eventDrop(c.kEditor,a):Trex.KEditor.eventDrop(c.kEditor,a))}),Trex.invokeRegisters(c,f,g,e,d),Trex.invokeModules(c,f,g,e,d),this.cleanupBtn=$("#tx_cleanup"+d.initializedId||"").closest("li");try{var j=$("<canvas></canvas>").appendTo($(document.body));try{j[0].toDataURL("image/jpeg",0),Trex.Image._SUPPORT_JPEG_QUALITY=!0}catch(a){Trex.Image._SUPPORT_JPEG_QUALITY=!1}j.remove()}catch(a){Trex.Image._SUPPORT_JPEG_QUALITY=!1}var k=$("#tx_bottom_tab"+d.initializedId||""),l=$("#tx_preview_wrapper"+d.initializedId||""),m=$("#tx_trex_container"+d.initializedId||""),n=$("#tx_preview"+d.initializedId||"")[0],o=null;n&&(o=n.contentWindow.document),this.initPreviewIframe=function(){o&&(o.open(),o.write(d.previewInitHTML?d.previewInitHTML():"<html><head></head><body></body></html>"),o.close())},k.length>0&&"none"!=k[0].style.display&&($(".tx-bottom-tab-bar .editor",k).on("click",function(){b(),m.is(":visible")||m.show(),$(".tx-bottom-tab-bar .tx-bottom-tab",k).removeClass("selected"),$(this).addClass("selected"),"html"!=e.mode&&e.changeMode("html")}),$(".tx-bottom-tab-bar .html",k).on("click",function(){b(),m.is(":visible")||m.show(),$(".tx-bottom-tab-bar .tx-bottom-tab",k).removeClass("selected"),$(this).addClass("selected"),"source"!=e.mode&&e.changeMode("source")}),$(".tx-bottom-tab-bar .preview",k).on("click",function(){$(".tx-bottom-tab-bar .tx-bottom-tab",k).removeClass("selected"),$(this).addClass("selected"),"html"!=e.mode&&e.changeMode("html"),m.is(":visible")&&m.hide(),l.is(":visible")||(l.show(),o.body.innerHTML=d.previewBodyHTML())}))},showCleanupBtn:function(a){this.cleanupBtn[!1===a?"hide":"show"]()},setTranslate:function(a){this.canvas.translateFn=a,this.canvas.translateFn?$(".tx-toolbar-boundary ul.tx-group-translate",this.toolbar.el).show():$(".tx-toolbar-boundary ul.tx-group-translate",this.toolbar.el).hide()},getToolbar:function(){return this.toolbar},getSidebar:function(){return this.sidebar},getCanvas:function(){return this.canvas},getUsedWebfont:function(){return this.canvas.getUsedWebfont()},getConfig:function(){return this.config},getInitialConfig:function(){return this.initialConfig},getParam:function(a){var b={},c=this.config;return c.params.each(function(a){c[a]&&(b[a]=c[a])}),b[a]},getWrapper:function(){if(!this.initialConfig.wrapper)throw new Error("`wrapper` config variable should be provided");return $must(this.initialConfig.wrapper)},getInitializedId:function(){return this.initialConfig.initializedId||""},saveEditor:function(){this.setDisableUnloadHandler(),this.getSaver().submit()},loadEditor:function(a){this.getSaver().load(a)},getContent:function(){return this.getSaver().getContent()},getAttachments:function(a,b){return this.getSaver().getAttachments(a,b)},getEmbeddedData:function(a){return this.getSaver().getEmbeddedData(a)},getResults:function(a){return this.getSaver().getResults(a)},getAutosaveSeq:function(){return this.getAutoSaver&&this.getAutoSaver()?this.getAutoSaver().getCurSeq():"0"},getImagePasteLayer:function(){return this.imagePasteLayer||(this.imagePasteLayer=new Trex.Image.ImageInfo(this,this.toolbar,this.canvas,this.config,"paste")),this.imagePasteLayer}}),function(){_WIN.Editor=Trex.Class.create({$const:{__ACTIVE:_FALSE,__PANEL_LOADED:_FALSE,__EDITOR_LOADED:_FALSE,__MULTI_LIST:[],__SELECTED_INDEX:0},_initEditor:function(a,b){Editor.__EDITOR_LOADED=_FALSE,Editor.__PANEL_LOADED=_FALSE,a=new Trex.Editor(b);var c=a.getInitializedId();if(c!=_NULL){var d=""==c?0:c;Editor.__MULTI_LIST[d]=a,Editor.__SELECTED_INDEX=d}Object.extend(Editor,a),Editor.__EDITOR_LOADED=_TRUE,Editor.__ACTIVE=_TRUE},initialize:function(a){Trex.hmailLogging&&Trex.hmailLogging(a),Editor.initStartTime=(new Date).getTime();var b=null;if(_WIN.DEBUG)this._initEditor(b,a);else try{this._initEditor(b,a)}catch(a){if(!b)throw"failed to initialize editor. caused by "+a;throw b.fireJobs(Trex.Ev.__RUNTIME_EXCEPTION,a),a}}}),Editor.modify=function(a){Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.loadEditor&&this.loadEditor(a):setTimeout(this.modify.bind(this,a),10)},Editor.restore=function(a){Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.getAutoSaver&&this.getAutoSaver()&&this.getAutoSaver().load(a):setTimeout(this.restore.bind(this,a),10)},Editor.save=function(){return Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.saveEditor&&this.saveEditor():setTimeout(this.saveEditor.bind(this),10),_FALSE},Editor.focus=function(){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){var a=this.getCanvas();a&&a.focus()}else setTimeout(this.focus.bind(this),10);return _FALSE},Editor.focusOnTop=function(){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){var a=this.getCanvas();a&&a.focusOnTop()}else setTimeout(this.focusOnTop.bind(this),10);return _FALSE},Editor.focusOnBottom=function(){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){var a=this.getCanvas();a&&a.focusOnBottom()}else setTimeout(this.focusOnBottom.bind(this),10);return _FALSE},Editor.permitUnload=function(){Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED?this.setDisableUnloadHandler():setTimeout(this.permitUnload.bind(this),500)},Editor.onPanelLoadComplete=function(a){Editor.__PANEL_LOADED==_TRUE&&Editor.__EDITOR_LOADED==_TRUE?a&&a():setTimeout(Editor.onPanelLoadComplete.bind(Editor,a),500)},Editor.switchEditor=function(a){Editor.__SELECTED_INDEX=a,Object.extend(Editor,Editor.__MULTI_LIST[a])},Editor.editorForAsyncLoad=Editor,Editor.forEachEditor=function(a){var b,c=Editor.__MULTI_LIST,d=[];for(b in c)if(c.hasOwnProperty(b)){try{if(0==$("#tx_trex_container"+c[b].kEditor.eInstanceId).length){d.push(b);continue}}catch(a){continue}a(c[b])}for(var e=0;e<d.length;e++)delete c[d[e]]},Editor.isValidEditor=function(a){try{var b=Editor.__MULTI_LIST,c=b[a];if(!c)return!1;if(0==$("#tx_trex_container"+c.kEditor.eInstanceId).length)return delete b[a],!1}catch(a){return!1}return!0},Editor.focusOnForm=function(a){if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){_WIN.focus();var b=Editor.getForm();b.getElementByName(a)&&b.getElementByName(a).focus()}else setTimeout(Editor.focusOnForm.bind(Editor,a),500);return _FALSE},Editor.fromHdrive=function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c]);var d={content:"",attachments:b};if(Editor.__PANEL_LOADED&&Editor.__EDITOR_LOADED){if(this.loadEditor){this.loadEditor(d);for(var e=Editor.getAttachBox().datalist,f=0;f<e.length;f++)e[f].execAppend()}}else setTimeout(this.fromHdrive.bind(this,a),10)},Editor.refreshSize=function(){this.canvas.fireJobs(Trex.Ev.__CANVAS_WRAP_WIDTH_CHANGE)},Editor.prototype.switchEditor=Editor.switchEditor,Editor.prototype.focusOnForm=Editor.focusOnForm}(),Trex.Toolbar=Trex.Class.create({$mixins:[Trex.I.JobObservable],el:_NULL,tools:_NULL,initialize:function(a,b){this.canvas=a.getCanvas();var c=b.initializedId||"";this.el=$must("tx_toolbar_basic"+c,"Trex.Toolbar")},disableToolbar:function(){var a=this.tools;for(var b in a)a[b].button&&a[b].button.disable()},serializeToolValues:function(){var a=this.tools,b={};for(var c in a){var d=a[c];b[c]=d.button.lastValue}return b},widgetSeq:0,makeWidget:function(a,b,c){var d=this,e=this.canvas,f=new function(){this.identity="widget"+ ++d.widgetSeq,this.wysiwygonly=_TRUE,this.menuFoldAuto=_TRUE,this.canvas=e,this.toolbar=d};return Trex.Tool.prototype.weave.bind(f)(a,b,c),this.tools[f.identity]=f,f}}),Trex.install("editor.getTool",function(a,b){var c=b.tools={};a.getTool=function(a){return c[a]!=_NULL?c[a]:0==arguments.length?c:_NULL}}),Trex.register("new tools",function(a,b,c,d,e){var f=b.tools,g=e.initializedId||"";for(var h in Trex.Tool){var i=Trex.Tool[h].__Identity;if(i){var j=TrexConfig.getTool(i,e);j.initializedId=g,Trex.available(j,i+g)&&(f[i]=new Trex.Tool[h](a,b,j))}}d.config.readonly&&b.disableToolbar()}),Trex.module("bind events with tools",function(a,b,c,d){var e=b.tools,f=function(){var a,b,c;if($tx.ios||$tx.android)for(a in e)b=e[a],b.disabledonmobile&&(c=b.button,c.disable())};f();var g=function(a,b){if(a!=b){for(var c in e){var d=e[c],g=d.button;Trex.Canvas.__WYSIWYG_MODE==b?g.enable():Trex.Canvas.__WYSIWYG_MODE==a&&(d.wysiwygonly?g.disable():g.enable())}f()}};d.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,g),d.observeJob(Trex.Ev.__CANVAS_MODE_INITIALIZE,g);var h=function(a){for(var b in e){var c=e[b];a!=c.identity&&(c.button&&(c.button.release(),c.button.decreaseZindex()),c.menu&&c.menuFoldAuto&&c.menu.release())}};d.observeJob(Trex.Ev.__CANVAS_PANEL_CLICK,h),d.observeJob(Trex.Ev.__CANVAS_SOURCE_PANEL_CLICK,h),d.observeJob(Trex.Ev.__CANVAS_TEXT_PANEL_CLICK,h),b.observeJob(Trex.Ev.__TOOL_CLICK,h),d.observeKey({ctrlKey:_FALSE,altKey:_FALSE,shiftKey:_FALSE,keyCode:27},h),a.observeKey({ctrlKey:_FALSE,altKey:_FALSE,shiftKey:_FALSE,
keyCode:27},h),$tx.observe(_DOC,"click",function(a){var b=$tx.element(a),c=["tx-sidebar","tx-toolbar-basic","tx-toolbar-advanced","tx-sidebar-boundary","tx-toolbar-boundary","tx-toolbar-boundary"];Trex.Util.getMatchedClassName(b,c)&&h("-")},_FALSE);var i=function(){a.fireJobs(Trex.Ev.__SHOULD_CLOSE_MENUS)};b.observeJob(Trex.Ev.__TOOL_CLICK,i)}),Trex.Tool=Trex.Class.draft({identity:_NULL,button:_NULL,menu:_NULL,initialize:function(a,b,c){if(!this.constructor.__Identity)throw new Error("[Exception]Trex.Tool : not implement const(__Identity)");if(this.identity=this.constructor.__Identity,!a)throw new Error("[Exception]Trex.Tool : not exist argument(editor)");this.editor=a,this.toolbar=b,this.canvas=a.getCanvas(),this.config=c,this.wysiwygonly=c.wysiwygonly!=_NULL?c.wysiwygonly:_TRUE,this.menuFoldAuto=c.menuFoldAuto!=_NULL?c.menuFoldAuto:_TRUE,c.disabledonmobile!=_NULL&&(this.disabledonmobile=c.disabledonmobile),this.buttonCfg=TrexConfig.merge({id:"tx_"+this.identity},c),this.menuCfg=TrexConfig.merge({id:"tx_"+this.identity+"_menu"},c),this.oninitialized.bind(this)(c)},oninitialized:function(){throw new Error("[Exception]Trex.Tool : not implements function(oninitialized)")},weave:function(a,b,c,d){var e=this,f=this.identity,g=this.toolbar,h=this.canvas;this.button=a,a.tool=this;var i=_NULL;b?(this.menu=b,b.tool=this,b.initHandler=d||function(){},b.cancelHandler=function(){a.setState(_FALSE)},b.setCommand(i=function(){var b=arguments,d=c.apply(e,b);return d===$stop?a.normalState.apply(a,b):a.updateAfterCommand.apply(a,b),d}),a.setCommand(function(c){if(g.fireJobs(Trex.Ev.__TOOL_CLICK,f,c),a.isPushed()){if(b.hide(),$tx.msie){var d=h.getProcessor();d.restoreRange&&setTimeout(function(){d.restoreRange()},0)}}else{var e=a.getValue();a.increaseZindex(),b.show(e)}return _TRUE}),b.observeJob(Trex.Ev.__MENU_LAYER_SHOW,function(a){g.fireJobs(Trex.Ev.__MENU_LAYER_SHOW,a)}),b.observeJob(Trex.Ev.__MENU_LAYER_HIDE,function(a){g.fireJobs(Trex.Ev.__MENU_LAYER_HIDE,a)}),b.observeJob(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,function(a){g.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,a)})):a.setCommand(i=function(){return g.fireJobs(Trex.Ev.__TOOL_CLICK,f),c.apply(e,arguments)}),this.execute=i},resetWeave:function(){null!=this.button&&(this.button.removeHandler(),this.button.normalState(),this.button=_NULL,this.menu=_NULL,this.execute=_NULL)},forceActivate:function(){this.button&&this.menu&&(this.button.pushedState(),this.button.increaseZindex(),this.menu.show())},bindKeyboard:function(a,b){var c=this.toolbar,d=this.identity;this.canvas.observeKey(a,function(a){b(a),c.fireJobs(Trex.Ev.__TOOL_SHORTCUT_KEY,d)})}}),Trex.AsyncTool=Trex.Class.draft({$extend:Trex.Tool,oninitialized:function(){throw this.loaded=!1,new Error("[Exception]Trex.AsyncTool : not implements function(oninitialized)")},onLoadModule:function(){var a=this,b=this.config.asyncUrl;if(!1===/^(?:\/\/)|(?:\w+:\/\/)/.test(b)&&(b=this.getJSBasePath()+b),"development"==EditorJSLoader.getOption("environment")){var c=(new Date).getTime();-1===b.indexOf("?")?b+="?open&dummy="+c:b+="&dummy="+c}else EditorJSLoader._VER&&(b+=(-1===b.indexOf("?")?"?open&":"&")+"_ver="+EditorJSLoader._VER);Editor.editorForAsyncLoad=this.editor,EditorJSLoader.asyncLoadModule({url:TrexConfig.getUrl(b),callback:function(){a.loaded=!0}})},getJSBasePath:function(){var a;try{a=EditorJSLoader.getJSBasePath("editor.js")}catch(b){a=EditorJSLoader.getJSBasePath()}return a}}),Trex.I.Tool={},Trex.I.Tool.QueryStyle={},Trex.I.Tool.QueryStyle.Standard=Trex.Mixin.create({queryNodeStyle:function(a,b,c,d){return $tx.getStyle(a,b).include(c)}}),Trex.I.Tool.QueryStyle.Gecko=Trex.Mixin.create({queryNodeStyle:function(a,b,c,d){for(var e=a,f=_FALSE;e&&!$tom.isBody(e)&&!f;)f=$tom.isTagName(e,d)?_TRUE:$tx.getStyle(a,b).include(c),e=e.parentNode;return f}}),Trex.Sidebar=Trex.Class.create({$const:{__REG_ENTRY_ATTR_PAIR_Q:new RegExp('([\\w]+)="([^"]+)"',"g"),__REG_ENTRY_ATTR_PAIR_NQ:new RegExp("([\\w]+)=([\\w]+)","g")},$mixins:[Trex.I.JobObservable],entryboxRegistry:_NULL,initialize:function(a){var b=a.getCanvas();this.entryboxRegistry={},this.getFields=function(){var a=[];for(var b in this.entryboxRegistry){var c=this.entryboxRegistry[b];a=a.concat(c.getFields())}return a},this.syncSidebar=function(){var a=b.getContent();for(var c in this.entryboxRegistry)this.entryboxRegistry[c].syncBox(a)},this.emptyEntries=function(){for(var a in this.entryboxRegistry)this.entryboxRegistry[a].empty()}}}),Trex.EntryBox=Trex.Class.draft({$mixins:[Trex.I.JobObservable],autoSeq:0,datalist:[],initialize:function(){throw new Error("[Exception]Trex.EntryBox : not implements function(initialize)")},newSeq:function(){return++this.autoSeq},syncSeq:function(a){return this.autoSeq=a>this.autoSeq?a:this.autoSeq,a},empty:function(){this.fireJobs(Trex.Ev.__ENTRYBOX_ALL_ENTRY_REMOVED),this.datalist=[]},append:function(a){this.datalist.push(a),this.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_ADDED,a)},modify:function(a){this.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_MODIFIED,a)},remove:function(a){a.deletedMark=_TRUE,this.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_REMOVED,a)},syncBox:function(a){this.datalist.each(function(b){b.execSync(a)})},getFields:function(){var a=[];return this.datalist.each(function(b){a.push(b.getField())}),a.findAll(function(a){return a!=_NULL})},getEntries:function(a){if(!a)return this.datalist;var b=[];return this.datalist.each(function(c){c.type==a&&b.push(c)}),b}}),Trex.Entry=Trex.Class.draft({$mixins:[Trex.I.JobObservable],existStage:_FALSE,deletedMark:_FALSE,initialize:function(){throw new Error("[Exception]Trex.Entry : not implements function(initialize)")},setExistStage:function(a){this.existStage=a},execRegister:function(){this.register(),this.entryBox.append(this),this.setExistStage(_TRUE)},execReload:function(){this.reload&&this.reload(),this.entryBox.append(this),this.exchangeHandlerAtReload()},execRemove:function(){this.remove(),this.entryBox.remove(this)},execReplace:function(a){this.replace(a),this.entryBox.modify(this),this.setExistStage(_TRUE)},execAppend:function(){this.register(),this.setExistStage(_TRUE)},execSync:function(a){this.setExistStage(this.checkExisted(a))},checkExisted:function(a){return this.canvas.isWYSIWYG()?a.search(this.regHtml)>-1:a.search(this.regText)>-1},getChangedContent:function(a,b,c,d){var e=_FALSE;return a.search(b)>-1&&(e=_TRUE,a=this.actor.canResized?this.getChangedContentWithAttr(a,b,c,d):a.replace(b,c)),this.setExistStage(e),a},getChangedContentFromHtml:function(a){return this.getChangedContent(a,this.regHtml,this.dispText,["id","class"])},getChangedContentToHtml:function(a){return this.getChangedContent(a,this.regText,this.dispHtml)},getChangedContentAtSave:function(a){return this.getChangedContent(a,this.regHtml,this.saveHtml,["id","class"])},getChangedContentAtLoad:function(a){return this.getChangedContent(a,this.regLoad,this.dispHtml)},getChangedContentWithAttr:function(a,b,c,d){d=d||[];var e,f=Trex.Util.getAllAttributes(c),g=a;for(b.lastIndex=0;(e=b.exec(g))!=_NULL;){var h=e[0],i=function(a){var b=Trex.Util.getMatchValue(/<([a-z]*)/i,c,1),e=["<"+b.toLowerCase()],g=Trex.Util.getAllAttributes(a);for(var h in f)["width","height"].contains(h)?g[h]||e.push(h+'="'+f[h]+'"'):e.push(h+'="'+f[h]+'"');for(var h in g)d.contains(h)||(["width","height"].contains(h)?e.push(h+'="'+g[h]+'"'):f[h]||e.push(h+'="'+g[h]+'"'));return e.push("/>"),e.join(" ")}(h),j=h.getRegExp();a=a.replace(new RegExp(j,"gmi"),i)}return a},getField:function(){return this.field?{name:this.field.name,value:[this.field.value,this.existStage].join("|")}:_NULL},exchangeHandlerAtReload:function(){}}),Trex.Actor=Trex.Class.draft({$mixins:[Trex.I.JobObservable],isDisabled:_FALSE,initialize:function(){throw new Error("[Exception]Trex.Actor : not implements function(initialize)")},execAttach:function(a,b){var c=this.createEntry(this.getDataForEntry(a),b);c.execRegister(),this.canvas.fireJobs("canvas."+(b||this.constructor.__Identity)+".added",c)},getDatalist:function(){return this.entryBox.getEntries(this.name)},execReattach:function(a,b){var c=this.getDatalist(),d=this.getDataForEntry(a);if(c.length<1){var e=this.createEntry(d,b);e.execRegister()}else{var e=c[0],f={regHtml:e.regHtml,regText:e.regText};e.setProperties(d),e.execReplace(f)}},execReload:function(a,b,c){var d=this.getDataForEntry(a,b);if(d){this.createEntry(d,c).execReload()}},existEntry:function(){return 0!==this.getDatalist().findAll(function(a){return a.deletedMark!=_TRUE}).length},getFirstEntryData:function(){var a=this.getDatalist().findAll(function(a){return a.deletedMark!=_TRUE});return 0==a.length?_NULL:a[0].data}}),Trex.install("editor.getDocParser",function(a,b,c,d,e){var f=new Trex.Docparser(a,c,e);a.getDocParser=function(){return f}}),Trex.Docparser=Trex.Class.create({initialize:function(a,b,c){this.editor=a,this.sidebar=b,this.config=c},filters:{},registerFilter:function(a,b){this.filters[a]=b},getFilter:function(a){return this.filters[a]},executeFilters:function(a,b){var c=this.filters;return["before "+a,a,"after "+a].each(function(a){var d,e;for(d in c)c.hasOwnProperty(d)&&(e=c[d],e[a]&&(b=e[a](b)))}),b},getContentsAtChangingMode:function(a,b,c){return b==c?a:(a=a.trim()||"",this.executeFilters(b.concat("2").concat(c),a))},convertAtLoad:function(a,b,c){return"original"==c?a=this.executeFilters(b.concat("@load"),a):b!=c&&(a=this.executeFilters(c.concat("2").concat(b),a)),a},convertAtSave:function(a,b,c){return"original"==c?a=this.executeFilters(b.concat("4save"),a):b!=c&&(a=this.executeFilters(b.concat("2").concat(c),a)),a},text2source:function(a){return this.executeFilters("text2source",a)},text2html:function(a){return""===a?$tom.EMPTY_PARAGRAPH_HTML:this.executeFilters("text2html",a)},source2text:function(a){return this.executeFilters("source2text",a)},source2html:function(a){return""===a?$tom.EMPTY_PARAGRAPH_HTML:this.executeFilters("source2html",a)},html2text:function(a){return this.executeFilters("html2text",a)},html2source:function(a){return this.executeFilters("html2source",a)}}),Trex.install("editor.getEntryProxy",function(a,b,c,d,e){var f=new Trex.EntryProxy(a,c,e);a.getEntryProxy=function(){return f}}),Trex.EntryProxy=Trex.Class.create({initialize:function(a,b,c){this.editor=a,this.sidebar=b,this.config=c},commands:{},registerCommand:function(a,b){this.commands[a]=b},getcommand:function(a){return this.commands[a]},executeCommand:function(a,b){for(var c in this.commands){var d=this.commands[c];d[a]&&d[a](b)}},setAttachments:function(a,b){a=a||[],b=b||"",this.editor.getAttachBox().empty();var c=this.sidebar.getAttacher();a.each(function(a){try{var d=c[a.attacher];d&&d.execReload(a.data,b,a.type)}catch(a){}})},getAttachments:function(a,b){b=!!b;var c=[];return a.each(function(a){a.deletedMark||(b||a.existStage)&&c.push({type:a.type,attacher:a.actor.name,existStage:a.existStage,data:Object.extend(a.data,{tmpSeq:a.dataSeq})})}),c}}),Trex.install("editor.getForm",function(a,b,c,d,e){var f=new Trex.FormProxy(a,c,e);a.getForm=function(){return f}}),Trex.FormProxy=Trex.Class.create({initialize:function(a,b,c){this.editor=a,this.sidebar=b,this.config=c;var d=this.elForm=_DOC.forms[c.form]||_DOC.getElementById(c.form);if(!d)throw new Error("[Exception]Trex.Form : not exist element - "+c.form);d.onsubmit=function(){return _FALSE}},submit:function(){this.elForm.submit()},createField:function(a){this.elForm.appendChild(a)},getElements:function(){return this.elForm.elements},getElementByName:function(a){return this.elForm[a]},getFormField:function(){for(var a,b={},c=this.getElements(),d=0;d<c.length;d++)a=c[d],["select","input","textarea"].contains(a.tagName.toLowerCase())&&(a.name||a.id)&&("select"==a.tagName.toLowerCase()?a.selectedIndex>0&&(b[a.name]=a.options[a.selectedIndex].value):("radio"!=a.type||a.checked)&&("checkbox"!=a.type||a.checked)&&(b[a.name||a.id]=a.value));return b},setFormField:function(a){if(a)for(var b,c,d=this.getElements(),e=0;e<d.length;e++)if(b=d[e],["select","input","textarea"].contains(b.tagName.toLowerCase())&&b.name!==_NULL&&0!==b.name.length&&a[b.name])if(c=a[b.name],"select"==b.tagName.toLowerCase()){for(var f=0;f<b.options.length;f++)if(b.options[f].value==c){b.options[f].selected=_TRUE;break}}else"radio"==b.type||"checkbox"==b.type?b.value==c&&(b.checked=_TRUE):b.value=c}}),Trex.install("editor.getSaver & editor.getDataAsJSON & editor.setDataByJSON",function(a,b,c,d,e){var f=new Trex.Save(a,b,c,d,e);a.getSaver=function(){return f},a.getDataAsJSON=function(){var b=d.getContent();return(new Trex.Validator).exists(b)?{inputmode:d.getCurrentPanel().getName(),content:b,attachments:function(){var b=c.getAttachments();return a.getEntryProxy().getAttachments(b,_TRUE)}(),resultBox:function(){var b=a.getResultBox(),c=[];return b.datalist.each(function(a){c.push(a.data)}),c}(),formfield:a.getForm().getFormField()}:_NULL},a.setDataByJSON=function(b){if(b){var e=d.mode,f=b.inputmode||e;"original"==f||f!=e&&(d.fireJobs(Trex.Ev.__CANVAS_MODE_INITIALIZE,e,f),d.changeMode(f));var g=b.content;b.attachments&&a.getEntryProxy().setAttachments(b.attachments,g),g&&(g=a.getDocParser().convertAtLoad(g,e,f),d.initContent(g)),b.resultBox&&b.resultBox.each(function(a){var b;(b=c.searchers[a._meta.type])&&b.execReload(a,g)}),c.syncSidebar(),b.formfield&&a.getForm().setFormField(b.formfield)}}}),Trex.Save=Trex.Class.create({editor:_NULL,toolbar:_NULL,sidebar:_NULL,canvas:_NULL,config:_NULL,form:_NULL,initialize:function(a,b,c,d,e){this.editor=a,this.toolbar=b,this.sidebar=c,this.canvas=d,this.config=e,this.form=a.getForm(),this.docparser=a.getDocParser(),this.entryproxy=a.getEntryProxy()},save:function(){try{return("function"!=typeof validForm||validForm(this.editor))&&("function"!=typeof setForm||setForm(this.editor))?_TRUE:_FALSE}catch(a){return this.editor.fireJobs(Trex.Ev.__RUNTIME_EXCEPTION,a),_FALSE}},submit:function(){if(this.save())if(this.editor.fireJobs(Trex.Ev.__ON_SUBMIT,this.editor),this.config.save&&"function"==typeof this.config.save.onSave){var a=this.config.save.onSave;a()}else this.form.submit()},getContent:function(a){var b=this.canvas,c=b.mode,d=a||"original",e=b.getContent();return e=this.docparser.convertAtSave(e,c,d)},getAttachments:function(a,b){b=b||_FALSE;var c=this.sidebar.getAttachments(a);return this.entryproxy.getAttachments(c,b)},getEmbeddedData:function(a){return this.sidebar.getEmbeddedData(a)},getResults:function(a){return this.sidebar.getResults(a)},load:function(a){if(a={inputmode:a.inputmode&&"html"!=a.inputmode?a.inputmode:"original",content:function(){var b=a.content;return"string"==typeof b?a.content:b&&b.nodeType&&1==b.nodeType?a.content.value:""}(),attachments:a.attachments},this.editor.fireJobs(Trex.Ev.__EDITOR_LOAD_DATA_BEGIN,a),!a)throw new Error("[Exception]Trex.Save : not exist argument(data)");"function"==typeof loadForm&&loadForm(this.editor,a);try{this.setDataByJSONToEditor(a)}catch(b){alert(" - Error: "+b.message+Trex._I18N.g("setDataByJSONToEditor_error","\n소스보기 모드로 전환합니다.\n잘못된 HTML이 있는지 확인해주세요.")),a.inputmode=Trex.Canvas.__HTML_MODE;try{this.setDataByJSONToEditor(a)}catch(a){}}"function"==typeof postLoad&&postLoad(this.editor,a),this.editor.fireJobs(Trex.Ev.__EDITOR_LOAD_DATA_END)},setDataByJSONToEditor:function(a){this.editor.setDataByJSON(a)},makeField:function(){var a=this.sidebar,b=this.form,c=this.getContent();b.createField(tx.textarea({name:"tx_content",style:{display:"none"}},c)),a.getFields().each(function(a){b.createField(tx.input({type:"hidden",name:a.name,value:a.value}))})}}),Trex.module("new Trex.Resizer",function(a,b,c,d,e){var f=e.initializedId||"",g=TrexConfig.get("resizer",e),h=_NULL;a.setMinHeight=function(a){return h.setMinHeight(a)},a.restoreMinHeight=function(){return h.restoreMinHeight()},Trex.available(g,"resizer"+f)&&(h=new Trex.Resizer(a,g))}),TrexConfig.add({resizer:{minHeight:200}}),Trex.Resizer=Trex.Class.create({$const:{__Identity:"resizer"},$mixins:[Trex.I.JobObservable],initialize:function(a,b){var c=0;if(a){this.config=b;var d=a.getInitializedId(),e=this.elBar=$tx("tx_resizer"+d);if(e){"5.5"==$tx.msie_ver&&e.setAttribute("align","center"),this.resizeHeightAtService=function(a){"function"==typeof resizeHeight&&resizeHeight(a)},this.resizingHeightAtService=function(a){"function"==typeof resizingEditorHeight&&resizingEditorHeight(a)},this.minDragHeight=b.minHeight;var f;this.startDrag=function(b){var c=a.getCanvas(),d=c.getCurrentPanel();if(d!=_NULL){var e=d.getPosition();if(this.panelHeight=e.height,this.dragStartPosY=b.clientY,this.isDragging=_TRUE,$tx.observe(_DOC,"mousemove",this.documentDraggingHandler),$tx.observe(_DOC,"mouseup",this.stopDragHandler),d.getName()==Trex.Canvas.__WYSIWYG_MODE){if(this.panelTop=e.y,(f=d.getDocument())==_NULL)return;c.fireJobs("canvas.height.beforechange"),$tx.observe(f,"mousemove",this.wysiwygDraggingHandler),$tx.observe(f,"mouseup",this.stopDragHandler)}$tx.stop(b)}},this.stopDrag=function(b){var d=a.getCanvas();d.getCurrentPanel()!=_NULL&&(this.isDragging=_FALSE,$tx.stopObserving(_DOC,"mousemove",this.documentDraggingHandler),$tx.stopObserving(_DOC,"mouseup",this.stopDragHandler),f!=_NULL&&($tx.stopObserving(f,"mousemove",this.wysiwygDraggingHandler),$tx.stopObserving(f,"mouseup",this.stopDragHandler),f=_NULL,this.resizeHeightAtService(c),d.fireJobs("canvas.height.afterchange"),$tx.stop(b)))},this.dragingAtDocument=function(b){var d=a.getCanvas();if(this.isDragging){var e=d.getCurrentPanel();if(e==_NULL)return;try{var f=Math.max(this.panelHeight+b.clientY-this.dragStartPosY,this.minDragHeight.parsePx()).toPx();e.setPanelHeight(f),c=f,d.fireJobs("canvas.height.change",f),this.resizingHeightAtService(f)}catch(a){}}$tx.stop(b)},this.dragingAtWysiwyg=function(b){var c=a.getCanvas();if(this.isDragging){var d=c.getCurrentPanel();if(d==_NULL)return;try{var e=_DOC.body.scrollTop||_DOC_EL.scrollTop||_WIN.pageYOffset,f=c.getCanvasPos(),g=Math.max(this.panelHeight+b.clientY+f.y-this.dragStartPosY+this.panelTop-e,this.minDragHeight.parsePx()).toPx();d.setPanelHeight(g),c.fireJobs("canvas.height.change",g)}catch(a){}}$tx.stop(b)},this.startDragHandler=this.startDrag.bindAsEventListener(this),this.stopDragHandler=this.stopDrag.bindAsEventListener(this),this.documentDraggingHandler=this.dragingAtDocument.bindAsEventListener(this),this.wysiwygDraggingHandler=this.dragingAtWysiwyg.bindAsEventListener(this),this.isDragging=_FALSE,$tx.observe(e,"mousedown",this.startDragHandler);var g=a.getCanvas();g.observeJob(Trex.Ev.__CANVAS_FULL_SCREEN_CHANGE,function(){$tx.hide(e)}),g.observeJob(Trex.Ev.__CANVAS_NORMAL_SCREEN_CHANGE,function(){$tx.show(e)})}}},setMinHeight:function(a){return this.minDragHeight=a.toPx()},restoreMinHeight:function(){return this.minDragHeight=this.config.minHeight||200}}),Trex.I.History={},Trex.I.History.Standard={getRangeData:function(){throw Error("Unimplemented abstract method")},restoreRange:function(a){throw Error("Unimplemented abstract method")}},Trex.I.History.Webkit={getRangeData:function(){var a,b,c=this.canvas.getProcessor(),d=c.getTxSel(),e=d.getSel().rangeCount;if(e){var f=d.getSel().getRangeAt(0),g=f.cloneRange();g.selectNodeContents(this.canvas.getCurrentPanel().getDocument().body),g.setEnd(f.startContainer,f.startOffset),a=g.toString().length,b=a+f.toString().length}else a=0,b=0;return{start:a,end:b}},restoreRange:function(a){var b=this.canvas.getCurrentPanel().getWindow(),c=b.document,d=c.body,e=0,f=c.createRange();f.setStart(d,0),f.collapse(!0);for(var g,h=[d],i=!1,j=!1;!j&&(g=h.pop());)if(3==g.nodeType){var k=e+g.length;!i&&a.start>=e&&a.start<=k&&(f.setStart(g,a.start-e),i=!0),i&&a.end>=e&&a.end<=k&&(f.setEnd(g,a.end-e),j=!0),e=k}else for(var l=g.childNodes.length;l--;)h.push(g.childNodes[l]);var m=b.getSelection();m.removeAllRanges(),m.addRange(f)}},Trex.I.History.Trident={getRangeData:function(){var a=this.canvas.getCurrentPanel().getDocument(),b=a.body,c=null,d=this.canvas._SELECTION_RANGE;if(d)c=d;else try{c=a.selection.createRange()}catch(a){return{start:0,end:0}}var e=a.body.createTextRange();e.moveToElementText(b);try{e.setEndPoint("EndToStart",c);var f=e.text.length;return{start:f,end:f+c.text.length}}catch(a){}var g=e.text.length;return{start:g,end:g}},restoreRange:function(a){var b=this.canvas.getCurrentPanel().getDocument(),c=b.body,d=b.body.createTextRange();d.moveToElementText(c),d.collapse(!0),d.moveEnd("character",a.end),d.moveStart("character",a.start),d.select()}},function(){function a(a,b){for(;a.length>=b;)a.shift()}Trex.History=Trex.Class.create({$mixins:[Trex.I.History.Standard,$tx.msie_nonstd?Trex.I.History.Trident:Trex.I.History.Webkit],maxUndoCount:10,canvas:_NULL,undoMementoList:_NULL,redoMementoList:_NULL,currentMemento:_NULL,contentModified:_FALSE,initialize:function(a){this.canvas=a,this.setupHistory(),this.bindKeyEvent(a)},bindKeyEvent:function(a){var b=this;a.observeJob("canvas.panel.undo",function(){b.undoHandler()}),a.observeJob("canvas.panel.redo",function(){b.redoHandler()})},setupHistory:function(){this.initHistory({content:$tom.EMPTY_PARAGRAPH_HTML,scrollTop:0})},canUndo:function(){return this.undoMementoList.length>0},canRedo:function(){return this.redoMementoList.length>0},setCurrentMemento:function(a){this.currentMemento=a},undoHandler:function(){var a=this;if(a.saveHistoryIfEdited(),a.canUndo()){var b=a.undoMementoList.pop();b.undo(),a.redoMementoList.push(b),a.setCurrentMemento(b)}},redoHandler:function(){var a=this;if(a.saveHistoryIfEdited(),a.canRedo()){var b=a.redoMementoList.pop();b.redo(),a.undoMementoList.push(b),a.setCurrentMemento(b)}},initHistory:function(a){var c=this;c.undoMementoList=[],c.redoMementoList=[];var d=new b,e=Object.extend({content:$tom.EMPTY_PARAGRAPH_HTML,scrollTop:0},a);d.addUndoData(e),d.addHandler(c.getTextHandler()),c.setCurrentMemento(d)},saveHistory:function(c,d,e){var f=this;if(!f._historyDisabled){var g=f.undoMementoList,h=f.currentMemento;f.redoMementoList=[],3==arguments.length&&h.addUndoRedData(c,d,e);var i=f.getTextData();h.addRedoData(i),a(g,f.maxUndoCount),g.push(h);var j=new b;j.addHandler(f.getTextHandler()),j.addUndoData(i),f.setCurrentMemento(j),f.contentModified=_FALSE}},injectHistory:function(a,b,c){if(this.canUndo()){var d=this.undoMementoList;d[d.length-1].addUndoRedData(a,b,c)}},saveHistoryIfEdited:function(){this.contentModified&&this.saveHistory()},saveHistoryByKeyEvent:function(a){var b={code:a.keyCode,ctrl:a.ctrlKey||17===a.keyCode,alt:a.altKey||18===a.keyCode,shift:a.shiftKey||16===a.keyCode};if(229!=b.code){var c=this;b.code==Trex.__KEY.ENTER||b.code==Trex.__KEY.SPACE||b.code==Trex.__KEY.TAB?c.saveHistoryIfEdited():b.code==Trex.__KEY.DELETE||b.code==Trex.__KEY.BACKSPACE?c.saveHistory():b.code!=Trex.__KEY.PASTE&&b.code!=Trex.__KEY.CUT||!b.ctrl?b.code>32&&b.code<41&&b.shift||65==b.code&&b.ctrl?c.saveHistoryIfEdited():b.ctrl||b.alt||b.shift&&16==b.code||(c.contentModified=_TRUE):c.saveHistory()}},getTextHandler:function(){var a=this.canvas,b=this;return function(c){a.setContent(c.content);var d={start:0,end:0},e=c.range||d;b.restoreRange(e),$tx.msie_nonstd&&setTimeout(function(){a.setScrollTop(c.scrollTop)},0)}},getTextData:function(){return{content:this.canvas.getContent(),scrollTop:this.canvas.getScrollTop(),range:this.getRangeData()}}});var b=Trex.Class.create({initialize:function(){this.before={},this.after={},this.handlers=[]},addUndoRedData:function(a,b,c){Object.extend(this.before,a),Object.extend(this.after,b),this.handlers.push(c)},addHandler:function(a){this.handlers.push(a)},addUndoData:function(a){Object.extend(this.before,a)},addRedoData:function(a){Object.extend(this.after,a)},undo:function(){var a=this;a.handlers.each(function(b){b(a.before)})},redo:function(){var a=this;a.handlers.each(function(b){b(a.after)})}})}(),function(a){var b=new $tx.Set(13,8,32,33,34,37,38,39,40,46),c=function(a){return b.contains(a)};TrexConfig.add({canvas:{doctype:"auto",mode:["text","html","source"],styles:{color:"#333333",fontFamily:"돋움",fontSize:"9pt",backgroundColor:"#ffffff",lineHeight:"1.5",padding:"8px",margin:"0px"},pMarginZero:!0,selectedMode:"html",readonly:_FALSE,initHeight:400,minHeight:200,ext:"html",param:"",newlinepolicy:"p",showGuideArea:_TRUE,convertingText:_TRUE,escapeTextModeContents:_TRUE,removeTextModeBr:_FALSE,respectVisibilityInDesign:_TRUE}},function(b){var c=TrexConfig.get("canvas",b),d=b.events;c.initializedId=b.initializedId||"",c.useHotKey=d.useHotKey;var e=TrexConfig.getTool("switcher",b);a.available(e,"switcher"+c.initializedId)&&(c.mode=e.options.pluck("data"));var f=TrexConfig.getTool("fontfamily",b);a.available(f,"fontfamily"+c.initializedId)&&f.webfont&&f.webfont.use&&(c.webfont=f.webfont,c.webfont.options.each(function(a){a.url=TrexConfig.getUrl(a.url)}));var g=TrexConfig.get("resizer",b);g&&(c.minHeight=g.minHeight),c.wysiwygUrl=TrexConfig.getUrl([c.wysiwygPath||"#host#path/pages/daumx/","wysiwyg_",c.serviceWysiwyg||"","html"==c.doctype?"html":"xhtml",".",c.ext?c.ext:"html","?prefix="+b.initializedId,"&",c.param].join("")),"auto"==c.doctype&&($tx.msie&&$tx.msie_quirks?c.doctype="quirks":c.doctype="edge")}),TrexConfig.add({size:{}}),a.Canvas=a.Class.create({$const:{__TEXT_MODE:"text",__HTML_MODE:"source",__WYSIWYG_MODE:"html",__WYSIWYG_PADDING:8,__IMAGE_PADDING:5},$mixins:[a.I.JobObservable,a.I.KeyObservable,a.I.ElementObservable,a.I.MouseoverObservable],editor:_NULL,elContainer:_NULL,elEditorBlockUI:_NULL,config:_NULL,history:_NULL,panels:_NULL,initialize:function(b,c){this.editor=b;var d=this.config=TrexConfig.get("canvas",c),e=c.initializedId?c.initializedId:"";this.elContainer=$tx("tx_canvas"+e),this.wysiwygEl=$tx("tx_canvas_wysiwyg_holder"+e),this.sourceEl=$tx("tx_canvas_source_holder"+e),this.textEl=$tx("tx_canvas_text_holder"+e),this.elEditorBlockUI=$tx("tx_editor_blockui"+e),this.initConfig(c),this.createPanel(),this.history=new a.History(this,d),this.setCanvasSize({height:d.initHeight})},initConfig:function(a){var b=this.config;this.getRootConfig=function(){return a},this.getConfig=function(){return b},this.getStyleConfig=function(a){return a?b.styles[a]:b.styles};var c=TrexConfig.get("size",a);this.measureWrapWidth=function(){c.wrapWidth=this.getContainerWidth()},this.measureWrapWidth(),c.contentWidth||(c.contentWidth=c.wrapWidth),c.contentPadding=b.styles.padding.parsePx(),this.getSizeConfig=function(){return c}},getContainerWidth:function(){return $tx.getDimensions(this.elContainer).width},createPanel:function(){var b=this,c=this.config;this.panels={},this.mode=c.selectedMode||a.Canvas.__WYSIWYG_MODE,this._isForceTextMode()&&(this.mode=a.Canvas.__TEXT_MODE);var d={text:function(c){return new a.Canvas.TextPanel(b,c)},source:function(c){return new a.Canvas.HtmlPanel(b,c)},html:function(c){return new a.Canvas.WysiwygPanel(b,c)}};c.mode.each(function(a){d[a]&&(b.panels[a]=d[a](c))});for(var e in b.panels)this.mode==e?b.panels[e].show():b.panels[e].hide();b.observeJob("canvas.panel.iframe.load",function(c){b.fireJobs(a.Ev.__IFRAME_LOAD_COMPLETE,c)})},_isForceTextMode:function(){return $tx.ios||$tx.android},changeMode:function(b){var c=this.editor,d=this.mode;if(d!=b&&(d==a.Canvas.__WYSIWYG_MODE&&c._imageResizeCtrl&&c._imageResizeCtrl.changeMode(),!this._isForceTextMode()||d!=a.Canvas.__TEXT_MODE)){var e=this.panels[d],f=this.panels[b];if(!e||!f)throw new Error("[Exception]Trex.Canvas : not suppored mode");var g=e.getContent(),h=c.getDocParser().getContentsAtChangingMode(g,d,b);if(d==a.Canvas.__WYSIWYG_MODE){8===$tx.msie_ver&&e.hide(),e.setContent("");try{this.focusOnTop()}catch(a){}}try{f.setContent(h)}catch(b){return alert(" - Error: "+b.message+a._I18N.g("changeMode_error","\n에디터 타입 변경에 실패하였습니다.\n잘못된 HTML이 있는지 확인해주세요.")),e.setContent(g),void e.show()}this.mode=b,this.fireJobs(a.Ev.__CANVAS_MODE_CHANGE,d,b),f.setPanelHeight(e.getPanelHeight()),f.show(),e.hide();try{"html"==b&&!this.getPanel("html").designModeActivated&&$tx.gecko&&(this.getPanel("html").el.contentDocument.designMode="on",this.getPanel("html").designModeActivated=_TRUE)}catch(a){throw a}}},focus:function(){this.panels[this.mode].focus()},focusOnTop:function(){this.getProcessor().focusOnTop()},focusOnBottom:function(){this.getProcessor().focusOnBottom()},getCanvasPos:function(){var a=$tx.cumulativeOffset(this.elContainer);return{x:a[0],y:a[1]}},setCanvasSize:function(a){if(!this.panels[this.mode]||!a.height)throw new Error("[Exception]Trex.Canvas : argument has no property - size.height ");this.panels[this.mode].setPanelHeight(a.height)},canHTML:function(){return this.isWYSIWYG()},isWYSIWYG:function(){return this.mode===a.Canvas.__WYSIWYG_MODE},getPanel:function(a){return this.panels[a]?this.panels[a]:_NULL},getCurrentPanel:function(){return this.panels[this.mode]?this.panels[this.mode]:_NULL},getProcessor:function(a){return a?this.panels[a].getProcessor():this.panels[this.mode].getProcessor()},getContent:function(){var b=this.panels[this.mode].getContent();return b&&(b=b.replace(a.__WORD_JOINER_REGEXP,"")),b},getScrollTop:function(){return this.isWYSIWYG()?this.panels[this.mode].getScrollTop():0},setScrollTop:function(a){this.isWYSIWYG()&&this.panels[this.mode].setScrollTop(a)},setContent:function(a){this.panels[this.mode].setContent(a),this.includeWebfontCss(a)},initContent:function(b){this.history.initHistory({content:b}),this.panels[this.mode].setContent(b),this.includeWebfontCss(b),this.fireJobs(a.Ev.__CANVAS_DATA_INITIALIZE,a.Canvas.__WYSIWYG_MODE,_NULL)},includeWebfontCss:function(a){if(this.isWYSIWYG())return this.panels[this.mode].includeWebfontCss(a)},getUsedWebfont:function(){return this.isWYSIWYG()?this.panels[this.mode].getUsedWebfont():[]},runScript:function(a){if(!this.isWYSIWYG())return[];this.panels[this.mode].runScript(a)},importScript:function(a,b){if(!this.isWYSIWYG())return[];this.panels[this.mode].importScript(a,b)},query:function(a){return this.isWYSIWYG()?a(this.getProcessor()):_NULL},execute:function(a){var b=this.history,c=this.getProcessor();this.isWYSIWYG()?(this.getPanel("html").ensureFocused(),c.restoreRange?setTimeout(function(){c.restoreRange(),a(c),b.saveHistory(),c.restore()},0):(c.focus(),a(c),b.saveHistory(),c.restore())):a(c)},moveCaret:function(a){a&&this.isWYSIWYG()&&this.getProcessor().moveCaretWith(a)},pasteContent:function(a,b,c){b=b||_FALSE,this.execute(function(d){d.pasteContent(a,b,c)})},pasteNode:function(a,b,c){this.isWYSIWYG()&&(b=b||_FALSE,this.execute(function(d){d.pasteNode(a,b,c)}))},addStyle:function(a){this.panels[this.mode].addStyle(a)},getStyle:function(a){return this.panels[this.mode].getStyle(a)},getPositionByNode:function(a){return this.isWYSIWYG()?this.panels[this.mode].getPositionByNode(a):{x:0,y:0,width:0,height:0}},onKeyDown:function(b){function c(a,b){var c=goog.dom.Range.createFromBrowserSelection(a.getSelection?a.getSelection():b.getSel());return{node:c.getStartNode(),offset:c.getStartOffset()}}function d(a,b,c){a.style.fontFamily=c.queryStyle(b,"fontFamily"),a.style.fontSize=c.queryStyle(b,"fontSize"),a.style.color=c.queryStyle(b,"color")}function e(a){if(!(--q<0)&&a){if("SPAN"==a.nodeName||"FONT"==a.nodeName)return a.removeNode(!1),void e(m.nextSibling);if("P"==a.nodeName&&a.childNodes.length>0){if("P"==a.childNodes[0].nodeName)return a.removeNode(!1),void e(m.nextSibling);if("SPAN"==a.childNodes[0].nodeName||"FONT"==a.childNodes[0].nodeName){if($tom.descendant(a.childNodes[0],"%paragraph"))return a.childNodes[0].removeNode(!1),void e(m.nextSibling)}}}}function f(c){if(!(--q<0)&&c){if("SPAN"==c.nodeName||"FONT"==c.nodeName)return c.removeNode(""==c.textContent.replace(/\s/g,"")),void f(m.previousSibling);if("P"==c.nodeName){if(0==c.childNodes.length)return c.removeNode(!0),b.preventDefault?b.preventDefault():b.returnValue=!1,void(b.stopPropagation?b.stopPropagation():b.cancelBubble=!0);var d=c.childNodes&&c.childNodes[c.childNodes.length-1]||null;if(d&&"P"==d.nodeName)return d.removeNode(!1),void f(m.previousSibling);if(d&&("SPAN"==d.nodeName||"FONT"==d.nodeName)){if($tom.descendant(d,"%paragraph"))return d.removeNode(!1),void f(m.previousSibling)}for(var e=10;d&&!(--e<0);){if("BR"==d.nodeName){d.removeNode(!0);break}
if(("SPAN"==d.nodeName||"FONT"==d.nodeName||"STRONG"==d.nodeName||"B"==d.nodeName)&&(1==d.childNodes.length&&"BR"==d.childNodes[0].nodeName||0==d.childNodes.length)){0!=d.childNodes.length&&d.childNodes[0].removeNode(!0);var g=h.doc.createTextNode(a.__WORD_JOINER);d.appendChild(g);break}if(("SPAN"==d.nodeName||"FONT"==d.nodeName)&&""==d.innerHTML||"#text"==d.nodeName&&null==d.previousSibling&&""==d.textContent.replace(/\s/g,"")){var i=d,j=d.parentNode;if(d=c,i.removeNode(!0),"P"==j.nodeName&&""==j.innerHTML){j.removeNode(!0);break}}d=d&&d.childNodes&&d.childNodes[d.childNodes.length-1]||null}}}}this.fireJobs(a.Ev.__CANVAS_PANEL_KEYDOWN,b);var g=null;if(b.keyCode==a.__KEY.BACKSPACE){var h=this.getProcessor();if(h.isCollapsed()){var i=this.getCurrentPanel().getDocument(),j=c(i,h);(g=$tom.prevNodeUntilTagName(j.node,j.offset,"table"))&&$tom.isTagName(g,"table")&&($tx.stop(b),this.fireJobs(a.Ev.__CANVAS_PANEL_BACKSPACE_TABLE,g))}}if($tx.msie&&11==$tx.msie_ver&&b.keyCode==a.__KEY.DELETE){var h=this.getProcessor();if(h.isCollapsed()){var i=this.getCurrentPanel().getDocument(),j=c(i,h),k=j.node,l=j.offset;if(k.childNodes&&1==k.childNodes.length&&"BR"==k.childNodes[0].nodeName&&k.childNodes[0].removeNode(!0),"#text"==k.nodeName&&1==k.length&&"%EF%BB%BF"==encodeURIComponent(k.nodeValue)&&(k.nodeValue=""),"#text"==k.nodeName&&k.length<=l||""==k.textContent){var m=null;if("P"==k.nodeName)m=k;else for(var n=k.parentNode;null!=n&&(m=n,"P"!=m.nodeName);n=n.parentNode)if(null!=m.nextSibling){m=null;break}for(var o=m&&m.parentNode||null,p=10;o&&!(--p<0);){if("SPAN"!=o.nodeName&&"FONT"!=o.nodeName&&"P"!=o.nodeName){o=null;break}o.removeNode(!1),o=m.parentNode}m&&m.nextSibling&&("SPAN"==m.nextSibling.nodeName||"FONT"==m.nextSibling.nodeName)&&m.nextSibling.removeNode(!1);var q=10;if(m&&e(m.nextSibling),m&&m.nextSibling&&"P"==m.nextSibling.tagName){var r=m.nextSibling.childNodes;1==r.length&&r[0].childNodes&&1==r[0].childNodes.length&&"BR"==r[0].childNodes[0].nodeName&&r[0].removeNode(!0);for(var s=0;s<r.length;s++){var t=r[s];if(3==t.nodeType&&""!==t.textContent.replace(/[ \f\n\r\t\v]/g,"")){var u=h.create("span");$tom.wrap(u,t),d(u,u,h)}else 1==t.nodeType&&"SPAN"==t.nodeName&&d(t,t,h)}}}}}if($tx.msie&&11==$tx.msie_ver&&b.keyCode==a.__KEY.BACKSPACE){var h=this.getProcessor();if(h.isCollapsed()){var i=this.getCurrentPanel().getDocument(),j=c(i,h),k=j.node,l=j.offset,m=null;if(3==k.nodeType&&k.nodeValue==a.__WORD_JOINER&&1==l){l=0;var v=k;k=k.parentNode,v.removeNode(!0)}if("P"==k.nodeName&&0==l)m=k;else if(0==l&&null==k.previousSibling)for(var n=k.parentNode;null!=n&&(m=n,"P"!=m.nodeName);n=n.parentNode)if(null!=m.previousSibling){m=null;break}if(m&&"P"!=k.nodeName&&1==k.nodeType&&k.childNodes&&(0==k.childNodes.length||1==k.childNodes.length&&"BR"==k.childNodes[0].nodeName||1==k.childNodes.length&&3==k.childNodes[0].nodeType&&k.childNodes[0].nodeValue==a.__WORD_JOINER)){for(var w=k,x=100;w&&w.parentNode&&w.parentNode!=m&&1==w.parentNode.childNodes.length&&!(--x<0);)w=w.parentNode;w&&w.removeNode(!0)}for(var o=m&&m.parentNode||null,p=10;o&&!(--p<0);){if("SPAN"!=o.nodeName&&"FONT"!=o.nodeName&&"P"!=o.nodeName){o=null;break}o.removeNode(!1),o=m.parentNode}var q=10;if(m&&f(m.previousSibling),m&&m.style&&m.style.marginLeft){var y=parseInt(m.style.marginLeft);y<2&&(m.style.margin=m.style.marginLeft="")}if(m&&m.previousSibling&&"P"==m.previousSibling.nodeName){var g=m.previousSibling;if(m.children&&1==m.children.length&&"SPAN"==m.children[0].nodeName&&""!==m.textContent.replace(/[ \f\n\r\t\v]/g,""))d(m.children[0],m.children[0],h);else if(m.children&&1==m.children.length&&"BR"==m.children[0].nodeName&&m.removeChild(m.children[0]),""!==m.textContent.replace(/[ \f\n\r\t\v]/g,"")&&(1!=m.childNodes.length||1!=m.childNodes[0].nodeType)){var u=h.create("span");g.appendChild(u);var z=h.doc.createTextNode(a.__WORD_JOINER);u.appendChild(z),d(u,m,h)}}}}else if(!$tx.msie&&b.keyCode==a.__KEY.BACKSPACE){var h=this.getProcessor();if(h.isCollapsed()){var i=this.getCurrentPanel().getDocument(),j=c(i,h),k=j.node,l=j.offset,m=null;if("P"==k.nodeName&&0==l)m=k;else if(0==l&&null==k.previousSibling)for(var n=k.parentNode;null!=n&&(m=n,"P"!=m.nodeName);n=n.parentNode)if(null!=m.previousSibling){m=null;break}if(m&&m.style&&m.style.marginLeft){var y=parseInt(m.style.marginLeft);y<2&&(m.style.margin=m.style.marginLeft="")}}}if($tx.msie&&(40==b.keyCode||38==b.keyCode)){var h=this.getProcessor();if(h.isCollapsed()){var i=this.getCurrentPanel().getDocument(),j=c(i,h),k=j.node,m=null;m="P"==k.nodeName?k:k.parentNode&&"P"==k.parentNode.nodeName?k.parentNode:$tom.find(k,"%paragraph"),m=m||k.parentNode;var A=m?40==b.keyCode?m.nextSibling:m.previousSibling:null;A&&"P"==A.nodeName&&1==A.childNodes.length&&1==A.childNodes[0].length&&"%EF%BB%BF"==encodeURIComponent(A.childNodes[0].nodeValue)&&(A.innerHTML="<br>")}}if(this.config.useHotKey&&this.fireKeys(b),$tx.msie&&11==$tx.msie_ver&&b.keyCode==a.__KEY.ENTER&&!b.shiftKey){var B=this;setTimeout(B._ie11Enterbug.bind(B),25)}86==b.keyCode&&b.ctrlKey&&this.fireJobs(a.Ev.__CANVAS_PANEL_PASTE_CUSTOM_KEY,b)},_ie11Enterbug:function(){var b=this.getProcessor();if(b.isCollapsed()){var c=this.getCurrentPanel().getDocument(),d=goog.dom.Range.createFromBrowserSelection(c.getSelection?c.getSelection():b.getSel()),e=d.getStartNode();if(e&&1===e.nodeType&&e.children&&e.children.length<=1&&(1!=e.childNodes.length||"BR"!=e.childNodes[0].nodeName&&"IMG"!=e.childNodes[0].nodeName)&&""===e.textContent.replace(/[ \f\n\r\t\v]/g,"")){var f="P"==e.nodeName?e:e.parentNode;if(f&&"P"==f.nodeName&&f.previousSibling&&"P"==f.previousSibling.nodeName){var g=f.previousSibling;0==g.childNodes.length&&""===g.textContent.replace(/[ \f\n\r\t\v]/g,"")?g.innerHTML="<BR>":1==g.childNodes.length&&"SPAN"==g.childNodes[0].nodeName&&(g=g.childNodes[0],0==g.childNodes.length?g.innerHTML="<BR>":3==g.childNodes[0].nodeType&&""==g.childNodes[0].nodeValue.replace(a.__WORD_JOINER_REGEXP,"")&&(g.innerHTML="<BR>"))}if(f&&"P"==f.nodeName&&f.nextSibling&&"P"==f.nextSibling.nodeName){var g=f.nextSibling,h=!1;0==g.childNodes.length&&""===g.textContent.replace(/[ \f\n\r\t\v]/g,"")?h=!0:1==g.childNodes.length&&"SPAN"==g.childNodes[0].nodeName&&(g=g.childNodes[0],0==g.childNodes.length?h=!0:1==g.childNodes.length&&3==g.childNodes[0].nodeType&&""==g.childNodes[0].nodeValue.replace(a.__WORD_JOINER_REGEXP,"")&&(h=!0)),h&&(g.innerHTML="<BR>")}var i=b.newDummy(!1);d.insertNode(i,!0),d.select()}else if(e&&1===e.nodeType&&"SPAN"==e.nodeName&&1==e.childNodes.length){var j=e.childNodes[0],k=e.parentNode;if(k&&1==k.childNodes.length&&j.nodeName==e.nodeName&&j.style.cssText==e.style.cssText){var k=e.parentNode;$tom.remove(e),k.appendChild(j),d.select()}}else if(e&&1===e.nodeType&&""===e.textContent.replace(/[ \f\n\r\t\v]/g,"")){var i=b.newDummy(!1);d.insertNode(i,!0),d.select()}}},onKeyUp:function(b){var d=b.keyCode+"",e=c(d);e&&this.getProcessor().clearDummy(),this.history.saveHistoryByKeyEvent(b);try{this.mayAttachmentChanged=_TRUE,this.fireJobs(a.Ev.__CANVAS_PANEL_KEYUP,b),this.isWYSIWYG()&&e&&this.triggerQueryStatus()}catch(a){}try{if(this.isWYSIWYG()){var f=this;setTimeout(function(){try{var a=f.getProcessor().createGoogRange();f._SELECTION_RANGE=a&&a.browserRangeWrapper_?a.browserRangeWrapper_.range_:null}catch(a){f._SELECTION_RANGE=null}},0)}}catch(a){}},onMouseOver:function(b){try{this.fireMouseover($tx.element(b)),this.fireJobs(a.Ev.__CANVAS_PANEL_MOUSEOVER,b)}catch(a){}},onMouseMove:function(b){try{this.fireJobs(a.Ev.__CANVAS_PANEL_MOUSEMOVE,b)}catch(a){}},onMouseOut:function(b){try{this.fireJobs(a.Ev.__CANVAS_PANEL_MOUSEOUT,b)}catch(a){}},onMouseDown:function(b){this.getProcessor().clearDummy();try{this.fireElements($tx.element(b))}catch(a){}this.fireJobs(a.Ev.__CANVAS_PANEL_MOUSEDOWN,b),this.history.saveHistoryIfEdited()},onMouseUp:function(b){try{var c=this;c.fireJobs(a.Ev.__CANVAS_PANEL_MOUSEUP,b);var d=b.button;setTimeout(function(){var b=d,e=c.getProcessor().createGoogRange();e&&c.fireJobs(a.Ev.__CANVAS_PANEL_QUERY_STATUS,e),c.isWYSIWYG()&&1==b&&(c._SELECTION_RANGE=e&&e.browserRangeWrapper_?e.browserRangeWrapper_.range_:null)},20)}catch(a){}},onBlur:function(b){try{this.fireJobs(a.Ev.__CANVAS_PANEL_BLUR,b)}catch(a){}},mayAttachmentChanged:_FALSE,onClick:function(b){this.fireJobs(a.Ev.__CANVAS_PANEL_CLICK,b)},onDoubleClick:function(b){this.fireJobs(a.Ev.__CANVAS_PANEL_DBLCLICK,b)},onScroll:function(b){this.fireJobs(a.Ev.__CANVAS_PANEL_SCROLLING,b)},onPaste:function(b){this.fireJobs(a.Ev.__CANVAS_PANEL_PASTE_CUSTOM,b),this.fireJobs(a.Ev.__CANVAS_PANEL_PASTE,b)},onDrop:function(b){b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,this.fireJobs(a.Ev.__CANVAS_PANEL_DROP,b)},onFocus:function(b){this.fireJobs(a.Ev.__CANVAS_PANEL_FOCUS,b)},onDragEnter:function(a){this.focus(),$tx.msie&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0)},onDragOver:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},onDragLeave:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},onContextMenu:function(b){this.fireJobs(a.Ev.__CANVAS_CONTEXTMENU_SHOW,b)},triggerQueryStatus:function(){this.cancelReservedQueryStatusTrigger(),this.reserveQueryStatusTrigger()},reserveQueryStatusTrigger:function(){var b=this;this.reservedQueryStatusTrigger=setTimeout(function(){var c=b.getProcessor().createGoogRange();c&&(b.fireJobs(a.Ev.__CANVAS_PANEL_QUERY_STATUS,c),b.fireElements(b.getProcessor().getNode()))},20)},cancelReservedQueryStatusTrigger:function(){this.reservedQueryStatusTrigger&&clearTimeout(this.reservedQueryStatusTrigger)},syncProperty:function(){this.triggerQueryStatus()}})}(Trex),Trex.module("bind canvas events for close external menus",function(a,b,c,d){var e=function(){a.fireJobs(Trex.Ev.__SHOULD_CLOSE_MENUS)};d.observeJob(Trex.Ev.__CANVAS_PANEL_CLICK,e),d.observeJob(Trex.Ev.__CANVAS_SOURCE_PANEL_CLICK,e),d.observeJob(Trex.Ev.__CANVAS_TEXT_PANEL_CLICK,e)}),Trex.module("make getter for 'iframeheight' and 'iframetop' size",function(a,b,c,d){function e(){try{var a=d.getPanel(Trex.Canvas.__WYSIWYG_MODE);if(!a||!a.el||0==$("#"+a.el.id.replace(/\$/g,"\\$")).length)return;f=a.getPanelHeight().parsePx();var b=$tom.getPosition(a.el);g=b.y}catch(a){}}var f=0,g=0;d.observeJob(Trex.Ev.__CANVAS_HEIGHT_CHANGE,function(a){e()}),d.observeJob(Trex.Ev.__CANVAS_FULL_SCREEN_CHANGE,function(){e()}),d.observeJob(Trex.Ev.__CANVAS_NORMAL_SCREEN_CHANGE,function(){e()}),d.observeJob("canvas.apply.background",function(){e()}),d.observeJob("canvas.apply.letterpaper",function(){e()}),d.reserveJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){e()},300);var h=a.getAttachBox();h.observeJob(Trex.Ev.__ATTACHBOX_FULLSCREEN_SHOW,function(){e()}),h.observeJob(Trex.Ev.__ATTACHBOX_FULLSCREEN_HIDE,function(){e()}),$tx.observe(_WIN,"resize",function(){e()}),d.getIframeHeight=function(){return f},d.getIframeTop=function(){return g}}),Trex.module("sync attachment data periodically",function(a,b,c,d){}),Trex.module("synchronize the font style when caret is in end of paragraph",function(a,b,c,d){$tx.gecko&&d.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEUP,function(a){if(d.isWYSIWYG()){var b=a.target,c=b instanceof HTMLParagraphElement,e=b instanceof HTMLHtmlElement;if(!c&&!e)return;var f=d.getProcessor(),g=a.pageX,h=a.pageY,i=f.doc.caretPositionFromPoint(g,h),j=i&&i.offsetNode,k=j&&$tom.descendants(j,"#text");if(!k||!k.length)return;var l=k[k.length-1];if(l){f.createGoogRangeFromNodes(l,l.length,l,l.length).select()}}})}),Trex.module("apply respectVisibilityInDesign for old IE",function(a,b,c,d,e){function f(){if(d.isWYSIWYG()){var a=d.getProcessor(),b=a.doc.queryCommandState(h),c=d.config.respectVisibilityInDesign;b!=c&&a.doc.execCommand(h,!1,c)}}var g=$tx.msie&&$tx.msie_docmode<9;g&&d.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,function(a,b){f()}),g&&d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(a){f()});var h="RespectVisibilityInDesign"}),Trex.Canvas.BasedPanel=Trex.Class.draft({initialize:function(a,b){if(this.config=b,this.canvas=a,this.elHolder=this.getHolder(b),this.el=this.getPanel(b),!this.el)throw new Error("[Exception]Trex.Canvas.Panel : panel element is not founded");var c=this.constructor.__MODE;this.getName=function(){return c},this.lastHeight=_NULL},focus:function(){this.el.focus()},show:function(){try{$tx.show(this.elHolder)}catch(a){}},hide:function(){try{$tx.hide(this.elHolder)}catch(a){}},getStyle:function(a){return this.el.style[a]?this.el.style[a]:_NULL},addStyle:function(a){for(var b in a)this.el.style[b]&&(this.el.style[b]=a[b])},getPosition:function(){return $tom.getPosition(this.el)},getPanelHeight:function(){return $tom.getHeight(this.el).toPx()},setPanelHeight:function(a){a=a.toPx(),this.lastHeight!=a&&($tom.setHeight(this.el,a),this.lastHeight=a)}}),function(){Trex.WysiwygIframeLoader=Trex.Class.create({initialize:function(a,b,c){switch(this.iframe=a,this.iframeUrl=b,this.doctype="",c){case"edge":case"loose":case"strict":this.doctype=c}},load:function(a){try{this.loadLocalIframe(a,this.doctype)}catch(b){this.reloadUsingCatalyst(a)}},loadLocalIframe:function(a,f){var g=this.iframe.contentWindow.document;switch(g.open(),f){case"edge":g.write(b);break;case"loose":g.write(c);break;case"strict":g.write(d)}g.write(e),g.close(),setTimeout(function(){a(g)},0)},reloadUsingCatalyst:function(a){var b=this;if(_WIN.__tx_wysiwyg_iframe_load_complete=function(){b.loadLocalIframe(a,"")},!this.iframeUrl){var c=this.getIframePagePath(),d=this.doctype;switch(d){case"edge":case"loose":case"strict":this.iframeUrl=c+"trex/iframe_loader_catalyst_"+d+".html?open";break;default:this.iframeUrl=c+"trex/iframe_loader_catalyst.html?open"}}document.location.hostname!=document.domain&&(this.iframeUrl=this.iframeUrl+(this.iframeUrl.indexOf("?")>-1?"&":"?")+"xssDomain="+document.domain),this.iframe.src=this.iframeUrl},getIframePagePath:function(){return EditorJSLoader.getPageBasePath("editor.js")},loadRemoteIframe:function(){this.el.setAttribute("src",this.canvasConfig.wysiwygUrl)}});var a=function(a){var b=_DOC.location;if(/^(https?:|file:|)\/\//.test(a));else if(0===a.indexOf("/"))a="//"+b.host+":"+(b.port||"80")+a;else{var c=b.href,d=c.lastIndexOf("/");a=c.substring(0,d+1)+a}return a}(EditorJSLoader.getCSSBasePath()),b="<!DOCTYPE html>",c='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">',d='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',e='<html lang="ko"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>K-Portal Web Editor</title><script id="txScriptForEval"><\/script><link rel="stylesheet" href="'+a+"content_view"+(Trex._JS_MIN?".min":"")+".css?open&_ver="+(EditorJSLoader._VER||"")+'" type="text/css"></link><link rel="stylesheet" href="'+a+"content_wysiwyg"+(Trex._JS_MIN?".min":"")+".css?open&_ver="+(EditorJSLoader._VER||"")+'" type="text/css"></link><style id="txStyleForSetRule"></style></head><body class="tx-content-container">'+$tom.EMPTY_PARAGRAPH_HTML+"</body></html>"}(),function(){Trex.WebfontLoader=Trex.Class.create({initialize:function(a,b){this.doc=a,this.styleCnt=0,this.defWebfont=b.styles.fontFamily,this.useWebfont=b.webfont&&b.webfont.use,this.webfontCfg=b.webfont||[],this.elStyleSheet=this.getStyleSheet()},load:function(a){if($tx.msie&&a&&this.useWebfont){var b=[];if(a+=" // font-family:"+this.defWebfont,a.replace(/font-family\s*:\s*(\w*)/gi,function(a,c){return b.push(c),a}),0!=b.length){var c=this;setTimeout(function(){var a=b.uniq().join("||");c.webfontCfg.options.each(function(b){b.url&&a.indexOf(b.data)>-1&&c.imports(b)})},10)}}},getUsed:function(){if(!$tx.msie)return[];var a=[];return this.useWebfont?(this.webfontCfg.options.each(function(b){b.url||a.push(b.data)}),a):a},getStyleSheet:function(){return this.doc.styleSheets[this.styleCnt++]},imports:function(a){try{this.elStyleSheet.addImport(a.url,2)}catch(b){this.elStyleSheet=this.getStyleSheet(),this.elStyleSheet.addImport(a.url,2)}a.url=_NULL}})}(),function(){Trex.WysiwygRelative=Trex.Class.create({initialize:function(a){this.iframe=a},getRelative:function(a){var b={x:0,y:0,width:0,height:0},c=this.iframe.contentWindow.document;if(a){var d=$tom.getPosition(a,_TRUE),e=$tom.getHeight(this.iframe),f=$tom.getScrollTop(c);if(d.y+d.height<f||d.y>f+e)return b;var g=$tom.getWidth(this.iframe),h=$tom.getScrollLeft(c);b.x=0+(h>0?0:d.x),b.width=Math.min(g-d.x-16,d.width-(h>0?h-d.x:0)),b.height=d.height,b.y=d.y-f+0}return b}})}(),function(){Trex.WysiwygEventBinder=Trex.Class.create({initialize:function(a,b,c){this.win=a,this.doc=b,this.canvas=c},bindEvents:function(){this.translateDocumentEventToCanvas("keyup","onKeyUp"),this.translateDocumentEventToCanvas("keydown","onKeyDown"),this.translateDocumentEventToCanvas("mouseover","onMouseOver"),this.translateDocumentEventToCanvas("mousemove","onMouseMove"),this.translateDocumentEventToCanvas("mouseout","onMouseOut"),this.translateDocumentEventToCanvas("click","onClick"),this.translateDocumentEventToCanvas("dblclick","onDoubleClick"),this.translateDocumentEventToCanvas("mousedown","onMouseDown"),this.translateDocumentEventToCanvas("mouseup","onMouseUp"),this.translateDocumentEventToCanvas("contextmenu","onContextMenu"),this.translateWindowEventToCanvas("scroll","onScroll"),this.translateBodyEventToCanvas("paste","onPaste"),this.translateBodyEventToCanvas("blur","onBlur"),this.translateDocumentEventToCanvas("drop","onDrop"),this.translateDocumentEventToCanvas("dragenter","onDragEnter"),this.translateDocumentEventToCanvas("dragover","onDragOver"),this.translateDocumentEventToCanvas("dragleave","onDragLeave"),this.translateWindowEventToCanvas("focus","onFocus"),this.triggerQueryStatusWhenTenConsecutiveKeyPressesDetected()},translateDocumentEventToCanvas:function(a,b){this.translateEventToCanvas(this.doc,a,b)},translateWindowEventToCanvas:function(a,b){this.translateEventToCanvas(this.win,a,b)},translateBodyEventToCanvas:function(a,b){this.translateEventToCanvas(this.doc.body,a,b)},translateEventToCanvas:function(a,b,c){var d=this.canvas;$tx.observe(a,b,function(a){d[c](a)},_FALSE)},triggerQueryStatusWhenTenConsecutiveKeyPressesDetected:function(){var b=this.canvas;a(this.doc,function(){b.triggerQueryStatus()})}});var a=function(a,c){var d=0,e=-1;$tx.observe(a,"keydown",function(a){var f=a.keyCode;b(f)||e===f||(d>=9?(c(),d=0):d++,e=f)},_FALSE)},b=function(a){return c.contains(a)},c=new $tx.Set(8,16,17,18,32,33,34,37,38,39,40,46,229)}(),function(){function a(a){for(var b=["color","fontSize","fontFamily","lineHeight","pMarginZero","browser"],c=Object.clone(a),d=0;d<b.length;d++)delete c[b[d]];return c}function b(a){return a.replace(Trex.__WORD_JOINER_REGEXP,"")}function c(a){return $tx.msie&&(a=a.replace(/(<script|<style)/i,Trex.__WORD_JOINER+"$1")),a}function d(a){if($tx.msie_nonstd)for(var b=$tom.collectAll(a,"p,li"),c=0,d=b.length;c<d;c++){var e=b[c];if(0===$tom.getLength(e)&&"p"!==e.tagName.toLowerCase())try{e.innerHTML="&nbsp;"}catch(a){}1===$tom.getLength(e)&&"&nbsp;"===e.innerHTML&&(e.innerHTML="")}}Trex.Canvas.WysiwygPanel=Trex.Class.create({$extend:Trex.Canvas.BasedPanel,$const:{__MODE:Trex.Canvas.__WYSIWYG_MODE,EVENT_BINDING_DELAY:500},initialize:function(a,b){this.$super.initialize(a,b),this.canvasConfig=b,this.iframe=this.el,this.wysiwygWindow=this.iframe.contentWindow,this.onceWysiwygFocused=!1;var c=this;new Trex.WysiwygIframeLoader(this.iframe,b.wysiwygCatalystUrl,b.doctype).load(function(b){if(c.wysiwygDoc=b,c.initializeSubModules(b),installHyperscript(c.wysiwygWindow,c.wysiwygDoc),c.makeEditable(),c.applyBodyStyles(c.canvasConfig.styles),c.applyCustomCssText(c.canvasConfig.customCssText),c.clearContent(),c.bindEvents(a),Editor.__PANEL_LOADED=_TRUE,$tx.observe(c.wysiwygWindow,"focus",function(){c.onceWysiwygFocused||(c.onceWysiwygFocused=!0)}),$tx.msie_nonstd){var d=c.wysiwygDoc.getElementsByTagName("html");d&&d[0]&&$tx.observe(d[0],"click",function(b){var e=$tx.element(b);a.canHTML()&&d[0]==e&&c.focus()})}a.fireJobs(Trex.Ev.__IFRAME_LOAD_COMPLETE,b)})},_bodyHeight:0,_bodyContentHeight:0,initializeSubModules:function(a){var b=this.wysiwygWindow;this.processor=new Trex.Canvas.ProcessorP(b,a),this.webfontLoader=new Trex.WebfontLoader(a,this.canvasConfig)},makeEditable:function(){if(!this.canvasConfig.readonly)if(this.wysiwygDoc.body.contentEditable)this.wysiwygDoc.body.contentEditable=_TRUE;else{var a=this;setTimeout(function(){try{a.wysiwygDoc.designMode="On",$tx.gecko&&a.wysiwygDoc.execCommand("enableInlineTableEditing",_FALSE,_FALSE)}catch(b){a.designModeActivated=_FALSE}},10)}},getName:function(){return this.constructor.__MODE},getWindow:function(){return this.wysiwygWindow},getDocument:function(){return this.wysiwygDoc},getContent:function(){return this.wysiwygDoc.body.innerHTML},setContent:function(a){a=this.doPreFilter(a),this.setBodyHTML(a),this.doPostFilter(this.wysiwygDoc.body)},doPreFilter:function(a){return a&&(a=b(a),a=c(a)),a},setBodyHTML:function(a){this.wysiwygDoc.body.innerHTML=a||$tom.EMPTY_PARAGRAPH_HTML},doPostFilter:function(a){d(a)},clearContent:function(){this.setContent("")},getScrollTop:function(){return $tom.getScrollTop(this.wysiwygDoc)},setScrollTop:function(a){$tom.setScrollTop(this.wysiwygDoc,a)},getScrollLeft:function(){return $tom.getScrollLeft(this.wysiwygDoc)},getProcessor:function(){return this.processor},ifProcessorReady:function(a){this.processor&&a(this.processor)},getStyle:function(a){return $tx.getStyle(this.wysiwygDoc.body,a)},addStyle:function(a){$tx.setStyleProperty(this.wysiwygDoc.body,a)},setBodyStyle:function(b,c){var d=a(c);$tx.setStyleProperty(b.body,d)},setFontStyle:function(a,b){var c=Object.extend(b,{browser:$tx.browser,pMarginZero:this.canvasConfig.pMarginZero?"true":"false"}),d=new Template(["#{if:pMarginZero=='true'}p { margin:0; padding:0; }#{/if:pMarginZero}","body, td, button { color:#{color}; font-size:#{fontSize}; font-family:#{fontFamily}; line-height:#{lineHeight}; }","div.txc-search-border { border-color:#{color}; }","div.txc-search-opborder { border-color:#{color}; }","img.tx-unresizable { width: auto !important; height: auto !important; }","button a { text-decoration:none #{if:browser=='firefox'}!important#{/if:browser}; color:#{color} #{if:browser=='firefox'}!important#{/if:browser}; }"].join("\n")).evaluate(c);$tx.applyCSSText(a,d)},applyBodyStyles:function(a){var b=this.wysiwygDoc;try{this.setFontStyle(b,a),this.setBodyStyle(b,a)}catch(a){}},applyCustomCssText:function(a){if(a){var b=this.wysiwygDoc;try{$tx.applyCSSText(b,a)}catch(a){}}},setRule:function(a,b){var c,d,e;try{c=this.wysiwygDoc.getElementById("txStyleForSetRule"),d=c.sheet?c.sheet:c.styleSheet,e=d.cssRules?d.cssRules:d.rules,d.insertRule?(0<e.length&&d.deleteRule(0),a&&d.insertRule(a+"{"+b+"}",0)):d.addRule&&(0<e.length&&d.removeRule(0),a&&d.addRule(a,b,0))}catch(a){}},bindEvents:function(a){var b=new Trex.WysiwygEventBinder(this.wysiwygWindow,this.wysiwygDoc,a,this.processor);setTimeout(function(){b.bindEvents()},this.constructor.EVENT_BINDING_DELAY)},getPanel:function(a){var b=a.initializedId||"";return $must("tx_canvas_wysiwyg"+b,"Trex.Canvas.WysiwygPanel")},setHeightBody:function(a){var b=this.wysiwygWindow.document.body,c=this.config.styles,d=c.marginTop?parseInt(c.marginTop):c.margin?parseInt(c.margin):parseInt($tx.getStyle(b,"margin-top")),e=c.paddingTop?parseInt(c.paddingTop):c.padding?parseInt(c.padding):parseInt($tx.getStyle(b,"padding-top")),f=d+e,g=c.marginBottom?parseInt(c.marginBottom):c.margin?parseInt(c.margin):parseInt($tx.getStyle(b,"margin-bottom")),h=c.paddingBottom?parseInt(c.paddingBottom):c.padding?parseInt(c.padding):parseInt($tx.getStyle(b,"padding-bottom")),i=g+h;a=parseInt(a)-f-i,b.style.height=a.toPx(),this._bodyHeight=a},setPanelHeight:function(a){function b(d){if(0!==d)try{c.setHeightBody(a)}catch(a){setTimeout(b.bind(this,d-1),30)}}var c=this;b(10),c.$super.setPanelHeight(a)},getHolder:function(a){var b=a.initializedId||"";return $must("tx_canvas_wysiwyg_holder"+b,"Trex.Canvas.WysiwygPanel")},focus:function(){this.ifProcessorReady(function(a){a.focus()})},ensureFocused:function(){this.onceWysiwygFocused||(this.onceWysiwygFocused=!0,this.focus())},show:function(){this.$super.show(),this.ifProcessorReady(function(a){setTimeout(function(){try{a.focusOnTop()}catch(a){}},100)})},hide:function(){this.ifProcessorReady(function(a){a.blur()}),this.$super.hide()},includeWebfontCss:function(a){this.webfontLoader.load(a)},getUsedWebfont:function(){return this.webfontLoader.getUsed()},getPositionByNode:function(a){return new Trex.WysiwygRelative(this.iframe).getRelative(a)}})}(),Trex.module("canvas set focus on mousedown event. only IE.",function(a,b,c,d,e){$tx.msie_std&&d.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEUP,function(a){if($tx.isLeftClick(a)){"html"==$tx.element(a).tagName.toLocaleLowerCase()&&d.focusOnBottom()}})}),Trex.module("auto body resize",function(a,b,c,d,e){d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){function b(){try{delete Editor.__MULTI_LIST[a.kEditor.instanceId]}catch(a){}if(d&&d.history){d.history.undoMementoList=[],d.history.redoMementoList=[],d.history.undoMementoList=null,d.history.redoMementoList=null;try{d.history.currentMemento.before.content=null,d.history.currentMemento.before=null}catch(a){}try{d.history.currentMemento.after.content=null,d.history.currentMemento.after=null}catch(a){}d.history.currentMemento=null,d.history=null}try{delete d.jobObservers}catch(a){}try{delete d.keyObservers}catch(a){}g.el=g.elHolder=g.iframe=g.wysiwygWindow=g.wysiwygDoc=g.canvas=null,d.elContainer=d.wysiwygEl=d.sourceEl=d.textEl=d.elEditorBlockUI=null,e=""}function c(){try{if(0==--i){if(a&&a.kEditor&&0==$("#tx_trex_container"+a.kEditor.eInstanceId).length)return clearInterval(h),void b();i=10}if(!d.isWYSIWYG())return;var c=g.getDocument(),e=c.body,k=e.scrollHeight;g._bodyContentHeight=k,k-=j,e.style.height=k<=f?f.toPx():""}catch(a){clearInterval(h)}}var e="",f=0,g=d.getPanel("html");f=g._bodyHeight;var h=null,i=30;d.observeJob("canvas.height.change",function(a){f=parseInt(g._bodyHeight)});var j=16;try{j=2*parseInt(this.config.styles.padding,10)}catch(a){}h=setInterval(c,1e3)})}),Trex.Canvas.TextareaPanel=Trex.Class.create({$extend:Trex.Canvas.BasedPanel,initialize:function(a,b){this.$super.initialize(a,b);var c=new Trex.Canvas.TextAreaProcessor(this.el);this.getProcessor=function(){return c},this.lastHeight=(this.lastHeight-18).toPx(),b.readonly&&this.setReadOnly()},show:function(){this.$super.show();var a=this.elHolder,b=this.getProcessor();setTimeout(function(){try{b.focusOnTop()}catch(a){}$tx.msie6&&(a.style.padding="1px",setTimeout(function(){a.style.padding="0px"},0))},100)},setContent:function(a){this.el.value=a},getContent:function(){return this.el.value},getPanelHeight:function(){return($tom.getHeight(this.el).parsePx()+2).toPx()},setPanelHeight:function(a){this.$super.setPanelHeight((a.parsePx()-2).toPx())},setReadOnly:function(){this.el.readOnly=_TRUE}}),Trex.Canvas.HtmlPanel=Trex.Class.create({$extend:Trex.Canvas.TextareaPanel,$const:{__MODE:Trex.Canvas.__HTML_MODE},initialize:function(a,b){this.$super.initialize(a,b),this.bindEvents(),"8"==$tx.msie_ver&&this.el.setAttribute("style","width: 500px; min-width: 100%; max-width: 100%;"),b.styles.notApplyBgColorOnSourceMode||(b.styles.backgroundColor&&$tx.setStyle(this.el,{backgroundColor:b.styles.backgroundColor}),b.styles.color&&$tx.setStyle(this.el,{color:b.styles.color}))},bindEvents:function(){var a={keydown:function(a){this.canvas.fireJobs(Trex.Ev.__CANVAS_SOURCE_PANEL_KEYDOWN,a)},keyup:function(){var a=this.canvas.getProcessor();a&&a.savePosition&&a.savePosition()},mousedown:function(a){this.canvas.fireJobs(Trex.Ev.__CANVAS_SOURCE_PANEL_MOUSEDOWN,a)},mouseup:function(){var a=this.canvas.getProcessor();a&&a.savePosition&&a.savePosition()},click:function(a){this.canvas.fireJobs(Trex.Ev.__CANVAS_SOURCE_PANEL_CLICK,a)}};for(var b in a)$tx.observe(this.el,b,a[b].bind(this),_TRUE)},getPanel:function(a){var b=a.initializedId?a.initializedId:"";return $must("tx_canvas_source"+b,"Trex.Canvas.HtmlPanel")},getHolder:function(a){var b=a.initializedId?a.initializedId:"";return $must("tx_canvas_source_holder"+b,"Trex.Canvas.HtmlPanel")},setContent:function(a){(new Trex.Validator).exists(a)?this.$super.setContent(a):this.$super.setContent("")}}),Trex.Canvas.TextPanel=Trex.Class.create({$extend:Trex.Canvas.TextareaPanel,$const:{__MODE:Trex.Canvas.__TEXT_MODE},initialize:function(a,b){this.$super.initialize(a,b),this.bindEvents()},bindEvents:function(){var a={keydown:function(){},keyup:function(){},mousedown:function(){},mouseup:function(){},click:function(a){this.canvas.fireJobs(Trex.Ev.__CANVAS_TEXT_PANEL_CLICK,a)}};for(var b in a)$tx.observe(this.el,b,a[b].bind(this),_TRUE)},getPanel:function(a){var b=a.initializedId?a.initializedId:"";return $must("tx_canvas_text"+b,"Trex.Canvas.TextPanel")},getHolder:function(a){var b=a.initializedId?a.initializedId:"";return $must("tx_canvas_text_holder"+b,"Trex.Canvas.TextPanel")}}),Trex.module("interrupt enter key action @ text panel",function(a,b,c,d){var e=d.config.newlinepolicy,f=d.config.insertbr;"br"==e&&f&&d.observeJob(Trex.Ev.__CANVAS_SOURCE_PANEL_KEYDOWN,function(a){d.isWYSIWYG()||d.getProcessor().controlEnter(a)})}),Trex.I.Marker={},Trex.I.Marker.Standard={paste:function(){var a=this.processor.getRange(),b=a.endContainer,c=a.startContainer;9==b.nodeType&&(b=this.processor.doc.body,c=this.processor.doc.body);var d=this.endMarker=this.processor.create("span",{id:"tx_end_marker"}),e=a.endOffset;3==b.nodeType?(b.splitText(e),b.parentNode.insertBefore(d,b.nextSibling)):b.insertBefore(d,b.childNodes[e]);var f=this.startMarker=this.processor.create("span",{id:"tx_start_marker"}),g=a.startOffset;3==c.nodeType?(c.splitText(g),c.parentNode.insertBefore(f,c.nextSibling)):c.insertBefore(f,c.childNodes[g])},remove:function(){$tom.remove(this.startMarker),$tom.remove(this.endMarker)}},Trex.I.Marker.Trident={paste:function(){this.clear();var a=this.processor.getRange(),b=this.processor.doc.body,c=a.duplicate();c.collapse(_TRUE),c.pasteHTML('<span id="tx_start_marker"></span>'),this.startMarker=$tom.collect(b,"#tx_start_marker");var d=a.duplicate();d.collapse(_FALSE),d.pasteHTML('<span id="tx_end_marker"></span>'),this.endMarker=$tom.collect(b,"#tx_end_marker")},clear:function(){var a=this.processor.doc.body;$tom.remove($tom.collect(a,"#tx_start_marker")),$tom.remove($tom.collect(a,"#tx_end_marker"))},remove:function(){$tom.remove(this.startMarker),$tom.remove(this.endMarker)}},Trex.Canvas.Marker=Trex.Class.create({$mixins:[$tx.msie_nonstd?Trex.I.Marker.Trident:Trex.I.Marker.Standard],initialize:function(a){this.processor=a},backup:function(){this.processor.bookmarkWithMarker(this)},checkCollapsed:function(){return $tom.next(this.startMarker)==this.endMarker}}),Trex.I.Selection={},Trex.I.Selection.Standard={getSel:function(){return this.win.getSelection()},getText:function(){return this.getSel().toString()},getNode:function(){var a=this.getRange();if(a){var b=a.startContainer;return 1==b.nodeType?$tom.isBody(b)?b:b.childNodes[a.startOffset]:b.parentNode}return _NULL},createRange:function(){return this.doc.createRange()},createTextRange:function(){return this.doc.createRange()},getRange:function(a){var b=this.getSel();if(b&&b.rangeCount>0){if(a==_NULL)return 1==b.rangeCount?b.getRangeAt(0):this.mergeRange(b);var c=b.getRangeAt(0);return c.collapse(a),c}return this.doc.createRange()},isCollapsed:function(){var a=this.getSel();return a&&a.isCollapsed},collapse:function(a){var b=this.getSel();if(b&&b.rangeCount>0){b.getRangeAt(0).collapse(a)}},getControl:function(){var a,b=this.getSel();if($tx.opera){if((a=b.anchorNode.childNodes[b.anchorOffset])==_NULL)return _NULL;if(b.isCollapsed&&"IMG"!=a.tagName)return _NULL}else{if(b.isCollapsed)return _NULL;a=b.anchorNode.childNodes[b.anchorOffset]}return $tom.kindOf(a,"%control")?a:_NULL},
hasControl:function(){return this.getControl()!=_NULL},selectControl:function(a){var b=this.createRange();b.selectNode(a);var c=this.getSel();c.removeAllRanges(),c.addRange(b)},compareTextPos:function(){var a=this.getRange();if(a){var b=a.startContainer;if(3==b.nodeType)return 0==b.textContent.trim().length?$tom.__POSITION.__EMPTY_TEXT:0==a.startOffset?$tom.__POSITION.__START_OF_TEXT:a.startOffset==b.textContent.length?$tom.__POSITION.__END_OF_TEXT:$tom.__POSITION.__MIDDLE_OF_TEXT}return $tom.__POSITION.__END_OF_TEXT},mergeRange:function(a){try{for(var b=[],c=0,d=a.rangeCount;c<d;c++)b.push(a.getRangeAt(c));a.removeAllRanges();var e=b[0].startContainer.childNodes[b[0].startOffset],f=b[d-1].endContainer.childNodes[b[d-1].endOffset-1],g=this.doc.createRange();try{g.setStart(e,0)}catch(a){g.collapse(_TRUE)}try{g.setEnd(f,f.childNodes.length)}catch(a){}return a.addRange(g),a.getRangeAt(0)}catch(b){return a.getRangeAt(0)}},setStart:function(a,b,c){try{a.setStart(b,c)}catch(d){a.collapse(_TRUE),a.setStart(b,c)}},setEnd:function(a,b,c){try{a.setEnd(b,c)}catch(d){a.collapse(_FALSE),a.setEnd(b,c)}},selectRange:function(a){var b=this.getSel();b.removeAllRanges(),b.addRange(a)}},Trex.I.Selection.Trident={getSel:function(){return this.doc.selection},getText:function(){return this.getSel().createRange().text},getNode:function(){var a=this.getSel();return"control"===a.type.toLowerCase()?a.createRange().item(0):a.createRange().parentElement()},createRange:function(){return this.getSel().createRange()},createTextRange:function(){return this.doc.body.createTextRange()},getRange:function(a){var b=this.getSel(),c=b.type.toLowerCase();if("none"==c)return b.createRange()?b.createRange():function(){var a=this.doc.body.createTextRange();return a.collapse(_TRUE),a.select(),a}();if(a==_NULL)return b.createRange();if("text"===c){var d=b.createRange();return d.collapse(a),d.select(),b.createRange()}return"control"===c&&b.empty(),b.createRange()},isCollapsed:function(){var a=this.getSel(),b=a.type.toLowerCase();if("none"===b)return _TRUE;if("control"===b)return _TRUE;if("text"===b){var c=a.createRange();return 0==c.compareEndPoints("StartToEnd",c)}return _TRUE},collapse:function(a){var b=this.getSel(),c=b.type.toLowerCase();if("text"===c){var d=b.createRange();return d.collapse(a),d.select(),b.createRange()}return"control"===c&&b.empty(),b.createRange()},getControl:function(){var a=this.getSel();if("control"===a.type.toLowerCase()){var b=a.createRange().item(0);return $tom.kindOf(b,"%control")?b:_NULL}return _NULL},hasControl:function(){return"control"===this.getSel().type.toLowerCase()?_TRUE:_FALSE},selectControl:function(a){var b=this.doc.body.createControlRange();b.add(a),b.select()},compareTextPos:function(){var a=this.getSel();if("none"===a.type.toLowerCase()){var b=a.createRange(),c=b.duplicate();return c.moveToElementText(b.parentElement()),0==c.text.trim().replace(Trex.__WORD_JOINER_REGEXP,"").length?$tom.__POSITION.__EMPTY_TEXT:0==b.compareEndPoints("StartToStart",c)?$tom.__POSITION.__START_OF_TEXT:0==b.compareEndPoints("EndToEnd",c)?$tom.__POSITION.__END_OF_TEXT:$tom.__POSITION.__MIDDLE_OF_TEXT}return $tom.__POSITION.__END_OF_TEXT},transTextRange:function(a,b,c,d){var e=this.createTextRange(),f=this.win.span(Trex.__WORD_JOINER);return $tom.insertAt(f,b),e.moveToElementText(f),$tom.remove(f),e.collapse(_TRUE),e.moveStart("character",c),d?a.setEndPoint("StartToStart",e):a.setEndPoint("EndToEnd",e),a},setStart:function(a,b,c){try{this.transTextRange(a,b,c,_TRUE)}catch(a){}return a},setEnd:function(a,b,c){try{this.transTextRange(a,b,c,_FALSE)}catch(a){}return a},selectRange:function(a){a.select()}},Trex.I.Selection.TridentStandard={getControl:function(){var a=this.getSel();if(a.isCollapsed)return null;if($tom.isElement(a.anchorNode)){var b=a.anchorNode.childNodes[a.anchorOffset];return $tom.kindOf(b,"%control")?b:null}var c=$tom.previous(a.focusNode);return c==$tom.next(a.anchorNode)?$tom.first(c,"%control"):null},selectControl:function(a){var b=this.createRange();b.selectNode(a);var c=this.getSel();c.removeAllRanges(),c.addRange(b)}},Trex.I.Selection.Gecko={},Trex.I.Selection.Webkit={getControl:function(){var a=this.getSel();if(a.isCollapsed)return _NULL;if($tom.isElement(a.anchorNode)){var b=a.anchorNode.childNodes[a.anchorOffset];return $tom.kindOf(b,"%control")?b:_NULL}var c=$tom.previous(a.focusNode);return c==$tom.next(a.anchorNode)?$tom.first(c,"%control"):_NULL},selectControl:function(a){var b=this.createRange();b.selectNode(a);var c=this.getSel();c.removeAllRanges(),c.addRange(b)}},Trex.I.Selection.Presto={},Trex.Canvas.Selection=Trex.Class.create({$mixins:[Trex.I.Selection.Standard,$tx.msie_nonstd?Trex.I.Selection.Trident:{},$tx.msie_std?Trex.I.Selection.TridentStandard:{},$tx.gecko?Trex.I.Selection.Gecko:{},$tx.webkit?Trex.I.Selection.Webkit:{},$tx.presto?Trex.I.Selection.Presto:{}],initialize:function(a){this.processor=a,this.win=a.win,this.doc=a.doc}}),Trex.Canvas.Bookmark=Trex.Class.create({startContainer:_NULL,startOffset:0,endContainer:_NULL,endOffset:0,initialize:function(a){this.processor=a,this.win=a.win,this.doc=a.doc,this.dummy=function(){return a.newDummy()}},collapse:function(a){a?this.updateEnd(this.startContainer,this.startOffset):this.updateStart(this.endContainer,this.endOffset)},save:function(a){this.updateStart(a.startContainer,a.startOffset),this.updateEnd(a.endContainer,a.endOffset)},saveAroundNode:function(a){this.updateStartBefore($tom.top(a)),this.updateEndAfter($tom.bottom(a))},saveIntoFirst:function(a){var b=$tom.top(a);this.updateEndBefore(b),this.collapse(_FALSE)},saveIntoLast:function(a){var b=$tom.bottom(a);this.updateEndBefore(b),this.collapse(_FALSE)},savePreviousTo:function(a){if($tom.previous(a)){var b=$tom.top($tom.previous(a));this.updateEndAfter(b)}else this.updateEndBefore(a);this.collapse(_FALSE)},saveNextTo:function(a){if($tom.next(a)){var b=$tom.top($tom.next(a));this.updateEndBefore(b)}else this.updateEndAfter(a);this.collapse(_FALSE)},saveWithMarker:function(a){a.checkCollapsed()?(this.updateEndAfter(a.endMarker),this.collapse(_FALSE)):(this.updateStartBefore(a.startMarker),this.updateEndAfter(a.endMarker))},select:function(a){if(this.isValid()){var b=a.createTextRange();try{a.setStart(b,this.startContainer,this.startOffset),a.setEnd(b,this.endContainer,this.endOffset)}catch(a){}a.selectRange(b)}this.reset()},isValid:function(){return this.isValidStartContainer()&&this.isValidEndContainer()},isValidStartContainer:function(){return this.doc.body===$tom.body(this.startContainer)},isValidEndContainer:function(){return this.doc.body===$tom.body(this.endContainer)},updateStart:function(a,b){this.startContainer=a,this.startOffset=b},updateStartBefore:function(a){var b=this.dummy();$tom.insertAt(b,a),this.startContainer=b,this.startOffset=0},updateStartAfter:function(a){var b=this.dummy();$tom.insertNext(b,a),this.startContainer=b,this.startOffset=0},updateEnd:function(a,b){this.endContainer=a,this.endOffset=b},updateEndBefore:function(a){var b=this.dummy();a.nodeName&&"P"==a.nodeName.toUpperCase()&&!a.nodeValue?$tom.append(a,b):$tom.insertAt(b,a),this.endContainer=b,this.endOffset=b.length},updateEndAfter:function(a){var b=this.dummy();$tom.insertNext(b,a),this.endContainer=b,this.endOffset=b.length},reset:function(){this.startContainer=_NULL,this.startOffset=0,this.endContainer=_NULL,this.endOffset=0}}),Trex.Canvas.TextAreaProcessor=Trex.Class.create({$mixins:[],initialize:function(a){this.el=a},focus:function(){this.el.focus()},blur:function(){_WIN.focus()},focusOnTop:function(){var a=this.el;a.focus(),this._selectCharacter(0,0),a.scrollTop=0},focusOnBottom:function(){var a=this.el;a.focus();var b=a.value.length;this._selectCharacter(b,b),a.scrollTop=a.scrollHeight},savePosition:function(){},controlEnter:function(){this.insertTag("<br/>","")},insertTag:function(a,b){return this.pasteContent(a+b),_TRUE},pasteContent:function(a){this.el.value+=a},_selectCharacter:function(a,b){var c=this.el;if(c.setSelectionRange)c.select(),c.setSelectionRange(a,b);else if(c.createTextRange){var d=c.createTextRange();d.collapse(_TRUE),d.moveStart("character",a),d.moveEnd("character",b),d.select()}}}),Trex.I.Processor={},Trex.I.Processor.Standard={txSelection:_NULL,isRangeInsideWysiwyg:_FALSE,lastRange:_NULL,initialize:function(a,b){this.win=a,this.doc=b,this.txSelection=new Trex.Canvas.Selection(this),this.bookmark=new Trex.Canvas.Bookmark(this)},getTxSel:function(){return this.txSelection},getSel:function(){return this.txSelection.getSel()},getRange:function(){return this.txSelection.getRange()},getBookmark:function(){return this.bookmark},isCollapsed:function(){return this.txSelection.isCollapsed()},getNode:function(){return this.txSelection.getNode()},getControl:function(){return this.txSelection.getControl()},hasControl:function(){return this.txSelection.hasControl()},selectControl:function(a){return this.txSelection.selectControl(a)},getText:function(){return this.txSelection.getText()},compareTextPos:function(){return this.txSelection.compareTextPos()},findNode:function(a){try{return $tom.find(this.getNode(),a)}catch(a){return _NULL}},queryStyle:function(a,b){if(!a)return _NULL;if(b="float"==b?a.style.styleFloat===_UNDEFINED?"cssFloat":"styleFloat":b,a.style&&a.style[b])return a.style[b];if(a.currentStyle&&a.currentStyle[b])return a.currentStyle[b];if(_WIN.getComputedStyle){for(var c=a;$tom.isText(c);)c=c.parentNode;var d=$tom.getWindow(this.doc),e=d.getComputedStyle(c,_NULL);return e?e[b]:_NULL}return _NULL},queryAttr:function(a,b){return a?$tom.getAttribute(a,b):_NULL},queryCommandState:function(a){try{return this.doc.queryCommandState(a)}catch(a){return _FALSE}},queryCommandValue:function(a){try{return this.doc.queryCommandValue(a)}catch(a){return""}},execCommand:function(a,b){if($tx.gecko)try{this.doc.execCommand("styleWithCSS",_FALSE,_FALSE)}catch(a){}try{this.doc.execCommand(a,_FALSE,b)}catch(a){}},execWithMarker:function(a){var b=new Trex.Canvas.Marker(this);this.bookmarkTo();try{b.paste(),b.backup(),a(b)}catch(a){}finally{b.remove()}},focus:function(){this.doc.body.focus()},blur:function(){_WIN.focus()},focusOnTop:function(){this.focus(),this.selectFirstText(this.doc.body),this.doc.body.scrollTop=0},selectFirstText:function(a){var b=$tom.top(a);this.createGoogRangeFromNodes(b,0,b,0).select()},selectLastText:function(a){var b=$tom.bottom(a),c=0;b&&3==b.nodeType&&b.length&&(c=b.length),this.createGoogRangeFromNodes(b,c,b,c).select()},focusOnBottom:function(){this.focus(),this.moveCaretTo(this.doc.body,_FALSE),this.doc.body.scrollTop=this.doc.body.scrollHeight},moveCaretTo:function(a,b,c){a&&(this.focus(),this.bookmarkInto(a,b),!1!==c&&this.bookmark.select(this.txSelection))},moveCaretWith:function(a){if(a){var b=this.findNode(a);b&&(this.focus(),this.bookmark.saveNextTo(b),this.bookmark.select(this.txSelection))}},selectAround:function(a){a&&(this.focus(),this.bookmark.saveAroundNode(a),this.bookmark.select(this.txSelection))},bookmarkInto:function(a,b){a&&(b=b==_NULL?_TRUE:b,b?this.bookmark.saveIntoFirst(a):this.bookmark.saveIntoLast(a))},bookmarkToPrevious:function(a){a&&this.bookmark.savePreviousTo(a)},bookmarkToNext:function(a){a&&this.bookmark.saveNextTo(a)},bookmarkTo:function(a){a=a||this.txSelection.getRange(),this.bookmark.save({startContainer:a.startContainer,startOffset:a.startOffset,endContainer:a.endContainer,endOffset:a.endOffset})},bookmarkWithMarker:function(a){this.bookmark.saveWithMarker(a)},restore:function(){this.bookmark.select(this.txSelection)},create:function(){for(var a=arguments[0],b=this.newNode(a),c=1;c<arguments.length;c++){var d=arguments[c];if(d.nodeType)$tom.append(b,d);else if("string"==typeof d||"number"==typeof d)b.innerHTML+=d;else if("array"==typeof d)for(var e=0;e<d.length;e++)$tom.append(b,d[e]);else $tom.applyAttributes(b,d)}return b},pasteNode:function(a,b,c,d){if(a){if(a.length||(a=[].concat(a)),this.txSelection.collapse(_FALSE),b){var e,f,g,h=this;this.execWithMarker(function(b){if(g=$tom.divideParagraph(b.endMarker),$tom.kindOf(g,"p,li,dd,dt,h1,h2,h3,h4,h5,h6")?(e=$tom.previous(g),f=$tom.clone(g)):(g=h.newNode("p"),$tom.insertAt(g,b.endMarker),f=h.newNode("p")),$tom.insertAt(f,g),a.each(function(a){$tom.append(f,a)}),c&&$tom.applyAttributes(f,c),1==a.length){var d=a[0],i=$tom.kindOf(d,"table,hr,blockquote,pre,h1,h2,h3,h4,h5,h6,div"),j=$tom.isTagName(f,"p");i&&j&&$tom.unwrap(f)}}),e&&($tom.hasData(e)||this.stuffNode(e)),this.stuffNode(g),this.bookmark.saveIntoFirst(g)}else{var i=this;this.executeUsingCaret(function(b,c){var e=c.getCaret(_FALSE),f=c.getCaret(_FALSE),g=$tx.msie_nonstd?e:_NULL;$tx.webkit&&a.reverse(),a.each(function(a){b.insertNode(a,g)}),f&&f.nextSibling?i.moveCaretTo(f.nextSibling,0,d):f&&i.moveCaretTo(f,0,d)})}return a[0]}},pasteContent:function(a,b,c,d){var e=this.create("div");e.innerHTML=a;var f=$tom.children(e);return this.pasteNode(f,b,c,d)},pasteHtml:function(a,b,c){function d(){var d=null;if(c&&$tx.msie&&(d=e.doc.createTextNode("")),f.getRangeAt&&null!=f.rangeCount){if(0==f.rangeCount&&!c)return;if(c&&(h=c),b&&!h&&(h=b.getProcessor().getSelectionRange(b)),h||(h=f.getRangeAt(f.rangeCount-1)),h.deleteContents(),h.createContextualFragment)g=h.createContextualFragment(a);else{var i=e.doc.createElement("div");i.innerHTML=a,g=document.createDocumentFragment();for(var j=i.firstChild;null!=j;)g.appendChild(j),j=i.firstChild}try{h.selectNode(g)}catch(a){}if(d)try{h.insertNode(d)}catch(a){}h.insertNode(g),f.collapseToEnd()}else if(f.type&&"Control"!=f.type){if(c&&(h=c),b&&(h=b._SELECTION_RANGE),h||(h=f.createRange()),d)try{h.insertNode(d)}catch(a){}h.pasteHTML(a)}try{if(h&&(h.collapse(!1),f.removeAllRanges(),f.addRange(h),d)){if(d.nextSibling&&"#text"==d.nextSibling.nodeType){var k=d.nextSibilng;d.parentNode.removeChild(d),d=k}h.selectNode(d)}}catch(a){}}var e=this,f=this.doc.getSelection?this.doc.getSelection():this.doc.selection,g=null,h=null;try{$tx.msie?d():this.doc.execCommand("insertHTML",!1,a)}catch(a){d()}},getSelectionRange:function(a){var b=this.doc,c=b.getSelection?b.getSelection():b.selection,d=null;if(c.getRangeAt&&null!=c.rangeCount){if(0==c.rangeCount)return;d=c.getRangeAt(c.rangeCount-1)}else c.type&&"Control"!=c.type&&(a&&(d=a._SELECTION_RANGE),d||(d=c.createRange()));return d},pasteNodeCustom:function(a,b,c){var d=this,e=this.doc.getSelection?this.doc.getSelection():this.doc.selection,f=null;try{return function(){var g=null;if(c&&$tx.msie&&(g=d.doc.createTextNode(" ")),e.getRangeAt&&null!=e.rangeCount){if(0==e.rangeCount&&!c)return;if(c&&(f=c),f||(f=e.getRangeAt(e.rangeCount-1)),f.deleteContents(),g)try{f.insertNode(g)}catch(a){}f.insertNode(a);try{f.selectNode(a)}catch(a){}e.collapseToEnd()}else if(e.type&&"Control"!=e.type){if(c&&(f=c),b&&!f&&(f=b._SELECTION_RANGE),f||(f=e.createRange()),g)try{f.insertNode(g)}catch(a){}f.insertNode(a)}try{if(c&&(f.collapse(!1),e.removeAllRanges(),e.addRange(f),g)){if(g.nextSibling&&"#text"==g.nextSibling.nodeType){var h=g.nextSibilng;g.parentNode.removeChild(g),g=h}f.selectNode(g)}}catch(a){}}(),a}catch(b){return this.pasteNode(a,!1,c)}},replace:function(a,b,c){return this.bookmark.saveAroundNode(a),$tom.replace(a,this.create(b,c))},blocks:function(a){var b=[],c=a();if(this.hasControl()){var d=this.getControl();$tom.kindOf(d.parentNode,c)&&b.push(d.parentNode)}else{var e=this;this.execWithMarker(function(a){for(var d,f=e.getBlockRangeIterator(c,a.startMarker,a.endMarker);f.hasNext();)d=f.next(),$tom.kindOf(d,"#tx_start_marker,#tx_end_marker")||b.push(d)})}return b},inlines:function(a){var b=[],c=a(),d=this,e=function(){return d.create($tom.inlineOf())};if(this.hasControl()){var f=this.getControl();if($tom.kindOf(f,c))b.push(f);else{var g=e();$tom.insertNext(g,f),$tom.append(g,f)}}else this.execWithMarker(function(a){if(a.checkCollapsed()){var f=e();$tom.append(f,d.newDummy()),$tom.insertNext(f,a.startMarker),d.bookmarkTo({startContainer:f,startOffset:1,endContainer:f,endOffset:1}),b.push(f)}else for(var g,h=d.getInlineRangeIterator(c,a.startMarker,a.endMarker);h.hasNext();)g=h.next(),$tom.kindOf(g,"#tx_start_marker,#tx_end_marker")||$tom.kindOf(g,"br")||b.push(g)});return b},controls:function(a){var b=[];return this.hasControl()&&$tom.kindOf(this.getControl(),a())&&b.push(this.getControl()),b},addDummyNbsp:function(){},apply:function(a,b){return a?(a.length||(a=[].concat(a)),a.each(function(a){$tom.applyAttributes(a,b)}),a):_NULL},wrap:function(a,b,c){if(!a)return _NULL;a.length||(a=[].concat(a)),c=c||{};var d=$tom.wrap(this.create(b,c),a);if($tx.msie&&!$tom.nextContent(d)){var e=this.doc.createElement("p");e.innerHTML=$tom.EMPTY_BOGUS,this.doc.body.appendChild(e)}return d},unwrap:function(a){return a?(this.bookmark.saveAroundNode(a),$tom.unwrap(a)):_NULL},createGoogRange:function(){return goog.dom.Range.createFromWindow(this.win)},createGoogRangeFromNodes:function(a,b,c,d){return goog.dom.Range.createFromNodes(a,b,c,d)},executeUsingCaret:function(a){try{var b=this.createGoogRange();b||(this.doc.body.focus(),b=this.createGoogRange());var c=null;return b&&b.saveUsingCarets&&(c=b.saveUsingCarets()),a(b,c)}finally{c&&!c.isDisposed()&&c.restore()}}},Trex.module("observe that @when control elements are focused at",function(a,b,c,d){($tx.webkit||$tx.presto)&&d.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEDOWN,function(a){var b=d.getProcessor(),c=$tx.element(a);if($tom.kindOf(c,"img,hr,iframe,table")){var e=$tom.find(c,"button");e?b.selectControl(e):b.selectControl(c)}else $tom.kindOf(c,"button")&&b.selectControl(c)})}),Trex.module("bind iframe activate or deactivate event",function(a,b,c,d){d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(a){var b=d.getProcessor(Trex.Canvas.__WYSIWYG_MODE);$tx.observe(a,"beforedeactivate",function(a){b.isRangeInsideWysiwyg=!0,b.lastRange=b.getRange()}),$tx.observe(a,"deactivate",function(a){b.hasControl()||(b.isRangeInsideWysiwyg=!1)}),$tx.observe(a,"activate",function(){b.isRangeInsideWysiwyg=!0,b.lastRange=_NULL})})}),Trex.I.Processor.Trident={stuffNode:function(a){return 0==$tom.getLength(a)&&(a.innerHTML="&nbsp;"),a},controlEnterByParagraph:function(){var a,b=this.findNode("div");if(!b)throw $propagate;var c=this.findNode("%paragraph");if($tom.kindOf(c,"p")){if($tom.first(b,"p")!=c)throw $propagate;this.execWithMarker(function(b){a=$tom.divideParagraph(b.endMarker)}),this.stuffNode(c),this.stuffNode(a),this.moveCaretTo(a)}else{if($tom.kindOf(c,"li,td,th,dd,dt"))throw $propagate;if(!c||!$(c).hasClass("txc-textbox"))throw $propagate;a=this.newParagraph("p"),this.execWithMarker(function(b){$tom.insertNext(a,b.endMarker)}),this.moveCaretTo(a)}}},Trex.module("delete image element @when backspace key event fires",function(a,b,c,d){$tx.msie_nonstd&&d.observeKey({ctrlKey:_FALSE,altKey:_FALSE,shiftKey:_FALSE,keyCode:Trex.__KEY.BACKSPACE},function(){var a=d.getProcessor();if(a.hasControl()&&a.getControl()){try{var b=a.getControl();$tom.remove(b)}catch(a){}throw $stop}throw $propagate})}),Object.extend(Trex.I.Processor.Trident,{restoreRange:function(){if(!this.isRangeInsideWysiwyg&&this.lastRange)try{this.lastRange.select()}catch(d){var a=this.getSel(),b=a.type.toLowerCase();if("control"===b){a.empty();var c=a.createRange();c.collapse(_FALSE),c.select()}}finally{this.lastRange=_NULL}}}),Trex.I.Processor.TridentStandard={stuffNode:function(a){return $tom.stuff(a,this.newNode("br"))},controlEnterByParagraph:function(a){var b=this.getRange(!1),c=b.endContainer;if(1==c.nodeType&&"P"!=c.nodeName&&1==c.childNodes.length&&"BR"==c.childNodes[0].nodeName)$tom.remove(c.childNodes[0]);else if(1==c.childNodes.length){for(var d=!1,e=c.childNodes[0],f=10;e;){if(--f<0){d=!1;break}if(!(e.childNodes&&e.childNodes.length<=1)||"BR"!=e.nodeName&&"SPAN"!=e.nodeName&&"STRONG"!=e.nodeName&&"B"!=e.nodeName&&"U"!=e.nodeName&&"I"!=e.nodeName&&"EM"!=e.nodeName&&"STRIKE"!=e.nodeName){d=!1;break}e=e.childNodes[0],d=!0}d&&$tom.remove(c.childNodes[0])}else 0!=c.childNodes.length||!c.nextSibling||"BR"!=c.nextSibling.nodeName||2!=c.parentNode.childNodes.length||"SPAN"!=c.parentNode.nodeName&&"STRONG"!=c.parentNode.nodeName&&"B"!=c.parentNode.nodeName&&"U"!=c.parentNode.nodeName&&"I"!=c.parentNode.nodeName&&"EM"!=c.parentNode.nodeName&&"STRIKE"!=c.parentNode.nodeName||$tom.remove(c.nextSibling);throw $propagate},controlEnterByLinebreak:function(a){var b=this,c=this.getRange(!1),d=c.endContainer.parentNode;if(d&&("P"==d.tagName||"DIV"==d.tagName||"BODY"==d.tagName||"BLOCKQUOTE"==d.tagName)&&("BLOCKQUOTE"==d.tagName||$tx.hasClassName(d,"txc-textbox")||$tx.hasClassName(d,"txc-moreless"))){$tx.stop(a);var e=b.win.br();c.insertNode(e),c.selectNode(e),c.collapse(!1),e=b.win.br(),c.insertNode(e),c.selectNode(e),c.collapse(!1);var c=b.getRange(!1);c.selectNodeContents(e.nextSibling);var f=b.getSel();f.removeAllRanges(),f.addRange(c),f.collapseToStart()}},queryCommandState:function(a){var b=this.getRange();if(this.hasControl()&&b.collapsed===_FALSE&&b.endOffset-b.startOffset==1&&("bold"===a||"underline"===a||"italic"===a||"strikethrough"===a)){var c=this.getControl();if("IMG"===c.tagName||"BUTTON"===c.tagName)return _FALSE}try{return this.doc.queryCommandState(a)}catch(a){return _FALSE}},addDummyNbsp:function(a){var b;1===a.length&&(b=a[0],"span"===b.tagName.toLowerCase()&&1===b.childNodes.length&&3===b.firstChild.nodeType&&""===b.firstChild.data&&(b.firstChild.data=" "))}},Object.extend(Trex.I.Processor.TridentStandard,{restoreRange:function(){if(!this.isRangeInsideWysiwyg&&this.lastRange){var a=this.lastRange.startContainer;if(a&&1==a.nodeType&&"BODY"==a.nodeName)return;var b=this.getSel();b.removeAllRanges(),b.addRange(this.lastRange)}}}),Trex.I.Processor.Gecko={stuffNode:function(a){return $tom.stuff(a,this.newNode("br"))},controlEnterByParagraph:function(){throw $propagate}},Trex.I.Processor.Webkit={stuffNode:function(a){return $tom.stuff(a,this.newNode("br"))},controlEnterByParagraph:function(){throw $propagate},findParagraph:function(a){var b=function(a){return $tom.kindOf(a,"div,p,blockquote")},c=function(a){return $tom.kindOf(a,"body,li,%tablegroup")};return $tom.findAncestor(a,b,c)},findAncestorListItem:function(a){var b=function(a){return $tom.kindOf(a,"li")},c=function(a){return $tom.kindOf(a,"body,%tablegroup")};return $tom.findAncestor(a,b,c)},divideListItem:function(a){var b,c=this;c.execWithMarker(function(c){b=$tom.divideTree(a,c.endMarker)}),$tom.hasUsefulChildren(a,_TRUE)||(a.innerHTML=""),$tom.hasUsefulChildren(b,_TRUE)||(b.innerHTML=""),c.stuffNode(a),c.stuffNode(b),c.moveCaretTo(b)},queryCommandState:function(a){var b=this.getRange();if(this.hasControl()&&b.collapsed===_FALSE&&b.endOffset-b.startOffset==1&&("bold"===a||"underline"===a||"italic"===a||"strikethrough"===a)){var c=this.getControl();if("IMG"===c.tagName||"BUTTON"===c.tagName)return _FALSE}try{return this.doc.queryCommandState(a)}catch(a){return _FALSE}},addDummyNbsp:function(a){var b;1===a.length&&(b=a[0],"span"===b.tagName.toLowerCase()&&1===b.childNodes.length&&3===b.firstChild.nodeType&&""===b.firstChild.data&&(b.firstChild.data=" "))}},Trex.I.Processor.Presto={stuffNode:function(a){return $tom.stuff(a,this.newNode("br"))},controlEnterByParagraph:function(a){throw $propagate}},Trex.I.Processor.StandardP={putBogusParagraph:function(){var a=this.doc.body,b=$tom.last(a);if(!b||!$tom.kindOf(b,"p")&&!$tom.kindOf(b,"div")){var c=this.newParagraph("p");$tom.kindOf(b,"br")?$tom.replace(b,c):$tom.append(a,c)}}},Trex.module("put bogus paragraph @when any key event fires",function(a,b,c,d){$tx.msie_nonstd||"p"==d.config.newlinepolicy&&d.reserveJob(Trex.Ev.__CANVAS_PANEL_KEYUP,function(){if(d.isWYSIWYG()){d.getProcessor().putBogusParagraph()}},10)}),Trex.module("interrupt enter key action @ wysiwyg panel",function(a,b,c,d){"p"==TrexConfig.get("canvas").newlinepolicy&&d.observeKey({ctrlKey:_FALSE,altKey:_FALSE,shiftKey:_FALSE,keyCode:Trex.__KEY.ENTER},function(a){if(d.isWYSIWYG()){var b=d.getProcessor();try{b.getTxSel().collapse(_FALSE),b.controlEnterByParagraph(a)}catch(a){if(a==$propagate)throw a}}})}),Trex.I.Processor.TridentP={},Trex.I.Processor.TridentStandardP={},Trex.I.Processor.GeckoP={},Trex.I.Processor.WebkitP={},Trex.I.Processor.PrestoP={},function(){var a=Trex.Class.create({initialize:function(a,b,c,d){this.processor=a,this.start=c,this.end=d||this.start,this.current=this.start,this.wTranslator=$tom.translate(b).extract("%wrapper"),this.pTranslator=$tom.translate(b).extract("%paragraph")},hasNext:function(){return!!this.current},next:function(){var a=this.current;a=this.find(a);var b=a;if($tom.include(a,this.end))b=_NULL;else{for(;b&&!$tom.next(b);)b=$tom.parent(b),$tom.isBody(b)&&(b=_NULL);b&&(b=$tom.next(b))}return b==this.end&&(b=_NULL),this.current=b,a},find:function(a){var b,c=a;if(!$tom.hasContent(c))return c;for(;c&&(b=c,!$tom.isBody(c));){if($tom.kindOf(c,this.wTranslator.getExpression()))return c;if($tom.kindOf(c,"%wrapper,%outergroup")){if(c=$tom.descendant(b,this.pTranslator.getExpression()))return c;if(c=$tom.descendant(b,"%paragraph")){b=c;break}}if($tom.kindOf(c,this.pTranslator.getExpression()))return c;c=c.nextSibling&&3==c.nodeType?c.nextSibling:c.parentNode}var d=$tom.paragraphOf($tom.getName(b)),e=this.processor.newNode(d),f=$tom.extract(b,a,"%text,%inline,img,object,embed,hr");return $tom.wrap(e,f),this.processor.stuffNode(e),e}});Object.extend(Trex.I.Processor.Standard,{getBlockRangeIterator:function(b,c,d){return new a(this,b,c,d)}})}(),function(){var a=Trex.Class.create({initialize:function(a,b,c,d){this.processor=a,this.start=c,this.end=d||this.start,this.current=this.start,this.iTranslator=$tom.translate(b).extract("%inline")},hasNext:function(){return!!this.current},next:function(){var a=this.current;a=this.find(a);var b=a;if(a==this.end)b=_NULL;else{for(;b&&!$tom.next(b);)b=$tom.parent(b),$tom.isBody(b)&&(b=_NULL);b&&(b=$tom.next(b))}return $tom.include(b,this.end)&&(b=$tom.top(b,_TRUE)),this.current=b,a},find:function(a){var b=a;if($tom.kindOf(b,"%paragraph,%outergroup,%block")||$tom.isBody(b)){var c=b;if(!(b=$tom.top(c,_TRUE))){var d=$tom.inlineOf(),e=this.processor.create(d);return $tom.append(c,e),e}}if($tom.kindOf(b,"br"))return b;if(!$tom.hasContent(b))return b;if($tom.kindOf(b,this.iTranslator.getExpression()))return b;var d=$tom.inlineOf(),e=this.processor.create(d);return $tom.insertAt(e,b),b&&$tom.append(e,b),e}});Object.extend(Trex.I.Processor.Standard,{getInlineRangeIterator:function(b,c,d){return new a(this,b,c,d)}})}(),function(){var a=_NULL,b={},c={};Object.extend(Trex.I.Processor.Standard,{newNode:function(c){return a!=this.doc&&(b={},a=this.doc),b[c]||(b[c]=this.win[c]()),$tom.clone(b[c],_FALSE)},newText:function(a){return this.doc.createTextNode(a)},newParagraph:function(b){return a!=this.doc&&(c={},a=this.doc),c[b]||(c[b]=this.stuffNode(this.newNode(b))),$tom.clone(c[b],_TRUE)}})}(),function(){var a=_NULL,b=_NULL,c=_FALSE,d=[];Object.extend(Trex.I.Processor.Standard,{newDummy:function(e){a!=this.doc&&(b=_NULL,d=[],a=this.doc),b||(b=this.doc.createTextNode(Trex.__WORD_JOINER));var f=$tom.clone(b);return e||(d.push(f),c=_TRUE),f},clearDummy:function(){if(c){var a,b;try{a=this.createGoogRange(),b=a&&a.getStartNode()}catch(a){}for(var e=_NULL,f=0,g=d.length-1;f<g;f++)try{var h=d.shift();h&&h.nodeValue&&(h.nodeValue==Trex.__WORD_JOINER?b!=h?$tom.remove(h):e=h:h.nodeValue=h.nodeValue.replace(Trex.__WORD_JOINER_REGEXP,""))}catch(a){}e&&d.splice(0,0,e),c=_FALSE}}})}(),Trex.Canvas.Processor=Trex.Class.draft({$mixins:[Trex.I.Processor.Standard,$tx.msie_nonstd?Trex.I.Processor.Trident:{},$tx.msie_std?Trex.I.Processor.TridentStandard:{},$tx.gecko?Trex.I.Processor.Gecko:{},$tx.webkit?Trex.I.Processor.Webkit:{},$tx.presto?Trex.I.Processor.Presto:{}]}),Trex.Canvas.ProcessorP=Trex.Class.create({$extend:Trex.Canvas.Processor,$mixins:[Trex.I.Processor.StandardP,$tx.msie_nonstd?Trex.I.Processor.TridentP:{},$tx.msie_std?Trex.I.Processor.TridentStandardP:{},$tx.gecko?Trex.I.Processor.GeckoP:{},$tx.webkit?Trex.I.Processor.WebkitP:{},$tx.presto?Trex.I.Processor.PrestoP:{}]}),Trex.register("filter > mode change",function(a,b,c,d,e){function f(a){for(var b=[[Trex.__WORD_JOINER_REGEXP,""],[new RegExp("<(\\/?[a-z]+)[^>]*>","gi"),"<$1>"],[new RegExp("\\n\\s*","g"),""],[new RegExp("<head>.*?<\\/head>","gi"),""],[new RegExp("<script>.*?<\\/script>","gi"),""],[new RegExp("<style>.*?<\\/style>","gi"),""],[new RegExp("\x3c!--.*?--\x3e","gi"),""],[new RegExp("<span></span>","gi"),""],[new RegExp("^<p>&nbsp;</p>$","gi"),""],[new RegExp("^<p><br></p>$","gi"),""],[new RegExp("<td>(.+?)<\\/td>","gi"),"\t$1"],[new RegExp("<th>(.+?)<\\/th>","gi")," \t$1"],[new RegExp("<\\/tr>","gi"),""],[new RegExp("<tr>","gi"),"\n"],[new RegExp("<\\?tbody>","gi"),""],[new RegExp("<div>([^<]*)<\\/div>","gi"),"\n$1"],[new RegExp("<p>&nbsp;</p>","gi"),"\n"],[new RegExp("<p><br></p>","gi"),"\n"],[new RegExp("<br>(<\\/p>)","gi"),"$1"],[new RegExp("<h[1-6]>(.+?)<\\/h[1-6]>","gi"),"\n$1\n\n"],[new RegExp("(<p>(.+?)<\\/p>)","gi"),"$1\n"],[new RegExp("<br>\\n","gi"),"\n"],[new RegExp("<br>","gi"),"\n"],[new RegExp("(<ul>|<\\/ul>|<ol>|<\\/ol>|<\\/table>)","gi"),"\n\n"],[new RegExp("(<li>(.+?)<\\/li>)","gi"),"\t$1\n"],[new RegExp("<div><\\/div>\n","gi"),"~"],[new RegExp("<[\\/a-zA-Z!]+>","g"),""],[new RegExp("&nbsp;?","g")," "],[new RegExp("&quot;?","g"),'"'],[new RegExp("&gt;?","g"),">"],[new RegExp("&lt;?","g"),"<"],[new RegExp("&amp;?","g"),"&"],[new RegExp("&copy;?","g"),"(c)"],[new RegExp("&trade;?","g"),"(tm)"],[new RegExp("&#8220;?","g"),'"'],[new RegExp("&#8221;?","g"),'"'],[new RegExp("&#8211;?","g"),"_"],[new RegExp("&#8217;?","g"),"'"],[new RegExp("&#38;?","g"),"&"],[new RegExp("&#169;?","g"),"(c)"],[new RegExp("&#8482;?","g"),"(tm)"],[new RegExp("&#151;?","g"),"--"],[new RegExp("&#039;?","g"),"'"],[new RegExp("&#147;?","g"),'"'],[new RegExp("&#148;?","g"),'"'],[new RegExp("&#149;?","g"),"*"],[new RegExp("&reg;?","g"),"(R]"],[new RegExp("&bull;?","g"),"*"]],c=a,d=0;d<b.length;d++)c=c.replace(b[d][0],b[d][1]);return c}function g(a){try{return a.replace(new RegExp("<br[^>]*>\\n","gi"),"\n")}catch(a){}return a}function h(a){return a!==_NULL&&0!==a.length&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/ /g,"&nbsp;"),a=a.replace(/\"/g,"&quot;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/</g,"&lt;"),a.lastIndexOf("\n")===a.length-1&&(a=a.substr(0,a.length-1)),a.lastIndexOf("\r")===a.length-1&&(a=a.substr(0,a.length-1)),a=a.replace(/\r\n|\r|\n/g,"<br>\n")),a}function i(a){return a.replace(/<\/(p)><(p[\s>])/gi,"</$1>\n<$2")}function j(a){return a.replace(/<\/(p)>\n+<(p[\s>])/gi,"</$1><$2")}function k(a){if(!($tx.msie&&$tx.msie_docmode<9))return a;if(!d.isWYSIWYG())return a;var b=d.getCurrentPanel().getWindow().location,c=b.protocol+"//"+b.host,e=b.href,f=e.substring(0,e.lastIndexOf("/")+1),g=new RegExp("(href=[\"'])("+c.getRegExp()+"[^\"']*)([\"'])","gi");return a.replace(g,function(a,b,d,g){return b+d.replace(e,"").replace(f,"").replace(c,"")+g})}a.getDocParser().registerFilter("filter/converting",{"text@load":function(a){return f(a)},"source@load":function(a){return a},"html@load":function(a){return a},text4save:function(a){var b;return b=e.canvas.escapeTextModeContents?h(a):a,e.canvas.removeTextModeBr&&(b=g(b)),b},source4save:function(a){return a},html4save:function(a){return k(a)},text2source:function(a){return h(a)},text2html:function(a){return h(a)},source2text:function(a){return f(j(a))},source2html:function(a){return j(a)},html2text:function(a){return f(a)},html2source:function(a){return k(i(a))}})}),Trex.register("filter > non-breaking space",function(a){function b(a){return a.replace(/\u00A0/g," ")}a.getDocParser().registerFilter("filter/converting/nonbreakingsapce",{"text@load":function(a){return b(a)},"source@load":function(a){return b(a)},"html@load":function(a){return b(a)},text4save:function(a){return b(a)},source4save:function(a){return b(a)},html4save:function(a){return b(a)},text2html:function(a){return b(a)},source2html:function(a){return b(a)},html2source:function(a){return b(a)}})}),Trex.register("filter > clear redundancy",function(a){function b(a){var b=function(a,b,c){
var d=0,e=function(a,c,e){return d++,0==e.length||0==e.trim().length?"":['<span style="',b,":",c,';">',e,"</span>"].join("")},f=new RegExp('(?:<span[^>;]*style="'+b+':[^";]*;?"[^>;]*>){'+c+"}<span\\s*style=['\"]?"+b+":\\s*(\\w+)[;'\"]*>([\\S\\s]*?)</span>(?:</span>){"+c+"}","gi");do{d=0,a=a.replace(f,e)}while(d>0);return a};a=a.replace(/<(span|font)([^>]*)><\/\1>/gi,function(a,b,c){return/ (?:id|class)=/i.test(c)?a:""});for(var c=["font-size","font-family"],d=0;d<c.length;d++)a=b(a,c[d],2),a=b(a,c[d],1);return a}function c(a){return $tx.msie?a.replace(/<p>\s*<\/p>/gi,""):a}function d(a){return $tx.msie?a.replace(/<p>\s*<\/p>/gi,$tom.EMPTY_PARAGRAPH_HTML):a}a.getDocParser().registerFilter("filter/redundancy",{"text@load":function(a){return a},"source@load":function(a){return c(b(a))},"html@load":function(a){return c(b(a))},text4save:function(a){return a},source4save:function(a){return d(a)},html4save:function(a){return d(a)},text2source:function(a){return a},text2html:function(a){return a},source2text:function(a){return a},source2html:function(a){return a},html2text:function(a){return a},html2source:function(a){return b(a)}})}),TrexMessage.addMsg({"@attacher.only.wysiwyg.alert":Trex._I18N.g("attacher.only.wysiwyg.alert","에디터 상태에서만 본문에 삽입할 수 있습니다.\n에디터모드에서 첨부박스의 썸네일을 클릭해서 삽입할 수 있습니다.")}),Trex.Attachment=Trex.Class.draft({$extend:Trex.Entry,isChecked:_FALSE,focused:_FALSE,attrs:{align:"left"},initialize:function(a,b){this.actor=a,this.canvas=a.canvas,this.entryBox=a.entryBox,this.type=this.constructor.__Identity,this.setProperties(b),this.oninitialized&&this.oninitialized(a,b)},setFocused:function(a){this.focused!==a&&(this.focused=a)},setExistStage:function(a){this.existStage=a,this.entryBox.changeState&&this.entryBox.changeState(this)},remove:function(){var a=this.canvas.getContent();this.canvas.isWYSIWYG()?a.search(this.regHtml)>-1&&(a=a.replace(this.regHtml,""),this.canvas.setContent(a)):a.search(this.regText)>-1&&(a=a.replace(this.regText,""),this.canvas.setContent(a))},register:function(){if(!Editor.getSidebar().addOnlyBox){if(!this.actor.boxonly)if(this.canvas.isWYSIWYG()){var a=this.pastescope,b=this.dispHtml,c="img",d=this.matchRegexStartTag,e=b.match(d);if(e&&e[1]&&(c=e[1]),this.objectStyle){var f=new RegExp("<"+c+" ","i");b=b.replace(f,"<"+c+' style="'+Trex.Util.toStyleString(this.objectStyle)+'" ')}this.objectAttr&&(b=b.replace(f,"<"+c+" "+Trex.Util.toAttrString(this.objectAttr)+" "));var g=this.paragraphStyle||{};$tx.webkit&&this.canvas.getPanel("html").el.focus(),this.canvas.execute(function(c){c.moveCaretWith(a),c.pasteContent(b,_TRUE,{style:g})})}else this.actor.wysiwygonly?alert(TXMSG("@attacher.only.wysiwyg.alert")):this.canvas.getProcessor().insertTag("",this.dispText)}},replace:function(a){var b=this.canvas,c=b.getContent();this.actor.boxonly||(b.isWYSIWYG()?c.search(a.regHtml)>-1?(c=c.replace(a.regHtml,this.dispHtml),b.setContent(c)):b.pasteContent(this.dispHtml,_TRUE):(c.search(a.regText)>-1&&(c=c.replace(a.regText,""),b.setContent(c)),alert(TXMSG("@attacher.only.wysiwyg.alert"))))},setProperties:function(a){var b=a;this.data=b,this.key=this.actor.getKey(b)||"K"+Trex.Util.generateKey(),this.field=this.getFieldAttr(b),this.boxAttr=this.getBoxAttr(b),this.objectAttr=this.getObjectAttr.bind(this)(b),this.objectStyle=this.getObjectStyle.bind(this)(b),this.paragraphStyle=this.getParaStyle.bind(this)(b),this.saveHtml=this.getSaveHtml.bind(this)(b),this.dispHtml=this.getDispHtml.bind(this)(b),this.dispText=this.getDispText.bind(this)(b),this.regLoad=this.getRegLoad.bind(this)(b),this.regHtml=this.getRegHtml.bind(this)(b),this.regText=this.getRegText.bind(this)(b)},refreshProperties:function(){this.setProperties(this.data)},getObjectAttr:function(){return this.actor.config.objattr},getObjectStyle:function(){var a={};return this.actor.config.objstyle&&(a=Object.extend(a,this.actor.config.objstyle)),a},getParaStyle:function(a){return Object.extend({},this.actor.config.parastyle||this.actor.config.defaultstyle)},updateEntryElement:function(a){if(a){var b=_DOC.createElement("div");b.innerHTML=this.dispHtml,a.innerHTML=$tom.first(b).innerHTML}}}),TrexConfig.addSidebar("attachbox",{show:_FALSE,destroy:_FALSE}),Trex.AttachBox=Trex.Class.create({$extend:Trex.EntryBox,isChecked:_FALSE,initialize:function(){},checkAvailableCapacity:function(){return _TRUE},getAvailableCapacity:function(){return _TRUE},checkInsertableSize:function(){return _TRUE}}),Trex.install("editor.getAttachBox & sidebar.getAttachments",function(a,b,c,d,e){var f=new Trex.AttachBox(e,a);c.entryboxRegistry.attachbox=f,a.getAttachBox=function(){return f},c.getAttachments=f.getEntries.bind(f)}),Trex.register("filter > attachers",function(a){var b=a.getAttachBox();a.getDocParser().registerFilter("filter/attachments",{"text@load":function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("text@load",a),a=b.getChangedContent(a,b.regLoad,"")}),a},"source@load":function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source@load",a),a=b.getChangedContent(a,b.regLoad,b.dispText)}),a},"html@load":function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html@load",a),a=b.getChangedContent(a,b.regLoad,b.dispHtml)}),a},text4save:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("text4save",a),a=b.getChangedContent(a,b.regText,"")}),a},source4save:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source4save",a),a=b.getChangedContent(a,b.regText,b.saveHtml,["id","class"])}),a},html4save:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html4save",a),a=b.getChangedContent(a,b.regHtml,b.saveHtml,["id","class"])}),a},text2source:function(a){return a},text2html:function(a){return a},source2text:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source2text",a),a=b.getChangedContent(a,b.regText,"")}),a},source2html:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source2html",a),a=b.getChangedContent(a,b.regText,b.dispHtml)}),a},html2text:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html2text",a),a=b.getChangedContent(a,b.regHtml,"")}),a},html2source:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html2source",a),a=b.getChangedContent(a,b.regHtml,b.dispText,["id","class"])}),a}})}),Trex.module("push history @when entrybox has changes",function(a,b,c,d){var e=a.getAttachBox();e.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_REMOVED,function(a){d.history.saveHistory({deleted:_FALSE},{deleted:_TRUE},function(b){a.deletedMark=b.deleted,e.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_REFRESH,a)})});var f=function(a){$tx.msie?setTimeout(function(){a()},0):a()};e.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_ADDED,function(a){f(function(){d.history.injectHistory({deleted:_TRUE},{deleted:_FALSE},function(b){a.deletedMark=b.deleted,e.fireJobs(Trex.Ev.__ENTRYBOX_ENTRY_REFRESH,a)})})})}),TrexMessage.addMsg({"@attacher.ins":Trex._I18N.g("attacher.ins","삽입"),"@attacher.del":Trex._I18N.g("attacher.del","삭제"),"@attacher.preview.image":"#iconpath/pn_preview.gif","@attacher.delete.confirm":Trex._I18N.g("attacher.delete.confirm","삭제하시면 본문에서도 삭제됩니다. 계속하시겠습니까?"),"@attacher.delete.all.confirm":Trex._I18N.g("attacher.delete.all.confirm","모든 첨부 파일을 삭제하시겠습니까? 삭제하시면 본문에서도 삭제됩니다."),"@attacher.exist.alert":Trex._I18N.g("attacher.exist.alert","이미 본문에 삽입되어 있습니다.")}),Trex.install("attachbox.onAttachBoxInitialized @if config.sidebar.attachbox.show = true",function(a,b,c,d,e){var f=a.getAttachBox();e.sidebar.attachbox.show==_TRUE&&(Object.extend(f,Trex.I.AttachBox),f.onAttachBoxInitialized(e,d,a))}),Trex.I.AttachBox={useBox:_TRUE,isDisplay:_FALSE,lastSelectedEntry:_NULL,onAttachBoxInitialized:function(a,b){var c=this;this.canvas=b;var d=a.initializedId?a.initializedId:"";this.elBox=$must("tx_attach_div"+d,"Trex.I.AttachBox"),this.elList=$must("tx_attach_list"+d,"Trex.I.AttachBox");var e=$must("tx_attach_preview"+d,"Trex.I.AttachBox");this.elPreviewKind=$tom.collect(e,"p");var f=$tom.collect(e,"img");this.elPreviewImg=f,this.imageResizer=new Trex.ImageResizer(f,{maxWidth:147,maxHeight:108,defImgUrl:TXMSG("@attacher.preview.image"),onComplete:function(a,b){f.style.marginTop=Math.floor((108-b)/2).toPx()}}),this.elDelete=$tom.collect("#tx_attach_delete"+d+" a"),$tx.observe(this.elDelete,"click",function(){a.sidebar.attachbox.confirmForDeleteAll?c.onDeleteAll(!1):c.onDeleteAll(!0)}),"function"==typeof showAttachBox&&this.observeJob(Trex.Ev.__ATTACHBOX_SHOW,function(){showAttachBox()}),"function"==typeof hideAttachBox&&this.observeJob(Trex.Ev.__ATTACHBOX_HIDE,function(){hideAttachBox()});var g=$must("tx_upload_progress"+d,"Trex.I.AttachBox");this.elProgress=g,this.elProgressPercent=$tom.collect(g,"div"),this.elProgressTicker=$tom.collect(g,"p"),this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_ADDED,function(a){c.registerEntryNode(a),c.displayBox()}),this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_MODIFIED,function(a){c.modifyEntryNode(a),c.refreshPreview()}),this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_REMOVED,function(a){c.removeEntryNode(a),c.displayBox(),c.lastSelectedEntry&&c.lastSelectedEntry.key==a.key&&c.refreshPreview()}),this.observeJob(Trex.Ev.__ENTRYBOX_ALL_ENTRY_REMOVED,function(){c.datalist.each(function(a){c.removeEntryNode(a,_TRUE)}),c.displayBox(),c.lastSelectedEntry&&c.refreshPreview()}),this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_REFRESH,function(a){c.displayBox(),c.refreshEntryNode(a)});var h=$tx("tx_attach_up_size"+d),i=$tx("tx_attach_max_size"+d),j=$tx("tx_attach_group_used_size"+d),k=$tx("tx_attach_group_max_size"+d);this.observeJob(Trex.Ev.__ENTRYBOX_CAPACITY_UPDATE,function(){var b=a.sidebar.capacity;b.show!=_FALSE&&(h&&(h.innerText=b.uploaded.toByteUnit()),i&&(i.innerText=b.available.toByteUnit()),b.group&&(j&&(j.innerText=(b.group.used+b.uploaded).toByteUnit()),k&&(k.innerText=b.group.maximum.toByteUnit())))})},onDeleteAll:function(a){0!==this.datalist.length&&(a||confirm(TXMSG("@attacher.delete.all.confirm")))&&(this.datalist.each(function(a){a.deletedMark==_FALSE&&a.execRemove()}),this.initPreviewImage())},checkDisplay:function(){return this.isDisplay},setDisplay:function(a){this.isDisplay=a},displayBox:function(){for(var a=_FALSE,b=0;b<this.datalist.length;b++)this.datalist[b].deletedMark==_FALSE&&(a=_TRUE);this.isDisplay!=a&&(a?($tx.show(this.elBox),this.fireJobs(Trex.Ev.__ATTACHBOX_SHOW,_TRUE)):($tx.hide(this.elBox),this.fireJobs(Trex.Ev.__ATTACHBOX_HIDE,_FALSE)),this.isDisplay=a)},registerEntryNode:function(a){var b=tx.li({className:"type-"+a.type});a.actor.boxonly&&$tx.addClassName(b,"tx-boxonly"),this.elList.appendChild(b),a.elData=b,a.makeSelection=function(b){b?this.showEntryThumb(a):this.hideEntryThumb(a)}.bind(this),$tx.observe(b,"mouseover",this.onEntryMouseOver.bind(this,a)),$tx.observe(b,"mouseout",this.onEntryMouseOut.bind(this,a));var c=tx.dl();b.appendChild(c);var d=tx.dt({className:"tx-name",unselectable:"on"},a.boxAttr.name);a.elName=d,c.appendChild(d),$tx.observe(b,"click",function(b){var c=$tx.element(b);"tx-delete"!=c.className&&"tx-insert"!=c.className&&(b.ctrlKey?this.clickEntryWithCtrl(a):b.shiftKey?this.clickEntryWithShift(a):this.clickEntry(a),"image"==a.actor.name&&(a.data.width&&a.data.height||new Trex.ImageScale(a.data)))}.bind(this),_FALSE);var e=tx.dd({className:"tx-button"});c.appendChild(e);var f=tx.a({className:"tx-delete"},TXMSG("@attacher.del"));e.appendChild(f),$tx.observe(f,"click",function(){confirm(TXMSG("@attacher.delete.confirm"))&&a.execRemove()},_FALSE);var g=tx.a({className:"tx-insert"},TXMSG("@attacher.ins"));a.elInsert=g,e.appendChild(g),$tx.observe(g,"click",function(){a.existStage&&!a.actor.config.multipleuse?alert(TXMSG("@attacher.exist.alert")):a.execAppend()},_FALSE)},changeState:function(a){a.existStage&&!a.actor.config.multipleuse?$tx.addClassName(a.elData,"tx-existed"):$tx.removeClassName(a.elData,"tx-existed")},modifyEntryNode:function(a){a.elName.innerText=a.boxAttr.name},removeEntryNode:function(a,b){b?a.elData.parentNode.removeChild(a.elData):a.deletedMark&&$tx.hide(a.elData)},refreshEntryNode:function(a){a.deletedMark?$tx.hide(a.elData):$tx.show(a.elData)},refreshPreview:function(){for(var a=0,b=this.datalist.length-1;a<b;++a){var c=this.datalist[a];if(this.lastSelectedEntry&&this.lastSelectedEntry.key==c.key&&0==c.deleteMark)return this.setPreivewImage(c),_TRUE}for(var a=0,b=this.datalist.length-1;a<b;++a){var c=this.datalist[a];if(0==c.deletedMark&&$tx.hasClassName(c.elData,"tx-clicked"))return this.setPreivewImage(c),_TRUE}return this.initPreviewImage(),_FALSE},setPreivewImage:function(a){this.imageResizer.execResize(a.boxAttr.image),this.lastSelectedEntry=a},initPreviewImage:function(){this.imageResizer.execResize(TXMSG("@attacher.preview.image")),this.lastSelectedEntry=_NULL},showEntryThumb:function(a){$tx.addClassName(a.elData,"tx-clicked"),$tx.removeClassName(a.elData,"tx-hovered")},hideEntryThumb:function(a){$tx.removeClassName(a.elData,"tx-clicked")},onEntryMouseOver:function(a){$tx.addClassName(a.elData,"tx-hovered")},onEntryMouseOut:function(a){$tx.removeClassName(a.elData,"tx-hovered")},startUpload:function(){this.elProgressPercent.style.width="0".toPx(),$tx.setStyle(this.elList,{opacity:.3}),$tx.show(this.elProgress)},doUpload:function(a){this.elProgressPercent.style.width=Math.floor(300*(isNaN(a)?0:.01*parseFloat(a))).toPx(),this.elProgressTicker.innerText=Math.floor(isNaN(a)?0:parseFloat(a))+"%"},endUpload:function(){$tx.hide(this.elProgress),$tx.setStyle(this.elList,{opacity:1})},clickEntry:function(a){if(this.lastSelectedEntry){if(this.lastSelectedEntry.key==a.key)return;this.datalist.each(function(a){a.makeSelection(_FALSE)})}this.elPreviewKind.className=a.boxAttr.className?a.boxAttr.className:"",a.makeSelection(_TRUE),this.setPreivewImage(a)},clickEntryWithCtrl:function(a){$tx.hasClassName(a.elData,"tx-clicked")?(a.makeSelection(_FALSE),this.refreshPreview()):(this.elPreviewKind.className=a.boxAttr.className?a.boxAttr.className:"",a.makeSelection(_TRUE),this.setPreivewImage(a))},clickEntryWithShift:function(a){if($tx.hasClassName(a.elData,"tx-clicked"))a.makeSelection(_FALSE),this.lastSelectedEntry=_NULL;else{var b,c=this.getIndexOf(a);this.lastSelectedEntry&&(b=this.getIndexOf(this.lastSelectedEntry));var d=b,e=c;c==b?d=e=c:c<b&&(d=c,e=b),this.elPreviewKind.className=a.boxAttr.className?a.boxAttr.className:"";for(var f=d;f<e+1;f++)this.datalist[f].makeSelection(_TRUE);this.setPreivewImage(a)}},getIndexOf:function(a){var b,c;for(b=0;b<this.datalist.length;b++)if(this.datalist[b]===a){c=_TRUE;break}return c?b:-1},getSelectedList:function(a){var b,c=[];return b=a?this.getAttachments(a):this.datalist,b.each(function(a){$tx.hasClassName(a.elData,"tx-clicked")&&c.push(a)}),c},removeSelection:function(a){a.each(function(a){$tx.removeClassName(a.elData,"tx-clicked")})}},Trex.install("attachbox.onFileCapacityInitialized @if sidebar.capacity.show = true",function(a,b,c,d,e){var f=a.getAttachBox();e.sidebar.capacity.show===_TRUE&&(Object.extend(f,Trex.I.FileCapacity),f.onFileCapacityInitialized(e,d))}),Trex.module("attachbox.updateCapacity on Trex.Ev.__ATTACHBOX_SHOW",function(a){var b=a.getAttachBox();b.observeJob(Trex.Ev.__ATTACHBOX_SHOW,function(){b.updateCapacity()})}),TrexConfig.addSidebar("capacity",{show:_TRUE,maximum:3145728,filemaximum:_NULL,filter:{use:"",sound:{title:"sound file",maximum:3145728,extensions:",mp3,wav,ogg,wma,mp4,ape,wmv,asf,ra,ram,"},movie:{title:"movie file",maximum:3145728,extensions:",wmv,mpg,avi,"}}}),Trex.I.FileCapacity={onFileCapacityInitialized:function(a,b){var c=(a.initializedId&&a.initializedId,a.sidebar.capacity);c.uploaded=0,c.available=c.maximum,c.uploadedFileNum=0;var d=function(a,b){return b=parseInt(b,10),isNaN(b)||c[a]==_UNDEFINED?_FALSE:(c.group&&"available"==a?c[a]=Math.min(b,c.maximum,c.group.maximum-c.group.used):c[a]=b,c[a])};this.checkAvailableCapacity=function(){return c.uploaded<c.available},this.checkInsertableSize=function(a){return parseInt(c.uploaded,10)+parseInt(a,10)<=parseInt(c.available,10)},this.getCapacity=function(a){return c[a]||0},this.changeAvailableCapacity=function(a){return d("available",a)?(j(),a):_FALSE},this.changeMaximumCapacity=function(a){return d("maximum",a)?a:_FALSE},this.changeFileMaximumCapacity=function(a){return d("filemaximum",a)?a:_FALSE},this.updateCapacity=function(){j()};var e=function(a){var b=c.uploaded+a.toNumber();b<0&&(b=0),c.uploaded=b},f=function(a){e(-1*a),c.uploadedFileNum-=1},g=function(a){e(a),c.uploadedFileNum+=1},h={};c.filter.use.length>0&&c.filter.use.split(",").each(function(a){c.filter[a]&&(h[a]=Object.extend({},c.filter[a]))}),this.getFiltersNameByExt=function(a){var b=[];for(var c in h)h[c].extensions.indexOf(","+a.toLowerCase()+",")>-1&&b.push(c);return b},this.getFilterExtensions=function(a){return h[a]?h[a].extensions:_NULL},this.getFilterMaximum=function(a){return h[a]?h[a].maximum:_NULL},this.getUploadedSizeByFilter=function(a){var b=0,c=h[a].extensions;return this.datalist.each(function(a){if(a.data&&a.data.filename){var d=a.data.filename.split(".").pop().toLowerCase();c.indexOf(","+d+",")>-1&&(b+=a.data.filesize)}}),b},c.group&&d("available",Math.min(c.maximum,c.group.maximum-c.group.used)),this.getGroupCapacity=function(a){return c.group?c.group[a]||0:0},this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_ADDED,function(a){a.actor.isCheckSize&&(g(a.data.filesize||0),j())}),this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_REMOVED,function(a){a.actor.isCheckSize&&(f(a.data.filesize||0),j())}),this.observeJob(Trex.Ev.__ENTRYBOX_ALL_ENTRY_REMOVED,function(){c.uploaded=0,c.uploadedFileNum=0,j()}),this.observeJob(Trex.Ev.__ENTRYBOX_ENTRY_REFRESH,function(a){if(a.actor.isCheckSize){var b=a.data.filesize||0;a.deletedMark?f(b):g(b),j()}});var i=this,j=function(){var a={uploaded:c.uploaded,available:c.available,maximum:c.maximum,uploadedFileNum:c.uploadedFileNum,group:c.group};i.fireJobs(Trex.Ev.__ENTRYBOX_CAPACITY_UPDATE,a)}}},TrexMessage.addMsg({"@attacher.can.modify.alert":Trex._I18N.g("attacher.can.modify.alert","기존에 등록된 #{title}을(를) 수정할 수 있는 화면으로 이동합니다."),"@attacher.can.modify.confirm":Trex._I18N.g("attacher.can.modify.confirm","#{title}은(는) 하나만 등록이 가능합니다.\n다시 올리시면 기존의 #{title}이(가) 삭제됩니다. 계속하시겠습니까?"),"@attacher.insert.alert":Trex._I18N.g("attacher.insert.alert","에디터 상태에서만 삽입할 수 있습니다."),"@attacher.capacity.alert":Trex._I18N.g("attacher.capacity.alert","용량을 초과하였습니다."),"@attacher.size.alert":Trex._I18N.g("attacher.size.alert","용량을 초과하여 더이상 등록할 수 없습니다.")}),Trex.install("sidebar.getAttacher & sidebar.getUploadAdaptor",function(a,b,c){var d=c.attachers={};c.getAttacher=function(a){return d[a]!=_NULL?d[a]:0==arguments.length?d:_NULL}}),Trex.register("new attachers",function(a,b,c,d,e){var f=a.getAttachBox(),g=c.attachers;for(var h in Trex.Attacher){var i=Trex.Attacher[h].__Identity;i&&(g[i]=new Trex.Attacher[h](a,f,e))}g.file&&(c.getUploadAdaptor=function(){return g.file.getAdaptor()})}),Trex.Attacher=Trex.Class.draft({$extend:Trex.Actor,canModified:_FALSE,canResized:_FALSE,initialize:function(a,b,c){this.editor=a,this.canvas=a.getCanvas(),this.entryBox=b;var d=this.config=TrexConfig.getAttacher(this.constructor.__Identity,c);c.pvpage&&d.usepvpage&&(this.pvUrl=TrexConfig.getUrl(c.pvpage,{pvname:this.name})),this.boxonly=d.boxonly!=_NULL?d.boxonly:_FALSE,this.isMultiple=d.multiple!=_NULL?d.multiple:_FALSE,this.isCheckSize=d.checksize!=_NULL?d.checksize:_FALSE,this.wysiwygonly=d.wysiwygonly!=_NULL?d.wysiwygonly:_TRUE,this.pastescope=d.pastescope,this.oninitialized&&this.oninitialized(c),this.attachHandler=this.attachHandler.bind(this)},execute:function(a){if(this.wysiwygonly&&!this.canvas.isWYSIWYG())return void alert(TXMSG("@attacher.insert.alert"));if(this.isCheckSize&&!this.entryBox.checkAvailableCapacity())return void alert(TXMSG("@attacher.capacity.alert"));if(!this.checkInsertable())if(this.canModified){var b=new Template(TXMSG("@attacher.can.modify.alert"));alert(b.evaluate({title:this.title}))}else{var b=new Template(TXMSG("@attacher.can.modify.confirm"));if(!confirm(b.evaluate({title:this.title})))return}if(this.clickHandler)this.clickHandler();else try{var c=this.config.popPageUrl;a&&(c=c+(c.indexOf("?")>-1?"&":"?open&")+a);document.location.hostname!=document.domain&&(c=c+(c.indexOf("?")>-1?"&":"?open&")+"xssDomain="+document.domain),c=this.pvUrl?this.pvUrl+(this.pvUrl.indexOf("?")>-1?"&":"?open&")+"u="+escape(c):c;_WIN.open(c,"image_edit"==this.name?"":"at"+this.name,this.config.features).focus()}catch(a){}},attachHandler:function(a,b){if(this.checkInsertable()){if(this.isCheckSize&&!this.entryBox.checkInsertableSize(a.filesize))return void alert(TXMSG("@attacher.size.alert"));this.execAttach(a,b)}else this.execReattach(a,b)},createEntry:function(a,b){return this.createAttachment(a,b)},createAttachment:function(a,b){var c=this.constructor.__Identity;return b&&(c=b),new(Trex.Attachment[c.capitalize()])(this,a)},checkInsertable:function(){return this.isMultiple?_TRUE:0===this.getDatalist().findAll(function(a){return a.deletedMark!=_TRUE}).length}}),TrexMessage.addMsg({"@embeder.alert":Trex._I18N.g("embeder.alert","에디터 상태에서만 삽입할 수 있습니다.")}),Trex.EmbedBox=Trex.Class.create({$extend:Trex.EntryBox,initialize:function(){}}),Trex.install("editor.getEmbedBox & sidebar.getEmbeder & sidebar.getEmbeddedData",function(a,b,c,d,e){var f=new Trex.EmbedBox(e,d,a);c.entryboxRegistry.embedbox=f,a.getEmbedBox=function(){return f},c.getEmbeddedData=f.getEntries.bind(f);var g=c.embeders={};c.getEmbeder=function(a){return g[a]!=_NULL?g[a]:0==arguments.length?g:_NULL}}),Trex.register("new embeders",function(a,b,c,d,e){var f=a.getEmbedBox(),g=c.embeders;for(var h in Trex.Embeder){var i=Trex.Embeder[h].__Identity;i&&(b.tools[i],g[i]=new Trex.Embeder[h](a,f,e))}}),Trex.Embeder=Trex.Class.draft({$extend:Trex.Actor,canResized:_FALSE,initialize:function(a,b,c){this.editor=a,this.canvas=a.getCanvas(),this.entryBox=b;var d=this.config=TrexConfig.getEmbeder(this.constructor.__Identity,c);c.pvpage&&d.usepvpage&&(this.pvUrl=TrexConfig.getUrl(c.pvpage,{pvname:this.name})),this.wysiwygonly=d.wysiwygonly!=_NULL?d.wysiwygonly:_TRUE,this.pastescope=d.pastescope,this.embedHandler=this.embedHandler.bind(this),this.oninitialized&&this.oninitialized.bind(this)(c)},execute:function(a){if(this.wysiwygonly&&!this.canvas.isWYSIWYG())return void alert(TXMSG("@embeder.alert"));if(this.clickHandler)this.clickHandler();else try{var b=this.config.popPageUrl;document.location.hostname!=document.domain&&(b=b+(b.indexOf("?")>-1?"&":"?open&")+"xssDomain="+document.domain),a&&(b=b+(b.indexOf("?")>-1?"&":"?open&")+a),b=this.pvUrl?this.pvUrl+(this.pvUrl.indexOf("?")>-1?"&":"?open&")+"u="+escape(b):b;_WIN.open(b,"at"+this.name,this.config.features).focus()}catch(a){}},embedHandler:function(a){this.execAttach(a)},createEntry:function(a,b){var c=this.constructor.__Identity;return b&&(c=b),new(Trex.EmbedEntry[c.capitalize()])(this,a)},execAttach:function(a){var b=this.pastescope,c=this.getCreatedHtml(a),d=this.config.parastyle||this.config.defaultstyle||{};this.canvas.execute(function(a){a.moveCaretWith(b),a.pasteContent(c,_TRUE,d)})},execReattach:function(){},execReload:function(){},getReloadContent:function(a,b){if(!a.dispElId)return b;var c=this.getCreatedHtml(a),d=new RegExp('<(?:img|IMG)[^>]*id="?'+a.dispElId+'"?[^>]*/?>',"gm");return b.search(d)>-1?b.replace(d,c):b}}),Trex.register("filter > embeder",function(a){var b=a.getEmbedBox();a.getDocParser().registerFilter("filter/embeder",{"text@load":function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("text@load",a),a=b.getChangedContent(a,b.regLoad,"")}),a},"source@load":function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source@load",a),a=b.getChangedContent(a,b.regLoad,b.dispText)}),a},"html@load":function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html@load",a),a=b.getChangedContent(a,b.regLoad,b.dispHtml)}),a},text4save:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("text4save",a),a=b.getChangedContent(a,b.regText,"")}),a},source4save:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source4save",a),a=b.getChangedContent(a,b.regText,b.saveHtml,["id","class"])}),a},html4save:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html4save",a),a=b.getChangedContent(a,b.regHtml,b.saveHtml,["id","class"])}),a},text2source:function(a){return a},text2html:function(a){return a},source2text:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source2text",a),a=b.getChangedContent(a,b.regText,"")}),a},source2html:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("source2html",a),a=b.getChangedContent(a,b.regText,b.dispHtml)}),a},html2text:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html2text",a),a=b.getChangedContent(a,b.regHtml,"")}),a},html2source:function(a){return b.datalist.each(function(b){b.loadDataByContent&&b.loadDataByContent("html2source",a),a=b.getChangedContent(a,b.regHtml,b.dispText,["id","class"])}),a}})}),Trex.module("embad entry data",function(a,b,c,d,e){var f=a.getEmbedBox(),g=c.embeders;a.observeJob(Trex.Ev.__EDITOR_LOAD_DATA_BEGIN,function(a){f.empty();var b=a.content;for(var c in g)g[c].onloadData&&function(a,b){a=a||[],b=b||"",a.each(function(a){try{var c=g[a.embeder];c&&c.execReload(a.data,b,a.type)}catch(a){}})}(g[c].onloadData(b),b)})}),Trex.EmbedEntry=Trex.Class.create({$extend:Trex.Entry,attrs:{align:"left"},initialize:function(a,b){this.actor=a,this.canvas=a.canvas,this.entryBox=a.entryBox,this.setProperties(b)},register:function(){if(this.canvas.isWYSIWYG()){var a=this.actor.config.defaultstyle;a?this.canvas.pasteContent(this.dispHtml,_TRUE,{style:a}):this.canvas.pasteContent(this.dispHtml,_TRUE)}else this.canvas.getProcessor().insertTag("",this.dispText)},setProperties:function(a){this.type=this.constructor.__Identity;var b=this.data=a;this.key=b.key,this.dispHtml=this.getDispHtml(b),this.saveHtml=this.dispText=this.getDispText(b),this.regHtml=this.getRegHtml(b),this.regLoad=this.regText=this.getRegText(b)},refreshProperties:function(){this.setProperties(this.data)}}),Trex.I.ButtonFontTool=Trex.Mixin.create({oninitialized:function(a){var b=this;b.button=new Trex.Button(b.buttonCfg),b.weave(b.button,_NULL,b.handler),a.sync&&b.startSyncButtonWithStyle(),b.bindKeyboard(a.hotKey,b.handler.bind(b))},rangeExecutor:function(a,b,c){var d=null;if($tx.msie&&this.wrapDummy&&a.isCollapsed()){d=this.wrapDummy(a,c),a.execCommand(this.getQueryCommandName());a.createGoogRangeFromNodes(d,1,d,1).select()}else a.execCommand(this.getQueryCommandName())},onAfterHandler:function(a){var b=this.canvas;b.triggerQueryStatus&&b.triggerQueryStatus()},startSyncButtonWithStyle:function(){var a=this;a.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(b){a.syncButton(a.queryCurrentStyle(b))})},queryCurrentStyle:function(a){var b=this;return b.canvas.query(function(c){var d=b.getQueryCommandName(),e=$tx.gecko&&$tx.gecko_ver<20;if(!d||$tx.opera||e){var f=b.findQueryingNode(a);return!!f&&b.isStyleApplied(f)}return c.queryCommandState(d)})},computeNewStyle:function(){return _NULL},cachedProperty:_FALSE,syncButton:function(a){this.cachedProperty!=a&&(this.button.setState(a),this.cachedProperty=a)}}),Trex.I.MenuFontTool=Trex.Mixin.create({oninitialized:function(a){var b=this;b.beforeOnInitialized(a);var c=b.menuInitHandler&&b.menuInitHandler.bind(b);b.weave(b.createButton(),b.createMenu(),b.handler,c),a.sync&&b.startSyncButtonWithStyle()},rangeExecutor:function(a,b,c){this.wrapTextAsStyledSpan(a,b,c)},startSyncButtonWithStyle:function(){var a=this;a.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(b){a.syncButton(a.queryCurrentStyle(b))})},queryCurrentStyle:function(a){var b=this,c=b.queryCommandValue();if(b.reliableQueriedValue(c)&&c&&b.getTextByValue(c))return b._customQueryCurrStyle=c,b.getTextByValue(c);var d=b.canvas.query(function(c){var d;return d=$tx.msie&&a.isCollapsed()?c.getNode():b.findQueryingNode(a),b.queryElementCurrentStyle(d)});return d&&b.getTextByValue(d)?(b._customQueryCurrStyle=d,b.getTextByValue(d)):(b._customQueryCurrStyle=c||d||b.getDefaultProperty(),c||d||b.getTextByValue(b.getDefaultProperty()))},queryCommandValue:function(){var a=this;return a.canvas.query(function(b){return b.queryCommandValue(a.getQueryCommandName())})},reliableQueriedValue:function(a){return _TRUE},queryElementCurrentStyle:function(a){for(var b=this.getCssPropertyName(),c=a,d=0;d<10&&$tom.kindOf(c,"%inline");d++){var e=c.style[b];if(e)return e;if($tom.kindOf(c,"font")&&$tom.getAttribute(this.getFontTagAttribute()))return $tom.getAttribute(this.getFontTagAttribute());c=c.parentNode}var f=this.canvas.getProcessor();return a?f.queryStyle(a,b):_NULL},computeNewStyle:function(a){var b={};return b[this.getCssPropertyName()]=a,b},cachedProperty:_FALSE,syncButton:function(a){var b=this;b.button.setText(a),b.cachedProperty!=a&&(b.customSetButton&&b.customSetButton(b._customQueryCurrStyle),b.button.setText(a),b.cachedProperty=a),b.button.setText(a)}}),Trex.I.FontTool=Trex.Mixin.create({initialize:function(a,b,c){this.$super.initialize(a,b,c)},handler:function(a){this.onBeforeHandler(a),this.doHandle(a),this.onAfterHandler(a)},onBeforeHandler:function(){},doHandle:function(a){var b,c=this,d=c.computeNewStyle(a);c.canvas.execute(function(a){var e=a.table?a.table.getTdArr():[];e.length>0?(b=goog.dom.Range.createFromNodeContents(e[0]),a.executeUsingCaret(function(){c.tableCellsExecutor(a,d,e)})):(b=a.createGoogRange())&&c.rangeExecutor(a,d,b)})},onAfterHandler:function(){},tableCellsExecutor:function(a,b,c){var d=this;c.each(function(c){var e=goog.dom.Range.createFromNodeContents(c);e.select(),d.rangeExecutor(a,b,e)})},findQueryingNode:function(a){if(a){var b;try{b=this.findFirst(a.__iterator__(),function(a){return 3==a.nodeType&&a.nodeValue.trim()})}catch(a){}if(b)return b.parentNode;var c=a.getStartNode();return c&&3==c.nodeType?c.parentNode:c}},findFirst:function(a,b){try{return goog.iter.filter(a,b).next()}catch(a){return null}}}),Trex.I.WrappingSpanFontTool=Trex.Mixin.create({wrapTextAsStyledSpan:function(a,b,c){function d(a){var b=a.getCaret(_TRUE),c=a.getCaret(_FALSE);return new goog.dom.TextRangeIterator(b,0,c,0)}function e(a){var b=[];return goog.iter.forEach(a,function(a){3!=a.nodeType||$tom.kindOf(a.parentNode,"table,thead,tbody,tr,ul,ol")?1!=a.nodeType||!a.nodeName||"P"!=a.nodeName&&"SPAN"!=a.nodeName||0!=a.childNodes.length&&(1!=a.childNodes.length||"BR"!=a.childNodes[0].nodeName&&(3!=a.firstChild.nodeType||a.firstChild.nodeValue!=Trex.__WORD_JOINER))?1!=a.nodeType||!a.nodeName||"P"!=a.nodeName&&"SPAN"!=a.nodeName||a.innerHTML.search(/<span\s+id="goog/i)<=0&&b.push(a):a.id&&-1!=a.id.indexOf("goog")||b.push(a):b.push(a)}),b}function f(b){var c=[];return b.each(function(b){var d=b.parentNode;if("1"==b.nodeType&&"P"==b.nodeName)if(0==b.childNodes.length){var e=a.create("span");b.appendChild(e),c.push(e)}else c.push(b);else"1"==b.nodeType&&"SPAN"==b.nodeName&&c.push(b);if("SPAN"!=d.nodeName&&"P"!=d.nodeName||!g(d)){if("1"!=b.nodeType){var e=a.create("span");$tom.wrap(e,b),c.push(e)}}else if("3"==b.nodeType&&"P"==d.nodeName){var e=a.create("span");$tom.wrap(e,b),c.push(e),c.push(d)}else c.push(d)}),c}function g(a){var b=a.childNodes,c=b.length;if(c>3)return _FALSE;for(var d=0,e=c;d<e;d++)($tom.isGoogRangeCaret(b[d])||"BR"==b[d].nodeName)&&(c-=1);return 1==c}var h;if(a.isCollapsed()){var i=c.getStartNode();3==i.nodeType&&(i=i.parentNode);var j=this.findOrCreateDummySpan(i,a,c);if(j&&0==j.childNodes.length)h=[j];else{var k=j.firstChild;a.createGoogRangeFromNodes(k,k.length,k,k.length).select(),h=[j]}}else a.executeUsingCaret(function(a,b){
var c=d(b),g=e(c);h=f(g)});if(b&&b.backgroundColor)for(var l=h.length-1;l>=0;l--)1==h[l].nodeType&&"P"==h[l].nodeName&&h.splice(l,1);if(b&&b.fontFamily&&this.editor&&this.editor.kEditor&&this.editor.kEditor.config&&this.editor.kEditor.config.fallbackFont){for(var m=b.fontFamily,n=new Set,l=0;l<h.length;l++){var o=h[l];if(!n.has(o)){n.add(o);var p=m;o.style.fontFamily&&(p+=","+o.style.fontFamily.split(",").splice(0,3).join(",")),b.fontFamily=p,a.apply([o],{style:b})}}n.clear(),n=null}else a.apply(h,{style:b});this.processAffectedNodes(h)},processAffectedNodes:function(){},findOrCreateDummySpan:function(a,b,c){return"SPAN"==a.tagName&&0==a.childNodes.length||"SPAN"==a.tagName&&1==a.childNodes.length&&"BR"==a.childNodes[0].nodeName||"SPAN"==a.tagName&&1==a.childNodes.length&&3==a.firstChild.nodeType&&a.firstChild.nodeValue==Trex.__WORD_JOINER?a:this.createDummySpan(a,b,c)},createDummySpan:function(a,b,c){var d=null;return d="SPAN"==a.tagName?$tom.clone(a):b.create("span"),d.appendChild(b.newDummy()),d=c.insertNode(d),$tom.removeEmptyTextNode(d.previousSibling),$tom.removeEmptyTextNode(d.nextSibling),d}}),Trex.I.WrappingDummyFontTool=Trex.Mixin.create({wrapDummy:function(a,b){var c=this.createDummySpan(a,b),d=c.firstChild;return $tom.unwrap(c),a.createGoogRangeFromNodes(d,0,d,d.length).select(),d},createDummySpan:function(a,b){var c=null;return c=a.create("span"),c.appendChild(a.newDummy()),c=b.insertNode(c),$tom.removeEmptyTextNode(c.previousSibling),$tom.removeEmptyTextNode(c.nextSibling),c}}),TrexMessage.addMsg({"@switcher.wysiwyg":Trex._I18N.g("switcher.wysiwyg","에디터"),"@switcher.source":Trex._I18N.g("switcher.source","HTML"),"@switcher.text":Trex._I18N.g("switcher.text","텍스트")}),TrexConfig.addTool("switcher",{wysiwygonly:_FALSE,status:_TRUE,options:[{label:TXMSG("@switcher.wysiwyg"),title:TXMSG("@switcher.wysiwyg"),data:"html"},{label:TXMSG("@switcher.source"),title:TXMSG("@switcher.source"),data:"source"},{label:TXMSG("@switcher.text"),title:TXMSG("@switcher.text"),data:"text"}]}),Trex.Tool.Switcher=Trex.Class.create({$const:{__Identity:"switcher"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c={};a.options.each(function(a){c[a.data]={title:a.title}});var d="",e=a.options[0],f=function(a){return"text"===a&&"text"!==b.mode?_TRUE:_FALSE},g=function(){var a,c,d;return a=b.getContent(),c=a.toLowerCase().trim(),d=$tom.EMPTY_PARAGRAPH_HTML.toLowerCase().trim(),c&&c!==d&&"&nbsp;"!==c?_TRUE:_FALSE},h=function(c){if(a.changeModeConfirmMsg&&f(c)&&g()&&_FALSE===confirm(a.changeModeConfirmMsg))return $stop;b.changeMode(c)},i=function(a,b){a!=b&&d!=b&&c[b]&&(this.button.setValue(b),this.button.setText(c[b].title),d=b)}.bind(this);b.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,i),b.observeJob(Trex.Ev.__CANVAS_MODE_INITIALIZE,i),this.weave.bind(this)(new Trex.Button.Select(TrexConfig.merge(this.buttonCfg,{selectedValue:e.data,selectedText:e.label})),new Trex.Menu.Select(this.menuCfg),h)}}),TrexConfig.addTool("switchertoggle",{wysiwygonly:_FALSE,sync:_TRUE,status:_TRUE,options:[{label:Trex._I18N.g("tx_switchertoggle-editor","에디터"),title:Trex._I18N.g("tx_switchertoggle-editor","에디터"),data:"html"},{label:Trex._I18N.g("tx_switchertoggle-html","HTML"),title:Trex._I18N.g("tx_switchertoggle-html","HTML"),data:"source"}]}),Trex.Tool.SwitcherToggle=Trex.Class.create({$const:{__Identity:"switchertoggle"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=function(){switch(a.mode){case"html":a.changeMode("source");break;case"source":a.changeMode("html")}return _FALSE};this.weave.bind(this)(new Trex.Button.Toggle(TrexConfig.merge(this.buttonCfg,{borderClass:"tx-switchtoggle"})),_NULL,b);var c=Trex._I18N.g("tx_switchertoggle-title-html","HTML 타입"),d=Trex._I18N.g("tx_switchertoggle-title","에디터 타입"),e=function(a,b){this.button.setValue("source"==b),this.button.elIcon.title="source"==b?d:c}.bind(this);a.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,e),a.observeJob(Trex.Ev.__CANVAS_MODE_INITIALIZE,e)}}),TrexMessage.addMsg({"@fontfamily.nanumgothic":"나눔고딕","@fontfamily.malgungothic":"맑은 고딕","@fontfamily.gulim":"굴림","@fontfamily.batang":"바탕","@fontfamily.dotum":"돋움","@fontfamily.gungsuh":"궁서"}),TrexConfig.addTool("fontfamily",{sync:_TRUE,status:_TRUE,useFavorite:_TRUE,options:Trex._I18N.g("_FONT_LIST",[{label:TXMSG("@fontfamily.malgungothic")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.malgungothic"),data:"Malgun Gothic,맑은 고딕,sans-serif",klass:"tx-malgun"},{label:TXMSG("@fontfamily.gulim")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.gulim"),data:"Gulim,굴림,AppleGothic,sans-serif",klass:"tx-gulim"},{label:TXMSG("@fontfamily.batang")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.batang"),data:"Batang,바탕,serif",klass:"tx-batang"},{label:TXMSG("@fontfamily.dotum")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.dotum"),data:"Dotum,돋움,sans-serif",klass:"tx-dotum"},{label:TXMSG("@fontfamily.gungsuh")+' (<span class="tx-txt">가나다라</span>)',title:TXMSG("@fontfamily.gungsuh"),data:"Gungsuh,궁서,serif",klass:"tx-gungseo"},{label:'Arial (<span class="tx-txt">abcde</span>)',title:"Arial",data:"Arial,sans-serif",klass:"tx-arial"},{label:'Verdana (<span class="tx-txt">abcde</span>)',title:"Verdana",data:"Verdana,sans-serif",klass:"tx-verdana"},{label:'Courier New (<span class="tx-txt">abcde</span>)',title:"Courier New",data:"Courier New,monspace",klass:"tx-courier-new"}])}),Trex.Tool.FontFamily=Trex.Class.create({$const:{__Identity:"fontfamily"},$extend:Trex.Tool,$mixins:[Trex.I.CookieBaker,Trex.I.FontTool,Trex.I.MenuFontTool,Trex.I.WrappingSpanFontTool],beforeOnInitialized:function(a){function b(a){if(void 0==a)return"";var b=a,c=/\s|\.|\(|\)/;return b=b.replace(/-Bold/g," Bold").replace(/-HairLine/g," HairLine").replace(/-Light/g," Light").replace(/-Medium/g," Medium").replace(/-SemiBold/g," SemiBold").replace(/-Thin/g," Thin"),b=b.replace(/ Bold/g,""),b=$.trim(b.replace(/  /g," ")),b=c.test(b)?"'"+b+"'":b}function c(a){var c=b(a.name),d=b(a.ename);return""==c?"":""==d||c==d?c:d+", "+c}var d=this;d.focusLoosed=_FALSE,function(a){d.usedWebFonts=$tx.msie&&a.webfont&&a.webfont.use?a.webfont.options:[],d.usedFonts=a.options.concat(d.usedWebFonts)}(a),function(a){a.useFavorite&&d.usedWebFonts.length>0?(d.useFavorite=_TRUE,d.initCookie("txFontFamilyFavorite")):d.useFavorite=_FALSE}(a),d.editor.config.fontList&&d.editor.config.fontList.length&&(d.usedFonts=d.editor.config.fontList);try{var e=localStorage.getItem("fontlist");if(null!=e&&""!=e){var f=$.parseJSON(e),g=[],h=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;$.each(f,function(a,b){void 0!=b.name&&g.push({label:"<span>"+b.name+'</span> (<span class="tx-txt">'+(h.test(b.name)?"가나다라":"ABCDE")+"</span>)",title:b.name,data:c(b),klass:""})}),g=function(a,b,c){return SortedResult=a.sort(function(a,d){return c?a[b]>d[b]?1:a[b]<d[b]?-1:0:d[b]>a[b]?1:d[b]<a[b]?-1:0}),SortedResult}(g,"title","asc"),d.usedFonts=g}}catch(a){}d.createFontFamilyMap(d.usedFonts)},createFontFamilyMap:function(a){var b=this,c={},d={};this.fontFamilyMap=c,this.fontFamilyOptionMap=d,a.each(function(a){var e,f,g;e=a.data.split(","),f=a.title,g=b.preprocessFontFamily(e[0]),c[g]=f,d[g]=a,c[f.toLowerCase()]||(c[f.toLowerCase()]=f,d[f.toLowerCase()]=a)}),b._isCreatedFontFamilyMap=!0},createButton:function(){var a=new Trex.Button.Select(this.buttonCfg);this.button=a,a.customLabelStyle=function(){this.elText.style.fontSize="12px",this.elText.style.lineHeight="12px",this.elText.style.paddingTop="4px"},a.setValue(this.getDefaultProperty());var b=this.getTextByValue(this.getDefaultProperty());a.setText(b);try{a.elIcon.title=(b||"").replace(/['"]/g,"")}catch(a){}return a},createMenu:function(){var a=this,b=new Trex.Menu.Select(TrexConfig.merge(a.menuCfg,{options:a.usedFonts}));if(this.menu=b,b.generateListItem=function(b){var c,d,e,f,g=[],h=a.editor.canvas.config.styles||{},i=h.fontFamily||"";for(i=i.split(",")[0].replace(/['"]/g,""),c=0;c<b.length;c+=1){d=b[c],e=d.label,d.label=d.label.replace(/<span class="tx\-txt">/g,'<span class="tx-txt" f-style>').replace(/f\-style/g,'style="font-family:'+d.data+';"'),f=d.klass;var j=d.data.split(","),k=$.trim(j[0].replace(/'/g,""));i&&k==i&&(d.klass+=" default_item"),g.push(Trex.MarkupTemplate.get("menu.select.item").evaluate(d)),d.label=e,d.klass=f}return g.join("")},a.usedWebFonts.length>0){$tx.addClassName(b.elMenu,"tx-fontfamily-webfont-menu");var c=tx.input({type:"text",className:"tx-dummyfocus"});$tom.append(b.elMenu,c),$tx.observe(b.elMenu,"mousedown",function(b){b.offsetX<a.menu.elMenu.clientWidth||(c.style.top=b.offsetY.toPx(),a.focusLoosed||(c.focus(),c.blur(),a.menu.elMenu.focus(),a.focusLoosed=_TRUE))})}return b},menuInitHandler:function(){var a=this,b=a.menu;a.focusLoosed=_FALSE,b.elMenu.style.overflow="hidden",b.elMenu.style.overflowY="auto";var c=a.editor.getCanvas().getPanel("html").iframe.offsetHeight;if(b.elMenu.style.maxHeight=c+"px",this._updateMenu){var d=$tom.collect(b.elMenu,"ul.tx-menu-list");d&&$tom.remove(d),b.config.options=a.usedFonts,b.generate(),this._updateMenu=!1}var d=$tom.collect(b.elMenu,"ul.tx-menu-list");d.style.display="inline-block";var e=null;if(a.useFavorite){b.elMenu.scrollTop=0;var d=$tom.collect(b.elMenu,"ul.tx-menu-favlist");d&&$tom.remove(d),e=a.extractOptions(a.usedFonts,a.readCookie()),d=b.generateList(e),$tom.insertFirst(b.elMenu,d),$tx.addClassName(d,"tx-menu-favlist")}else e=[];if($tx.msie&&$tx.msie_docmode<8){b.elMenu.style.height="10px";var f=b.elMenu.scrollHeight+4;c<f&&(f=c),b.elMenu.style.height=f+"px"}var g=b.elMenu.offsetWidth-b.elMenu.clientWidth;b.elMenu.style.width=d.offsetWidth+g+"px";var h=a.button.elText.innerText,i=$(".tx-fontfamily-menu span:contains('"+h+"')"),j=i.closest("li").first(),k=24*j.index();return b.elMenu.scrollTop=k,$(b.elMenu).find("li").css({"background-color":""}),j.css({"background-color":"#f5e9e9"}),e},onBeforeHandler:function(a){this.canvas.includeWebfontCss("font-family: "+a)},onAfterHandler:function(a){var b=this;try{b.button.elIcon.title=b.getTextByValue(a||"").replace(/['"]/g,"")}catch(a){}b.useFavorite&&b.writeCookie(b.mergeValues(b.readCookie(),a))},getDefaultProperty:function(){return this.canvas.getStyleConfig().fontFamily},getRelatedCssPropertyNames:function(){return["font",this.getCssPropertyName()]},getCssPropertyName:function(){return"fontFamily"},getQueryCommandName:function(){return"fontname"},getFontTagAttribute:function(){return"face"},preprocessFontFamily:function(a){return a.toLowerCase().replace(/'|"/g,"").replace(/_?9$/,"")},getTextByValue:function(a){return a.include(",")&&(a=a.split(",")[0]),a=this.preprocessFontFamily(a),this.fontFamilyMap[a]},customSetButton:function(a){if(this._isCreatedFontFamilyMap){var b=a;if(a.include(",")&&(b=b.split(",")[0]),b=b.replace(/'|"/g,"")){var c=this.preprocessFontFamily(b),d=this.fontFamilyOptionMap[c];d||(d={label:"<span f-style>"+b+"</span> "+Trex._I18N.g("_FONT_SAMPLE",'(<span class="tx-txt">가나다라</span>)'),title:b,data:a,klass:""},this.usedFonts.push(d),this.fontFamilyMap[c]=b,this.fontFamilyOptionMap[c]=d,this._updateMenu=!0),this.button.setValue(d.data)}}}}),TrexConfig.addTool("fontsize",{sync:_TRUE,status:_TRUE,options:[{label:Trex._I18N.g("font-size-l7","(8pt)","가나다라마바사 (8pt)"),title:"8pt",data:"8pt",klass:"tx-8pt"},{label:Trex._I18N.g("font-size-l7","(9pt)","가나다라마바사 (9pt)"),title:"9pt",data:"9pt",klass:"tx-9pt"},{label:Trex._I18N.g("font-size-l7","(10pt)","가나다라마바사 (10pt)"),title:"10pt",data:"10pt",klass:"tx-10pt"},{label:Trex._I18N.g("font-size-l7","(11pt)","가나다라마바사 (11pt)"),title:"11pt",data:"11pt",klass:"tx-11pt"},{label:Trex._I18N.g("font-size-l7","(12pt)","가나다라마바사 (12pt)"),title:"12pt",data:"12pt",klass:"tx-12pt"},{label:Trex._I18N.g("font-size-l7","(14pt)","가나다라마바사 (14pt)"),title:"14pt",data:"14pt",klass:"tx-14pt"},{label:Trex._I18N.g("font-size-l7","(18pt)","가나다라마바사 (18pt)"),title:"18pt",data:"18pt",klass:"tx-18pt"},{label:Trex._I18N.g("font-size-l5","(24pt)","가나다라마 (24pt)"),title:"24pt",data:"24pt",klass:"tx-24pt"},{label:Trex._I18N.g("font-size-l3","(36pt)","가나다 (36pt)"),title:"36pt",data:"36pt",klass:"tx-36pt"}]}),Trex.Tool.FontSize=Trex.Class.create({$const:{__Identity:"fontsize"},$extend:Trex.Tool,$mixins:[Trex.I.FontTool,Trex.I.MenuFontTool,Trex.I.WrappingSpanFontTool],beforeOnInitialized:function(a){this.createFontSizeMap(a)},createButton:function(){var a=this.getDefaultProperty(),b=this.button=new Trex.Button.Select(this.buttonCfg);return b.setValue(a),b.setText(this.getTextByValue(a)),b},createMenu:function(){var a=this.editor.canvas.config.styles||{};return goog.iter.forEach(this.menuCfg.options,function(b){b.data==a.fontSize&&(b.klass+=" default_item")}),new Trex.Menu.Select(this.menuCfg)},createFontSizeMap:function(a){var b=this.fontSizeMap={};a.options.each(function(a){b[a.data]=a.title}),[{title:"8pt",data:"1"},{title:"10pt",data:"2"},{title:"12pt",data:"3"},{title:"14pt",data:"4"},{title:"18pt",data:"5"},{title:"24pt",data:"6"},{title:"36pt",data:"7"},{title:"7.5pt",data:"10px"},{title:"8pt",data:"11px"},{title:"9pt",data:"12px"},{title:"10pt",data:"13px"},{title:"11pt",data:"15px"},{title:"12pt",data:"16px"},{title:"14pt",data:"19px"},{title:"18pt",data:"24px"},{title:"24pt",data:"32px"},{title:"36pt",data:"48px"},{title:"8pt",data:"x-small"},{title:"10pt",data:"small"},{title:"12pt",data:"medium"},{title:"14pt",data:"large"},{title:"18pt",data:"x-large"},{title:"24pt",data:"xx-large"},{title:"36pt",data:"-webkit-xxx-large"}].each(function(a){b[a.data]=a.title})},reliableQueriedValue:function(a){return!1===$tx.webkit},getTextByValue:function(a){var b=this.fontSizeMap[a];if(!b){var c=Math.round(parseFloat(a)).toPx();b=this.fontSizeMap[c]}return b},getRelatedCssPropertyNames:function(){return["font",this.getCssPropertyName()]},getCssPropertyName:function(){return"fontSize"},getQueryCommandName:function(){return"fontsize"},getDefaultProperty:function(){return this.canvas.getStyleConfig().fontSize},getFontTagAttribute:function(){return"size"}}),TrexConfig.addTool("bold",{wysiwygonly:_TRUE,sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:66}}),Trex.Tool.Bold=Trex.Class.create({$const:{__Identity:"bold"},$extend:Trex.Tool,$mixins:[Trex.I.FontTool,Trex.I.ButtonFontTool,Trex.I.WrappingDummyFontTool],getRelatedCssPropertyNames:function(){return["font",this.getCssPropertyName()]},getCssPropertyName:function(){return"fontWeight"},getQueryCommandName:function(){return"bold"},isStyleApplied:function(a){return["bold","700"].contains($tx.getStyle(a,"fontWeight"))}}),TrexConfig.addTool("underline",{wysiwygonly:_TRUE,sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:85}}),Trex.Tool.Underline=Trex.Class.create({$const:{__Identity:"underline"},$extend:Trex.Tool,$mixins:[Trex.I.FontTool,Trex.I.ButtonFontTool,Trex.I.WrappingSpanFontTool,$tx.gecko?Trex.I.Tool.QueryStyle.Gecko:Trex.I.Tool.QueryStyle.Standard],rangeExecutor:function(a,b,c){if(!0===this.cachedProperty){var d=null;if($tx.msie&&this.wrapDummy&&a.isCollapsed()){d=this.wrapDummy(a,c),a.execCommand(this.getQueryCommandName());a.createGoogRangeFromNodes(d,1,d,1).select()}else a.execCommand(this.getQueryCommandName())}else this.wrapTextAsStyledSpan(a,b,c)},computeNewStyle:function(a){var b={};return b[this.getCssPropertyName()]=this.getQueryCommandName(),b},getDefaultProperty:function(){return this.canvas.getStyleConfig().textDecoration},getRelatedCssPropertyNames:function(){return[this.getCssPropertyName()]},getCssPropertyName:function(){return"textDecoration"},getQueryCommandName:function(){return"underline"},isStyleApplied:function(a){return this.queryNodeStyle(a,this.getCssPropertyName(),this.getQueryCommandName(),"u")}}),TrexConfig.addTool("italic",{wysiwygonly:_TRUE,sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:73}}),Trex.Tool.Italic=Trex.Class.create({$const:{__Identity:"italic"},$extend:Trex.Tool,$mixins:[Trex.I.FontTool,Trex.I.ButtonFontTool,Trex.I.WrappingDummyFontTool],getRelatedCssPropertyNames:function(){return["font",this.getCssPropertyName()]},getCssPropertyName:function(){return"fontStyle"},getQueryCommandName:function(){return"italic"},isStyleApplied:function(a){return"italic"==$tx.getStyle(a,"fontStyle")}});TrexConfig.addTool("strike",{wysiwygonly:_TRUE,sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:68}}),Trex.Tool.Strike=Trex.Class.create({$const:{__Identity:"strike"},$extend:Trex.Tool,$mixins:[Trex.I.FontTool,Trex.I.ButtonFontTool,Trex.I.WrappingDummyFontTool,$tx.gecko?Trex.I.Tool.QueryStyle.Gecko:Trex.I.Tool.QueryStyle.Standard],getRelatedCssPropertyNames:function(){return[this.getCssPropertyName()]},getCssPropertyName:function(){return"textDecoration"},getQueryCommandName:function(){return"strikethrough"},isStyleApplied:function(a){return this.queryNodeStyle(a,this.getCssPropertyName(),this.getQueryCommandName(),"strike")}}),TrexConfig.addTool("forecolor",{defaultcolor:"#7c84ef",wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,useFavorite:_TRUE,thumbs:Trex.__CONFIG_COMMON.thumbs,needRevert:_TRUE}),Trex.Tool.ForeColor=Trex.Class.create({$const:{__Identity:"forecolor"},$extend:Trex.Tool,$mixins:[Trex.I.CookieBaker,Trex.I.FontTool,Trex.I.MenuFontTool,Trex.I.WrappingSpanFontTool],beforeOnInitialized:function(a){this.useFavorite=!!a.useFavorite,this.useFavorite&&this.initCookie("txForeColorFavorite")},processAffectedNodes:function(a){for(var b=0;b<a.length;b++){var c=$(a[b]).parents().filter(function(a){return"u"==(this.tagName||"").toLowerCase()||-1!=$(this).css("text-decoration").search(/underline/gi)});if(c.length>0){(c[0].tagName||"").toLowerCase();a[b].style.textDecoration="underline"}}},createButton:function(){var a=this.readCookie()||this.getDefaultProperty(),b=this.button=new Trex.Button.Splits(this.buttonCfg);return b.setValue(a),this.syncButton(a),b},createMenu:function(){return new Trex.Menu.ColorPallete(this.menuCfg)},onAfterHandler:function(a){this.syncButton(a),this.useFavorite&&this.writeCookie(a)},getDefaultProperty:function(){return this.canvas.getStyleConfig().color},getRelatedCssPropertyNames:function(){return[this.getCssPropertyName()]},getCssPropertyName:function(){return"color"},getQueryCommandName:function(){return"forecolor"},computeNewStyle:function(a){var b={};return b[this.getCssPropertyName()]=a||this.getDefaultProperty(),b},syncButton:function(a){try{a&&$tx.setStyle(this.button.elButton,{backgroundColor:a})}catch(a){}}}),TrexConfig.addTool("backcolor",{defaultcolor:"#9aa5ea",wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,useFavorite:_TRUE,texts:{options:[{color:"#ff0000",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#e545d0",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#000000",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#ff5e00",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#7c43b1",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#848484",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#ffbb00",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#4673ff",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#66e8ff",text:"#000000",label:Trex._I18N.g("backcolor","가나다")},{color:"#ffe400",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#1fafda",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#8cfccb",text:"#000000",label:Trex._I18N.g("backcolor","가나다")},{color:"#a8c40d",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#009999",text:"#ffffff",label:Trex._I18N.g("backcolor","가나다")},{color:"#ffffff",text:"#000000",label:Trex._I18N.g("backcolor","가나다")}]},thumbs:Trex.__CONFIG_COMMON.thumbs,needRevert:_TRUE,needTrans:_FALSE}),Trex.Tool.BackColor=Trex.Class.create({$const:{__Identity:"backcolor"},$extend:Trex.Tool,$mixins:[Trex.I.CookieBaker,Trex.I.FontTool,Trex.I.MenuFontTool,Trex.I.WrappingSpanFontTool],beforeOnInitialized:function(a){this.useFavorite=!!a.useFavorite,this.useFavorite&&this.initCookie("txBackColorFavorite")},createButton:function(){var a=this.readCookie()||this.getDefaultProperty(),b=this.button=new Trex.Button.Splits(this.buttonCfg);return b.setValue(a),this.syncButton(a),b},createMenu:function(){return new Trex.Menu.ColorPallete(this.menuCfg)},onAfterHandler:function(a){this.syncButton(a),this.useFavorite&&this.writeCookie(a)},getDefaultProperty:function(){return this.config.defaultcolor},syncButton:function(a){try{var b=a?a.split("|")[0]:_NULL;b&&$tx.setStyle(this.button.elButton,{backgroundColor:b})}catch(a){}},getRelatedCssPropertyNames:function(){return["color",this.getCssPropertyName()]},getCssPropertyName:function(){return"backgroundColor"},getQueryCommandName:function(){return $tx.gecko||$tx.opera?"hilitecolor":"backcolor"},computeNewStyle:function(a){if(this.shouldRevert(a)||this.includeTextColor(a)){var b=a?a.split("|"):[];return{backgroundColor:b[0],color:b[1]}}return{backgroundColor:a}},shouldRevert:function(a){return a==_NULL},includeTextColor:function(a){return a&&a.indexOf("|")>-1}}),TrexConfig.addTool("indent",{sync:_FALSE,status:_FALSE,hotKey:{keyCode:9}}),Trex.Tool.Indent=Trex.Class.create({$const:{__Identity:"indent"},$extend:Trex.Tool,oninitialized:function(a){this.weave(new Trex.Button(this.buttonCfg),_NULL,this.handler),this.bindKeyboard(a.hotKey,this.tabKeyHandler.bind(this)),this.createHandlers()},handler:function(){var a=this;a.canvas.execute(function(b){a.onIndentClicked.handle(b)})},tabKeyHandler:function(){var a=this;this.canvas.execute(function(b){a.onTabPressed.handle(b)})},createHandlers:function(){var a=Trex.Tool.Indent,b=a.Judge,c=a.Operation,d=a.Handler,e=Trex.ChainHandler,f=e.connect([new e(b.ListItem,c.IndentListItem),new e(b.BlockNode,c.IndentBlockNode)]),g=e.connect([new e(b.And(b.HeadOfParagraph,b.ListItem),c.IndentListItem),new e(b.ChildOfLastTableCell,c.GoToBelowTable),new e(b.ChildOfTableCell,c.GoToNextCell),new e(b.AlwaysTrue,c.AddFourSpaces)]);this.onTabPressed=new d(g,f,f,this.editor),this.onIndentClicked=new d(f,f,f,this.editor)}}),Trex.Tool.Indent.Handler=Trex.Class.create({initialize:function(a,b,c,d){var e=Trex.Tool.Indent,f=e.RangeIndenter,g=e.TableCellIndenter;this.collapsedRange=new f(a,d),this.selectedRange=new f(b,d),this.tableCellSelected=new g(c)},handle:function(a){(a.table?a.table.getTdArr():[]).length>0?this.tableCellSelected.indent(a):a.isCollapsed()?this.collapsedRange.indent(a):this.selectedRange.indent(a)}}),Trex.ChainHandler=Trex.Class.create({$const:{connect:function(a){for(var b=a[0],c=1;c<a.length;c++)a[c-1].setNext(a[c]);return b}},initialize:function(a,b){return this.judge=a,this.executor=b,this},setNext:function(a){return this.successor=a,this.successor},handle:function(){var a=arguments;this.judge.apply(this,a)?this.executor.apply(this,a):this.successor&&this.successor.handle.apply(this.successor,a)}}),function(){Trex.Tool.Indent.Helper={findBlocksToIndentFromRange:function(a,b,c){var d=c.getCaret(_TRUE),e=c.getCaret(_FALSE);if(b.isCollapsed()){a&&a.getStartNode&&a.getStartNode(),a&&a.getStartOffset&&a.getStartOffset();var f=null;if(d.nextSibling==e&&e.nextSibling&&"TABLE"==e.nextSibling.nodeName)return[e.nextSibling];if(d.nextSibling&&"TABLE"==d.nextSibling.nodeName&&e.previousSibling&&d.nextSibling==e.previousSibling)return[d.nextSibling];f=this.findBlockToIndent(d,b);return"P"==f.tagName&&f.firstChild==d&&f.lastChild==e&&b.stuffNode(f),c.restoreInternal(),[f]}var g=new goog.dom.TextRangeIterator(d,0,e,0);return this.findBlocksToIndentFromIterator(b,g)},findBlocksToIndentFromIterator:function(a,b){var c=this,d=c.collectAllNodes(b),e=c.selectLeafNodes(d),f=c.filterUnableToIndent(e),g=f.map(function(b){return c.findBlockToIndent(b,a)});return g=g.compact().uniq()},collectAllNodes:function(a){var b=[];return goog.iter.forEach(a,function(a){b.contains(a)||b.push(a)}),b},selectLeafNodes:function(a){var b=[];return a.each(function(a){0==a.childNodes.length&&b.push(a)}),b},filterUnableToIndent:function(a){var b=[];return a.each(function(a){$tom.kindOf(a,"ul,ol,dl")?$tom.removeListIfEmpty(a):$tom.kindOf(a.parentNode,"table")&&$tom.isText(a)||$tom.kindOf(a.parentNode,"thead,tbody,tfooter")&&!$tom.kindOf(a,"tr")||$tom.kindOf(a.parentNode,"tr")&&!$tom.kindOf(a,"th,td")||$tom.kindOf(a.parentNode,"ul,ol,dl")&&!$tom.kindOf(a,"li,dd,dt")||b.push(a)}),b},findBlockToIndent:function(a){var b=this.findOrCreateBlockForNode(a);return this.findIndentableHigherBlock(b)},findOrCreateBlockForNode:function(a){if($tom.isText(a)||$tom.kindOf(a,"%inline,img")){var b=$tom.ancestor(a,"p,li,dd,dt,h1,h2,h3,h4,h5,h6,div");return b&&0==$tom.children(b,"%block").length?b:(b=$tom.ancestor(a,"%paragraph,pre,noscript,form,hr,address,fieldset,blockquote"),$tom.wrapInlinesWithP(a,b))}return a},findIndentableHigherBlock:function(a){for(var b=_NULL,c=a;c&&"BODY"!=c.tagName;){if(!b&&$tom.kindOf(c,"p,div,h1,h2,h3,h4,h5,h6"))b=c;else{if($tom.kindOf(c,"li,dd,dt"))return c;if(b&&$tom.kindOf(c,"td,th"))return b}c=c.parentNode}return b},findAncestorTableCell:function(a){return $tom.ancestor(a,"td,th")},findNextCell:function(a){var b=this.findCurrentCell(a),c=$tom.next(b,"td,th");if(!c){var d=$tom.next($tom.parent(b),"tr");d&&(c=$tom.first(d,"td,th"))}return c},findPreviousCell:function(a){var b=this.findCurrentCell(a),c=$tom.previous(b,"td,th");if(!c){var d=$tom.previous($tom.parent(b),"tr");d&&(c=$tom.last(d,"td,th"))}return c},findCurrentCell:function(a){return $tom.kindOf(a,"td,th")?a:this.findAncestorTableCell(a)},isCaretOnStartOf:function(a,b){for(var c=b.getStartNode(),d=b.getStartOffset();$tom.isElement(c)&&c.childNodes.length>0;)c=c.childNodes[d],d=0;if(!c)return _TRUE;var e=new goog.dom.TextRangeIterator(a,0,c,d),f=_FALSE;return goog.iter.forEach(e,function(a){if(3!=a.nodeType||$tom.kindOf(a.parentNode,"script,style"))$tom.isElement(a)&&$tom.kindOf(a,"img,embed,iframe")&&(f=_TRUE);else{var b=a===c?a.nodeValue.substring(0,d):a.nodeValue;b=b.replace(Trex.__WORD_JOINER_REGEXP,""),f=$tom.removeMeaninglessSpace(b).length>0}if(f)throw goog.iter.StopIteration}),!f}};var a=Trex.Tool.Indent.Helper,b={};Trex.Tool.Indent.RangeIndenter=Trex.Class.create({initialize:function(a,b){this.editor=b,this.handler=a},indent:function(c){var d=this;c.executeUsingCaret(function(e,f){var g=null;if(d.editor&&d.editor._imageResizeCtrl&&d.editor._imageResizeCtrl.isActive){f&&f.dispose();var h=d.editor._imageResizeCtrl.activeElement;d.editor._imageResizeCtrl.clearAll(),g=[a.findOrCreateBlockForNode(h)];var i=d.editor.canvas.getCurrentPanel().getWindow().document;e=i.createRange();var j=i.getSelection();j.removeAllRanges(),e.selectNode(h),e.collapse(!0),j.addRange(e)}else g=a.findBlocksToIndentFromRange(e,c,f);g.each(function(a){try{d.handler.handle(a,c,e)}catch(a){if(a!=b)throw a;f&&f.dispose()}})})}}),Trex.Tool.Indent.TableCellIndenter=Trex.Class.create({initialize:function(a){this.handler=a},indent:function(b){var c=this;(b.table?b.table.getTdArr():[]).each(function(d){var e=new goog.dom.TagIterator(d);a.findBlocksToIndentFromIterator(b,e).each(function(a){c.handler.handle(a,b,_NULL)})})}}),Trex.Tool.Indent.Judge={ChildOfFirstTableCell:function(b){var c=a.findAncestorTableCell(b);return c&&!a.findPreviousCell(c)},ChildOfLastTableCell:function(b){var c=a.findAncestorTableCell(b);return c&&!a.findNextCell(c)},ChildOfTableCell:function(b){return a.findAncestorTableCell(b)},ListItem:function(a){return $tom.kindOf(a,"li")&&$tom.kindOf(a.parentNode,"ol,ul")},OneDepthList:function(a){if($tom.kindOf(a,"li")){if(1==(new Trex.Tool.StyledList.ListBuilder).countDepthOfList(a))return _TRUE}return _FALSE},IndentedBlockNode:function(a){return $tom.kindOf(a,"%block")&&a.style&&""!=a.style.marginLeft},BlockNode:function(a){return $tom.kindOf(a,"%block")},HeadOfParagraph:function(b,c,d){return a.isCaretOnStartOf(b,d)},And:function(a,b){return function(){return a.apply(this,arguments)&&b.apply(this,arguments)}},AlwaysTrue:function(){return _TRUE}},Trex.Tool.Indent.Operation={GoToBelowTable:function(a,c){var d=$tom.ancestor(a,"table");throw c.bookmarkToNext(d),b},GoToNextCell:function(c,d){var e=a.findNextCell(c);if(e)throw d.selectFirstText(e),b},IndentListItem:function(a){var b=$tom.ancestor(a,"ul,ol,dl");if(b){var c=$tom.previous(a),d=$tom.next(a);if($tom.kindOf(c,"ul,ol,dl"))$tom.append(c,a);else{var e=$tom.clone(b);$tom.applyStyles(e,{marginLeft:_NULL,paddingLeft:_NULL}),$tom.wrap(e,a)}$tom.kindOf(d,"ul,ol,dl")&&($tom.moveChild(d,a.parentNode),$tom.remove(d))}},getChildrenAsElement:function(a){for(var b=[],c=a.childNodes,d=0,e=c.length;d<e;d++){var f=c[d];if($tom.isText(f)){var g=$tom.wrapInlinesWithP(f,a);b.push(g)}else $tom.isElement(f)&&b.push(f)}return b},IndentBlockNode:function(a){$tom.applyStyles(a,{marginLeft:"+2em"})},AddFourSpaces:function(a,b){b.pasteContent("&nbsp;&nbsp;&nbsp;&nbsp;",_FALSE,null,_FALSE)},GoToAboveTable:function(a,c){var d=$tom.ancestor(a,"table");throw c.bookmarkToPrevious(d),b},GoToPreviousCell:function(c,d){var e=a.findPreviousCell(c);if(e)throw d.moveCaretTo(e,_TRUE),b},OutdentListItem:function(a,b){var c=$tom.ancestor(a,"ul,ol,dl");if(c){var d=c.parentNode;$tom.kindOf(d,"li")&&($tom.unwrap(d),d=c.parentNode);var e,f=$tom.kindOf(d,"ul,ol,dl")?d:_NULL;if(f)e=$tom.divideNode(c,$tom.indexOf(a)),$tom.insertAt(a,e);else{e=$tom.divideNode(c,$tom.indexOf(a));var g=$tom.getStyleText(a),h=b.newNode("p");$tom.setStyleText(h,g),$tom.replace(a,h),$tom.insertAt(h,e)}$tom.removeListIfEmpty(c),$tom.removeListIfEmpty(e)}},OutdentBlockNode:function(a){$tom.applyStyles(a,{marginLeft:"-2em"})},Propagate:function(){throw $propagate}}}(),TrexConfig.addTool("outdent",{sync:_FALSE,status:_FALSE,hotKey:{shiftKey:_TRUE,keyCode:9}}),Trex.Tool.Outdent=Trex.Class.create({$const:{__Identity:"outdent"},$extend:Trex.Tool,oninitialized:function(a){this.weave(new Trex.Button(this.buttonCfg),_NULL,this.handler),this.createHandlers(),$tx.opera==_FALSE&&this.observeBackspace()},handler:function(){var a=this;this.canvas.execute(function(b){a.onOutdentClicked.handle(b)})},shiftTabKeyHandler:function(){var a=this;this.canvas.execute(function(b){a.onShiftTabPressed.handle(b)})},observeBackspace:function(){var a=this.canvas,b=this;a.observeKey({keyCode:Trex.__KEY.BACKSPACE},function(){a.query(function(a){b.onBackspace.handle(a)})})},createHandlers:function(){var a=Trex.Tool.Indent,b=a.Judge,c=a.Operation,d=a.Handler,e=Trex.ChainHandler,f=e.connect([new e(b.ListItem,c.OutdentListItem),new e(b.BlockNode,c.OutdentBlockNode)]),g=e.connect([new e(b.AlwaysTrue,c.Propagate)]),h=e.connect([new e(b.ListItem,c.OutdentListItem),new e(b.ChildOfFirstTableCell,c.GoToAboveTable),new e(b.ChildOfTableCell,c.GoToPreviousCell),new e(b.BlockNode,c.OutdentBlockNode)]),i=e.connect([new e(b.And(b.HeadOfParagraph,b.OneDepthList),c.Propagate),new e(b.And(b.HeadOfParagraph,b.ListItem),c.OutdentListItem),new e(b.And(b.HeadOfParagraph,b.IndentedBlockNode),c.OutdentBlockNode),new e(b.AlwaysTrue,c.Propagate)]);this.onShiftTabPressed=new d(h,f,f,this.editor),this.onOutdentClicked=new d(f,f,f,this.editor),this.onBackspace=new d(i,g,g,this.editor)}}),Trex.I.AlignExecution=Trex.Mixin.create({executeAlignImageMode:function(a){var b=this.constructor.__ImageModeProps.image,c=a.getControl();if(this.editor._imageResizeCtrl&&this.editor._imageResizeCtrl.isActive&&(c=$(this.editor._imageResizeCtrl.wrapper)[0]),c){a.apply(c,b);var d=this.constructor.__ImageModeProps.paragraph;if(d){this.editor._imageResizeCtrl&&this.editor._imageResizeCtrl.isActive&&(c=c.parentElement);var e=$tom.find(c,"%paragraph");a.apply(e,d)}this.editor._imageResizeCtrl&&this.editor._imageResizeCtrl.isActive&&this.editor._imageResizeCtrl.clearAll()}},executeAlignTextMode:function(a){var b=this.constructor.__TextModeProps.paragraph,c=a.getControl();if(c&&$tom.kindOf(c,"button")){var d=$tom.find(c,"%paragraph");d&&a.apply(d,b);var e=$tom.collect(c,"blockquote");e&&(e.style.margin=this.constructor.__TextModeProps.button.style.margin)}else{var f=a.blocks(function(){return"%paragraph"});a.apply(f,b);var g=[];f.each(function(a){var b;b=$tom.collectAll(a,"table,hr"),b.each(function(a){g.push(a)})}),a.apply(g,{align:b.style.textAlign})}},queryImageFloat:function(a){var b=a.getControl()
;return this.editor._imageResizeCtrl&&this.editor._imageResizeCtrl.isActive&&(b=$(this.editor._imageResizeCtrl.wrapper)[0]),b?a.queryStyle(b,"float"):_NULL},queryParaFloat:function(a){var b,c=a.findNode("%paragraph");return c&&(b=a.queryStyle(c,"float")),b||_NULL},queryTextAlign:function(a){var b=a.findNode("%paragraph"),c=a.queryStyle(b,"textAlign");return c||(c=a.queryAttr(b,"align")),c&&"start"!=c&&"auto"!=c&&"-webkit-auto"!=c||(c="left"),c},queryControlAlign:function(a){var b=a.getControl();return a.queryAttr(b,"align")},executeAlign:function(a){var b=this,c=b.getAlignMode(a);"tableCell"==c?b.executeTableCellMode(a):"image"==c?b.executeAlignImageMode(a):b.executeAlignTextMode(a)},getAlignMode:function(a){return(a.table?a.table.getTdArr():[]).length>0?"tableCell":this.imageAlignMode?"image":"text"},executeTableCellMode:function(a){function b(a){$tom.applyAttributes(a,e.constructor.__TextModeProps.paragraph)}if(!this.indenter){var c=Trex.Tool.Indent.Judge,d=Trex.ChainHandler,e=this,f=d.connect([new d(c.ListItem,b),new d(c.BlockNode,b)]);this.indenter=new Trex.Tool.Indent.TableCellIndenter(f)}this.indenter.indent(a)},syncButtonState:function(){var a=this,b=a.canvas.query(function(b){return a.queryCurrentStyle(b)});a.button.setState(b)},queryCurrentStyle:function(a){return this.imageAlignMode?this.queryImageMode(a):this.queryTextMode(a)},queryImageMode:function(a){var b=this.constructor.__ImageModeProps,c=this.queryImageFloat(a);if(c&&"none"!=c&&b.image&&b.image.style.float)return c==b.image.style.float;var d=this.queryParaFloat(a);if(d&&"none"!=d&&b.paragraph&&b.paragraph.style.float)return d==b.paragraph.style.float;var e=this.queryTextAlign(a);return b.paragraph&&b.paragraph.style.textAlign?e==b.paragraph.style.textAlign:_FALSE},queryTextMode:function(a){var b=this.constructor.__TextModeProps,c=b.paragraph.style.textAlign,d=this.queryControlAlign(a);if(d==_NULL){return(this.queryTextAlign(a)||"left")==c}return d==c}}),function(){TrexConfig.addTool("alignleft",{sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:188}});var a={align:_NULL,style:{textAlign:"left"}};Trex.Tool.AlignLeft=Trex.Class.create({$const:{__Identity:"alignleft",__ImageModeProps:{paragraph:a,image:{style:{clear:"none",float:"none",marginLeft:"",marginRight:""}}},__TextModeProps:{paragraph:a,button:{style:{margin:"0"}}}},$extend:Trex.Tool,$mixins:[Trex.I.AlignExecution],oninitialized:function(a){var b=this;b.imageAlignMode=_FALSE,b.weave(new Trex.Button(b.buttonCfg),_NULL,b.handler),b.startSyncButtonWithStyle()},handler:function(){var a=this,b=a.canvas,c=a.toolbar;b.execute(function(b){a.executeAlign(b);var d=a.getAlignMode(b);"image"==d?c.fireJobs(Trex.Ev.__CMD_ALIGN_IMG_LEFT):"text"==d&&c.fireJobs(Trex.Ev.__CMD_ALIGN_LEFT)}),b.triggerQueryStatus()},startSyncButtonWithStyle:function(){var a=this;a.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(){a.syncButtonState()})}})}(),function(){TrexConfig.addTool("aligncenter",{sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:190}});var a={align:_NULL,style:{textAlign:"center"}};Trex.Tool.AlignCenter=Trex.Class.create({$const:{__Identity:"aligncenter",__ImageModeProps:{paragraph:a,image:{style:{clear:"none",float:"none",marginLeft:"",marginRight:""}}},__TextModeProps:{paragraph:a,button:{style:{margin:"0 auto"}}}},$extend:Trex.Tool,$mixins:[Trex.I.AlignExecution],oninitialized:function(a){var b=this;b.imageAlignMode=_FALSE,b.weave(new Trex.Button(b.buttonCfg),_NULL,b.handler),b.startSyncButtonWithStyle()},handler:function(){var a=this,b=a.canvas,c=a.toolbar;b.execute(function(b){a.executeAlign(b);var d=a.getAlignMode(b);"image"==d?c.fireJobs(Trex.Ev.__CMD_ALIGN_IMG_CENTER):"text"==d&&c.fireJobs(Trex.Ev.__CMD_ALIGN_CENTER)}),b.triggerQueryStatus()},startSyncButtonWithStyle:function(){var a=this;a.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(){a.syncButtonState()})}})}(),function(){TrexConfig.addTool("alignright",{sync:_TRUE,status:_TRUE,hotKey:{ctrlKey:_TRUE,keyCode:191}});Trex.Tool.AlignRight=Trex.Class.create({$const:{__Identity:"alignright",__ImageModeProps:{image:{style:{clear:"both",float:"left",marginLeft:"",marginRight:"8px"}}},__TextModeProps:{paragraph:{align:_NULL,style:{textAlign:"right"}},button:{style:{margin:"0 0 0 auto"}}}},$extend:Trex.Tool,$mixins:[Trex.I.AlignExecution],oninitialized:function(a){var b=this;b.imageAlignMode=_FALSE,b.weave(new Trex.Button(b.buttonCfg),_NULL,b.handler),b.startSyncButtonWithStyle()},handler:function(){var a=this,b=a.canvas,c=a.toolbar;b.execute(function(b){a.executeAlign(b);var d=a.getAlignMode(b);"image"==d?c.fireJobs(Trex.Ev.__CMD_ALIGN_IMG_FLOAT_LEFT):"text"==d&&c.fireJobs(Trex.Ev.__CMD_ALIGN_RIGHT)}),b.triggerQueryStatus()},startSyncButtonWithStyle:function(){var a=this;a.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(){a.syncButtonState()})}})}(),function(){TrexConfig.addTool("alignfull",{sync:_TRUE,status:_TRUE});Trex.Tool.AlignFull=Trex.Class.create({$const:{__Identity:"alignfull",__ImageModeProps:{image:{style:{clear:"both",float:"right",marginLeft:"8px",marginRight:""}}},__TextModeProps:{paragraph:{align:_NULL,style:{textAlign:"justify"}},button:{style:{margin:"0"}}}},$extend:Trex.Tool,$mixins:[Trex.I.AlignExecution],oninitialized:function(){var a=this;a.imageAlignMode=_FALSE,a.weave(new Trex.Button(a.buttonCfg),_NULL,a.handler),a.startSyncButtonWithStyle()},handler:function(){var a=this,b=a.canvas,c=a.toolbar;b.execute(function(b){a.executeAlign(b);var d=a.getAlignMode(b);"image"==d?c.fireJobs(Trex.Ev.__CMD_ALIGN_IMG_FLOAT_RIGHT):"text"==d&&c.fireJobs(Trex.Ev.__CMD_ALIGN_FULL)}),b.triggerQueryStatus()},startSyncButtonWithStyle:function(){var a=this;a.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(){a.syncButtonState()})}})}(),TrexConfig.addTool("insertcells",{sync:_FALSE,status:_TRUE,options:[{label:Trex._I18N.g("insertcells-addRowUpper","위로 삽입"),title:Trex._I18N.g("insertcells-addRowUpper","위로 삽입"),data:"addRowUpper",klass:"tx-insertcells-1"},{label:Trex._I18N.g("insertcells-addRowBelow","아래 삽입"),title:Trex._I18N.g("insertcells-addRowBelow","아래 삽입"),data:"addRowBelow",klass:"tx-insertcells-2"},{label:Trex._I18N.g("insertcells-addColLeft","왼쪽 삽입"),title:Trex._I18N.g("insertcells-addColLeft","왼쪽 삽입"),data:"addColLeft",klass:"tx-insertcells-3"},{label:Trex._I18N.g("insertcells-addColRight","오른쪽 삽입"),title:Trex._I18N.g("insertcells-addColRight","오른쪽 삽입"),data:"addColRight",klass:"tx-insertcells-4"}]}),Trex.Tool.Insertcells=Trex.Class.create({$const:{__Identity:"insertcells"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c=b.getStyleConfig().insert,d={};(a.options||[]).each(function(a){d[a.data]=a.title});var e=function(a){b.execute(function(b){if(b.table)switch(a){case"addRowUpper":b.table.insertRowAbove();break;case"addRowBelow":b.table.insertRowBelow();break;case"addColLeft":b.table.insertColLeft();break;case"addColRight":b.table.insertColRight()}})};this.weave.bind(this)(new Trex.Button.Select(TrexConfig.merge(this.buttonCfg,{selectedValue:c})),new Trex.Menu.Select(this.menuCfg),e)}}),TrexConfig.addTool("deletecells",{sync:_FALSE,status:_TRUE,options:[{label:Trex._I18N.g("deletecells-deleteRow","행 삭제"),title:Trex._I18N.g("deletecells-deleteRow","행 삭제"),data:"deleteRow",klass:"tx-deletecells-1"},{label:Trex._I18N.g("deletecells-deleteCol","열 삭제"),title:Trex._I18N.g("deletecells-deleteCol","열 삭제"),data:"deleteCol",klass:"tx-deletecells-2"}]}),Trex.Tool.deletecells=Trex.Class.create({$const:{__Identity:"deletecells"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c=b.getStyleConfig().insert,d=function(a){b.execute(function(b){if(b.table)switch(a){case"deleteRow":b.table.deleteRow();break;case"deleteCol":b.table.deleteCol()}})};this.weave.bind(this)(new Trex.Button.Select(TrexConfig.merge(this.buttonCfg,{selectedValue:c})),new Trex.Menu.Select(this.menuCfg),d)}}),TrexConfig.addTool("mergecells",{sync:_FALSE,status:_TRUE,options:[{label:Trex._I18N.g("mergecells-merge","병합"),title:Trex._I18N.g("mergecells-merge","병합"),data:"merge",klass:"tx-mergecells-1"},{label:Trex._I18N.g("mergecells-cancelmerge","분할"),title:Trex._I18N.g("mergecells-cancelmerge","분할"),data:"cancelmerge",klass:"tx-mergecells-2"}]}),Trex.Tool.Mergecells=Trex.Class.create({$const:{__Identity:"mergecells"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=a.getStyleConfig().insert,c=function(b){a.execute(function(a){if(a.table)switch(b){case"merge":a.table.merge();break;case"cancelmerge":a.table.resetMerge()}})};this.weave.bind(this)(new Trex.Button.Select(TrexConfig.merge(this.buttonCfg,{selectedValue:b})),new Trex.Menu.Select(this.menuCfg),c)}}),TrexMessage.addMsg({"@cellslineheight.subtitle1":"1pt","@cellslineheight.subtitle2":"2pt","@cellslineheight.subtitle3":"3pt","@cellslineheight.subtitle4":"4pt","@cellslineheight.subtitle5":"5pt"}),TrexConfig.addTool("cellslineheight",{sync:_FALSE,status:_TRUE,options:[{label:TXMSG("@cellslineheight.subtitle1"),title:"1pt",data:1,klass:"tx-cellslineheight-1"},{label:TXMSG("@cellslineheight.subtitle2"),title:"2pt",data:2,klass:"tx-cellslineheight-2"},{label:TXMSG("@cellslineheight.subtitle3"),title:"3pt",data:3,klass:"tx-cellslineheight-3"},{label:TXMSG("@cellslineheight.subtitle4"),title:"4pt",data:4,klass:"tx-cellslineheight-4"},{label:TXMSG("@cellslineheight.subtitle5"),title:"5pt",data:5,klass:"tx-cellslineheight-5"}]}),Trex.Tool.Cellslineheight=Trex.Class.create({$const:{__Identity:"cellslineheight"},$extend:Trex.Tool,oninitialized:function(a){var b=this;b.createListStyleMap(a),b.weave(new Trex.Button.CellslineheightList(b.buttonCfg),new Trex.Menu.Select(b.menuCfg),b.handler)},createListStyleMap:function(a){var b=this.listStyleMap={};a.options.each(function(a){b[a.data]={type:a.type,klass:a.klass}})},handler:function(a){var b=this;b.listStyleMap[a]&&b.canvas.query(function(b){b.table&&b.table.setBorderHeight(a)})},getButtonClassByValue:function(a){var b=this.listStyleMap;return b[a]?b[a].klass:b[this.getDefaultProperty()].klass}}),Trex.Button.CellslineheightList=Trex.Class.create({$extend:Trex.Button.Select}),TrexConfig.addTool("cellslinecolor",{defaultcolor:"#7c84ef",wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,useFavorite:_TRUE,thumbs:Trex.__CONFIG_COMMON.thumbs,needRevert:_TRUE}),Trex.Tool.Cellslinecolor=Trex.Class.create({$const:{__Identity:"cellslinecolor"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=this;this.button=new Trex.Button(this.buttonCfg);var c=function(b){d(b),a.query(function(a){a.table&&a.table.setBorderColor(b)})},d=function(a){if(a)try{$tx.setStyle(b.button.elButton,{backgroundColor:a})}catch(a){}};d(this.config.defaultcolor),this.weave.bind(this)(b.button,new Trex.Menu.ColorPallete(this.menuCfg),c)}}),TrexMessage.addMsg({"@cellslinestyle.subtitle1":Trex._I18N.g("cellslinestyle.subtitle1","테두리 없음"),"@cellslinestyle.subtitle2":Trex._I18N.g("cellslinestyle.subtitle2","실선"),"@cellslinestyle.subtitle3":Trex._I18N.g("cellslinestyle.subtitle3","점선"),"@cellslinestyle.subtitle4":Trex._I18N.g("cellslinestyle.subtitle4","작은 점선")}),TrexConfig.addTool("cellslinestyle",{sync:_FALSE,status:_TRUE,options:[{label:TXMSG("@cellslinestyle.subtitle1"),title:Trex._I18N.g("cellslinestyle.subtitle1","테두리 없음"),data:"none",klass:"tx-cellslinestyle-1"},{label:TXMSG("@cellslinestyle.subtitle2"),title:Trex._I18N.g("cellslinestyle.subtitle2","실선"),data:"solid",klass:"tx-cellslinestyle-2"},{label:TXMSG("@cellslinestyle.subtitle3"),title:Trex._I18N.g("cellslinestyle.subtitle3","점선"),data:"dotted",klass:"tx-cellslinestyle-3"},{label:TXMSG("@cellslinestyle.subtitle4"),title:Trex._I18N.g("cellslinestyle.subtitle4","작은 점선"),data:"dashed",klass:"tx-cellslinestyle-4"}]}),Trex.Tool.Cellslinestyle=Trex.Class.create({$const:{__Identity:"cellslinestyle"},$extend:Trex.Tool,oninitialized:function(a){var b=this;b.createListStyleMap(a),b.weave(new Trex.Button.CellsLineStyledList(b.buttonCfg),new Trex.Menu.Select(b.menuCfg),b.handler)},createListStyleMap:function(a){var b=this.listStyleMap={};a.options.each(function(a){b[a.data]={type:a.type,klass:a.klass}})},handler:function(a){var b=this;b.listStyleMap[a]&&b.canvas.query(function(b){b.table&&b.table.setBorderType(a)})},getDefaultProperty:function(){return 1}}),Trex.Button.CellsLineStyledList=Trex.Class.create({$extend:Trex.Button.Select}),TrexConfig.addTool("cellsoutline",{sync:_FALSE,status:_TRUE,options:[{label:Trex._I18N.g("cellsoutline-all","모든 테두리"),title:Trex._I18N.g("cellsoutline-all","모든 테두리"),data:"all",klass:"tx-cellsoutline-1"},{label:Trex._I18N.g("cellsoutline-out","바깥 테두리"),title:Trex._I18N.g("cellsoutline-out","바깥 테두리"),data:"out",klass:"tx-cellsoutline-2"},{label:Trex._I18N.g("cellsoutline-in","안쪽 테두리"),title:Trex._I18N.g("cellsoutline-in","안쪽 테두리"),data:"in",klass:"tx-cellsoutline-3"},{label:Trex._I18N.g("cellsoutline-top","위쪽 테두리"),title:Trex._I18N.g("cellsoutline-top","위쪽 테두리"),data:"top",klass:"tx-cellsoutline-4"},{label:Trex._I18N.g("cellsoutline-bottom","아래쪽 테두리"),title:Trex._I18N.g("cellsoutline-bottom","아래쪽 테두리"),data:"bottom",klass:"tx-cellsoutline-5"},{label:Trex._I18N.g("cellsoutline-left","왼쪽 테두리"),title:Trex._I18N.g("cellsoutline-left","왼쪽 테두리"),data:"left",klass:"tx-cellsoutline-6"},{label:Trex._I18N.g("cellsoutline-right","오른쪽 테두리"),title:Trex._I18N.g("cellsoutline-right","오른쪽 테두리"),data:"right",klass:"tx-cellsoutline-7"},{label:Trex._I18N.g("cellsoutline-none","테두리 없음"),title:Trex._I18N.g("cellsoutline-none","테두리 없음"),data:"none",klass:"tx-cellsoutline-8"}]}),Trex.Tool.Cellsoutline=Trex.Class.create({$const:{__Identity:"cellsoutline"},$extend:Trex.Tool,oninitialized:function(a){var b=this;this.twinkleCount=0,this.twinkleTimer=_NULL,b.createListStyleMap(a),b.weave(new Trex.Button.CellsoutlineList(b.buttonCfg),new Trex.Menu.Select(b.menuCfg),b.handler),this.toolbar.observeJob(Trex.Ev.__TOOL_CELL_LINE_CHANGE,function(a){a.fromInit!=_TRUE&&b.twinkleButton()})},createListStyleMap:function(a){var b=this.listStyleMap={};a.options.each(function(a){b[a.data]={type:a.type,klass:a.klass}})},handler:function(a){var b=this;b.listStyleMap[a]&&(b.canvas.query(function(b){b.table&&b.table.setBorderRange(a)}),b.canvas.execute(function(b){b.table&&("none"==a?b.table.setNoBorder():b.table.applyBorder())}))},twinkleButton:function(){var a;a=this,this.twinkleTimer&&(clearInterval(this.twinkleTimer),this.twinkleTimer=_NULL),this.twinkleCount=4,this.twinkleTimer=setInterval(function(){0<a.twinkleCount?(a.twinkleCount-=1,"hovered"==a.button.currentState()?a.button.normalState():a.button.hoveredState()):(a.button.normalState(),clearInterval(a.twinkleTimer),a.twinkleTimer=_NULL)},500)}}),Trex.Button.CellsoutlineList=Trex.Class.create({$extend:Trex.Button.Select}),Trex.MarkupTemplate.add("cellsline.preview",['<table width="#{width}" cellPadding="0" style="line-height:0"><tbody><tr>','<td valign="center" height="#{height}">','<div style="border-bottom:#{value};width:#{width}px;height:2px;overflow:hidden;"></div>',"</td>","</tr></tbody></table>"].join("")),TrexConfig.addTool("cellslinepreview",{sync:_FALSE,status:_TRUE,options:[{label:Trex.MarkupTemplate.get("cellsline.preview").evaluate({value:"1pt solid #ccc",width:70,height:14}),title:"1pt solid #ccc",data:"#ccc 1 solid"},{label:Trex.MarkupTemplate.get("cellsline.preview").evaluate({value:"2pt solid #c54",width:70,height:14}),title:"2pt solid #c54",data:"#c54 2 solid"},{label:Trex.MarkupTemplate.get("cellsline.preview").evaluate({value:"2pt solid #67f",width:70,height:14}),title:"2pt solid #67f",data:"#67f 2 solid"},{label:Trex.MarkupTemplate.get("cellsline.preview").evaluate({value:"3pt solid #000",width:70,height:14}),title:"3pt solid #000",data:"#000 3 solid"},{label:Trex.MarkupTemplate.get("cellsline.preview").evaluate({value:"1pt dashed #d4c",width:70,height:14}),title:"1pt dashed #d4c",data:"#d4c 1 dashed"}]}),Trex.Tool.Cellslinepreview=Trex.Class.create({$const:{__Identity:"cellslinepreview"},$extend:Trex.Tool,oninitialized:function(a){var b=this;this.data={color:"",height:0,type:""},this.weave(new Trex.Button.CellslinepreviewList(this.buttonCfg),new Trex.Menu.Select(this.menuCfg),this.handler),this.toolbar.observeJob(Trex.Ev.__TOOL_CELL_LINE_CHANGE,function(a){b.setData(a),b.refreshPreview()})},setData:function(a){"color"in a&&(this.data.color=a.color),"height"in a&&(this.data.height=a.height),"type"in a&&(this.data.type=a.type)},refreshPreview:function(){var a;a=this.data,text=a.height+"pt "+a.type+" "+a.color,this.setPreview(text)},setPreview:function(a){this.button.elText.innerHTML=Trex.MarkupTemplate.get("cellsline.preview").evaluate({value:a,width:43,height:14})},addBorderHistory:function(a){this.setData(a),this.refreshPreview()},handler:function(a,b){this.canvas.execute(function(b){var c;b.table&&(c=a.split(" "),b.table.setBorderButtons(c[0],c[1],c[2]))})}}),Trex.Button.CellslinepreviewList=Trex.Class.create({$extend:Trex.Button.Select,setText:function(a){this.tool.setPreview(a)}}),TrexConfig.addTool("tablebackcolor",{defaultcolor:"#9aa5ea",wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,useFavorite:_TRUE,thumbs:Trex.__CONFIG_COMMON.thumbs,needRevert:_TRUE}),Trex.Tool.Tablebackcolor=Trex.Class.create({$const:{__Identity:"tablebackcolor"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=this;b.button=new Trex.Button(this.buttonCfg);var c=function(b){a.query(function(a){a.table&&a.table.tableBackground(b)}),d(b)},d=function(a){try{a&&$tx.setStyle(b.button.elButton,{backgroundColor:a})}catch(a){}};this.weave.bind(this)(b.button,new Trex.Menu.ColorPallete(this.menuCfg),c)}}),TrexConfig.addTool("tableedittool",{sync:_FALSE,status:_TRUE,opened:_FALSE}),Trex.Tool.TableEditTool=Trex.Class.create({$const:{__Identity:"tableedittool"},$extend:Trex.Tool,oninitialized:function(a){var b=this.toolbar,c=b.el,d=$tom.collect(c.parentNode,"div.tx-toolbar-advanced");if(d){b.observeJob("toolbar.advanced.fold",function(){$tx.hide(d),$tx.removeClassName(c,"tx-toolbar-basic-open")}),b.observeJob("toolbar.advanced.spread",function(){$tx.show(d),$tx.addClassName(c,"tx-toolbar-basic-open")});var e=_FALSE,f=function(){e?b.fireJobs("toolbar.advanced.fold"):b.fireJobs("toolbar.advanced.spread"),e=!e};this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,f),a.opened==_TRUE&&(d.show(),$tx.addClassName(c,"tx-toolbar-basic-open"),e=_TRUE)}}}),TrexConfig.addTool("tabletemplate",{sync:_FALSE,status:_TRUE,rows:5,cols:9,options:[{label:"image",data:1,klass:"tx-tabletemplate-1"},{label:"image",data:2,klass:"tx-tabletemplate-2"},{label:"image",data:3,klass:"tx-tabletemplate-3"},{label:"image",data:4,klass:"tx-tabletemplate-4"},{label:"image",data:5,klass:"tx-tabletemplate-5"},{label:"image",data:6,klass:"tx-tabletemplate-6"},{label:"image",data:7,klass:"tx-tabletemplate-7"},{label:"image",data:8,klass:"tx-tabletemplate-8"},{label:"image",data:9,klass:"tx-tabletemplate-9"},{label:"image",data:10,klass:"tx-tabletemplate-10"},{label:"image",data:11,klass:"tx-tabletemplate-11"},{label:"image",data:12,klass:"tx-tabletemplate-12"},{label:"image",data:13,klass:"tx-tabletemplate-13"},{label:"image",data:14,klass:"tx-tabletemplate-14"},{label:"image",data:15,klass:"tx-tabletemplate-15"},{label:"image",data:16,klass:"tx-tabletemplate-16"},{label:"image",data:17,klass:"tx-tabletemplate-17"},{label:"image",data:18,klass:"tx-tabletemplate-18"},{label:"image",data:19,klass:"tx-tabletemplate-19"},{label:"image",data:20,klass:"tx-tabletemplate-20"},{label:"image",data:21,klass:"tx-tabletemplate-21"},{label:"image",data:22,klass:"tx-tabletemplate-22"},{label:"image",data:23,klass:"tx-tabletemplate-23"},{label:"image",data:24,klass:"tx-tabletemplate-24"},{label:"image",data:25,klass:"tx-tabletemplate-25"},{label:"image",data:26,klass:"tx-tabletemplate-26"},{label:"image",data:27,klass:"tx-tabletemplate-27"},{label:"image",data:28,klass:"tx-tabletemplate-28"},{label:"image",data:29,klass:"tx-tabletemplate-29"},{label:"image",data:30,klass:"tx-tabletemplate-30"},{label:"image",data:31,klass:"tx-tabletemplate-31"},{label:"image",data:32,klass:"tx-tabletemplate-32"},{label:"image",data:33,klass:"tx-tabletemplate-33"},{label:"image",data:34,klass:"tx-tabletemplate-34"},{label:"image",data:35,klass:"tx-tabletemplate-35"},{label:"image",data:36,klass:"tx-tabletemplate-36"},{label:"image",data:37,klass:"tx-tabletemplate-37"},{label:"image",data:38,klass:"tx-tabletemplate-38"},{label:"image",data:39,klass:"tx-tabletemplate-39"},{label:"image",data:40,klass:"tx-tabletemplate-40"},{label:"image",data:41,klass:"tx-tabletemplate-41"},{label:"image",data:42,klass:"tx-tabletemplate-42"},{label:"image",data:43,klass:"tx-tabletemplate-43"},{label:"image",data:44,klass:"tx-tabletemplate-44"},{label:"image",data:45,klass:"tx-tabletemplate-45"}]}),Trex.Tool.Tabletemplate=Trex.Class.create({$const:{__Identity:"tabletemplate"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c={};a.options.each(function(a){c[a.data]={type:a.type}});var d=function(a){if(c[a]){var d=_NULL;b.execute(function(b){b.table&&(d=b.findNode("table"),b.table.setTemplateStyle(d,a))})}};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.List(this.menuCfg),d)}}),TrexConfig.addTool("lineheight",{sync:_FALSE,status:_TRUE,options:[{label:"80%",title:"80%",data:"80%"},{label:"90%",title:"90%",data:"90%"},{label:"100%",title:"100%",data:"100%"},{label:"110%",title:"110%",data:"110%"},{label:"120%",title:"120%",data:"120%"},{label:"130%",title:"130%",data:"130%"},{label:"140%",title:"140%",data:"140%"},{label:"150%",title:"150%",data:"150%"},{label:"180%",title:"180%",data:"180%"},{label:"200%",title:"200%",data:"200%"}]}),Trex.Tool.LineHeight=Trex.Class.create({$const:{__Identity:"lineheight"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c=b.getStyleConfig().lineHeight,d={};(a.options||[]).each(function(a){d[a.data]=a.title});var e=function(a){b.execute(function(b){var c=b.blocks(function(){return"%paragraph"});b.apply(c,{style:{lineHeight:a}})})};this.weave.bind(this)(new Trex.Button.Select(TrexConfig.merge(this.buttonCfg,{selectedValue:c})),new Trex.Menu.Select(this.menuCfg),e)}}),TrexConfig.addTool("letterspacing",{sync:_FALSE,status:_TRUE,options:[{label:"0pt",title:"0pt",data:"",klass:"default_item"},{label:"1pt",title:"1pt",data:"1pt"},{label:"2pt",title:"2pt",data:"2pt"},{label:"3pt",title:"3pt",data:"3pt"},{label:"4pt",title:"4pt",data:"4pt"},{label:"5pt",title:"5pt",data:"5pt"},{label:"6pt",title:"6pt",data:"6pt"},{label:"7pt",title:"7pt",data:"7pt"},{label:"8pt",title:"8pt",data:"8pt"},{label:"9pt",title:"9pt",data:"9pt"},{label:"10pt",title:"10pt",data:"10pt"}]}),Trex.Tool.LetterSpacing=Trex.Class.create({$const:{__Identity:"letterspacing"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c=b.getStyleConfig().letterspacing,d={};(a.options||[]).each(function(a){d[a.data]=a.title});var e=function(a){b.execute(function(b){var c=b.blocks(function(){return"%paragraph"});b.apply(c,{style:{"letter-spacing":a}})})};this.weave.bind(this)(new Trex.Button.Select(TrexConfig.merge(this.buttonCfg,{selectedValue:c})),new Trex.Menu.Select(this.menuCfg),e)}}),TrexConfig.addTool("kwebhelper",{sync:_FALSE,status:_FALSE}),Trex.Tool.KWebHelper=Trex.Class.create({$const:{__Identity:"kwebhelper"},$extend:Trex.Tool,oninitialized:function(){var a=this.config,b=$("#tx_kwebhelper"+a.initializedId||"").closest("li"),c=KEditor.get(a.initializedId);void 0!=c.config.kwhIcon&&c.config.kwhIcon?b.show():b.hide();var d=function(){c.imageUploader&&c.imageUploader.openSetupPage(c)};this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,d)}}),TrexMessage.addMsg({"@styledlist.subtitle1":Trex._I18N.g("styledlist.subtitle1","취소"),"@styledlist.subtitle2":Trex._I18N.g("styledlist.subtitle2","동그라미"),"@styledlist.subtitle3":Trex._I18N.g("styledlist.subtitle3","네모"),"@styledlist.subtitle4":Trex._I18N.g("styledlist.subtitle4","숫자"),"@styledlist.subtitle5":Trex._I18N.g("styledlist.subtitle5","로마숫자"),"@styledlist.subtitle6":Trex._I18N.g("styledlist.subtitle6","알파벳")}),TrexConfig.addTool("styledlist",{status:_TRUE,options:[{label:TXMSG("@styledlist.subtitle1"),title:"cancel",type:"cancel",data:"cancel",klass:"tx-styledlist-0"},{label:TXMSG("@styledlist.subtitle2"),title:"disc",type:"ul",data:"disc",klass:"tx-styledlist-1"},{label:TXMSG("@styledlist.subtitle3"),title:"square",type:"ul",data:"square",klass:"tx-styledlist-2"},{label:TXMSG("@styledlist.subtitle4"),title:"decimal",type:"ol",data:"decimal",klass:"tx-styledlist-3"},{label:TXMSG("@styledlist.subtitle5"),title:"upper-roman",type:"ol",data:"upper-roman",klass:"tx-styledlist-4"},{label:TXMSG("@styledlist.subtitle6"),title:"upper-alpha",type:"ol",data:"upper-alpha",klass:"tx-styledlist-5"}],hotKey:{ul:{ctrlKey:_TRUE,altKey:_TRUE,keyCode:85},ol:{ctrlKey:_TRUE,altKey:_TRUE,keyCode:79}}}),Trex.Tool.StyledList=Trex.Class.create({$const:{__Identity:"styledlist"},$extend:Trex.Tool,oninitialized:function(a){var b=this;b.createListStyleMap(a),b.weave(new Trex.Button.StyledList(b.buttonCfg),new Trex.Menu.Select(b.menuCfg),b.handler,b.menuInitHandler.bind(b)),b.indentHelper=Trex.Tool.Indent.Helper,b.startSyncButtonWithStyle()},createListStyleMap:function(a){var b=this.listStyleMap={};a.options.each(function(a){b[a.data]={type:a.type,klass:a.klass}})},handler:function(a){var b=this;if(b.listStyleMap[a]){var c=b.listStyleMap[a].type,d={listStyleType:a};b.canvas.execute(function(a){"cancel"==c?b.outdentListItem(a):b.createListFromSelection(a,c,d)})}},outdentListItem:function(a){a.executeUsingCaret(function(b,c){Trex.Tool.Indent.Helper.findBlocksToIndentFromRange(b,a,c).each(function(b){Trex.Tool.Indent.Operation.OutdentListItem(b,a)})})},createListFromSelection:function(a,b,c){var d=this;a.executeUsingCaret(function(e,f){var g=d.indentHelper.findBlocksToIndentFromRange(e,a,f);d.groupEachList(g).each(function(d){new Trex.Tool.StyledList.ListBuilder(a,b,c).createListForNodes(d)})}),this._removeBrInListItemForIE(a)},_removeBrInListItemForIE:function(a){if($tx.msie_docmode>=11){var b=a.createGoogRange(),c=b.getStartNode();b.isCollapsed()&&$tom.isElement(c)&&$tom.isElement(c.firstChild)&&$tom.isTagName(c.firstChild,"br")&&($tom.remove(c.firstChild),c.appendChild(a.newText("")))}},groupEachList:function(a){var b=this.indentHelper,c=[],d=[],e=_NULL;return a.each(function(a){var f=b.findCurrentCell(a);f!=e&&(d.length>0&&(c.push(d),d=[]),e=f),d.push(a)}),d.length>0&&c.push(d),c},menuInitHandler:function(){var a=this.canvas.query(function(a){return!!a.findNode("%listhead")}),b=$tom.collect(this.menu.elMenu,"li");a?$tx.show(b):$tx.hide(b)},startSyncButtonWithStyle:function(){var a=this,b=a.canvas,c=a.getDefaultProperty();b.observeJob(Trex.Ev.__CANVAS_PANEL_QUERY_STATUS,function(){var d=b.query(function(a){var b=a.findNode("%listhead");return a.queryStyle(b,"listStyleType")});if(d=d||a.getDefaultProperty(),c!=d){var e=a.getButtonClassByValue(d);a.button.setText(e),c=d}})},getDefaultProperty:function(){return"decimal"},getButtonClassByValue:function(a){var b=this.listStyleMap;return b[a]?b[a].klass:b[this.getDefaultProperty()].klass}}),Trex.Button.StyledList=Trex.Class.create({$extend:Trex.Button.Select,setText:function(a){this.elIcon.className="tx-icon "+a}}),Trex.Tool.StyledList.ListBuilder=Trex.Class.create({currentDepth:_NULL,prepared:_FALSE,listElement:_NULL,uselessListCandidate:[],processor:_NULL,initialize:function(a,b,c){this.processor=a,this.listTag=b,this.listStyle=c},createListForNodes:function(a){var b=this;b.getNodeDepthList(a).each(function(a){var c=a.node,d=a.depth;b.prepared||b.prepareRootList(c,d),b.adjustDepth(c,d),b.appendAsListItem(c)}),b.cleanupEmptyList()},getNodeDepthList:function(a){var b=this;return a.map(function(a){return{node:a,depth:b.countDepthOfList(a)}})},countDepthOfList:function(a){for(var b=0,c=$tom.parent(a);c&&!$tom.isBody(c);){if($tom.kindOf(c,"ol,ul"))b++;else if($tom.kindOf(c,"th,td"))break;c=$tom.parent(c)}return b||1},prepareRootList:function(a,b){var c=this;c.listElement=c.createNewList();var d;"LI"==a.tagName?(c.uselessListCandidate.push(a.parentNode),d=$tom.divideNode(a.parentNode,$tom.indexOf(a))):d=a,$tom.insertAt(c.listElement,d),c.currentDepth=b,c.listDepth=b,c.prepared=_TRUE},adjustDepth:function(a,b){for(var c=this;b!=c.currentDepth;)b>c.currentDepth?c.increaseDepth():c.decreaseDepth()},increaseDepth:function(){var a=this,b=a.listElement;a.currentDepth++;var c=a.createNewList();b.appendChild(c),a.listElement=c},decreaseDepth:function(){var a=this,b=a.listElement;if(a.currentDepth--,a.listDepth>a.currentDepth){a.uselessListCandidate.push(b.parentNode);var c=$tom.divideNode(b.parentNode,$tom.indexOf(b)),d=a.createNewList();$tom.insertAt(d,c),d.appendChild(b)}a.listElement=b.parentNode},createNewList:function(){var a=this,b=a.processor.newNode(a.listTag);return $tx.setStyle(b,a.listStyle),b},cleanupEmptyList:function(){this.uselessListCandidate.each(function(a){$tom.removeListIfEmpty(a)})},wrapWithListItem:function(a){if("LI"==a.tagName)return a;if("P"==a.tagName||$tx.webkit&&"DIV"==a.tagName){var b=this.createListItem();return $tom.applyStyles(a,{marginLeft:_NULL}),$tom.getStyleText(a)?($tom.wrap(b,a),b):$tom.replace(a,b)}var c=this.createListItem();return c.appendChild(a),c},createListItem:function(){return this.processor.newNode("li")},appendAsListItem:function(a){var b=this.wrapWithListItem(a);$tom.kindOf(a.parentNode,"%listhead")&&this.uselessListCandidate.push(a.parentNode),this.listElement.appendChild(b)}}),TrexConfig.addTool("link",{wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE}),TrexMessage.addMsg({"@insertlink.cancel.image":Trex._I18N.g("btn_cancel","#iconpath/btn_cancel.gif?open&v=2"),"@insertlink.confirm.image":Trex._I18N.g("btn_confirm","#iconpath/btn_confirm.gif?open&v=2"),"@insertlink.invalid.url":Trex._I18N.g("insertlink.invalid.url","URL을 입력해주세요."),"@insertlink.link.alt":Trex._I18N.g("insertlink.link.alt","[#{title}]로 이동합니다."),"@insertlink.remove.image":Trex._I18N.g("btn_remove","#iconpath/btn_remove.gif?open&v=2"),"@insertlink.title":Trex._I18N.g("insertlink.title","선택된 부분에 걸릴 URL주소를 넣어주세요."),"@insertlink.onclick.target":Trex._I18N.g("insertlink.onclick.target","클릭 시"),"@insertlink.target.blank":Trex._I18N.g("insertlink.target.blank","새 창"),"@insertlink.target.self":Trex._I18N.g("insertlink.target.self","현재창"),"@insertlink.target.message":Trex._I18N.g("url_message","클릭시 새창으로 열립니다."),"@insertlink.class.name":"tx-link"}),Trex.Tool.Link=Trex.Class.create({$const:{__Identity:"link"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=function(b){a.isWYSIWYG()?b?a.execute(function(a){var c,d,e={href:b.link,target:b.target?b.target:"_blank",className:b.className};if(a.findNode("a"))c=a.findNode("a"),$tom.applyAttributes(c,e);else if(a.hasControl())d=a.controls(function(){return"img"}),$tom.wrap(a.create("a",e),d);else if(a.isCollapsed()){c=a.create("a",e);var f=a.doc.createTextNode(b.link);c.appendChild(f),a.pasteNode(c,_FALSE)}else d=a.inlines(function(){return"%text,img,a,%inline"}),d.each(function(b){if($tom.hasUsefulChildren(b,_TRUE))if($tom.kindOf(b,"a"))$tom.applyAttributes(b,e);else if($tom.kindOf(b,"img"))$tom.wrap(a.create("a",e),[b]);else{var c=$tom.getStyleText(b),d=$tom.collectAll(b,"a");d.each(function(a){$tom.moveChildToParent(a),$tom.remove(a)});var f=a.create("a",e);$tom.setStyleText(f,c),$tom.replace(b,f)}else $tom.remove(b)})}):a.execute(function(a){var b=a.findNode("a");b&&a.unwrap(b)}):a.execute(function(a){a.insertTag('<a href="'+b.link+'" target="'+b.target+'" >',"</a>")})},c=function(){return a.isWYSIWYG()?a.query(function(a){var b,c,d,e;if(b=a.findNode("a")){if(c=$tom.getAttribute(b,"href"))return d=$tom.getAttribute(b,"target"),{exist:_TRUE,value:c,target:d}}else if(e=a.getText(),/^\w+\:\/\/\S+/.test(e))return{exist:_FALSE,value:e};return{exist:_FALSE,value:""}}):{exist:_FALSE,value:""}};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.Link(this.menuCfg),b,c)}}),
Trex.MarkupTemplate.add("menu.insertlink",['<div class="tx-menu-inner">',"    <dl>","        <dt>","            @insertlink.title","        </dt>","        <dd>",'            <input type="text" class="tx-text-input"/>',"        </dd>","        <dd>",'\t\t\t<span class="tx-text link-target-msg">@insertlink.target.message</span>',"        </dd>",'        <dd class="tx-hr">',"            <hr/>","        </dd>","        <dd>",'            <img width="32" height="21" src="@insertlink.confirm.image"/>','            <img width="32" height="21" src="@insertlink.cancel.image"/>','            <img width="51" height="21" src="@insertlink.remove.image" style="display: none;"/>',"        </dd>","    </dl>","</div>"].join("")),Trex.Menu.Link=Trex.Class.create({$extend:Trex.Menu,ongenerated:function(){var a=this.elMenu;Trex.MarkupTemplate.get("menu.insertlink").evaluateToDom({},a),this._targetMsg=$tom.collect(a,".link-target-msg");var b=this.urlValidator,c=this.elInput=$tom.collect(a,"input.tx-text-input"),d=this;$tx.observe(c,"keydown",function(a){if(13==a.keyCode){var e=b(c.value);if(!e)return alert(TXMSG("@insertlink.invalid.url")),void $tx.stop(a);var f=d._dataTarget||"_blank";this.onSelect(a,{link:e,target:f,className:TXMSG("@insertlink.class.name")}),$tx.stop(a)}}.bindAsEventListener(this));var e=$tom.collectAll(a,"img");$tx.observe(e[0],"click",function(a){var e=b(c.value);if(!e)return alert(TXMSG("@insertlink.invalid.url")),void $tx.stop(a);var f=d._dataTarget||"_blank";this.onSelect(a,{link:e,target:f,className:TXMSG("@insertlink.class.name")}),$tx.stop(a)}.bind(this)),$tx.observe(e[1],"click",function(){this.onCancel()}.bindAsEventListener(this));var f=$tx(e[2]);$tx.observe(f,"click",function(a){this.onSelect(a,_NULL)}.bindAsEventListener(this)),this.toggleRemoveBtn=function(a){f.style.display=a?"":"none"}},onregenerated:function(){var a=this.elInput,b=this.initHandler();a.value=b.value,this._dataTarget=b.target||"_blank",this._targetMsg&&(this._targetMsg.style.display=this._dataTarget&&"_blank"!=this._dataTarget?"none":""),this.toggleRemoveBtn(b.exist),a.focus(),$tx.msie_nonstd&&setTimeout(function(){try{a.focus();var b=_DOC.selection.createRange();b.move("character",a.value.length),b.select()}catch(a){}},100)},urlValidator:function(a){return a?(a=a.trim(),0==a.length?_FALSE:/^[a-z0-9+.-]+:|^\/\/|^#/i.test(a)?a:"http://"+a):_FALSE}}),TrexConfig.addTool("richtextbox",{sync:_FALSE,status:_TRUE,rows:4,cols:6,borderwidth:1,bordercolor:"#cbcbcb",bgcolor:"#ffffff",padding:"10px",styles:[{klass:"",image:"#iconpath/textbox/thum_line01.gif?open&v=2",data:"solid"},{klass:"",image:"#iconpath/textbox/thum_line02.gif?open&v=2",data:"double"},{klass:"",image:"#iconpath/textbox/thum_line03.gif?open&v=2",data:"dashed"},{klass:"",image:"#iconpath/textbox/thum_line04.gif?open&v=2",data:"none"}],options:Trex.__CONFIG_COMMON.textbox.options,thumbs:Trex.__CONFIG_COMMON.thumbs}),TrexMessage.addMsg({"@richtextbox.add":Trex._I18N.g("richtextbox.add","더하기"),"@richtextbox.sub":Trex._I18N.g("richtextbox.sub","빼기"),"@richtextbox.alert":Trex._I18N.g("richtextbox.alert","1 이상 20 이하의 숫자만 입력 가능합니다."),"@richtextbox.bg.color":Trex._I18N.g("richtextbox.bg.color","배경색"),"@richtextbox.border.color":Trex._I18N.g("richtextbox.border.color","선 색"),"@richtextbox.border.style":Trex._I18N.g("richtextbox.border.style","선 스타일"),"@richtextbox.border.width":Trex._I18N.g("richtextbox.border.width","선 굵기")}),Trex.Tool.RichTextBox=Trex.Class.create({$const:{__Identity:"richtextbox"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=this.toolbar,c=this,d=this.handler=function(){var d=c.menu,e={borderStyle:d.elPreview.style.borderStyle,borderWidth:d.elPreview.style.borderWidth,borderColor:d.elPreview.style.borderColor,backgroundColor:d.elPreview.style.backgroundColor,padding:d.padding},f={className:"txc-textbox",style:e};a.execute(function(a){var c=$("<div><p>&nbsp;</p></div>").css(f.style).addClass(f.className)[0];a.pasteNode(c,!0),b.fireJobs("cmd.textbox.added",c)})};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.RichTextbox(this.menuCfg),d)}}),Trex.MarkupTemplate.add("richtextbox.colorpallete",['<dd class="#{wrapClass}">','\t<div class="tx-color-box">','\t\t<a href="javascript:;" class="tx-color-bg-thumb" style="background-color:#{color}"></a>',"\t</div>",'\t<a href="javascript:;" class="tx-color-arrow-down"></a>','\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"</dd>"].join("")),Trex.Menu.RichTextbox=Trex.Class.create({$extend:Trex.Menu,ongenerated:function(a){var b=this,c={};a.options.each(function(a){c[a.data]=a.style}),this.borderWidth=a.borderWidth||1,this.borderColor=a.borderColor||"#cbcbcb",this.bgColor=a.bgColor||"#ffffff",this.padding=a.padding;var d=this.generateBorderStyle.bind(this),e=this.generateBorderWidth.bind(this),f=this.generateBorderColor.bind(this),g=this.generateBgColor.bind(this),h=this.elMenu,i=$tom.collect(h,"div.tx-menu-header"),j=$tom.collect(i,"div.tx-menu-preview-area");this.elPreview=$tom.collect(j,"div.tx-menu-preview");var k=this.elSwitch=$tom.collect(i,"div.tx-menu-switch"),l=$tom.collect(k,"div.tx-menu-simple"),m=$tom.collect(k,"div.tx-menu-advanced"),n=$tom.collect(h,"div.tx-menu-inner"),o=$tom.collect(h,"div.tx-menu-footer"),p=$tom.collect(o,"img.tx-menu-confirm"),q=$tom.collect(o,"img.tx-menu-cancel");!function(){var d=b.simplePalette=tx.div({className:"tx-menu-list"});n.appendChild(d);var e=a.rows,f=a.cols;d.innerHTML=Trex.HtmlCreator.createTableMarkup(e,f,a.options),$tx.observe(d,"click",function(a){var b=$tx.element(a);TrexEvent.fire(b,{span:function(){var a;a=b.firstChild&&1==b.firstChild.nodeType&&"img"==b.firstChild.tagName.toLowerCase()?b.firstChild.title:b.innerText;var d=c[a];s(d)}}),$tx.stop(a)})}(),function(){var a=b.advancedPalette=tx.div({className:"tx-advanced-list"});n.appendChild(a),a.appendChild(tx.dl({style:{height:"24px"}},tx.dt(TXMSG("@richtextbox.border.style")),d())),a.appendChild(tx.dl(tx.dt(TXMSG("@richtextbox.border.width")),e())),a.appendChild(tx.dl(tx.dt(TXMSG("@richtextbox.border.color")),f())),a.appendChild(tx.dl(tx.dt(TXMSG("@richtextbox.bg.color")),g()))}();var r=function(){b.borderWidthInput.value=parseInt(b.elPreview.style.borderWidth),b.borderColorInput.style.backgroundColor=b.elPreview.style.borderTopColor,b.bgColorInput.style.backgroundColor=b.elPreview.style.backgroundColor},s=function(a){b.elPreview.style.border=a.border,b.elPreview.style.backgroundColor=a.backgroundColor},t=function(a){"simple"==a?($tx.addClassName(l,"tx-selected"),$tx.show(b.simplePalette),$tx.removeClassName(m,"tx-selected"),$tx.hide(b.advancedPalette)):"advanced"==a&&($tx.removeClassName(l,"tx-selected"),$tx.hide(b.simplePalette),$tx.addClassName(m,"tx-selected"),$tx.show(b.advancedPalette),r()),b.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,{detail:{menu:b}})};!function(){$tx.observe(l,"click",t.bind(b,"simple")),$tx.observe(m,"click",t.bind(b,"advanced")),$tx.observe(p,"click",b.onSelect.bind(b)),$tx.observe(q,"click",function(){b.onCancel()})}(),t("simple"),s(c["txc-textbox13"])},generateBorderStyle:function(){var a=this,b=tx.dd({className:"tx-border-area"});return $tx.observe(b,"click",function(b){var c=$tx.element(b);TrexEvent.fire(c,{img:function(b){var c=b.getAttribute("data");a.elPreview.style.borderStyle=c,"double"==c&&a.borderWidthInput.value.toNumber()<3&&(a.elPreview.style.borderWidth="3px",a.borderWidthInput.value="3")}}),$tx.stop(b)}),b.innerHTML=Trex.HtmlCreator.createTableMarkup(1,4,this.config.styles),b},generateBorderWidth:function(){var a=this,b=tx.dd({className:"tx-border-area"}),c=this.borderWidthInput=tx.input({type:"text",value:this.borderWidth});b.appendChild(c);var d=function(b){b>20?(alert(TXMSG("@richtextbox.alert")),c.value=20):b<1?(alert(TXMSG("@richtextbox.alert")),c.value=1):(a.elPreview.style.borderWidth=b+"px",c.value=b)};$tx.observe(c,"blur",function(a){d(c.value.toNumber())}),$tx.observe(c,"keydown",function(a){a.keyCode==$tx.KEY_RETURN&&$tx.stop(a)});var e=tx.a({href:"javascript:;",className:"btn_add"},TXMSG("@richtextbox.add"));b.appendChild(e),$tx.observe(e,"click",function(a){d(c.value.toNumber()+1),$tx.stop(a)});var f=tx.a({href:"javascript:;",className:"btn_sub"},TXMSG("@richtextbox.sub"));return b.appendChild(f),$tx.observe(f,"click",function(a){d(c.value.toNumber()-1),$tx.stop(a)}),b},generateBorderColor:function(){var a=this,b=Trex.MarkupTemplate.get("richtextbox.colorpallete").evaluateAsDom({color:this.borderColor,wrapClass:"tx-color-wrap"}),c=$tom.collect(b,"div.tx-colorpallete"),d=function(b){a.elPreview.style.borderColor=g.style.backgroundColor=a.borderColor=b},e=_NULL,f=function(){e==_NULL?(e=a.createColorPallete(c,d),e.show()):$tx.visible(c)?e.hide():e.show()};this.externalBorderColorToggler=function(){$tx.visible(c)&&e.hide()};var g=this.borderColorInput=$tom.collect(b,".tx-color-box a");$tx.observe(g,"click",function(b){a.externalBgColorToggler(),f(),$tx.stop(b)});var h=$tom.collect(b,"a.tx-color-arrow-down");return $tx.observe(h,"click",function(b){a.externalBgColorToggler(),f(),$tx.stop(b)}),b},createColorPallete:function(a,b){var c=this,d=new Trex.Menu.ColorPallete({el:a,thumbs:this.config.thumbs});return d.setCommand(b),d.observeJob(Trex.Ev.__MENU_LAYER_SHOW,function(a){c.fireJobs(Trex.Ev.__MENU_LAYER_SHOW,a)}),d.observeJob(Trex.Ev.__MENU_LAYER_HIDE,function(a){c.fireJobs(Trex.Ev.__MENU_LAYER_HIDE,a)}),d.observeJob(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,function(a){c.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,a)}),d},generateBgColor:function(){var a=this,b=Trex.MarkupTemplate.get("richtextbox.colorpallete").evaluateAsDom({color:this.bgColor}),c=$tom.collect(b,"div.tx-colorpallete"),d=function(b){a.elPreview.style.backgroundColor=g.style.backgroundColor=a.bgColor=b},e=_NULL,f=function(){e==_NULL?(e=a.createColorPallete(c,d),e.show()):$tx.visible(c)?e.hide():e.show()};this.externalBgColorToggler=function(){$tx.visible(c)&&e.hide()};var g=this.bgColorInput=$tom.collect(b,".tx-color-box a");$tx.observe(g,"click",function(b){a.externalBorderColorToggler(),f(),$tx.stop(b)});var h=$tom.collect(b,"a.tx-color-arrow-down");return $tx.observe(h,"click",function(b){a.externalBorderColorToggler(),f(),$tx.stop(b)}),b}}),TrexConfig.addTool("quote",{sync:_FALSE,status:_TRUE,rows:2,cols:3,options:[{type:"image",data:"tx-quote1",image:Trex._I18N.g("citation_img","01","#iconpath/quote/citation01.gif?open&v=2")},{type:"image",data:"tx-quote2",image:Trex._I18N.g("citation_img","02","#iconpath/quote/citation02.gif?open&v=2")},{type:"image",data:"tx-quote3",image:Trex._I18N.g("citation_img","03","#iconpath/quote/citation03.gif?open&v=2")},{type:"image",data:"tx-quote4",image:Trex._I18N.g("citation_img","04","#iconpath/quote/citation04.gif?open&v=2")},{type:"image",data:"tx-quote5",image:Trex._I18N.g("citation_img","05","#iconpath/quote/citation05.gif?open&v=2")},{type:"cancel",data:"tx-quote6",image:Trex._I18N.g("citation_img","06","#iconpath/quote/citation06.gif?open&v=2")}]},function(a){TrexConfig.getTool("quote",a).options.each(function(a){a.image=TrexConfig.getIconPath(a.image,"quote")})}),Trex.Tool.Quote=Trex.Class.create({$const:{__Identity:"quote"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c={};a.options.each(function(a){c[a.data]={type:a.type}});var d=function(a){if(c[a]){var d=c[a].type,e="blockquote",f={className:a};b.isWYSIWYG()?b.execute(function(a){var b=a.findNode(e);if(b)"cancel"==d?a.unwrap(b):a.apply(b,f);else if("cancel"!=d){var c=a.blocks(function(){return"%wrapper,%paragraph"});c=c.findAll(function(b){return $tom.kindOf(b,"%innergroup")?(a.wrap($tom.children(b),e,f),_FALSE):_TRUE}),a.wrap(c,e,f)}}):b.execute(function(a){a.insertTag("<blockquote>","</blockquote>")})}};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.List(this.menuCfg),d)}}),TrexConfig.addTool("table",{borderStyle:"1px solid #ccc",sync:_FALSE,status:_TRUE},function(a){var b=TrexConfig.get("canvas",a).styles.backgroundColor;"transparent"!=b&&(TrexConfig.getTool("table",a).bgcolor=b)}),TrexMessage.addMsg({"@table.alert":Trex._I18N.g("table.alert","1 이상 30 이하의 숫자만 입력 가능합니다.")}),Trex.Tool.Table=Trex.Class.create({$const:{__Identity:"table",__DEFAULT_TABLE_PROPERTY:{cellSpacing:0,cellPadding:1,border:0,style:{border:"none",borderCollapse:"collapse"}},__DEFAULT_TABLE_PROPERTY_STR:'cellspacing="0" cellpadding="0" border="0"',__DEFAULT_TABLE_STYLE:"border:none;border-collapse:collapse;word-break:break-all",__DEFAULT_TABLE_CLASS:"txc-table",__DEFAULT_TABLE_CELL_HEIGHT:24,__DEFAULT_TABLE_CELL_PADDING:"0px 3px 0px 3px"},$extend:Trex.Tool,oninitialized:function(a){var b=this;this.tableSize={row:0,col:0},this.tableTemplateLoader=new Trex.Table.TemplateLoader;var c=this.canvas,d=this.handler=function(d){c.execute(function(c){var e="100%";c.executeUsingCaret(function(a,c){var d=c.getCaret(_FALSE);$tom.ancestor(d,"table")||(e=b.getDefaultTableWidth())});var f=b.makeEmptyTable(d,e),g=c.pasteContent(f,_TRUE);c.bookmarkInto(g),d.type&&"style"==d.type&&b.tableTemplateLoader.getTemplate(d.tableStyle,function(a){a.apply(g)}),!a.isHideAdvanceMenu&&b.toolbar.tools.advanced&&b.toolbar.tools.advanced.forceOpen()})};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.Table(this.menuCfg,c),d)},makeEmptyTable:function(a,b){var c=[],d=a.row,e=a.col;c.push('<table class="'+Trex.Tool.Table.__DEFAULT_TABLE_CLASS+'"'),b&&c.push(' width="'+b+'"'),c.push(Trex.Tool.Table.__DEFAULT_TABLE_PROPERTY_STR),c.push(' style="'),c.push(Trex.Tool.Table.__DEFAULT_TABLE_STYLE),c.push(";font-family:"),c.push(this.editor.canvas.getStyle("fontFamily").replace(/"/g,"&quot;")),c.push(";font-size:"),c.push(this.editor.canvas.getStyle("fontSize")),c.push('"><tbody>');var f=this.config.borderStyle;a.type&&"custom"==a.type&&(f=a.lineWidth+"px "+a.lineStyle+" "+a.lineColor);for(var g=this.getDefaultCellWidth(e,b),h=this.getDefaultCellHeight(d),i=["border-bottom:",f,";border-right:",f,";"].join(""),j=0;j<d;j++){c.push("<tr>");for(var k=0;k<e;k++){c.push('<td style="width:'),c.push(g),c.push(";"),c.push("height:",h,";"),c.push(i),0==j&&c.push("border-top:",f,";"),0==k&&c.push("border-left:",f,";"),a.type&&"custom"==a.type&&this.config.bgcolor.toLowerCase()!=a.cellColor.toLowerCase()&&c.push("background-color:",a.cellColor,";"),Trex.Tool.Table.__DEFAULT_TABLE_CELL_PADDING&&c.push("padding:",Trex.Tool.Table.__DEFAULT_TABLE_CELL_PADDING,";"),c.push(';"><p>'+$tom.EMPTY_BOGUS+"</p></td>")}c.push("</tr>")}return c.push("</tbody></table>"),c.join("")},getDefaultCellWidth:function(a,b){var c;return b=b||"100%",-1!==b.toString().indexOf("%")?c=100/a+"%":(c=parseInt(parseInt(b,10)/a,10),isNaN(c)&&(c=0),c=c.toPx()),c},getDefaultCellHeight:function(a){return Trex.Tool.Table.__DEFAULT_TABLE_CELL_HEIGHT.toPx()},getDefaultTableWidth:function(){var a=this.config.tableWidth;return a||(a=this.getCanvasInnerWidth()),a},getCanvasInnerWidth:function(){var a=this.canvas.getSizeConfig().contentPadding||8,b=600;try{b=(this.canvas.wysiwygEl.offsetWidth||this.canvas.getSizeConfig().contentWidth||600)-2*a-20}catch(a){}return b}}),Trex.Tool.Table.TemplateWizard=Trex.Class.create({initialize:function(){this.templateList="function"==typeof getTableTemplateList?getTableTemplateList():[{klass:"ex1",common:{backgroundColor:"transparent",borderTop:"none",borderLeft:"none",borderRight:"1px solid #d9d9d9",borderBottom:"1px solid #d9d9d9"},firstRow:{borderTop:"1px solid #000"},firstCol:{borderLeft:"1px solid #000"},lastCol:{borderRight:"1px solid #000"},lastRow:{borderBottom:"1px solid #000"},evenRow:{},oddRow:{}}],this.currentTemplate=_NULL},applyStyle:function(a,b){if(!isNaN(b)){var c=new Trex.Tool.Table.TableCellMatrixer(a),d=c.getTdMatrix();this.currentTemplate=this.templateList[b];for(var e=0;e<d.length;e++)for(var f=0;f<d[e].length;f++)this.setCellStyle(d[e][f],{isEvenRow:e%2==1,isFirstRow:0==e,isLastRow:e==d.length-1,isFirstCol:0==f,isLastCol:f==d[e].length-1})}},setCellStyle:function(a,b){var c=this.currentTemplate,d=Object.extend({},c.common);Object.extend(d,b.isEvenRow?c.evenRow:c.oddRow),Object.extend(d,b.isFirstRow?c.firstRow:b.isLastRow?c.lastRow:{}),Object.extend(d,b.isLastCol?c.lastCol:{}),Object.extend(d,b.isFirstCol?c.firstCol:{}),txlib.setStyle(a,d)},getTemplateList:function(){return this.templateList}}),Trex.Tool.Table.TableCellMatrixer=Trex.Class.create({initialize:function(a){this.rowSize=this.initRowSize(a),this.colSize=this.initColSize(a);var b=$tom.first(a,"tbody")||a;this.tdMatrix=this.createTdMatrix(b);for(var c=0;c<this.tdMatrix.length;c++)for(var d=0;d<this.tdMatrix[c].length;d++){var e=this.tdMatrix[c][d];e.cols>1&&(e.cols--,this.tdMatrix[c].splice(d+1,0,e))}for(var c=0;c<this.tdMatrix.length;c++)for(var d=0;d<this.tdMatrix[c].length;d++){var e=this.tdMatrix[c][d];e.rows>1&&(e.rows--,this.tdMatrix[c+1].splice(d,0,e))}},createTdMatrix:function(a){for(var b=[],c=$tom.children(a,"tr"),d=0,e=c.length;d<e;d++)b.push(this.createTdArray(c[d]));return b},createTdArray:function(a){for(var b=[],c=$tom.children(a,"td"),d=0,e=c.length;d<e;d++)b.push(this.decorateSingleTd(c[d]));return b},decorateSingleTd:function(a){var b=parseInt(a.getAttribute("colSpan")||1),c=parseInt(a.getAttribute("rowSpan")||1);return a.cols=b,a.rows=(c-1)*b+1,a},initRowSize:function(a){return a.rows.length},initColSize:function(a){var b=0;return $tom.children($tom.collect(a,"tr"),"td").each(function(a){b+=parseInt(a.getAttribute("colSpan")||1)}),b},getRowSize:function(){return this.rowSize},getColSize:function(){return this.colSize},getTdMatrix:function(){return this.tdMatrix}}),TrexMessage.addMsg({"@table.title.insert":Trex._I18N.g("table.title.insert","표삽입 &nbsp;"),"@table.title.setDirectly":Trex._I18N.g("table.title.setDirectly","표 직접설정"),"@table.title.row":Trex._I18N.g("table.title.row","행 개수"),"@table.title.col":Trex._I18N.g("table.title.col","열 개수"),"@table.detail.menual":Trex._I18N.g("table.detail.menual","직접입력"),"@table.detail.style":Trex._I18N.g("table.detail.style","스타일선택"),"@table.detail.cell_bg":Trex._I18N.g("table.detail.cell_bg","셀 배경색"),"@table.detail.border_style":Trex._I18N.g("table.detail.border_style","테두리 스타일"),"@table.detail.border_line":Trex._I18N.g("table.detail.border_line","테두리 두께"),"@table.detail.border_color":Trex._I18N.g("table.detail.border_color","테두리 색"),"@table.detail.ok":Trex._I18N.g("table.detail.ok","확인"),"@table.detail.cancel":Trex._I18N.g("table.detail.cancel","취소")}),Trex.MarkupTemplate.add("menu.table.direct",["<div>@table.title.setDirectly</div>",'<div class="tx-table-input-area">','<div class="tx-field tx-col-field">@table.title.row<input type="text" value="1"><a class="tx-btn tx-btn-add" href="javascript:;">@table.title.row+</a><a class="tx-btn tx-btn-sub" href="javascript:;">@table.title.row-</a></div>','<div class="tx-field tx-row-field">@table.title.col<input type="text" value="1"><a class="tx-btn tx-btn-add" href="javascript:;">@table.title.col+</a><a class="tx-btn tx-btn-sub" href="javascript:;">@table.title.col-</a></div>',"</div>"].join("")),Trex.MarkupTemplate.add("menu.table.detail",['\t<div class="cell_prop">','\t\t<div class="g_divide line-bottom">',"\t\t\t<dl>","\t\t\t\t<dt>@table.title.row</dt>",'\t\t\t\t<dd><span class="g_select"><input type="text" name="detail_row" class="txt txt_sel" /><button type="button" name="btn_detail_row_up" class="bg btn btn_up_arrow">+</button><button type="button" name="btn_detail_row_down" class="bg btn btn_down_arrow">-</button></span></dd>',"\t\t\t</dl>","\t\t\t<dl>","\t\t\t\t<dt>@table.title.col</dt>",'\t\t\t\t<dd><span class="g_select"><input type="text" name="detail_col" class="txt txt_sel" /><button type="button" name="btn_detail_col_up" class="bg btn btn_up_arrow">+</button><button type="button" name="btn_detail_col_down" class="bg btn btn_down_arrow">-</button></span></dd>',"\t\t\t</dl>",'\t\t\t<table name="table_detail_preview"></table>',"\t\t</div>","\t\t<dl>",'\t\t\t<dt class="tit"><label><input type="radio" name="rdo_table_style" class="rdo" value="custom" checked /> <strong style="cursor:pointer;">@table.detail.menual</strong></label></dt>','\t\t\t<dd class="clear depth2">',"\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.border_style</dt>",'\t\t\t\t\t<dd class="g_line_dd">','\t\t\t\t\t\t<span class="g_line"><span class="line_style line1"></span><button type="button" name="btn_border_style" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t\t\t\t<ul class="line_style_option" style="display:none;">','\t\t\t\t\t\t\t#{for:line}<li class="#{class}" data-style="#{style}"><a href="javascript:;"></a></li>#{/for:line}',"\t\t\t\t\t\t</ul>","\t\t\t\t\t</dd>","\t\t\t\t</dl>","\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.border_line</dt>",'\t\t\t\t\t<dd><span class="g_select"><input type="text" name="txt_border_line" class="txt txt_sel" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span></dd>","\t\t\t\t</dl>","\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.border_color</dt>",'\t\t\t\t\t<dd><input type="text" name="txt_border_color" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t\t\t\t</dd>","\t\t\t\t</dl>","\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.cell_bg</dt>",'\t\t\t\t\t<dd><input type="text" name="txt_cell_bg" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t\t\t\t</dd>","\t\t\t\t</dl>","\t\t\t</dd>","\t\t</dl>",'\t\t<dl class="table_style">','\t\t\t<dt class="tit"><label><input type="radio" name="rdo_table_style" class="rdo" value="style" /> <strong class="s_disabled" style="cursor:pointer;">@table.detail.style</strong></label></dt>',"\t\t\t<dd>",'\t\t\t\t<span class="g_style"><span class="td_style"></span><button type="button" name="btn_table_style" class="bg btn btn_down_arrow2">'+Trex._I18N.g("btn_down_arrow2","펼치기")+"</button></span>",'\t\t\t\t<ul class="td_style_option" style="display:none;">','\t\t\t\t\t#{for:items}<li><span class="td_style #{text}" data-style="#{style}">#{text}</span></li>#{/for:items}',"\t\t\t\t</ul>","\t\t\t</dd>","\t\t</dl>",'\t\t<div class="custom_block"></div>','\t\t<div class="style_block"></div>',"\t</div>",'\t<div class="layer_bottom">','\t\t<button type="button" name="btn_detail_ok" class="btn btn_ok">@table.detail.ok</button>','\t\t<button type="button" name="btn_detail_cancel" class="btn btn_cancel">@table.detail.cancel</button>',"\t<div>"].join("")),Trex.MarkupTemplate.add("menu.table.template",['\t<div class="td_template_option">','\t\t#{for:items}<li><span class="td_template #{text}" data-style="#{style}">#{text}</span></li>#{/for:items}',"\t<div>"].join("")),Trex.Menu.Table=Trex.Class.create({$const:{MAX_ROW:30,MAX_COL:30,MAX_LINE_WIDTH:5,DEFAULT_ROW:4,DEFAULT_COL:4,BORDER_LINE:1,TABLE_STYLE:7,MAX_PADDING:20},$extend:Trex.Menu,ongenerated:function(){this.rowSize=Trex.Menu.Table.DEFAULT_ROW,this.colSize=Trex.Menu.Table.DEFAULT_COL,this.lineWidth=Trex.Menu.Table.BORDER_LINE,this.lineStyle=_NULL,this.lineColor=_NULL,this.cellColor=_NULL,this.tableStyle=Trex.Menu.Table.TABLE_STYLE,this.canvas=this.tool.canvas,this.cellPallete=_NULL,this.linePallete=_NULL,this.elInnerPreview=$tom.collect(this.elMenu,"div.tx-menu-inner .tx-menu-preview"),this.dynamicSizer=this.generateDynamicSizer(this.elInnerPreview),this.elTableDetail=$tom.collect(this.elPopupMenu,".table_detail"),this.generateDetailSizer()},onregenerated:function(){this.showDynamicSizer()},showPopup:function(a,b){$tx.show(this.canvas.elEditorBlockUI);var c=$(this.canvas.elContainer),d=$(this.elTableDetail);if(isNaN(a)||isNaN(b)){var e=c.outerWidth(),f=c.outerHeight(),g=d.outerWidth(),h=d.outerHeight();a=Math.ceil(f/2)-Math.ceil(h/2)+c.position().top,b=Math.ceil(e/2)-Math.ceil(g/2)+c.position().left}d.css({top:a,left:b}),$tx.show(d.get(0))},hidePopup:function(){this.onCancel(),$tx.hide(this.canvas.elEditorBlockUI),$tx.hide(this.elTableDetail)},showDynamicSizer:function(){this.dynamicSizer.clear(),$tx.show(this.elInnerPreview)},showTextSizer:function(){var a=$(this.elMenu).closest("li").position().top+$(this.elMenu).position().top,b=$(this.elMenu).closest("li").position().left,c=$(this.elTableDetail),d=$(this.canvas.elContainer);b+c.outerWidth()>d.position().left+d.outerWidth()&&(b+=d.position().left+d.outerWidth()-(b+c.outerWidth()+10)),this.showPopup(a,b)},generateDynamicSizer:function(a){var b=this,c={items:[],line:[]};c.items.push({text:"style1",style:1}),c.items.push({text:"style4",style:4}),c.items.push({text:"style7",style:7}),c.items.push({text:"style5",style:5}),c.items.push({text:"style10",style:10}),c.items.push({text:"style13",style:13}),c.items.push({text:"style16",style:16}),c.items.push({text:"style14",style:14}),c.items.push({text:"style37",style:37}),c.items.push({text:"style40",style:40}),c.items.push({text:"style44",style:44}),c.items.push({text:"style41",style:41});var d=[{class:"line1",style:"solid"},{class:"line2",style:"dotted"},{class:"line3",style:"double"}];c.line=d;var e=tx.span(),f=tx.div({className:"tx-dynamic-sizer-display"},TXMSG("@table.title.insert"),e);a.appendChild(f);var g=new Trex.DynamicSizer({el:a,clickHandler:this.onSelect.bind(this),moveHandler:function(a,b){e.innerHTML=a+"x"+b}}),h=tx.a({href:"javascript:;"},TXMSG("@table.title.setDirectly"));$tx.observe(h,"click",function(a){b.showTextSizer(),$tx.stop(a),b.fireJobs(Trex.Ev.__MENU_LAYER_CHANGE_SIZE,{detail:{menu:b}})});var i=tx.div({className:Trex._I18N.g("tx-more-button","tx-more-button")});return i.appendChild(h),a.appendChild(i),g},generateDetailSizer:function(){for(var a={items:[],line:[]},b=1;b<=45;b++)a.items.push({text:"style"+b,style:b});var c=[{class:"line1",style:"solid"},{class:"line2",style:"dotted"},{class:"line3",style:"double"}];a.line=c,Trex.MarkupTemplate.get("menu.table.detail").evaluateToDom(a,this.elTableDetail),this.initDetailSetting()},initDetailSetting:function(){var a=this,b=$(this.elTableDetail),c=b.find("input[name=detail_row]"),d=b.find("input[name=detail_col]"),e=b.find("input[name=txt_cell_bg]"),f=b.find("input[name=txt_border_line]"),g=b.find("input[name=txt_border_color]"),h=b.find("button[name=btn_detail_row_up]"),i=b.find("button[name=btn_detail_row_down]"),j=b.find("button[name=btn_detail_col_up]"),k=b.find("button[name=btn_detail_col_down]"),l=b.find("button[name=btn_line_up]"),m=b.find("button[name=btn_line_down]"),n=b.find("button[name=btn_detail_ok]"),o=b.find("button[name=btn_detail_cancel]"),p=$(e).next(),q=$(g).next(),r=b.find("input[type=radio]"),s=$(p).find("span"),t=$(q).find("span"),u=$(p).next(),v=$(q).next(),w=b.find("table:eq(0)"),x=b.find("button[name=btn_border_style]"),y=$(x).closest("dd").find("ul:eq(0)"),z=b.find("button[name=btn_table_style]"),A=$(z).closest("dd").find("ul:eq(0)"),B={calculate:function(b,c){var d="row"==b?a.rowSize:"col"==b?a.colSize:a.lineWidth,e="row"==b?Trex.Menu.Table.MAX_ROW:"col"==b?Trex.Menu.Table.MAX_COL:Trex.Menu.Table.MAX_LINE_WIDTH;return(d=parseInt(d))+c>e||d+c<1?("line"!=b&&alert(TXMSG("@table.alert")),d):("line"!=b&&(c>0?"row"==b?w.append(w.find("tr:eq(0)").clone()):w.find("tr").append("<td></td>"):"row"==b?w.find("tr:eq(0)").remove():w.find("tr").find("td:eq(0)").remove()),d+c)},getValidValue:function(b,c,d,e){var f="row"==b?Trex.Menu.Table.MAX_ROW:"col"==b?Trex.Menu.Table.MAX_COL:Trex.Menu.Table.MAX_LINE_WIDTH;if(isNaN(c))return d;if((c<=0||c>f)&&(c=c<=0?d:f,e&&(e.value=c),alert(Trex._I18N.g("number.alert","1",f.toString(),"1 이상 "+f+" 이하의 숫자만 입력 가능합니다."))),"line"!=b){w.empty();for(var g="row"==b?c:a.rowSize,h="row"==b?a.colSize:c,i=1;i<=g;i++){for(var j=$("<tr></tr>"),k=1;k<=h;k++)j.append("<td></td>");w.append(j)}}return c},validColor:function(a,b,c){var d=b.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return d===_NULL||b.length>8?c:(d[1].length,"#"+d[1].toLowerCase())}},C=function(){y.hide(),A.hide(),a.cellPallete&&a.cellPallete.hide(),a.linePallete&&a.linePallete.hide()};!function(){c.val(Trex.Menu.Table.DEFAULT_ROW),d.val(Trex.Menu.Table.DEFAULT_COL);for(var b=1;b<=Trex.Menu.Table.DEFAULT_ROW;b++){for(var h=$("<tr></tr>"),i=1;i<=Trex.Menu.Table.DEFAULT_COL;i++)h.append("<td></td>");w.append(h)}var j=a.config.bgcolor,k=parseInt(a.config.borderStyle.split(" ")[0]),l=a.config.borderStyle.split(" ")[2];a.cellColor=j,a.lineWidth=k,a.lineColor=l,a.lineStyle="solid",e.val(j),e.closest("dd").find("span").css("background",j),f.val(k),g.val(l),g.closest("dd").find("span").css("background",l),z.closest("span").find(".td_style").addClass("style"+Trex.Menu.Table.TABLE_STYLE)}(),function(){c.on("blur",function(b){this.value=a.rowSize=B.getValidValue("row",this.value,a.rowSize,this)}),c.on("keyup",function(b){""!=this.value&&(this.value=a.rowSize=B.getValidValue("row",this.value,a.rowSize,this))}),d.on("blur",function(){this.value=a.colSize=B.getValidValue("col",this.value,a.colSize,this)}),d.on("keyup",function(){""!=this.value&&(this.value=a.colSize=B.getValidValue("col",this.value,a.colSize,this))}),f.on("blur",function(){this.value=a.lineWidth=B.getValidValue("line",this.value,a.lineWidth,this)}),f.on("keyup",function(){""!=this.value&&(this.value=a.lineWidth=B.getValidValue("line",this.value,a.lineWidth,this))}),e.on("blur",function(){this.value=a.cellColor=B.validColor("cell",this.value,a.cellColor),s.css("background",this.value)}),g.on("blur",function(){this.value=a.lineColor=B.validColor("line",this.value,a.lineColor),t.css("background",this.value)}),h.on("click",function(){c.get(0).value=a.rowSize=B.calculate("row",1)}),i.on("click",function(){c.get(0).value=a.rowSize=B.calculate("row",-1)}),j.on("click",function(){d.get(0).value=a.colSize=B.calculate("col",1)}),k.on("click",function(){d.get(0).value=a.colSize=B.calculate("col",-1)}),l.on("click",function(){f.get(0).value=a.lineWidth=B.calculate("line",1)}),m.on("click",function(){f.get(0).value=a.lineWidth=B.calculate("line",-1)}),n.on("click",function(c){a.onSelect(c,{type:b.find("input[type=radio]:checked").val(),row:a.rowSize,col:a.colSize,cellColor:a.cellColor,lineStyle:a.lineStyle,lineWidth:a.lineWidth,lineColor:a.lineColor,tableStyle:a.tableStyle}),C(),a.hidePopup()}),o.on("click",function(){C(),a.hidePopup()}),r.on("click",function(){"custom"==this.value?($(this).next().removeClass("s_disabled"),r.eq(1).next().addClass("s_disabled"),b.find(".custom_block").hide(),b.find(".style_block").show()):($(this).next().removeClass("s_disabled"),r.eq(0).next().addClass("s_disabled"),b.find(".custom_block").show(),b.find(".style_block").hide()),C()}),x.on("click",function(){return a.cellPallete&&a.cellPallete.hide(),a.linePallete&&a.linePallete.hide(),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.ltie8&&"true"!=$(y).data("ltie8")&&($(y).data("dd",$(this).closest("dd")),$(".cell_prop",b).append(y),y.css("top","128px"),y.css("right","10px"),$(y).data("ltie8","true")),$tx.show(y.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(y.get(0))),!1}),x.closest("span").on("click",function(){x.click()}),y.find("li").on("click",function(b){var c=null;c=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_line:eq(0)"):$(this).closest("dd").find(".g_line:eq(0)");var d=$(this).attr("class"),e=$(this).data("style");c.find(".line_style").hasClass(d)||(c.find(".line_style").remove(),c.prepend('<span class="line_style '+d+'"></span>')),a.lineStyle=e,x.click(),b.preventDefault()}),p.on("click",function(){return a.cellPallete==_NULL&&($tx.ltie8&&($(".cell_prop",b).append(u),$(u).css("top","200px"),$(u).css("right","10px")),a.cellPallete=a.createColorPallete(u.get(0),function(b){b=b.toLowerCase(),a.cellColor=b,e.val(b),s.css("background",b)},!1)),
$tx.hide(y.get(0)),a.linePallete&&a.linePallete.hide(),a.cellPallete.toggle(),a.cellPallete.remainColor(e.val()),!1}),q.on("click",function(){return a.linePallete==_NULL&&($tx.ltie8&&($(".cell_prop",b).append(v),$(v).css("top","175px"),$(v).css("right","10px")),a.linePallete=a.createColorPallete(v.get(0),function(b){b=b.toLowerCase(),a.lineColor=b,g.val(b),t.css("background",b)},!1)),$tx.hide(y.get(0)),a.cellPallete&&a.cellPallete.hide(),a.linePallete.toggle(),a.linePallete.remainColor(g.val()),!1}),z.on("click",function(){return $(this).hasClass("btn_down_arrow2")?($(this).removeClass("btn_down_arrow2").addClass("btn_up_arrow2"),$tx.ltie8&&"true"!=$(A).data("ltie8")&&($(A).data("dd",$(this).closest("dd")),$(".cell_prop",b).append(A),A.css("bottom","50px"),$(A).data("ltie8","true")),A.show()):($(this).removeClass("btn_up_arrow2").addClass("btn_down_arrow2"),A.hide()),!1}),z.closest("span").on("click",function(){z.click()}),A.find("span").on("click",function(){var b=null;b=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_style:eq(0)"):$(this).closest("dd").find(".g_style:eq(0)");var c=$(this).text(),d=$(this).data("style");b.find(".td_style").hasClass(c)||(b.find(".td_style").remove(),b.prepend('<span class="td_style '+c+'"></span>')),a.tableStyle=d,z.click()})}()},createColorPallete:function(a,b,c,d,e){var f=new Trex.Menu.ColorPallete({el:a,thumbs:Trex.__CONFIG_COMMON.thumbs,colorInputHidden:c});return f.setCommand(b),f},generateTextSizer:function(a){var b=this;Trex.MarkupTemplate.get("menu.table.direct").evaluateToDom({},a);var c={calculate:function(a,b,c){return a=parseInt(a),a+c>b||a+c<1?(alert(TXMSG("@table.alert")),a):a+c},getValidValue:function(a,b,c){return a<=0||a>c?(alert(TXMSG("@table.alert")),b):a}},d=$tom.collect(a,"div.tx-col-field input");$tx.observe(d,"blur",function(){d.value=b.colSize=c.getValidValue(d.value,b.colSize,Trex.Menu.Table.MAX_COL)}),$tx.observe($tom.collect(a,"div.tx-col-field a.tx-btn-add"),"click",function(a){return d.value=b.colSize=c.calculate(b.colSize,Trex.Menu.Table.MAX_COL,1),$tx.stop(a),_FALSE}),$tx.observe($tom.collect(a,"div.tx-col-field a.tx-btn-sub"),"click",function(a){return d.value=b.colSize=c.calculate(b.colSize,Trex.Menu.Table.MAX_COL,-1),$tx.stop(a),_FALSE});var e=$tom.collect(a,"div.tx-row-field input");$tx.observe(e,"blur",function(){e.value=b.rowSize=c.getValidValue(e.value,b.rowSize,Trex.Menu.Table.MAX_ROW)}),$tx.observe($tom.collect(a,"div.tx-row-field a.tx-btn-add"),"click",function(a){return e.value=b.rowSize=c.calculate(b.rowSize,Trex.Menu.Table.MAX_ROW,1),$tx.stop(a),_FALSE}),$tx.observe($tom.collect(a,"div.tx-row-field a.tx-btn-sub"),"click",function(a){return e.value=b.rowSize=c.calculate(b.rowSize,Trex.Menu.Table.MAX_ROW,-1),$tx.stop(a),_FALSE})},generateButtonArea:function(a){var b=this,c=tx.div(),d=tx.a({href:"javascript:;",className:Trex._I18N.g("tx-btn-confirm","tx-btn-confirm")},Trex._I18N.g("tx-btn-confirm_txt","확인")),e=tx.a({href:"javascript:;",className:Trex._I18N.g("tx-btn-cancel","tx-btn-cancel")},Trex._I18N.g("tx-btn-cancel_txt","취소"));$tx.observe(d,"click",function(a){b.onSelect(a,{row:b.rowSize,col:b.colSize})}),$tx.observe(e,"click",function(a){return $tx.stop(a),this.onCancel(),_FALSE}.bindAsEventListener(this)),c.appendChild(d),c.appendChild(e),a.appendChild(c)}}),function(){TrexMessage.addMsg({"@emoticon.subtitle.person":Trex._I18N.g("emoticon.subtitle.person","사람"),"@emoticon.subtitle.animal":Trex._I18N.g("emoticon.subtitle.animal","동식물"),"@emoticon.subtitle.thing":Trex._I18N.g("emoticon.subtitle.thing","사물"),"@emoticon.subtitle.etc":Trex._I18N.g("emoticon.subtitle.etc","기타")});var a=function(a,c){for(var d=[],e=1;e<=c;e++)d.push("#decopath/emoticon/"+a+"_"+b(e)+".gif?open&v=2");return d},b=function(a){return a<10?"0"+a:String(a)};TrexConfig.addTool("emoticon",{sync:_FALSE,status:_TRUE,rows:5,cols:7,matrices:[{title:TXMSG("@emoticon.subtitle.person"),klass:"tx-menu-matrix-per",options:a("per",29)},{title:TXMSG("@emoticon.subtitle.animal"),klass:"tx-menu-matrix-ani",options:a("ani",28)},{title:TXMSG("@emoticon.subtitle.thing"),klass:"tx-menu-matrix-things",options:a("things",35),defaultshow:_TRUE},{title:TXMSG("@emoticon.subtitle.etc"),klass:"tx-menu-matrix-etc",options:a("etc",29)}],asyncUrl:"trex/tool/async/emoticon"+(Trex._JS_MIN?".min":"")+".js"},function(a){TrexConfig.getTool("emoticon",a).matrices.each(function(a){for(var b=0,c=a.options.length;b<c;b++)a.options[b]=TrexConfig.getDecoPath(a.options[b])})}),Trex.Tool.Emoticon=Trex.Class.create({$const:{__Identity:"emoticon"},$extend:Trex.AsyncTool,oninitialized:function(){this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,this.onLoadModule)}})}(),TrexConfig.addTool("redo",{sync:_FALSE,status:_FALSE}),Trex.Tool.ReDo=Trex.Class.create({$const:{__Identity:"redo"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=function(){a.getProcessor().blur(),setTimeout(function(){a.fireJobs("canvas.panel.redo")},0)};this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,b),this.bindKeyboard({ctrlKey:_TRUE,keyCode:89},function(){a.fireJobs("canvas.panel.redo"),a.triggerQueryStatus()})}}),TrexConfig.addTool("undo",{sync:_FALSE,status:_FALSE}),Trex.Tool.UnDo=Trex.Class.create({$const:{__Identity:"undo"},$extend:Trex.Tool,oninitialized:function(){var a=this.canvas,b=function(){a.getProcessor().blur(),setTimeout(function(){a.fireJobs("canvas.panel.undo")},20)};this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,b),this.bindKeyboard({ctrlKey:_TRUE,keyCode:90},function(){a.fireJobs("canvas.panel.undo"),a.triggerQueryStatus()})}}),TrexConfig.addTool("removeformat",{wysiwygonly:_TRUE,sync:_TRUE,status:_FALSE,hotKey:{ctrlKey:_TRUE,shiftKey:_TRUE,keyCode:88}}),Trex.I.FontToolForRemoveformat=Trex.Mixin.create({oninitialized:function(a){this.bindKeyboard(a.hotKey,this.handler.bind(this))},computeNewStyle:function(){return _NULL},rangeExecutor:function(a){a.execCommand(this.getQueryCommandName())}}),Trex.Tool.Removeformat=Trex.Class.create({$const:{__Identity:"removeformat"},$extend:Trex.Tool,$mixins:[Trex.I.FontTool,Trex.I.FontToolForRemoveformat],getQueryCommandName:function(){return"removeformat"},isStyleApplied:function(a){return!1}}),Trex.module("initialize removeformat without toolbar button",function(a,b,c,d){if(!$tx("tx_removeformat")){var e=TrexConfig.getTool("removeformat"),f=_DOC.createElement("div");f.id="tx_removeformat",_DOC.body.appendChild(f),new Trex.Tool.Removeformat(a,b,e)}}),TrexConfig.addTool("horizontalrule",{wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,top:_NULL,left:_NULL,options:[{data:"tx-hr-border-1",image:"#iconpath/horizontalrule/line01.gif?open&v=2",html:'<hr style="display:block; border: black 0 none; border-top: black 1px solid; height: 1px"/>'},{data:"tx-hr-border-2",image:"#iconpath/horizontalrule/line02.gif?open&v=2",html:'<hr style="display:block; border: black 0 none; border-top: black 1px solid; border-bottom: black 3px solid; height: 7px"/>'},{data:"tx-hr-border-3",image:"#iconpath/horizontalrule/line04.gif?open&v=2",html:'<hr style="display:block; border: black 0 none; border-top: black 1px dotted; height: 1px"/>'}]},function(a){TrexConfig.getTool("horizontalrule",a).options.each(function(a){a.image=TrexConfig.getIconPath(a.image),a.html&&(a.html=TrexConfig.getDecoPath(a.html))})}),Trex.Tool.HorizontalRule=Trex.Class.create({$const:{__Identity:"horizontalrule"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c={};a.options.each(function(a){c[a.data]={html:a.html}});var d=function(a){if(c[a]){var d=c[a];b.isWYSIWYG()?b.execute(function(a){var b=a.pasteContent(d.html,_TRUE);$tom.isTagName(b.parentNode,"p")&&$tom.unwrap(b.parentNode)}):b.execute(function(a){a.insertTag("",d.html)})}};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.List(this.menuCfg),d)}}),function(){TrexMessage.addMsg({"@specialchar.subtitle1":Trex._I18N.g("specialchar.subtitle1","일반기호"),"@specialchar.subtitle2":Trex._I18N.g("specialchar.subtitle2","수학부호, 통화단위"),"@specialchar.subtitle3":Trex._I18N.g("specialchar.subtitle3","원 기호, 괄호"),"@specialchar.subtitle4":Trex._I18N.g("specialchar.subtitle4","일본어"),"@specialchar.subtitle5":Trex._I18N.g("specialchar.subtitle5","로마자, 그리스")}),TrexConfig.addTool("specialchar",{sync:_FALSE,status:_TRUE,rows:9,cols:20,top:_NULL,left:-312,matrices:[{title:TXMSG("@specialchar.subtitle1"),options:["＃","＆","＊","＠","§","※","☆","★","○","●","◎","◇","◆","□","■","△","▲","▽","▼","→","←","↑","↓","↔","〓","◁","◀","▷","▶","♤","♠","♡","♥","♧","♣","⊙","◈","▣","◐","◑","▒","▤","▥","▨","▧","▦","▩","♨","☏","☎","☜","☞","¶","†","‡","↕","↗","↙","↖","↘","♭","♩","♪","♬","㉿","㈜","№","㏇","™","㏂","㏘","℡","®","ª","º","＂","（","）","［","］","｛","｝","‘","’","“","”","〔","〕","〈","〉","《","》","「","」","『","』","【","】","！","＇","，","．","／","：","；","？","＾","＿","｀","｜","￣","、","。","·","‥","…","¨","〃","―","∥","＼","∼","´","～","ˇ","˘","˝","˚","˙","¸","˛","¡","¿","ː"]},{title:TXMSG("@specialchar.subtitle2"),options:["＋","－","＜","＝","＞","±","×","÷","≠","≤","≥","∞","∴","♂","♀","∠","⊥","⌒","∂","∇","≡","≒","≪","≫","√","∽","∝","∵","∫","∬","∈","∋","⊆","⊇","⊂","⊃","∪","∩","∧","∨","￢","⇒","⇔","∀","∃","∮","∑","∏","＄","％","￦","Ｆ","′","″","℃","Å","￠","￡","￥","¤","℉","‰","?","㎕","㎖","㎗","ℓ","㎘","㏄","㎣","㎤","㎥","㎥","㎦","㎙","㎚","㎛","㎜","㎝","㎞","㎟","㎠","㎡","㎢","㏊","㎍","㎎","㎏","㏏","㎈","㎉","㏈","㎧","㎨","㎰","㎱","㎲","㎳","㎴","㎵","㎶","㎷","㎸","㎹","㎀","㎁","㎂","㎃","㎄","㎺","㎻","㎼","㎽","㎾","㎿","㎐","㎑","㎒","㎓","㎔","Ω","㏀","㏁","㎊","㎋","㎌","㏖","㏅","㎭","㎮","㎯","㏛","㎩","㎪","㎫","㎬","㏝","㏐","㏓","㏃","㏉","㏜","㏆"]},{title:TXMSG("@specialchar.subtitle3"),options:["㉠","㉡","㉢","㉣","㉤","㉥","㉦","㉧","㉨","㉩","㉪","㉫","㉬","㉭","㉮","㉯","㉰","㉱","㉲","㉳","㉴","㉵","㉶","㉷","㉸","㉹","㉺","㉻","㈀","㈁","㈂","㈃","㈄","㈅","㈆","㈇","㈈","㈉","㈊","㈋","㈌","㈍","㈎","㈏","㈐","㈑","㈒","㈓","㈔","㈕","㈖","㈗","㈘","㈙","㈚","㈛","ⓐ","ⓑ","ⓒ","ⓓ","ⓔ","ⓕ","ⓖ","ⓗ","ⓘ","ⓙ","ⓚ","ⓛ","ⓜ","ⓝ","ⓞ","ⓟ","ⓠ","ⓡ","ⓢ","ⓣ","ⓤ","ⓥ","ⓦ","ⓧ","ⓨ","ⓩ","①","②","③","④","⑤","⑥","⑦","⑧","⑨","⑩","⑪","⑫","⑬","⑭","⑮","⒜","⒝","⒞","⒟","⒠","⒡","⒢","⒣","⒤","⒥","⒦","⒧","⒨","⒩","⒪","⒫","⒬","⒭","⒮","⒯","⒰","⒱","⒲","⒳","⒴","⒵","⑴","⑵","⑶","⑷","⑸","⑹","⑺","⑻","⑼","⑽","⑾","⑿","⒀","⒁","⒂"]},{title:TXMSG("@specialchar.subtitle5"),options:["０","１","２","３","４","５","６","７","８","９","ⅰ","ⅱ","ⅲ","ⅳ","ⅴ","ⅵ","ⅶ","ⅷ","ⅸ","ⅹ","Ⅰ","Ⅱ","Ⅲ","Ⅳ","Ⅴ","Ⅵ","Ⅶ","Ⅷ","Ⅸ","Ⅹ","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω","α","β","γ","δ","ε","ζ","η","θ","ικ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"]}],asyncUrl:"trex/tool/async/specialchar"+(Trex._JS_MIN?".min":"")+".js"}),Trex.Tool.SpecialChar=Trex.Class.create({$const:{__Identity:"specialchar"},$extend:Trex.AsyncTool,oninitialized:function(a){this.config=a,this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,this.onLoadModule)}})}(),TrexConfig.addTool("dictionary",{url:"http://engdic.daum.net/dicen/small_view_top.do",sync:_FALSE,status:_FALSE}),Trex.Tool.Dictionary=Trex.Class.create({$const:{__Identity:"dictionary"},$extend:Trex.Tool,oninitialized:function(a){var b=this.canvas,c=function(){var c=b.query(function(a){return encodeURI(a.getText())}),d=c.length>0?"http://engdic.daum.net/dicen/small_search.do":a.url;_WIN.open(d+"?q="+c,"dicWin","width=410,height=550,scrollbars=yes").focus()};this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,c)}}),function(){TrexConfig.addTool("background",{wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,needRevert:!0,thumbs:Trex.__CONFIG_COMMON.thumbs});var a;Trex.Tool.Background=Trex.Class.create({$const:{__Identity:"background"},$extend:Trex.Tool,oninitialized:function(){this.weave(new Trex.Button(this.buttonCfg),new Trex.Menu.ColorPallete(this.menuCfg),this.handler)},handler:function(b){var c=this,d=c.canvas;d.fireJobs("canvas.apply.backgroundcolor",b),d.history.saveHistory({backgroundColor:a,backgroundImage:d.getStyle("backgroundImage")},{backgroundColor:b,backgroundImage:d.getStyle("backgroundImage")},function(a){c._restoreColor(a)}),null===b?(d.addStyle({backgroundColor:d.getConfig().styles?d.getConfig().styles.backgroundColor||"":"",backgroundImage:d.getConfig().styles?d.getConfig().styles.backgroundImage||"":""}),a="",d.getConfig().hasUserBgcolor=_FALSE):(d.addStyle({backgroundColor:b,backgroundImage:""}),a=b,d.getConfig().hasUserBgcolor=_TRUE)},_restoreColor:function(b){var c=this.canvas;c.addStyle({backgroundColor:b.backgroundColor}),b.backgroundImage&&c.addStyle({backgroundImage:b.backgroundImage}),a=b.backgroundColor}}),Trex.install("canvas.getBgColor & canvas.setBgColor & editor.getContentWithBg",function(b,c,d,e,f){a=f.canvas.styles.backgroundColor,e.getBgColor=function(){var b=a||e.getPanel("html").getStyle("backgroundColor");return b?Trex.Color.getHexColor(b):""},e.setBgColor=function(a){e.getPanel("html").addStyle({backgroundColor:a||"transparent"})},b.getContentWithBg=function(){var a=e.getBgColor().toLowerCase();return"transparent"==a?b.getContent():['<table class="txc-wrapper" border="0" cellspacing="0" cellpadding="0"><tr>','<td bgcolor="',a,'">',b.getContent(),"</td>","</tr></table>"].join("")};var g=e.initContent.bind(e);e.initContent=function(a){if(a.search(/<table[^>]*txc-wrapper[^>]*>/i)>-1){var b;a=a.replace(/<table[^>]*txc-wrapper[^>]*><tr><td([^>]*)>([\s\S]*?)<\/td><\/tr><\/table>/i,function(a,c,d){return b=c.replace(/\sbgcolor="([#\w]*)"/,"$1"),d}),e.setBgColor(b)}g(a)},e.history.initHistory({backgroundColor:f.canvas.styles.backgroundColor,backgroundImage:f.canvas.styles.backgroundImage||"none"}),e.reserveJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var a=e.config.articleBackgroundColor;a&&"transparent"!=a&&e.addStyle({backgroundColor:a,backgroundImage:""})}),e.observeJob("canvas.apply.letterpaper",function(a){a.id&&e.getPanel("html").addStyle({backgroundColor:"transparent"})})})}(),TrexConfig.addTool("advanced",{sync:_FALSE,status:_TRUE,opened:_FALSE}),Trex.Tool.Advanced=Trex.Class.create({$const:{__Identity:"advanced"},$extend:Trex.Tool,oninitialized:function(a){var b=this,c=this.toolbar,d=c.el;b.opened=_FALSE;var e=$tom.collect(d.parentNode,"div.tx-toolbar-advanced");if(e){c.observeJob(Trex.Ev.__CMD_ADVANCED_FOLD,function(){$tx.hide(e),$tx.removeClassName(d,"tx-toolbar-basic-open")}),c.observeJob(Trex.Ev.__CMD_ADVANCED_SPREAD,function(){$tx.show(e),$tx.addClassName(d,"tx-toolbar-basic-open")});var f=function(){b.opened?c.fireJobs(Trex.Ev.__CMD_ADVANCED_FOLD):c.fireJobs(Trex.Ev.__CMD_ADVANCED_SPREAD),b.opened=!b.opened};this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,f),a.opened==_TRUE&&this.forceOpen()}},forceOpen:function(){this.button.pushedState(),this.toolbar.fireJobs(Trex.Ev.__CMD_ADVANCED_SPREAD),this.opened=_TRUE}}),Trex.module("add drop-down menu button if extra buttons exist.",function(a,b,c,d){d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var c=$tom.collectAll(a.getWrapper(),"li.tx-list-extra div.tx-extra");0!=c.length&&c.each(function(a){var c=$tom.next(a,".tx-extra-menu");c&&b.makeWidget(new Trex.Button({el:a,sync:_FALSE,status:_TRUE}),new Trex.Menu({el:c}),function(){})})})}),function(){TrexConfig.addTool("fullscreen",{wysiwygonly:_FALSE,status:_FALSE,switched:_FALSE,minHeight:200,minWidth:766,asyncUrl:"trex/tool/async/fullscreen"+(Trex._JS_MIN?".min":"")+".js"}),Trex.Tool.FullScreen=Trex.Class.create({$const:{__Identity:"fullscreen"},$extend:Trex.AsyncTool,oninitialized:function(a){this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,this.onLoadModule)}})}(),TrexConfig.addTool("image",{disabledonmobile:_TRUE,wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE}),TrexMessage.addMsg({"@image.title":Trex._I18N.g("image.title","사진"),"@image.layer.title":Trex._I18N.g("image_popup_title","이미지 첨부"),"@image.cancel.image":Trex._I18N.g("btn_cancel","#iconpath/btn_cancel.gif?open&v=2"),"@image.confirm.image":Trex._I18N.g("btn_confirm","#iconpath/btn_confirm.gif?open&v=2")}),Trex.Tool.Image=Trex.Class.create({$const:{__Identity:"image"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor,b=function(b){a.getSidebar().getAttacher("image").execAttach(b)};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.Image(this.menuCfg),b,null)}}),Trex.MarkupTemplate.add("menu.insertimage",['<div class="tx-menu-inner">','    <div style="position:absolute;top:-2000px;left:-2000px;width:10px;height:10px;overflow:hidden;"><canvas class="tmp_canvas" width="1" height="1"></canvas></div>',"    <dl>","        <dt>","            @image.layer.title","        </dt>","        <dd>","           <label>"+Trex._I18N.g("image.image","이미지")+'</label><iframe id="imageUpload" src="" frameborder="0" style="width:270px;height:24px;vertical-align:middle;"></iframe></li>',"        </dd>",'        <dd class="prev_image singlefile" style="text-align:left;border:1px solid #e0e0e0;margin-top:10px;padding:5px;overflow:hidden;"><img class="prev_img" src="" style="max-width:90%;max-height:100px;"><div style="position:absolute;top:-2000px;left:-2000px;width:10px;height:10px;overflow:hidden;"><img src="" class="tmp_img"></div></dd>','\t\t <dd class="imageInfo singlefile imageAlign"><label>'+Trex._I18N.g("image.width","너비")+'</label><span class="g_select"><input type="text" name="txt_img_width" class="txt txt_sel txt_img_width" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_width_up">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_width_down">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span>",'\t\t <label class="inner">'+Trex._I18N.g("image.height","높이")+'</label><span class="g_select"><input type="text" name="txt_img_height" class="txt txt_sel txt_img_height" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_height_up">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_height_down">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span>",'\t\t    <label class="etc" style="margin-right:5px!important;float:right;line-height:25px;"><input type="checkbox" name="ratio" class="chk_img_ratio" style="vertical-align:middle;">'+Trex._I18N.g("image.ratio","비율유지")+"</label>","       </dd>",'\t\t <dd class="imageInfo singlefile" style="text-align:right;">','           <button type="button" name="btn_reset" class="btn btn_ok custom btn_reset" style="margin-right:5px;min-width:63px;">'+Trex._I18N.g("image.origin_size","원본크기")+"</button>","        </dd>",'\t\t<dd class="imageInfo singlefile line t_l">',"           <label>"+Trex._I18N.g("table.detail.border_style","테두리 스타일")+'</label><span class="g_line"><span class="line_style line1"></span><button type="button" name="btn_border_style" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t<ul class="line_style_option" style="display:none;">','\t\t\t#{for:line}<li class="#{class}" data-style="#{style}"><a href="javascript:;"></a></li>#{/for:line}',"\t\t\t</ul>",'           <label class="inner">'+Trex._I18N.g("table.detail.border_line","테두리 두께")+'</label><span class="g_select"><input type="text" name="txt_border_line" class="txt txt_sel" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_border_up">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_border_down">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span>","\t\t</dd>",'\t\t<dd class="imageInfo singlefile line">',"           <label>"+Trex._I18N.g("table.detail.border_color","테두리 색")+'</label><input type="text" name="txt_border_color" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t</dd>",'\t\t<dd class="imageInfo singlefile quality t_l">','           <label><input type="checkbox" name="quality" class="img_jpeg_quality"><span>'+Trex._I18N.g("image.jpeg_quality","JPEG 품질")+"</span></label>",'           <span class="ijqp_wrap" style="display:none;">: <input type="text" name="quality_p" class="img_jpeg_quality_percent" size=3 value="70"><span>%</span></span>','\t\t\t<span class="image_size_wrap">'+Trex._I18N.g("image.size","Size")+':<span class="image_size">-</span></span>',"\t\t</dd>",'\t\t<dd class="imageInfo multifile" style="display:none;">','\t\t\t<span class="desc">'+Trex._I18N.g("image.multifile.desc",'2개 이상의 이미지 선택 시 옵션 선택이 불가능 합니다.<br>본문 삽입 후 "이미지 선택 > 우 클릭"에서 개별 적용하여 주세요')+"</span>","\t\t</dd>",'        <dd class="tx-hr">',"            <hr/>","        </dd>",'        <dd class="tx-btn">','            <img width="32" height="21" src="@image.confirm.image"/>','            <img width="32" height="21" src="@image.cancel.image"/>',"        </dd>","    </dl>","</div>"].join("")),Trex.ACTIONS={},Trex.Menu.Image=Trex.Class.create({$extend:Trex.Menu,ongenerated:function(){function a(){i._prevInfo={width:this.width,height:this.height},f()}function b(){}function c(){if(i.canvas&&i._prevInfo){if(!i.elJpegQ.checked)return void d(i._origin.size);i.img_size.innerHTML="-";var a=i._img_tmp,b=a.width,c=a.height,e=i.ctx,f=i.canvas;f.width=b,f.height=c,e.clearRect(0,0,b,c),e.drawImage(a,0,0,b,c);var g=(i.elJpegQP.value||70)/100,h=f.toDataURL("image/jpeg",g);e.clearRect(0,0,b,c),f.width=1,f.height=1,e.restore(),d(.75*h.split(",")[1].length),h="",h=null}}function d(a){var b=i._keditor.config.imageLimitSize||0;i.applyImageSize=a,i.img_size.innerHTML=Trex._getDisplayFileSize(a),$(i.img_size)[0==b||b>a?"removeClass":"addClass"]("limit")}function e(a,b){var d=i.elImgRatio.checked,e=parseInt(a,0),f=parseInt(b,0);e=isNaN(e)?"":e,f=isNaN(f)?"":f,d&&i._prevInfo?(i._img_tmp.removeAttribute("width"),i._img_tmp.removeAttribute("height"),i._img_tmp.style.width="",i._img_tmp.style.height="",null!=a&&(i._img_tmp.style.width=parseInt(a,10)+"px",i._img_tmp.width=a),null!=b&&(i._img_tmp.style.height=parseInt(b,10)+"px",i._img_tmp.height=b),e=i._img_tmp.width,f=i._img_tmp.height):(null==a&&(e=null),null==b&&(f=null)),null!=e&&(i.elImgWidth.value=e),null!=f&&(i.elImgHeight.value=f),e=i.elImgWidth.value,f=i.elImgHeight.value,i._img&&i._prevInfo&&(d?i._img.removeAttribute("width"):i._img.width=e,i._img.height=f),c()}function f(){i._img&&i._prevInfo&&(i._img.style.border=i._getBorderStyle())}var g=this.elMenu;Trex.MarkupTemplate.get("menu.insertimage").evaluateToDom({line:[{class:"line1",style:"solid"},{class:"line2",style:"dotted"},{class:"line3",style:"double"}]},g),this.elIframe=$tom.collect(g,"iframe");var h=$tom.collectAll(g,".tx-btn img");this.elImgWidth=$tom.collect(g,".txt_img_width"),this.elImgHeight=$tom.collect(g,".txt_img_height"),this.elImgRatio=$tom.collect(g,".chk_img_ratio"),this.elReset=$tom.collect(g,".btn_reset"),this.canvas=$tom.collect(g,".tmp_canvas"),this.img_size=$tom.collect(g,".image_size"),this.elJpegQ=$tom.collect(g,".img_jpeg_quality"),this.elJpegQP=$tom.collect(g,".img_jpeg_quality_percent"),this.elJpegQWrap=$tom.collect(g,".ijqp_wrap"),this._elSingleFile=$tom.collectAll(g,".singlefile"),this._elMultiFile=$tom.collectAll(g,".multifile"),this.JPEG_Q_MIN=50,this.JPEG_Q_MAX=100;try{this.canvas.toDataURL("image/jpeg",0),this.ctx=this.canvas.getContext("2d"),this.ctx.save()}catch(a){this.canvas=null,this.ctx=null}null!=this.canvas&&(window.atob||window.Blob)||(this.canvas=null,this.ctx=null,$tom.collect(g,".quality").style.display="none");var i=this;this._origin=null,this._prevInfo=null,this._img_tmp=$tom.collect(g,".tmp_img"),this._img=$tom.collect(g,".prev_img"),this._img_dd=$tom.collect(g,".prev_image"),this._img.onload=a,this._img.onerror=b,this.insertCanvasImg=function(){var a={};a.imagealign="L";var b=i._img_tmp,c=b.width,d=b.height,e=i.ctx,f=i.canvas;f.width=c,f.height=d,e.clearRect(0,0,c,d),e.drawImage(b,0,0,c,d);var g=(i.elJpegQP.value||70)/100;a.width=i.elImgWidth.value,a.height=i.elImgHeight.value,a.style||(a.style={}),a.style.border=i._getBorderStyle();var g=(i.elJpegQP.value||70)/100;if(a.imageurl=i.canvas.toDataURL("image/jpeg",g),a.filesize=i.applyImageSize.toString(),a.filename="image_"+(new Date).getTime().toString(16)+".jpg",e.clearRect(0,0,c,d),f.width=1,f.height=1,e.restore(),i._range)try{i._range.deleteContents()}catch(a){}i.onSelect(null,a),i.clearLayer()},Trex.ACTIONS["image.action."+this.config.initializedId]=function(a){if(a.imagealign="L",a.width=i.elImgWidth.value,a.height=i.elImgHeight.value,a.style||(a.style={}),a.style.border=i._getBorderStyle(),i._range)try{i._range.deleteContents()}catch(a){}i.onSelect(null,a),i.clearLayer()},Trex.ACTIONS["image.action."+this.config.initializedId+".setImage"]=function(a){i._img.src=a,i._img_tmp.src=a,i.imgFiles=null,i._showMultiFile(!1)},Trex.ACTIONS["image.action."+this.config.initializedId+".setImages"]=function(a){i._showMultiFile(!0),i.imgFiles=a},Trex.ACTIONS["image.action."+this.config.initializedId+".imageinfo"]=function(a){i._origin=a;var b=i._origin||{};i.elImgWidth.value=b.width||"",i.elImgHeight.value=b.height||"",i.elImgRatio.checked=!0,i.elJpegQ.checked=!1,d(a.size)},$tx.observe(this.elJpegQ,"click",function(){i._prevInfo&&(this.checked?(i.elJpegQWrap.style.display="",c()):(i.elJpegQWrap.style.display="none",d(i._origin.size)))}),$tx.observe(this.elJpegQP,"keyup",function(){if(""!=this.value){var a=parseInt(this.value,10);isNaN(a)?this.value="":a>i.JPEG_Q_MAX?this.value=i.JPEG_Q_MAX:this.value=a,""==!this.value&&this.value>=i.JPEG_Q_MIN&&this.value<=i.JPEG_Q_MAX&&c()}}),$tx.observe(this.elJpegQP,"blur",function(){(""==this.value||this.value<i.JPEG_Q_MIN)&&(this.value=i.JPEG_Q_MIN,c())}),this.elImgWidth=$tom.collect(g,".txt_img_width"),this.elImgHeight=$tom.collect(g,".txt_img_height");var j=$tom.collect(g,".btn_width_up"),k=$tom.collect(g,".btn_width_down"),l=$tom.collect(g,".btn_height_up"),m=$tom.collect(g,".btn_height_down");$tx.observe(this.elImgWidth,"blur",function(){e(this.value,null)}),$tx.observe(this.elImgWidth,"keyup",function(){this.value=parseInt(this.value,10),e(this.value,null)}),$tx.observe(this.elImgRatio,"click",function(){this.checked&&i.elImgHeight.value&&e(null,i.elImgHeight.value)}),$tx.observe(this.elReset,"click",function(){i.elImgWidth.value=i._origin?i._origin.width:"",i.elImgHeight.value=i._origin?i._origin.height:"",e(null,null)}),$tx.observe(j,"click",function(){i.elImgWidth.value=(i.elImgWidth.value||0)-0+1,e(i.elImgWidth.value,null)}),$tx.observe(k,"click",function(){var a=(i.elImgWidth.value||0)-1;a=a<0?0:a,i.elImgWidth.value=a,e(i.elImgWidth.value,null)}),$tx.observe(this.elImgHeight,"blur",function(){e(null,this.value)}),$tx.observe(this.elImgHeight,"keyup",function(){e(null,this.value)}),$tx.observe(l,"click",function(){i.elImgHeight.value=(i.elImgHeight.value||0)-0+1,e(null,i.elImgHeight.value)}),$tx.observe(m,"click",function(){var a=(i.elImgHeight.value||0)-1;a=a<0?0:a,i.elImgHeight.value=a,e(null,i.elImgHeight.value)}),this.btn_border_style=$("button[name=btn_border_style]",g),this.border_list=$(".line_style_option",g),this.txt_border_line=$("input[name=txt_border_line]",g),this.btn_line_up=$(".btn_border_up",g),this.btn_line_dn=$(".btn_border_down",g),this.txt_border_color=$("input[name=txt_border_color]",g),this.btn_line_color=$(".btn_color",g),this.span_line_color=$(".btn_color span",g),this.line_color_pal=$(".tx-colorpallete",g),this.g_line=$(".line .g_line",g),this._line={},this._getBorderStyle=function(){var a=i._line;return a.color&&a.width&&a.style?a.width+"px "+a.style+" "+a.color:""},this._closeSubLayer=function(a){a!=i.btn_line_color&&i.linePallete_c&&i.linePallete_c.hide(),a!=i.btn_border_style&&($(i.btn_border_style).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(i.border_list.get(0)))};var n={calculate:function(a,b){var c="line"==a?i._line.width?i._line.width:0:"",d="line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"";return c=parseInt(c),isNaN(c)&&(c=1),c+b>d||c+b<0?("line"!=a&&"padding"!=a&&alert(TXMSG("@table.alert")),c):(c+=b,c<0&&(c=0),c.toString())},getValidValue:function(a,b,c,d){var e="row"==a?Trex.Menu.Table.MAX_ROW:"col"==a?Trex.Menu.Table.MAX_COL:"line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"padding"==a?Trex.Menu.Table.MAX_PADDING:"";return isNaN(b)?c:((b<0||b>e)&&(b=b>e?e:c,d&&(d.value=b),alert(Trex._I18N.g("number.alert","1",e.toString(),"1 이상 "+e+" 이하의 숫자만 입력 가능합니다."))),b)},validColor:function(a,b,c){var d=b.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return d===_NULL||b.length>8?c:(d[1].length,"#"+d[1].toLowerCase())}};this.btn_border_style.on("click",function(){return i._closeSubLayer(i.btn_border_style),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.show(i.border_list.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(i.border_list.get(0))),!1}),this.btn_border_style.closest("span").on("click",function(){i.btn_border_style.click()}),this.border_list.find("li").on("click",function(a){var b=$(i.g_line),c=$(this).attr("class"),d=$(this).data("style");b.find(".line_style").hasClass(c)||(b.find(".line_style").remove(),b.prepend('<span class="line_style '+c+'"></span>')),i._line.style=d,i.btn_border_style.click(),f(),a.preventDefault()}),this.setLineColor=function(){""==i._line.width||"0"==i._line.width||i._line.color?""==i._line.width||i._line.width:(i._line.color="#ccc",i.txt_border_color.val(i._line.color)),i._line.color?i.span_line_color.css("background",i._line.color):i.span_line_color.css("background","#dfeef9"),f()},this.setLineWidth=function(){""==i._line.color||i._line.width?""==i._line.color&&i._line.width:(i._line.width="1",i.txt_border_line.val(i._line.width)),f()},this.txt_border_line.on("blur",function(){this.value=i._line.width=n.getValidValue("line",this.value,"",this),i.setLineColor()}),this.txt_border_line.on("keyup",function(){this.value=i._line.width=n.getValidValue("line",this.value,"",this),i.setLineColor()}),this.btn_line_up.on("click",function(){i.txt_border_line.get(0).value=i._line.width=n.calculate("line",1),i.setLineColor()}),this.btn_line_dn.on("click",function(){i.txt_border_line.get(0).value=i._line.width=n.calculate("line",-1),i.setLineColor()}),this.txt_border_color.on("blur",function(){this.value=i._line.color=n.validColor("line",this.value,""),""==this.value?i.span_line_color.css("background","#dfeef9"):i.span_line_color.css("background",this.value),i.setLineWidth()}),this.btn_line_color.on("click",function(){return i._closeSubLayer(i.btn_line_color),i.linePallete_c==_NULL&&($tx.ltie8&&($(".tx-image-property",g).append(i.line_color_pal),$(i.line_color_pal).css("top","80px"),$(i.line_color_pal).css("right","10px")),i.linePallete_c=i.createColorPallete(i.line_color_pal.get(0),function(a){a=a.toLowerCase(),i._line.color=a,i.txt_border_color.val(a),""==a?i.span_line_color.css("background","#dfeef9"):i.span_line_color.css("background",a),i.setLineWidth()},!1)),$tx.hide(i.border_list.get(0)),i.cellPallete_c&&i.cellPallete_c.hide(),i.linePallete_c.toggle(),i.linePallete_c.remainColor(i.txt_border_color.val()),!1}),$tx.observe(h[0],"click",function(a){function b(a){var d=new FileReader;d.addEventListener("load",function(){i._command.apply(this,[{imagealign:"L",imageurl:d.result,filesize:a.size.toString(),filename:"image_"+(new Date).getTime().toString(16)+"_"+c+++".jpg"}]),i.imgFiles.length>0?b(i.imgFiles.shift()):(i.imgFiles=null,i.hide(),i.clearLayer())}),d.readAsDataURL(a)}if(null==i._origin&&null==i.imgFiles)return void alert(Trex._I18N.g("image.select_image","이미지를 선택해 주세요."));if(i.imgFiles){var c=0;if(i._range)try{i._range.deleteContents()}catch(a){}b(i.imgFiles.shift())}else{var d=i._keditor.config.imageLimitSize||0
;if(0!=d&&d<i.applyImageSize)return void(Trex.Image._SUPPORT_JPEG_QUALITY?alert(Trex._I18N.g("image.upload_limit_canvas",Trex._getDisplayFileSize(i.applyImageSize),Trex._getDisplayFileSize(d),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(d)+").\n이미지 첨부의 JPEG 품질 기능을 사용하여 이미지를 첨부해 주세요.")):alert(Trex._I18N.g("image.upload_limit",Trex._getDisplayFileSize(i.applyImageSize),Trex._getDisplayFileSize(d),"이미지 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(d)+").")));if(i.elJpegQ.checked)i.insertCanvasImg();else{i.elIframe.contentWindow.document.forms[0].submit()}}$tx.stop(a)}.bind(this)),$tx.observe(h[1],"click",function(){this.clearLayer(),this.onCancel()}.bindAsEventListener(this))},clearLayer:function(){this._img.src="",this._img.style.border="",this._img_tmp.src="",this._img_tmp.removeAttribute("width"),this._img_tmp.removeAttribute("height"),this._img_tmp.style.width="",this._img_tmp.style.height="";var a=this._keditor=KEditor.get(this.config.initializedId),b=("string"!=typeof a.config.imageUploadPath?a.config.imageUploadPath():a.config.imageUploadPath)+"&type=KEditorLayer&aid=image.action."+this.config.initializedId;this.elIframe.src=b,this.elImgWidth.value="",this.elImgHeight.value="",this.elImgRatio.checked=!1,this._origin=null,this._prevInfo=null,this._img_dd.style.textAlign="left",this._line={color:"",width:"",style:"solid"},this.txt_border_color.val(this._line.color),this.span_line_color.css("background","#dfeef9"),this.txt_border_line.val(this._line.width),this.elJpegQ.checked=!1,this.elJpegQP.value="70",this.elJpegQWrap.style.display="none",this.img_size.innerHTML="-",$($("li",this.border_list)[0]).trigger("click"),this._closeSubLayer(null),this._clearLayer=!0,this.imgFiles=null,this._showMultiFile(!1)},_showMultiFile:function(a){for(var b=this,c=0;c<b._elSingleFile.length;c++)b._elSingleFile[c].style.display=a?"none":"";for(var c=0;c<b._elMultiFile.length;c++)b._elMultiFile[c].style.display=a?"":"none"},onregenerated:function(){this._clearLayer||this.clearLayer(),this._clearLayer=!1,this._origin=null,this._prevInfo=null,this._range=this._keditor.editor.canvas.getProcessor().getSelectionRange(this._keditor.editor.canvas)},createColorPallete:function(a,b,c,d,e){var f=new Trex.Menu.ColorPallete({el:a,thumbs:Trex.__CONFIG_COMMON.thumbs,colorInputHidden:c});return f.setCommand(b),f}}),TrexConfig.addAttacher("image",{multiple:_TRUE,multipleuse:_FALSE,checksize:_TRUE,boxonly:_FALSE,wysiwygonly:_TRUE,objattr:{},features:{left:350,top:165,width:474,height:150},popPageUrl:"#host#path/pages/trex/image.html?open"},function(a){var b=TrexConfig.getAttacher("image",a);b.popPageUrl=TrexConfig.getUrl(b.popPageUrl),b.features=TrexConfig.getPopFeatures(b.features)}),Trex.Attacher.Image=Trex.Class.create({$const:{__Identity:"image"},$extend:Trex.Attacher,name:"image",title:TXMSG("@image.title"),canModified:_FALSE,canResized:_TRUE,matchRegexStartTag:/<(\w+)/,oninitialized:function(){},getKey:function(a){return a.imageurl},getDataForEntry:function(a){a.imageurl=this.encodeSpaceInUrl(a.imageurl),a.originalurl=this.encodeSpaceInUrl(a.originalurl),a.attachurl=this.encodeSpaceInUrl(a.attachurl),a.thumburl=a.thumburl||a.imageurl.replace(/\/image\//gm,"/P150x100/"),a.dispElId||(a.dispElId=Trex.Util.getDispElId());var b=a.tmpSeq?this.entryBox.syncSeq(a.tmpSeq):this.entryBox.newSeq();return Object.extend({dataSeq:b},a)},createEntry:function(a,b){return this.createAttachment(a,b)},encodeSpaceInUrl:function(a){if(a)return a.replace(/ /g,"%20")},execAttach:function(a,b){this.createEntry(this.getDataForEntry(a),b).execRegister()},execReload:function(a,b,c){this.createEntry(this.getDataForEntry(a,b),c).execReload()}}),Trex.Attachment.Image=Trex.Class.create({$const:{__Identity:"image"},$extend:Trex.Attachment,getFieldAttr:function(a){return{name:"tx_attach_image",value:[a.thumburl,a.imageurl,a.originalurl,a.exifurl,a.filename,a.filesize].join("|")}},getBoxAttr:function(a){var b=a.width?a.width+"x"+a.height+" / ":"";return{name:a.filename+" ("+b+a.filesize.toByteUnit()+")",image:a.thumburl}},getObjectAttr:function(a){var b=Object.extend({},this.actor.config.objattr);return a.width?(!b.width||b.width>a.width)&&(b.width=a.width):b.width=_NULL,a.height?(!b.height||b.height>a.height)&&(b.height=a.height):b.height=_NULL,b},getObjectStyle:function(a){var b={};if(this.actor.config.objstyle&&(b=Object.extend(b,this.actor.config.objstyle)),a.imagealign){var c={L:Trex.Tool.AlignLeft,C:Trex.Tool.AlignCenter,FL:Trex.Tool.AlignRight,FR:Trex.Tool.AlignFull}[a.imagealign];c&&c.__ImageModeProps&&c.__ImageModeProps.image&&(b=Object.extend(b,c.__ImageModeProps.image.style))}return a.style&&a.style.border&&(b.border=a.style.border),b},getParaStyle:function(a){var b=Object.extend({},this.actor.config.parastyle||this.actor.config.defaultstyle);if(a.imagealign){var c={L:Trex.Tool.AlignLeft,C:Trex.Tool.AlignCenter,FL:Trex.Tool.AlignRight,FR:Trex.Tool.AlignFull}[a.imagealign];c&&c.__ImageModeProps&&c.__ImageModeProps.paragraph&&(b=Object.extend(b,c.__ImageModeProps.paragraph.style))}return b},getSaveHtml:function(a){return'<img src="'+a.imageurl+'" class="txc-image"/>'},getDispHtml:function(a){return'<img id="'+a.dispElId+'" src="'+a.imageurl+'" class="txc-image"/>'},getDispText:function(a){return'<img src="'+a.imageurl+'" class="txc-image"/>'},getRegLoad:function(a){return new RegExp('<(?:img|IMG)[^>]*src="?'+a.imageurl.getRegExp()+'"?[^>]*/?>',"gim")},getRegHtml:function(a){return new RegExp('<(?:img|IMG)[^>]*src="?'+a.imageurl.getRegExp()+'"?[^>]*/?>',"gim")},getRegText:function(a){return new RegExp('<(?:img|IMG)[^>]*src="?'+a.imageurl.getRegExp()+'"?[^>]*/?>',"gim")}}),TrexConfig.addTool("image_edit",{disabledonmobile:_TRUE,wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),TrexMessage.addMsg({"@image_editor.title":Trex._I18N.g("image_editor.title","이미지 편집")}),Trex.Tool.Image_edit=Trex.Class.create({$const:{__Identity:"image_edit"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){a.getSidebar().getAttacher("image_edit").execute("instance="+a.kEditor.instanceId)})}}),TrexConfig.addAttacher("image_edit",{multiple:_TRUE,multipleuse:_FALSE,checksize:_TRUE,boxonly:_FALSE,wysiwygonly:_TRUE,objattr:{},features:{left:10,top:10,width:1194,height:674},popPageUrl:"#imageeditorpath"},function(a){var b=TrexConfig.getAttacher("image_edit",a);b.popPageUrl=TrexConfig.getUrl(b.popPageUrl),b.features=TrexConfig.getPopFeatures(b.features)}),Trex.Attacher.Image_edit=Trex.Class.create({$const:{__Identity:"image_edit"},$extend:Trex.Attacher,name:"image_edit",title:TXMSG("@image_editor.title"),canModified:_FALSE,canResized:_TRUE,matchRegexStartTag:/<(\w+)/,oninitialized:function(){},getKey:function(a){return a.imageurl},getDataForEntry:function(a){a.imageurl=this.encodeSpaceInUrl(a.imageurl),a.originalurl=this.encodeSpaceInUrl(a.originalurl),a.attachurl=this.encodeSpaceInUrl(a.attachurl),a.thumburl=a.thumburl||a.imageurl.replace(/\/image\//gm,"/P150x100/"),a.dispElId||(a.dispElId=Trex.Util.getDispElId());var b=a.tmpSeq?this.entryBox.syncSeq(a.tmpSeq):this.entryBox.newSeq();return Object.extend({dataSeq:b},a)},createEntry:function(a,b){return this.createAttachment(a,b)},encodeSpaceInUrl:function(a){if(a)return a.replace(/ /g,"%20")},execAttach:function(a,b){this.createEntry(this.getDataForEntry(a),b).execRegister()},execReload:function(a,b,c){this.createEntry(this.getDataForEntry(a,b),c).execReload()}}),Trex.Attachment.Image_edit=Trex.Class.create({$const:{__Identity:"image_edit"},$extend:Trex.Attachment,getFieldAttr:function(a){return{name:"tx_attach_image",value:[a.thumburl,a.imageurl,a.originalurl,a.exifurl,a.filename,a.filesize].join("|")}},getBoxAttr:function(a){var b=a.width?a.width+"x"+a.height+" / ":"";return{name:a.filename+" ("+b+a.filesize.toByteUnit()+")",image:a.thumburl}},getObjectAttr:function(a){var b=Object.extend({},this.actor.config.objattr);return a.width?(!b.width||b.width>a.width)&&(b.width=a.width):b.width=_NULL,a.height?(!b.height||b.height>a.height)&&(b.height=a.height):b.height=_NULL,b},getObjectStyle:function(a){var b={};if(this.actor.config.objstyle&&(b=Object.extend(b,this.actor.config.objstyle)),a.imagealign){var c={L:Trex.Tool.AlignLeft,C:Trex.Tool.AlignCenter,FL:Trex.Tool.AlignRight,FR:Trex.Tool.AlignFull}[a.imagealign];c&&c.__ImageModeProps&&c.__ImageModeProps.image&&(b=Object.extend(b,c.__ImageModeProps.image.style))}return b},getParaStyle:function(a){var b=Object.extend({},this.actor.config.parastyle||this.actor.config.defaultstyle);if(a.imagealign){var c={L:Trex.Tool.AlignLeft,C:Trex.Tool.AlignCenter,FL:Trex.Tool.AlignRight,FR:Trex.Tool.AlignFull}[a.imagealign];c&&c.__ImageModeProps&&c.__ImageModeProps.paragraph&&(b=Object.extend(b,c.__ImageModeProps.paragraph.style))}return b},getSaveHtml:function(a){return'<img src="'+a.imageurl+'" class="txc-image"/>'},getDispHtml:function(a){return'<img id="'+a.dispElId+'" src="'+a.imageurl+'" class="txc-image"/>'},getDispText:function(a){return'<img src="'+a.imageurl+'" class="txc-image"/>'},getRegLoad:function(a){return new RegExp('<(?:img|IMG)[^>]*src="?'+a.imageurl.getRegExp()+'"?[^>]*/?>',"gim")},getRegHtml:function(a){return new RegExp('<(?:img|IMG)[^>]*src="?'+a.imageurl.getRegExp()+'"?[^>]*/?>',"gim")},getRegText:function(a){return new RegExp('<(?:img|IMG)[^>]*src="?'+a.imageurl.getRegExp()+'"?[^>]*/?>',"gim")}}),TrexConfig.addTool("file",{disabledonmobile:_TRUE,wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),TrexMessage.addMsg({"@file.title":Trex._I18N.g("file.title","파일")}),Trex.Tool.File=Trex.Class.create({$const:{__Identity:"file"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){a.getSidebar().getAttacher("file").execute()})}}),TrexConfig.addAttacher("file",{multiple:_TRUE,multipleuse:_FALSE,checksize:_TRUE,boxonly:_FALSE,wysiwygonly:_FALSE,features:{left:250,top:65,width:450,height:404},popPageUrl:"#host#path/pages/trex/file.html?open"},function(a){var b=TrexConfig.getAttacher("file",a);b.popPageUrl=TrexConfig.getUrl(b.popPageUrl),b.features=TrexConfig.getPopFeatures(b.features)}),Trex.Attacher.File=Trex.Class.create({$const:{__Identity:"file"},$extend:Trex.Attacher,name:"file",title:TXMSG("@file.title"),canModified:_TRUE,canResized:_FALSE,oninitialized:function(){},getKey:function(a){return a.key||a.attachurl},getDataForEntry:function(a){a.dispElId||(a.dispElId=Trex.Util.getDispElId());var b,c=a.tmpSeq?this.entryBox.syncSeq(a.tmpSeq):this.entryBox.newSeq(),d=a.filename.split(".").pop().toLowerCase();switch(d){case"jpg":case"gif":case"png":case"bmp":b=a.attachurl.replace("/attach/","/thumbnail/");break;default:b=Trex.Util.thumburl(d)}return Object.extend({dataSeq:c,thumburl:b,prevurl:Trex.Util.prevurl(a.filename.split(".").pop().toLowerCase())},a)}}),Trex.Attachment.File=Trex.Class.create({$const:{__Identity:"file"},$extend:Trex.Attachment,getFieldAttr:function(a){return{name:"tx_attach_file",value:[a.attachurl,a.filesize,a.filename].join("|")}},getBoxAttr:function(a){var b=a.filename;if(b.getRealLength()>56)if(/\./.test(b)){var c=b.split("."),d=c.pop().cutRealLength(52),e=c.join(".").cutRealLength(55-d.length);b=e+"."+d}else b=b.cutRealLength(56);return{name:b+" ("+a.filesize.toByteUnit()+")",image:a.thumburl}},getObjectStyle:function(a){var b={};if(this.actor.config.objstyle&&(b=Object.extend(b,this.actor.config.objstyle)),a.imagealign){var c={L:Trex.Tool.AlignLeft,C:Trex.Tool.AlignCenter,FL:Trex.Tool.AlignRight,FR:Trex.Tool.AlignFull}[a.imagealign];c&&c.__TextModeProps&&c.__TextModeProps.image&&(b=Object.extend(b,c.__TextModeProps.button.style))}return b},getParaStyle:function(a){var b=Object.extend({},this.actor.config.parastyle||this.actor.config.defaultstyle);if(a.imagealign){var c={L:Trex.Tool.AlignLeft,C:Trex.Tool.AlignCenter,FL:Trex.Tool.AlignFull,FR:Trex.Tool.AlignRight}[a.imagealign];c&&c.__TextModeProps&&c.__TextModeProps.paragraph&&(b=Object.extend(b,c.__TextModeProps.paragraph.style))}return b},getSaveHtml:function(a){return'<a href="'+a.attachurl+'"><img src="'+a.prevurl+'"/> '+a.filename+"</a>"},getDispHtml:function(a){return'<button type="button" id="'+a.dispElId+'" class="txc-file"><img class="tx-unresizable" src="'+a.prevurl+'" ld="'+a.attachurl+'"/> '+a.filename+"</button>"},getDispText:function(a){return"["+TXMSG("@file.title")+":"+a.dataSeq+"]"},getRegLoad:function(a){return new RegExp('<(?:a|A)\\s*href="?'+a.attachurl.getRegExp()+'[^"]*"?[^>]*><(?:img|IMG)[^>]*/?>[\\S\\s]*?</(?:a|A)>',"gm")},getRegHtml:function(a){return new RegExp('<(?:button|BUTTON)[^>]*id="?'+a.dispElId+'"?[^>]*>[\\S\\s]*?'+a.attachurl.getRegExp()+"[\\S\\s]*?</(?:button|BUTTON)>","gm")},getRegText:function(a){return new RegExp("\\["+TXMSG("@file.title")+":"+a.dataSeq+"\\]","gm")}}),TrexConfig.addTool("voice",{wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),Trex.Tool.Voice=Trex.Class.create({$const:{__Identity:"voice"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){a.getSidebar().getEmbeder("voice").execute("instance="+a.kEditor.instanceId)})}}),TrexConfig.addEmbeder("voice",{wysiwygonly:_TRUE,useCC:_FALSE},function(a){var b=a.sidebar.embeder.voice,c=KEditor.get(a.initializedId);c.config.voice&&c.config.voice.enable&&c.config.voice.win&&(b.popPageUrl=TrexConfig.getUrl(c.config.voice.win.url),b.features=TrexConfig.getPopFeatures(c.config.voice.win.features))}),Trex.Embeder.Voice=Trex.Class.create({$const:{__Identity:"voice"},$extend:Trex.Embeder,name:"voice",title:"voice",canResized:_TRUE,getCreatedHtml:function(a){return this.editor.kEditor.config.voice.getHtml(a)}}),TrexConfig.addTool("recorder",{wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),Trex.Tool.Recorder=Trex.Class.create({$const:{__Identity:"recorder"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){a.getSidebar().getEmbeder("recorder").execute("instance="+a.kEditor.instanceId)})}}),TrexConfig.addEmbeder("recorder",{wysiwygonly:_TRUE,useCC:_FALSE},function(a){var b=a.sidebar.embeder.recorder,c=KEditor.get(a.initializedId);c.config.recorder&&c.config.recorder.enable&&c.config.recorder.win&&(b.popPageUrl=TrexConfig.getUrl(c.config.recorder.win.url),b.features=TrexConfig.getPopFeatures(c.config.recorder.win.features))}),Trex.Embeder.Recorder=Trex.Class.create({$const:{__Identity:"recorder"},$extend:Trex.Embeder,name:"recorder",title:"recorder",canResized:_TRUE,getCreatedHtml:function(a){return this.editor.kEditor.config.recorder.getHtml(a)}}),TrexConfig.addTool("findreplace",{wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,left:-425}),TrexMessage.addMsg({"@findreplace.layer.title":Trex._I18N.g("findreplace_title","찾기 / 바꾸기"),"@findreplace.layer.match.case":Trex._I18N.g("findreplace_match_case","대소문자 구분"),"@findreplace.layer.character.find":Trex._I18N.g("findreplace_character_find","찾을 내용"),"@findreplace.layer.character.replace":Trex._I18N.g("findreplace_character_replace","바꿀 내용"),"@findreplace.search.image":"#iconpath/btn_search.png?open&v=2","@findreplace.replace.image":Trex._I18N.g("btn_replace","#iconpath/btn_replace.gif?open&v=2"),"@findreplace.replaceall.image":Trex._I18N.g("btn_replaceall","#iconpath/btn_replaceall.gif?open&v=2"),"@findreplace.confirm.image":Trex._I18N.g("btn_confirm","#iconpath/btn_confirm.gif?open&v=2")}),Trex.Tool.FindReplace=Trex.Class.create({$const:{__Identity:"findreplace"},$extend:Trex.Tool,oninitialized:function(){var a=function(a){};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.FindReplace(this.menuCfg),a,null)}}),Trex.MarkupTemplate.add("menu.findreplace",['<div class="tx-menu-inner">',"    <dl>","        <dt>","            @findreplace.layer.title","        </dt>","        <dd>",'           <ul class="field">','               <li class="inputmenu">',"                   <ol>",'                       <li id="character_find">',"                          <label>@findreplace.layer.character.find</label>",'                          <input type="text" class="searchbox" name="character_find_input" />','                          <img src="@findreplace.search.image"/>','                          <input type="checkbox" id="match_case" value="sensitive" name="match_case" style="border:none" /> ','                          <label for="match_case">@findreplace.layer.match.case</label>',"                       </li>",'                       <li id="character_replace">',"                          <label>@findreplace.layer.character.replace</label>",'                          <input type="text" name="character_replace_input" />','                          <img src="@findreplace.replace.image"/>','                          <img src="@findreplace.replaceall.image"/>',"                       </li>","                   </ol>","              </li>","           </ul>","        </dd>",'        <dd id="change_text_count" class="changecount"></dd>',"    </dl>","</div>"].join("")),Trex.Menu.FindReplace=Trex.Class.create({$extend:Trex.Menu,ongenerated:function(){var a=this.elMenu,b=this;Trex.MarkupTemplate.get("menu.findreplace").evaluateToDom({},a),this.TRange=null,this.input_find=$tom.collectAll(a,"#character_find input"),this.input_replace=$tom.collectAll(a,"#character_replace input"),this.cntLayer=$tom.collectAll(a,"#change_text_count")[0];var c=$tom.collectAll(a,"img"),d=this.tool.canvas,e=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),f=e.getDocument(),g=$tom.getWindow(f);this.selectionItem=g.getSelection(),$tx.observe(b.input_find[0],"keydown",function(a){if(a.keyCode==$tx.KEY_RETURN){b.findTextSelection(f);this.input_find[0].focus()}}.bindAsEventListener(this)),$tx.observe(c[0],"click",function(a){b.findTextSelection(f)}.bind(this)),$tx.observe(c[1],"click",function(a){d.execute(function(a){var c=a.getSelectionRange(d);if(void 0==c||""==c.toString()){b.findTextSelection(f)&&(c=a.getSelectionRange(d))}if(void 0!=c){b.input_find[1].checked&&c.toString()==b.input_find[0].value?(a.pasteHtml(b.input_replace[0].value,d,c),b.cntLayer.innerHTML=""):b.input_find[1].checked||c.toString().toLowerCase()!=b.input_find[0].value.toLowerCase()||(a.pasteHtml(b.input_replace[0].value,d,c),b.cntLayer.innerHTML="");b.findTextSelection(f)}})}.bind(this)),$tx.observe(c[2],"click",function(a){function c(a,b){function c(a){for(var e=a.firstChild;e;){switch(e.nodeType){case Node.TEXT_NODE:b(e)&&d.push(e);break;case Node.ELEMENT_NODE:c(e)}e=e.nextSibling}}var d=[];return a&&c(a),d}function e(a){return!/^(\s|\n)+$/gi.test(a.data)}var g=f.body,h=b.input_find[0].value,i=b.input_replace[0].value,j=new RegExp(h,"g"),k=new RegExp(h,"gi");""!=h&&d.execute(function(a){for(var d=c(g,e),f=0,h=0;h<d.length;++h)b.input_find[1].checked?d[h].data=d[h].data.replace(j,function(a){return f++,i}):d[h].data=d[h].data.replace(k,function(a){return f++,i});b.cntLayer.innerHTML=f>0?Trex._I18N.g("findreplace_change_cnt","변경")+": "+f:""})}.bind(this))},onregenerated:function(){this.selectionItem.removeAllRanges(),this.input_find[0].value="",this.input_replace[0].value="",this.cntLayer.innerHTML="",this.input_find[0].focus()},findTextSelection:function(a){var b=$tom.getWindow(a),c=!1;return $tx.msie?(null!=this.TRange&&(this.TRange.collapse(!1),strFound=this.TRange.findText(this.input_find[0].value),strFound&&(this.TRange.select(),c=!0)),null!=this.TRange&&0!=strFound||(this.TRange=a.body.createTextRange(),strFound=this.TRange.findText(this.input_find[0].value),strFound&&(this.TRange.select(),c=!0))):c=b.find(this.input_find[0].value,!!this.input_find[1].checked),c||this.selectionItem.removeAllRanges(),c}}),TrexConfig.addTool("media",{wysiwygonly:_TRUE,sync:_FALSE,status:_TRUE,left:-265}),TrexMessage.addMsg({"@media.title":Trex._I18N.g("media.title","동영상"),"@media.layer.title":Trex._I18N.g("multimedia_title","동영상 삽입"),"@media.layer.type.link":Trex._I18N.g("multimedia_link","URL"),"@media.layer.type.source":Trex._I18N.g("multimedia_html","소스코드(iframe)"),"@media.layer.type.fileupload":Trex._I18N.g("multimedia_file_upload","파일 업로드"),"@media.layer.link":Trex._I18N.g("multimedia_input_link","URL을 입력해 주세요."),"@media.layer.source":Trex._I18N.g("multimedia_source","소스코드를 입력해 주세요."),"@media.layer.width":Trex._I18N.g("image.width","너비"),"@media.layer.height":Trex._I18N.g("image.height","높이"),"@media.layer.uparrow":Trex._I18N.g("btn_up_arrow","추가"),"@media.layer.downarrow":Trex._I18N.g("btn_down_arrow","삭제"),"@media.layer.attr.controls":Trex._I18N.g("multimedia_attr_controls","컨트롤 표시"),"@media.layer.attr.autoplay":Trex._I18N.g("multimedia_attr_autoplay","자동 재생"),"@media.layer.attr.muted":Trex._I18N.g("multimedia_attr_muted","음소거"),"@media.layer.attr.loop":Trex._I18N.g("multimedia_attr_loop","반복 재생"),"@media.layer.extension.description":Trex._I18N.g("multimedia_extension_description","유튜브, 카카오 TV, 네이버 TV, Vimeo의 링크 URL 외에는 mp4, webm, ogg의 형식으로 제작된 동영상만 스트리밍을 지원합니다."),"@media.prev.url":"#iconpath/spacer2.gif?open&v=2","@media.prev.url.tvpot":"#iconpath/img_multi_tvpot.gif?open&v=2","@media.prev.url.wmp":"#iconpath/spacer2.gif?open&v=2","@media.cancel.image":Trex._I18N.g("btn_cancel","#iconpath/btn_cancel.gif?open&v=2"),"@media.confirm.image":Trex._I18N.g("btn_confirm","#iconpath/btn_confirm.gif?open&v=2")}),Trex.Tool.Media=Trex.Class.create({$const:{__Identity:"media"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor,b=function(b){a.getSidebar().getEmbeder("media").embedHandler(b)};this.weave.bind(this)(new Trex.Button(this.buttonCfg),new Trex.Menu.Media(this.menuCfg),b,null)}}),Trex.MarkupTemplate.add("menu.insertmedia",['<div class="tx-menu-inner">',"    <dl>","        <dt>","            @media.layer.title","        </dt>","        <dd>",'           <ul class="field">','               <li class="codesubmenu">','                   <ol class="codeMenu">','                       <li id="fileupload_menu" style="display:none">','                           <label for="type_fileupload"><input type="radio" id="type_fileupload" value="fileupload" name="codeType" />@media.layer.type.fileupload</label>',"                       </li>","                       <li>",'                          <label for="type_url"><input type="radio" id="type_url" value="url" name="codeType" />@media.layer.type.link</label>',"                       </li>","                       <li>",'                           <label for="type_source"><input type="radio" id="type_source" value="source" name="codeType" />@media.layer.type.source</label>',"                       </li>","                   </ol> ","              </li>",'              <li class="inputmenu">',"                   <ol>",'                       <li id="inputmenu_fileupload" style="display:none">','                           <input type="file" name="%%File" id="input_file" style="display:none">','                           <div id="drop" class="droplayer">','                               <span id="dropfilelsit" class="filelistlayer"></span>',"                           </div>",'                           <progress id="progressBar" value="0" max="100" style="width:100%;padding-right: 7px;"></progress>',"                       </li>",'                       <li id="inputmenu_url">','                           <input type="text" name="url" placeholder="@media.layer.link" />',"                       </li>",'                       <li id="inputmenu_source">','                           <textarea rows="7" name="source" placeholder="@media.layer.source"></textarea>',"                       </li>","                   </ol>","              </li>",'              <li class="videooption" id="video_option">',"                   <ol>",'                       <li><span class="description">@media.layer.extension.description</span></li>',"                       <li><hr></li>","                       <li>",'                           <span class="input_cell">',"                               <label>@media.layer.width</label>",'                               <span class="g_select">','                                   <input type="text" name="txt_img_width" class="txt txt_sel txt_img_width" />','                                   <button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_width_up">@media.layer.uparrow</button>','                                   <button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_width_down">@media.layer.downarrow</button>',"                               </span>","                           </span>",'                           <span class="input_cell">','                               <label class="inner">@media.layer.height</label>','                               <span class="g_select">','                                   <input type="text" name="txt_img_height" class="txt txt_sel txt_img_height" />','                                   <button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_height_up">@media.layer.uparrow</button>','                                   <button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_height_down">@media.layer.downarrow</button>',"                               </span>","                           </span>","                       </li>","                       <li></li>","                       <li>",'                           <label for="controls"><input type="checkbox" id="controls" name="controls" checked><span>@media.layer.attr.controls</span></label>',"                       </li>","                       <li>",'                           <label for="autoplay"><input type="checkbox" id="autoplay" name="autoplay">@media.layer.attr.autoplay</label>',"                       </li>","                       <li>",'                           <label for="muted"><input type="checkbox" id="muted" name="muted">@media.layer.attr.muted</label>',"                       </li>","                       <li>",'                           <label for="loop"><input type="checkbox" id="loop" name="loop">@media.layer.attr.loop</label>',"                       </li>","                   </ol>","              </li>","           </ul>","        </dd>",'        <dd class="tx-hr"><hr/></dd>',"        <dd>",'            <img width="32" height="21" class="btn_media" src="@media.confirm.image"/>','            <img width="32" height="21" class="btn_media" src="@media.cancel.image"/>',"        </dd>","    </dl>","</div>"].join("")),Trex.Menu.Media=Trex.Class.create({$extend:Trex.Menu,ongenerated:function(){var a=this.elMenu,b=this;Trex.MarkupTemplate.get("menu.insertmedia").evaluateToDom({},a),this.uploadFiles=[],this.allowMimeType="video/mp4, video/webm, video/ogg, audio/mpeg, audio/ogg, audio/wav",this.defaultDragText='<img src="'+TrexConfig.getIconPath("#iconpath/ic_dragdrop.gif")+'">'+Trex._I18N.g("multimedia_file_drag","파일을 드래그하여 첨부할 수 있습니다."),this.textArea=$tom.collectAll(a,"#inputmenu_source textarea")[0],this.input=$tom.collectAll(a,"#inputmenu_url input")[0],this.codeType=$tom.collectAll(a,".codeMenu input"),this.inputfile=$tom.collect(a,"#input_file"),this.filedrop=$tom.collect(a,"#drop"),this.controls=$tom.collect(a,"#controls"),this.autoplay=$tom.collect(a,"#autoplay"),this.muted=$tom.collect(a,"#muted"),this.loop=$tom.collect(a,"#loop"),this.elImgWidth=$tom.collect(a,".txt_img_width"),this.elImgHeight=$tom.collect(a,".txt_img_height");var c=$tom.collect(a,"#fileupload_menu"),d=$tom.collect(a,".btn_width_up"),e=$tom.collect(a,".btn_width_down"),f=$tom.collect(a,".btn_height_up"),g=$tom.collect(a,".btn_height_down"),h=$tom.collectAll(a,".btn_media"),i=this.config,j=KEditor.get(i.initializedId);this._videouploadpath=j.config.videoUploadPath,void 0!=this._videouploadpath&&""!=this._videouploadpath?$(c).show():$(c).hide();var k=b.getDefaultSizeByUrl("");b.elImgWidth.value=k.width,b.elImgHeight.value=k.height,$(this.inputfile).attr("accept",this.allowMimeType),$tx.observe(this.codeType[0],"click",function(a){b.changeType("fileupload")}.bind(this)),$tx.observe(this.codeType[1],"click",function(a){b.changeType("url")}.bind(this)),$tx.observe(this.codeType[2],"click",function(a){b.changeType("source")}.bind(this)),$tx.observe(b.filedrop,"click",function(a){$(":file").trigger("click")}),$tx.observe(b.inputfile,"change",function(a){$(b.filedrop).removeClass("dragover"),b.drawAttachedFile(b.inputfile.files)});var l=0;$tx.observe(b.filedrop,"dragenter",function(a){l++,$(this).addClass("dragover")}),$tx.observe(b.filedrop,"dragleave",function(a){0===--l&&$(this).removeClass("dragover")}),$tx.observe(b.filedrop,"dragover",function(a){a.stopPropagation(),a.preventDefault()}),$tx.observe(b.filedrop,"drop",function(a){a.preventDefault(),$(this).removeClass("dragover"),b.drawAttachedFile(a.dataTransfer.files)}),$tx.observe(b.input,"paste",function(a){b.checkVideoSize(a.clipboardData.getData("Text"))}),$tx.observe(d,"click",function(){b.elImgWidth.value=(b.elImgWidth.value||0)-0+1}),$tx.observe(e,"click",function(){var a=(b.elImgWidth.value||0)-1;a=a<0?0:a,b.elImgWidth.value=a}),$tx.observe(f,"click",function(){b.elImgHeight.value=(b.elImgHeight.value||0)-0+1}),$tx.observe(g,"click",function(){var a=(b.elImgHeight.value||0)-1;a=a<0?0:a,b.elImgHeight.value=a}),$tx.observe(h[0],"click",function(a){var c={};if(b.codeType[0].checked){if(void 0!=b.uploadFiles[0])return b.videoUpload(b.uploadFiles[0]),void $tx.stop(a)}else b.codeType[1].checked?c.url=b.input.value.trim():b.codeType[2].checked&&(c.code=b.textArea.value.trim());b.callOnSelect(c),$tx.stop(a)}.bind(this)),$tx.observe(h[1],"click",function(){this.onCancel()}.bindAsEventListener(this))},onregenerated:function(){void 0!=this._videouploadpath&&""!=this._videouploadpath?(this.codeType[0].checked=!0,this.changeType("fileupload")):(this.codeType[1].checked=!0,this.changeType("url")),this.textArea.value="",this.input.value="",this.checkVideoSize(""),this.initVideoOptions(),this.setVideoOptions("on"),this.clearAttachedFile()},callOnSelect:function(a){var b=this;(b.codeType[0].checked||b.codeType[1].checked)&&(a.size={width:b.elImgWidth.value,height:b.elImgHeight.value},a.attribute="",b.controls.checked&&(a.attribute+=" controls"),b.autoplay.checked&&(a.attribute+=" autoplay"),b.muted.checked&&(a.attribute+=" muted"),b.loop.checked&&(a.attribute+=" loop")),a.url||a.code?b.onSelect(null,a):alert(Trex._I18N.g("multimedia_addr_error","첨부할 동영상 주소를 바르게 입력해주세요."))},videoUpload:function(a){var b=this,c=this.tool.editor.kEditor,d=(a.type.split("/")[0]||"").toLowerCase(),e=(a.type.split("/")[1]||"").toLowerCase(),f="video"==d||"audio"==d||"x-shockwave-flash"==e||"application"==d&&"ogg"==e,g="",h={},i={};if(!f)return void b.callOnSelect(i);"x-shockwave-flash"==e?g="swf":"audio"==d&&"ogg"==e?g="oga":"video"==d&&"ogg"==e?g="ogv":"application"==d&&"ogg"==e?g="ogx":"audio"==d&&"webm"==e?g="weba":"video"==d&&"webm"==e?g="webm":"x-midi"==e?g="midi":""!=e&&(g=e),h=c._getUploadVideoInfo(g),h.postdata||(h.postdata={}),h.type||h.type,h.fieldname||(h.fieldname="%%File");var j=new FormData;"domino"==h.type&&(j.append("__Click","0"),j.append("%%PostCharset","UTF-8"),j.append("Body",""));for(var k in h.postdata)j.append(k,h.postdata[k]);j.append(h.fieldname,a,h.name);var l=new XMLHttpRequest;l.open("POST",h.url,!0),l.upload.onprogress=function(a){var b=a.loaded/a.total*100;$("#inputmenu_fileupload #progressBar").val(Math.round(b))},document.location.hostname&&"local.k-portal.co.kr"==document.location.hostname&&(l.withCredentials=!0),l.send(j),l.onreadystatechange=function(a){if(4===l.readyState&&200===l.status){var d=l.responseText;return result=c._parseUploadResponse(d,h,"blob"),i.url=result.img_src.trim(),b.callOnSelect(i),void $("#inputmenu_fileupload #progressBar").val(0)}}},drawAttachedFile:function(a){var b=this.config,c=KEditor.get(b.initializedId),d=c.config.videoLimitSize||0;if(0!=a.length){if(a.length>1)return void alert(Trex._I18N.g("multimedia_file_limit","동영상 파일 업로드는 1개만 가능합니다."));var e=a[0].name,f=a[0].type.toLowerCase()
;if(-1==this.allowMimeType.indexOf(f))return void alert(Trex._I18N.g("multimedia_file_not_allow",this.allowMimeType,"지원되지 않는 동영상입니다.\n지원되는 미디어 타입 : "+this.allowMimeType));if(a[0].size&&0!=d&&d<a[0].size)return void alert(Trex._I18N.g("multimedia_upload_limit",Trex._getDisplayFileSize(a[0].size),Trex._getDisplayFileSize(d),"동영상 업로드 허용 용량을 초과했습니다(제한크기:"+Trex._getDisplayFileSize(d)+")"));this.uploadFiles.push(a[0]);var g='<img src="'+Trex.Util.prevurl(e.split(".").pop().toLowerCase())+'">';$("#dropfilelsit").empty().html('<span title="'+e+'">'+g+e+"</span>")}},clearAttachedFile:function(){this.inputfile.value="",this.uploadFiles=[],$("#dropfilelsit").empty().html(this.defaultDragText)},initVideoOptions:function(){this.controls.checked=!0,this.autoplay.checked=!1,this.muted.checked=!1,this.loop.checked=!1},setVideoOptions:function(a){"on"==a?($(this.controls).removeAttr("disabled"),$(this.autoplay).removeAttr("disabled"),$(this.muted).removeAttr("disabled"),$(this.loop).removeAttr("disabled")):($(this.controls).attr("disabled",!0),$(this.autoplay).attr("disabled",!0),$(this.muted).attr("disabled",!0),$(this.loop).attr("disabled",!0))},checkVideoSize:function(a){var b=this.getDefaultSizeByUrl(a);this.elImgWidth.value=b.width,this.elImgHeight.value=b.height,b.portalVideo?this.setVideoOptions("off"):this.setVideoOptions("on")},changeType:function(a){$tx.hide($tx("inputmenu_url")),$tx.hide($tx("inputmenu_source")),$tx.hide($tx("inputmenu_fileupload")),$tx.hide($tx("video_option")),"fileupload"==a?($tx.show($tx("inputmenu_fileupload")),$tx.show($tx("video_option")),this.input.value="",this.checkVideoSize(""),this.initVideoOptions(),this.setVideoOptions("on"),this.textArea.value=""):"url"==a?($tx.show($tx("inputmenu_url")),$tx.show($tx("video_option")),this.input.focus(),this.textArea.value="",this.clearAttachedFile()):"source"==a&&($tx.show($tx("inputmenu_source")),this.textArea.focus(),this.input.value="",this.checkVideoSize(""),this.initVideoOptions(),this.setVideoOptions("on"),this.clearAttachedFile())},getDefaultSizeByUrl:function(a){var b,c,d;return a.indexOf("youtube")>-1||a.indexOf("youtu.be")>-1?(b=640,c=360,d=!0):-1!=a.indexOf("tv.naver.com")?(b=544,c=306,d=!0):-1!=a.indexOf("tv.kakao.com")?(b=640,c=360,d=!0):-1!=a.indexOf("vimeo.com")?(b=640,c=360,d=!0):(b=640,c=360,d=!1),{width:b,height:c,portalVideo:d}}}),TrexConfig.addEmbeder("media",{wysiwygonly:_TRUE,useCC:_FALSE,features:{left:250,top:65,width:458,height:568,resizable:"yes"},popPageUrl:"#host#path/pages/trex/multimedia.html?open",allowNetworkingFilter:_FALSE,allowNetworkingSites:[]},function(a){var b=a.sidebar.embeder.media;window._KEDITOR_PATH&&window._KEDITOR_BODY_PATH?b.popPageUrl=b.popPageUrl.replace("#host#path",window._KEDITOR_BODY_PATH.split("/pages")[0]):b.popPageUrl=TrexConfig.getUrl(b.popPageUrl),b.features=TrexConfig.getPopFeatures(b.features)}),function(){function a(a){return(a.split("&")[0].match(/(?:http:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:embed\/)*(?:v\/)*(?:watch\?v=)?(.+)/)||[])[1]}function b(a){return(a.split("&")[0].match(/(?:http:\/\/)?(?:tv|play-tv)\.kakao\.com\/v\/?(.+)/)||[])[1]}function c(a){return(a.split("&")[0].match(/(?:http:\/\/)?tv\.naver\.com\/v\/?(.+)/)||[])[1]}function d(a){return(a.split("&")[0].match(/(?:http:\/\/)?vimeo\.com\/(?:channels\/)*(?:bestofstaffpicks\/)*(?:video\/)?(.+)/)||[])[1]}function e(a,b){var c,d,e,f;for(d="",c=/[\/]*\/\/([^\/]+)\//i.exec(a),c&&c[1]&&(d=c[1]),f=b.allowNetworkingSites.length,e=0;e<f;e+=1)if(d==b.allowNetworkingSites[e].host)return _TRUE;return _FALSE}function f(a,b){var c;return b.allowNetworkingFilter==_FALSE?a:(c=a.replace(/(<object[^>]*>)((?:\n|.)*?)(<\/object>)/gi,function(a,c,d,f){var g,h,i=_FALSE;return g=/data[\s]*=[\s"']*(http:\/\/[^\/]+\/)[^("'\s)]+/i.exec(c),g&&2==g.length&&(h=g[1],e(h,b)===_FALSE&&(i=_TRUE)),g=/<param[^>]*=[^\w]*movie[^\w]+[^>]*>/i.exec(d),g&&g[0]&&(h=/\s+value=["']?([^\s"']*)["']?/i.exec(g[0]))&&h[1]&&e(h[1],b)===_FALSE&&(i=_TRUE),g=/<param[^>]*=[^\w]*src[^\w]+[^>]*>/i.exec(d),g&&g[0]&&(h=/\s+value=["']?([^\s"']*)["']?/i.exec(g[0]))&&h[1]&&e(h[1],b)===_FALSE&&(i=_TRUE),i===_TRUE&&(d=d.replace(/<param[^>]*=[^\w]*allowNetworking[^\w]+[^>]*>/i,""),d='<param name="allowNetworking" value="internal" />'.concat(d)),c+d+f}),c=c.replace(/(<embed)([^>]*)(><\/embed>|\/>)/gi,function(a,c,d,f){var g=/\s+src=["']?([^\s"']*)["']?/i.exec(d);return g&&g[1]&&e(g[1],b)?c+d+f:(d=d.replace(/\s+allowNetworking=["']?[\w]*["']?/i,"").concat(' allowNetworking="internal"'),c+d+f)}))}function g(a){for(var b,c=new RegExp("<(?:img|IMG)[^>]*txc-media[^>]*/?>","gim"),d=a;(b=c.exec(d))!=_NULL;){var e=b[0],f=h(e);!$tx.msie&&f.indexOf("$")>-1&&(f=f.replace(/\$/g,"$$$$")),a=a.replace(e,f)}return a}function h(a){var b=Trex.Util.getAllAttributes(a),c=b.ld;if(!c||0==c.length)return"";var d=b.width,e=b.height,f=decodeURIComponent(c),g=f;if(f.indexOf("object")>-1||f.indexOf("OBJECT")>-1)for(var h,i=new RegExp("<(?:embed|EMBED)[^>]*src=[^>]*(?:/?>|></(?:embed|EMBED)>)","gim");(h=i.exec(f))!=_NULL;)g=h[0];b=Trex.Util.getAllAttributes(g);b.src;return isNaN(d)||(f=Trex.String.changeAttribute(f,"width",d,d)),isNaN(e)||(f=Trex.String.changeAttribute(f,"height",e,e)),f}Trex.Embeder.Media=Trex.Class.create({$const:{__Identity:"media"},$extend:Trex.Embeder,name:"media",title:TXMSG("@media.title"),canResized:_TRUE,getCreatedHtml:function(a){return a.code&&(a.code=a.code.replace(/ onerror=".*?"/gi,"").replace(/ onclick=".*?"/gi,"").replace(/ onchange=".*?"/gi,"").replace(/ onmouseover=".*?"/gi,"").replace(/ onmouseout=".*?"/gi,"").replace(/ onload=".*?"/gi,"").replace(/ onkeydown=".*?"/gi,"")),a.code||this.makeSourceByUrl(a)},getDataForEntry:function(){},makeSourceByUrl:function(a){switch(this.getUrlExt(a.url)){case"jpg":case"bmp":case"gif":case"png":return this.generateHTMLForImage(a.url,a.size);default:var b=this.generateHTMLIfIframeSource(a.url,a.size);return b||this.generateHTMLForDefaultEmbed(a)}},getUrlExt:function(a){return a.split(".").pop().split("?")[0].toLowerCase()},generateHTMLForDefaultEmbed:function(a){var b="";return b+='<video style="width:'+a.size.width+"px; height:"+a.size.height+'px; vertical-align:baseline;" '+a.attribute+">",b+='<source src="'+a.url+'">',b+="브라우저에서 지원되는 포맷이 아닙니다.",b+="</video>"},generateHTMLForImage:function(a,b){return'<img src="'+a+'" border="0"/ style="width:'+b.width+"px; height:"+b.height+"px;>"},generateHTMLIfIframeSource:function(e,f){var g=e.indexOf("https:")>-1?"https:":"http:",h="https:"==document.location.protocol?"https:":g,i=a(e);if(i)return'<iframe src="'+h+"//www.youtube.com/embed/"+i+"\" width='"+f.width+"' height='"+f.height+'\' frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>';var j=b(e);if(j)return'<iframe src="'+h+"//play-tv.kakao.com/embed/player/cliplink/"+j+"\" width='"+f.width+"' height='"+f.height+'\' frameborder="0" allow="autoplay; fullscreen; encrypted-media" allowfullscreen></iframe>';var k=c(e);if(k)return'<iframe src="'+h+"//tv.naver.com/embed/"+k+"\" width='"+f.width+"' height='"+f.height+'\' frameborder="0" allow="autoplay" allowfullscreen></iframe>';var l=d(e);return l?'<iframe src="'+h+"//player.vimeo.com/video/"+l+"\" width='"+f.width+"' height='"+f.height+'\' frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>':_NULL}}),Trex.register("filter > media ",function(a,b,c){var d=c.embeders.media.config;a.getDocParser().registerFilter("filter/embeder/media",{"text@load":function(a){return a},"source@load":function(a){return a},"html@load":function(a){return a},text4save:function(a){return a},source4save:function(a){return a=g(a),a=f(a,d)},html4save:function(a){return a=g(a),a=f(a,d)},text2source:function(a){return a},text2html:function(a){return a},source2text:function(a){return a},source2html:function(a){return a},html2text:function(a){return g(a)},html2source:function(a){return g(a)}})})}(),TrexMessage.addMsg({"@canvas.unload.message":Trex._I18N.g("canvas.unload.message","작성하신 내용이 저장되지 않았습니다. 페이지를 떠나시겠습니까?"),"@canvas.unload.message.at.modify":Trex._I18N.g("canvas.unload.message.at.modify","작성하신 내용이 저장되지 않았습니다. 페이지를 떠나시겠습니까?")}),Trex.install("editor.isDisableUnloadHandler & editor.setDisableUnloadHandler",function(a){var b=_TRUE;a.isDisableUnloadHandler=function(){return b},a.setDisableUnloadHandler=function(){b=_FALSE},a.setEnableUnloadHandler=function(){b=_TRUE}}),Trex.module("observing beforeunload event",function(a,b,c,d,e){var f=e.events,g=new Trex.Validator;$tx.observe(window,"beforeunload",function(b){if(a.isDisableUnloadHandler()&&f.preventUnload&&(d.fireJobs(Trex.Ev.__CANVAS_BEFORE_UNLOAD),g.exists(d.getContent())))return b.returnValue=TXMSG("@canvas.unload.message"),TXMSG("@canvas.unload.message")},_FALSE)}),TrexMessage.addMsg({"@align.image.align.center":Trex._I18N.g("align.image.align.center","가운데정렬"),"@align.image.align.full":Trex._I18N.g("align.image.align.full","오른쪽글흐름"),"@align.image.align.left":Trex._I18N.g("align.image.align.left","왼쪽정렬"),"@align.image.align.right":Trex._I18N.g("align.image.align.right","왼쪽글흐름"),"@align.text.align.center":Trex._I18N.g("align.text.align.center","가운데정렬 (Ctrl+.)"),"@align.text.align.full":Trex._I18N.g("align.text.align.full","양쪽정렬"),"@align.text.align.left":Trex._I18N.g("align.text.align.left","왼쪽정렬 (Ctrl+,)"),"@align.text.align.right":Trex._I18N.g("align.text.align.right","오른쪽정렬 (Ctrl+/)")}),Trex.module("Register an eventhandler in order to change align icons upon toolbar when user click a specific image or not.",function(a,b,c,d){var e=[b.tools.alignleft,b.tools.aligncenter,b.tools.alignright,b.tools.alignfull],f=["txc-2image-c","txc-3image-c","txc-footnote","txc-jukebox","txc-movie","txc-gallery","txc-imazing","txc-map","txc-file","txc-emo","tx-entry-embed","txc-bgm","txc-pie"],g=function(a){var b=function(a,b,c){if(a){var d=_NULL,e=_NULL;d||(d=$tom.find(a.button.elButton,"li")),e||(e=$tx(a.button.elIcon)),e.title=c,"image"==b?($tx.hasClassName(d,"tx-selected-image")||$tx.addClassName(d,"tx-selected-image"),a.imageAlignMode=_TRUE):($tx.hasClassName(d,"tx-selected-image")&&$tx.removeClassName(d,"tx-selected-image"),a.imageAlignMode=_FALSE)}};b(e[0],a,"image"==a?TXMSG("@align.image.align.left"):TXMSG("@align.text.align.left")),b(e[1],a,"image"==a?TXMSG("@align.image.align.center"):TXMSG("@align.text.align.center")),b(e[2],a,"image"==a?TXMSG("@align.image.align.right"):TXMSG("@align.text.align.right")),b(e[3],a,"image"==a?TXMSG("@align.image.align.full"):TXMSG("@align.text.align.full"))};d.observeElement([{tag:"body"},{tag:"table"},{tag:"hr"}],function(){g("text")}),d.observeElement({tag:"img"},function(a){var b=Trex.Util.getMatchedClassName(a,f);g(b?"text":$tom.find(a,"button")?"text":"image")})}),Trex.module("make padding area inside Canvas with editor width",function(a,b,c,d){function e(a){o.addStyle(f(a))}function f(a){for(var b={},c=["top","bottom","left","right"],d=0;d<c.length;d++){var e=c[d];b[e]=a&&a[e]||A}return B?(b.mleft=Math.max(Math.ceil(g()),0),b.mright=Math.max(Math.floor(g()),0),{width:z.toPx(),paddingLeft:b.left.toPx(),paddingRight:b.right.toPx(),paddingTop:b.top.toPx(),paddingBottom:b.bottom.toPx(),marginLeft:b.mleft.toPx(),marginRight:b.mright.toPx()}):{paddingTop:b.top.toPx(),paddingRight:b.right.toPx(),paddingBottom:b.bottom.toPx(),paddingLeft:b.left.toPx()}}function g(){return(y-z-w-u)/2}function h(){var a=g();return a<v?{leftWidth:"0",rightWidth:"0",rightPos:"0"}:{leftWidth:Math.ceil(a-A).toPx(),rightWidth:Math.max(0,Math.floor(a-A)).toPx(),rightPos:(z+Math.ceil(a+A)).toPx()}}function i(){return p&&q}function j(){clearTimeout(C),C=setTimeout(function(){y=d.getContainerWidth(),k()},4)}function k(){e(),m(),n()}function l(){var a=d.getStyleConfig().color;p=tx.div({className:"tx-wysiwyg-padding"}),r=tx.div({className:"tx-wysiwyg-padding-divL",style:{borderColor:a}}),q=tx.div({className:"tx-wysiwyg-padding"}),s=tx.div({className:"tx-wysiwyg-padding-divR",style:{borderColor:a}});var b=d.wysiwygEl;p.appendChild(r),b.insertBefore(p,t),q.appendChild(s),b.insertBefore(q,t),m()}function m(){if(i()){var a=h();$tx.setStyle(p,{width:a.leftWidth}),$tx.setStyle(q,{width:a.rightWidth,left:a.rightPos});var b=a.leftWidth.parsePx()>v,c=d.getConfig().showGuideArea,e=b&&c?"1px solid":"0 none";$tx.setStyle(r,{borderRight:e,borderBottom:e}),$tx.setStyle(s,{borderLeft:e,borderBottom:e})}}function n(){i()&&(d.mode==Trex.Canvas.__WYSIWYG_MODE?($tx.show(p),$tx.show(q)):($tx.hide(p),$tx.hide(q)))}var o=d.getPanel(Trex.Canvas.__WYSIWYG_MODE);if(o){var p,q,r,s,t=o.el,u=16,v=28,w=2,x=d.getSizeConfig(),y=d.getContainerWidth(),z=x.contentWidth.toNumber(),A=x.contentPadding.toNumber(),B=y>z;B=!1,d.observeJob("canvas.apply.background",function(a){e({top:a&&a.topLeftHeight?a.topLeftHeight.parsePx():0,right:a&&a.midRightWidth?a.midRightWidth.parsePx():0,bottom:a&&a.botLeftHeight?a.botLeftHeight.parsePx():0,left:a&&a.midLeftWidth?a.midLeftWidth.parsePx():0})}),d.observeJob("canvas.apply.letterpaper",function(a){e({top:a&&a.topHeight?a.topHeight.parsePx():0,right:a&&(a.midColor||a.midUrl)?A:0,bottom:a&&a.botHeight?a.botHeight.parsePx():0,left:a&&(a.midColor||a.midUrl)?A:0})}),B&&(d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){e(),l(),n()}),d.observeJob(Trex.Ev.__CANVAS_MODE_CHANGE,function(){m(),n()}),d.observeJob(Trex.Ev.__CANVAS_WRAP_WIDTH_CHANGE,j),d.observeJob(Trex.Ev.__CANVAS_NORMAL_SCREEN_CHANGE,j),d.observeJob(Trex.Ev.__CANVAS_FULL_SCREEN_CHANGE,j),$tx.msie_nonstd||($tx.gecko?$tx.setStyle(t,{overflowX:"auto",overflowY:"auto"}):$tx.chrome?$tx.setStyle(t.contentDocument.documentElement,{overflowX:"auto",overflowY:"auto"}):$tx.setStyle(t,{overflowX:"auto",overflowY:"scroll"}))),d.getCanvasGuideSize=function(){return h().leftWidth.parsePx()};var C}}),Trex.module("Register an eventhandler in order to resize block and edit search results & some images in wysiwig panel.",function(a,b,c,d){if($tx.msie_nonstd){var e=function(a){a.onresizestart==_NULL&&(a.onresizestart=function(){return _FALSE})};d.observeElement({tag:"img",klass:"tx-unresizable"},e),d.observeElement({tag:"img",klass:"tx-entry-attach"},e),d.observeElement({tag:"img",klass:"txc-footnote"},e),d.observeElement({tag:"iframe",klass:"txc-map"},e)}var f;f=$tx.msie_nonstd?function(a){a.setAttribute("unselectable","on"),$A(a.getElementsByTagName("*")).each(function(a){"/"!=a.nodeName.charAt(0)&&a.setAttribute("unselectable","on")}),d.getProcessor().selectControl(a)}:function(a){throw d.getProcessor().selectControl(a),$stop},d.observeElement({tag:"button"},f),d.observeElement({tag:"img"},function(a){var b=$tom.find(a,"button");if(b)throw f(b),$stop})}),Trex.module("in order to save history for image resizing on IE",function(a,b,c,d){var e=d.history,f={},g=_NULL;d.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEDOWN,function(a){var b=$tx.element(a);b&&b.tagName&&"img"==b.tagName.toLowerCase()&&(g=b,f=$tom.getPosition(b))}),d.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEUP,function(){if(g){var a=_FALSE;try{var b=$tom.getPosition(g);for(var c in b)b[c]!=f[c]&&(a=_TRUE);a&&e.saveHistory()}catch(a){}finally{g=_NULL}}})}),Trex.module("Add layer to display notice message on editor area before editing",function(a,b,c,d,e){e.initializedMessage&&d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var a=e.initializedId,c=tx.div({id:"tx-canvas-notice"+a,className:"tx-canvas-notice"},e.initializedMessage),f=$tx("tx_loading"+a),g=f.parentNode;g.insertBefore(c,f);var h=!1,i=function(){!h&&$tx("tx-canvas-notice"+a)&&(h=!0,g.removeChild(c),d.focus())};setTimeout(function(){$tx.observe(d.getPanel("html").getWindow(),"focus",i)},30),$tx.observe(c,"click",i),d.observeJob(Trex.Ev.__CANVAS_DATA_INITIALIZE,i),b.observeJob(Trex.Ev.__TOOL_CLICK,i)})}),Trex.MarkupTemplate.add("table.col.resize.dragger",'<div class="tx-table-col-resize-dragger" style="position:absolute; overflow:hidden; top: 0; left: 0; width: 3px; height: 100%; cursor:col-resize;"></div>'),Trex.MarkupTemplate.add("table.row.resize.dragger",'<div class="tx-table-row-resize-dragger" style="position:absolute; overflow:hidden; top: 0; left: 0; width: 100%; height: 3px; cursor:row-resize;"></div>'),TrexMessage.addMsg({"@table.noselect.alert":Trex._I18N.g("table.noselect.alert","테이블을 선택하신 후 사용가능합니다.")}),Trex.Table={},Trex.module("table selector",function(a,b,c,d,e){var f;f=function(a){var b,c,d;b=Trex.MarkupTemplate.get("table.col.resize.dragger").evaluateAsDom({}),c=Trex.MarkupTemplate.get("table.row.resize.dragger").evaluateAsDom({}),d=a.wysiwygEl,$tom.insertFirst(d,b),$tom.insertFirst(d,c),$tx.hide(b),$tx.hide(c)},d.observeJob(Trex.Ev.__CANVAS_PANEL_BACKSPACE_TABLE,function(a){$tom.remove(a)}),d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var c,g,h,i,j,k,l;c=new Trex.Table.Selector(a,e),g=new Trex.Table.Merge(a,e),h=new Trex.Table.Insert(a,e),i=new Trex.Table.Delete(a,e),j=new Trex.Table.Border(a,e),k=new Trex.Table.TemplateLoader,l=new Trex.Table.CellCopy.build(a,e,h),f(d);var m=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),n=m.getProcessor(),o=function(){var a,b;c.getSelected().isValid()===_FALSE&&(a=n.getNode(),(b=Trex.TableUtil.getClosestByTagNames(["td","th"],a))&&c.selectByTd(b,b))},p={range:"all",color:"",height:1,type:"solid"};!function(){var a=b.tools.cellslinecolor;a&&(p.color=a.config.defaultcolor)}();var q=function(){alert(TXMSG("@table.noselect.alert"))};n.table={getTdArr:function(){return c.getSelectedTdArr()},isDuringSelection:function(){return c.isDuringSelection()},execute:function(a,b){b||o(),c.getSelected().isValid()?(a(),d.history.saveHistory()):q()},merge:function(){this.execute(function(){g.merge(c)},_TRUE)},resetMerge:function(){this.execute(function(){g.resetMerge(c)})},insertRowAbove:function(){this.execute(function(){h.insertRowAbove(c)})},insertRowBelow:function(){this.execute(function(){h.insertRowBelow(c)})},insertColLeft:function(){this.execute(function(){h.insertColLeft(c)})},insertColRight:function(){this.execute(function(){h.insertColRight(c)})},deleteTable:function(){this.execute(function(){i.deleteTable(c)})},deleteRow:function(){this.execute(function(){i.deleteRow(c)})},deleteCol:function(){this.execute(function(){i.deleteCol(c)})},cellCopy:function(){this.execute(function(){l.copy(c)})},cellPaste:function(){this.execute(function(){l.paste(c)})},setBorderRange:function(a){p.range=a},setBorderColor:function(a){p.color=a,b.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{color:a})},setBorderHeight:function(a){p.height=a,b.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{height:a})},setBorderType:function(a){p.type=a,b.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{type:a})},setNoBorder:function(){var a=this;this.execute(function(){j.setTableSelect(c),j.setBorderRange("all"),j.changeBorderColor(a.getTdArr(),""),j.changeBorderHeight(a.getTdArr(),"0"),j.changeBorderType(a.getTdArr(),"none")})},setBorderButtons:function(a,c,d){var e;e=b.tools.cellslinecolor,e&&e.execute(a),e=b.tools.cellslineheight,e&&e.execute(c),(e=b.tools.cellslinestyle)&&e.execute(d)},getBorderProperty:function(){return{color:p.color,height:p.height,type:p.type}},applyBorder:function(){var a=this;this.execute(function(){j.setTableSelect(c),j.setBorderRange(p.range),j.changeBorderColor(a.getTdArr(),p.color),j.changeBorderHeight(a.getTdArr(),p.height),j.changeBorderType(a.getTdArr(),p.type),a.addBorderHistory()})},addBorderHistory:function(){var a;(a=b.tools.cellslinepreview)&&a.addBorderHistory(p)},tableBackground:function(a){var b=this;a=a||"transparent",this.execute(function(){var d,e,f,g;for(d={backgroundColor:a},e=b.getTdArr(),g=e.length,f=0;f<g;f+=1)$tx.setStyle(e[f],d);c.reset()})},setTemplateStyle:function(a,b){if(a){var d=this;k.getTemplate(b,function(b){b.apply(a),d._applyTemplateOutline(a,b.templateData),c.reset()})}else q()},_applyTemplateOutline:function(a,b){var d=b,e=this,f={top:this._parseBorderStyle(d.firstRow.borderTop),right:this._parseBorderStyle(d.lastCol.borderRight||d.common.borderRight),bottom:this._parseBorderStyle(d.lastRow.borderBottom||d.common.borderBottom),left:this._parseBorderStyle(d.firstCol.borderLeft)},g=new Trex.Tool.Table.TableCellMatrixer(a),h=g.getTdMatrix(),i=g.getRowSize(),k=g.getColSize();if(h&&h.length){c.selectByTd(h[0][0],h[i-1][k-1]),j.setTableSelect(c);["top","right","bottom","left"].each(function(a){j.setBorderRange(a),j.changeBorderColor(e.getTdArr(),f[a].color),j.changeBorderHeight(e.getTdArr(),f[a].height),j.changeBorderType(e.getTdArr(),f[a].type)})}},_parseBorderStyle:function(a){if("none"===(a=a.trim().toLowerCase()))return{height:"none",type:"solid",color:"transparent"};var b=a.split(" ");return 3!=b.length&&(b=["1px","solid","#000"]),{height:b[0].parsePx()||1,type:b[1],color:b[2]}}},b.fireJobs(Trex.Ev.__TOOL_CELL_LINE_CHANGE,{color:p.color,height:p.height,type:p.type,fromInit:_TRUE}),b.observeJob(Trex.Ev.__TOOL_CLICK,function(a){["fontfamily","fontsize","bold","underline","italic","strike","forecolor","backcolor","indent","outdent","alignleft","aligncenter","alignright","alignfull","mergecells","splitcells","insertcells","deletecells","cellsoutline","cellslinecolor","cellslineheight","cellslinestyle","cellslinepreview","tablebackcolor","tabletemplate"].contains(a)===_FALSE?c.reset():c.hideContextMenu(),"tablebackcolor"===a&&o()})})}),TrexMessage.addMsg({"@contextmenu.table.cellcopy":Trex._I18N.g("contextmenu.table.cellcopy","셀 복사"),"@contextmenu.table.cellpaste":Trex._I18N.g("contextmenu.table.cellpaste","셀 붙여넣기"),"@contextmenu.table.insertrowabove":Trex._I18N.g("contextmenu.table.insertrowabove","위에 행 추가"),"@contextmenu.table.insertrowbelow":Trex._I18N.g("contextmenu.table.insertrowbelow","아래에 행 추가"),"@contextmenu.table.insertcolleft":Trex._I18N.g("contextmenu.table.insertcolleft","왼쪽에 열 추가"),"@contextmenu.table.insertcolright":Trex._I18N.g("contextmenu.table.insertcolright","오른쪽에 열 추가"),"@contextmenu.table.deletetable":Trex._I18N.g("contextmenu.table.deletetable","표 삭제"),"@contextmenu.table.deleterow":Trex._I18N.g("contextmenu.table.deleterow","행 삭제"),"@contextmenu.table.deletecol":Trex._I18N.g("contextmenu.table.deletecol","열 삭제"),"@contextmenu.table.cellmerge":Trex._I18N.g("contextmenu.table.cellmerge","셀 병합"),"@contextmenu.table.cellsplit":Trex._I18N.g("contextmenu.table.cellsplit","셀 나누기"),"@contextmenu.table.samewidth":Trex._I18N.g("contextmenu.table.samewidth","셀 너비 같게"),"@contextmenu.table.sameheight":Trex._I18N.g("contextmenu.table.sameheight","셀 높이 같게"),"@contextmenu.table.samewh":Trex._I18N.g("contextmenu.table.samewh","셀 너비/높이 같게"),"@contextmenu.table.propcell":Trex._I18N.g("contextmenu.table.propcell","셀 속성"),"@contextmenu.table.proptable":Trex._I18N.g("contextmenu.table.proptable","표 속성")}),TrexMessage.addMsg({"@table.popup.ok":Trex._I18N.g("table.popup.ok","확인"),"@table.popup.cancel":Trex._I18N.g("table.popup.cancel","취소"),"@table.popup.cellsplit.rowinsert":Trex._I18N.g("table.popup.cellsplit.rowinsert","행 추가"),"@table.popup.cellsplit.columninsert":Trex._I18N.g("table.popup.cellsplit.columninsert","열 추가"),"@table.popup.cellattr.lineselect":Trex._I18N.g("table.popup.cellattr.lineselect","테두리 선택"),"@table.popup.cellattr.h_align":Trex._I18N.g("table.popup.cellattr.h_align","수평정렬"),"@table.popup.cellattr.v_align":Trex._I18N.g("table.popup.cellattr.v_align","수직정렬")}),TrexConfig.addContextMenu("table",{options:[{label:Trex._I18N.g("table-insert","삽입"),title:TXMSG("@contextmenu.table.insertrowabove"),icon:"tabletopinsert",eventname:"insertRowAbove"},{label:Trex._I18N.g("table-insert","삽입"),title:TXMSG("@contextmenu.table.insertrowbelow"),icon:"tablebottominsert",eventname:"insertRowBelow"},{label:Trex._I18N.g("table-insert","삽입"),title:TXMSG("@contextmenu.table.insertcolleft"),icon:"tableleftinsert",eventname:"insertColLeft"},{label:Trex._I18N.g("table-insert","삽입"),title:TXMSG("@contextmenu.table.insertcolright"),icon:"tablerightinsert",eventname:"insertColRight"},{label:Trex._I18N.g("table-sepa","구분"),title:"sepa"},{label:"copy_paste",title:TXMSG("@contextmenu.table.cellcopy"),icon:"tablecellcopy",eventname:"cellCopy"},{label:"copy_paste",title:TXMSG("@contextmenu.table.cellpaste"),icon:"tablecellpaste",eventname:"cellPaste",check:"cell_paste"},{label:"copy_paste",title:"sepa"},{label:Trex._I18N.g("table-delete","삭제"),title:TXMSG("@contextmenu.table.deletetable"),icon:"tabledelete",eventname:"deleteTable"},{label:Trex._I18N.g("table-delete","삭제"),title:TXMSG("@contextmenu.table.deleterow"),icon:"tablerowdelete",eventname:"deleteRow"},{label:Trex._I18N.g("table-delete","삭제"),title:TXMSG("@contextmenu.table.deletecol"),icon:"tablecolumndelete",eventname:"deleteCol"},{label:Trex._I18N.g("table-sepa","구분"),title:"sepa"},{label:Trex._I18N.g("table-merge","병합"),title:TXMSG("@contextmenu.table.cellmerge"),icon:"tablecellmerge",eventname:"merge",check:"select"},{label:Trex._I18N.g("table-split","분할"),title:TXMSG("@contextmenu.table.cellsplit"),icon:"tablecellsplit",check:"no_select",popup:"CellSplit"},{label:Trex._I18N.g("table-sepa","구분"),title:"sepa"},{label:Trex._I18N.g("table-same","조정"),title:TXMSG("@contextmenu.table.samewidth"),icon:"tablesamecolumn",eventname:"sameWidth",check:"select_cols"},{label:Trex._I18N.g("table-same","조정"),title:TXMSG("@contextmenu.table.sameheight"),icon:"tablesamerow",eventname:"sameHeight",check:"select_rows"},{label:Trex._I18N.g("table-sepa","구분"),title:"sepa"},{label:Trex._I18N.g("table-attr","속성"),title:TXMSG("@contextmenu.table.propcell"),icon:"tablecellattribute",popup:"CellAttr"},{label:Trex._I18N.g("table-attr","속성"),title:TXMSG("@contextmenu.table.proptable"),icon:"table",popup:"TableAttr"}]}),Trex.MarkupTemplate.add("contextmenu.table.popup.cellsplit",['<div class="cell_split_prop cell_prop">',"\t<dl>",'\t\t<dt><label><input type="radio" name="split_type" class="rdo" value="row_split"/> '+TXMSG("@table.popup.cellsplit.rowinsert")+"</label></dt>",'\t\t<dd><span class="g_select"><input type="text" name="split_row" class="txt txt_sel" value="2"/><button type="button" class="bg btn btn_up_arrow">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" class="bg btn btn_down_arrow">'+Trex._I18N.g("btn_down_arrow","삭제")+'</button></span><span class="bg ico_col">행 분할 설명 이미지</span></dd>',"\t\t</dl>","\t<dl>",'\t\t<dt><label><input type="radio" name="split_type" class="rdo" value="col_split"/> '+TXMSG("@table.popup.cellsplit.columninsert")+"</label></dt>",'\t\t<dd><span class="g_select"><input type="text" name="split_col" class="txt txt_sel disable" value="2"/><button type="button" class="bg btn btn_up_arrow">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" class="bg btn btn_down_arrow">'+Trex._I18N.g("btn_down_arrow","삭제")+'</button></span><span class="bg ico_row">열 분할 설명 이미지</span></dd>',"\t</dl>","</div>",'<div class="layer_bottom">','\t<button type="button" class="btn btn_ok">'+TXMSG("@table.popup.ok")+"</button>",'\t<button type="button" class="btn btn_cancel">'+TXMSG("@table.popup.cancel")+"</button>","</div>"].join("")),
Trex.MarkupTemplate.add("contextmenu.table.popup.cellattr",['<div class="cell_prop">',"\t<dl>","\t\t<dt>"+Trex._I18N.g("table.detail.border_style","테두리 스타일")+"</dt>",'\t\t<dd class="g_line_dd"><span class="g_line"><span class="line_style line1"></span><button type="button" name="btn_border_style" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t<ul class="line_style_option" style="display:none;">','\t\t\t#{for:line}<li class="#{class}" data-style="#{style}"><a href="javascript:;"></a></li>#{/for:line}',"\t\t\t</ul>","\t\t</dd>","\t</dl>","\t<dl>","\t\t<dt>"+Trex._I18N.g("table.detail.border_line","테두리 두께")+"</dt>",'\t\t<dd><span class="g_select"><input type="text" name="txt_border_line" class="txt txt_sel" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span></dd>","\t</dl>","\t<dl>","\t\t<dt>"+Trex._I18N.g("table.detail.border_color","테두리 색")+"</dt>",'\t\t<dd><input type="text" name="txt_border_color" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t</dd>","\t</dl>",'\t<dl class="line-bottom">',"\t\t<dt>"+Trex._I18N.g("table.detail.cell_bg","셀 배경색")+"</dt>",'\t\t<dd><input type="text" name="txt_cell_bg" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t</dd>","\t</dl>",'\t<dl class="line-bottom">',"\t\t<dt>"+Trex._I18N.g("table.popup.cellattr.lineselect","테두리 선택")+"</dt>",'\t\t<dd class="clear">','\t\t\t<ul class="cell_border">','\t\t\t\t<li><button type="button" name="btn_border1" class="bg btn btn_border1">'+Trex._I18N.g("cellattr.btn_border1","테두리없음")+"</button><em>"+Trex._I18N.g("cellattr.btn_border1.txt","없음")+"</em></li>",'\t\t\t\t<li><button type="button" name="btn_border2" class="bg btn btn_border2">'+Trex._I18N.g("cellattr.btn_border2","모든 테두리")+"</button><em>"+Trex._I18N.g("cellattr.btn_border2.txt","전체")+"</em></li>",'\t\t\t\t<li><button type="button" name="btn_border3" class="bg btn btn_border3">'+Trex._I18N.g("cellattr.btn_border3","바깥쪽 테두리")+"</button><em>"+Trex._I18N.g("cellattr.btn_border3.txt","바깥쪽")+"</em></li>",'\t\t\t\t<li><button type="button" name="btn_border4" class="bg btn btn_border4">'+Trex._I18N.g("cellattr.btn_border4","안쪽 테두리")+"</button><em>"+Trex._I18N.g("cellattr.btn_border4.txt","안쪽")+"</em></li>","\t\t\t</ul>",'\t\t\t<div class="view_border">',"\t\t\t\t<table>","\t\t\t\t\t<colgroup>",'\t\t\t\t\t\t<col style="width:50%;" />','\t\t\t\t\t\t<col style="width:50%;" />',"\t\t\t\t\t</colgroup>","\t\t\t\t\t<tr>",'\t\t\t\t\t\t<td class="top left middle center"></td>','\t\t\t\t\t\t<td class="top right middle"></td>',"\t\t\t\t\t</tr>","\t\t\t\t\t<tr>",'\t\t\t\t\t\t<td class="bottom left center"></td>','\t\t\t\t\t\t<td class="bottom right"></td>',"\t\t\t\t\t</tr>","\t\t\t\t</table>",'\t\t\t\t<button type="button" name="btn_border_top" class="bg btn btn_top">'+Trex._I18N.g("cellattr.align.top","위")+"</button>",'\t\t\t\t<button type="button" name="btn_border_middle" class="bg btn btn_middle">'+Trex._I18N.g("cellattr.align.middle","중간")+"</button>",'\t\t\t\t<button type="button" name="btn_border_bottom" class="bg btn btn_bottom">'+Trex._I18N.g("cellattr.align.bottom","아래")+"</button>",'\t\t\t\t<button type="button" name="btn_border_left" class="bg btn btn_left">'+Trex._I18N.g("cellattr.align.left","왼쪽")+"</button>",'\t\t\t\t<button type="button" name="btn_border_center" class="bg btn btn_center">'+Trex._I18N.g("cellattr.align.center","가운데")+"</button>",'\t\t\t\t<button type="button" name="btn_border_right" class="bg btn btn_right">'+Trex._I18N.g("cellattr.align.right","오른쪽")+"</button>","\t\t\t</div>","\t\t</dd>","\t</dl>","\t<dl>","\t\t<dt>"+Trex._I18N.g("table.popup.cellattr.h_align","수평정렬")+"</dt>","\t\t<dd>",'\t\t\t<span class="g_align"><span class="align_text"></span><button type="button" name="btn_text_align" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t<ul class="align_option" style="display:none;">','\t\t\t\t<li data-style=""></li>','\t\t\t\t<li data-style="left">'+Trex._I18N.g("cellattr.align.left","왼쪽")+"</li>",'\t\t\t\t<li data-style="center">'+Trex._I18N.g("cellattr.align.center","가운데")+"</li>",'\t\t\t\t<li data-style="right">'+Trex._I18N.g("cellattr.align.right","오른쪽")+"</li>","\t\t\t</ul>","\t\t</dd>","\t</dl>",'\t<dl class="line-bottom">',"\t\t<dt>"+Trex._I18N.g("table.popup.cellattr.v_align","수직정렬")+"</dt>","\t\t<dd>",'\t\t\t<span class="g_align"><span class="align_text"></span><button type="button" name="btn_vertical_align" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t<ul class="align_option" style="display:none;">','\t\t\t\t<li data-style=""></li>','\t\t\t\t<li data-style="top">'+Trex._I18N.g("cellattr.align.top","위쪽")+"</li>",'\t\t\t\t<li data-style="middle">'+Trex._I18N.g("cellattr.align.middle","중앙")+"</li>",'\t\t\t\t<li data-style="bottom">'+Trex._I18N.g("cellattr.align.bottom","아래쪽")+"</li>","\t\t\t</ul>","\t\t</dd>","\t</dl>","\t<dl>","\t\t<dt>"+Trex._I18N.g("table.detail.cell_padding","셀 여백")+"</dt>",'\t\t<dd><span class="g_select"><input type="text" name="txt_cell_padding" class="txt txt_sel" /><button type="button" name="btn_cell_padding_up" class="bg btn btn_up_arrow">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_cell_padding_down" class="bg btn btn_down_arrow">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span></dd>","\t</dl>","</div>",'<div class="layer_bottom">','\t<button type="button" class="btn btn_ok">'+TXMSG("@table.popup.ok")+"</button>",'\t<button type="button" class="btn btn_cancel">'+TXMSG("@table.popup.cancel")+"</button>","<div>"].join("")),Trex.MarkupTemplate.add("contextmenu.table.popup.tableattr",['\t<div class="cell_prop table_prop">','\t\t<dl class="line-bottom">','\t\t\t<dt class="tit"><label><input type="radio" name="rdo_table_style" class="rdo" value="custom" checked /> <strong style="cursor:pointer;">@table.detail.menual</strong></label></dt>','\t\t\t<dd class="clear depth2">',"\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.border_style</dt>",'\t\t\t\t\t<dd class="g_line_dd">','\t\t\t\t\t\t<span class="g_line"><span class="line_style line1"></span><button type="button" name="btn_border_style" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t\t\t\t<ul class="line_style_option" style="display:none;">','\t\t\t\t\t\t\t#{for:line}<li class="#{class}" data-style="#{style}"><a href="javascript:;"></a></li>#{/for:line}',"\t\t\t\t\t\t</ul>","\t\t\t\t\t</dd>","\t\t\t\t</dl>","\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.border_line</dt>",'\t\t\t\t\t<dd><span class="g_select"><input type="text" name="txt_border_line" class="txt txt_sel" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span></dd>","\t\t\t\t</dl>","\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.border_color</dt>",'\t\t\t\t\t<dd><input type="text" name="txt_border_color" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t\t\t\t</dd>","\t\t\t\t</dl>","\t\t\t\t<dl>","\t\t\t\t\t<dt>@table.detail.cell_bg</dt>",'\t\t\t\t\t<dd><input type="text" name="txt_cell_bg" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"\t\t\t\t\t</dd>","\t\t\t\t</dl>","\t\t\t</dd>","\t\t</dl>",'\t\t<dl class="table_style">','\t\t\t<dt class="tit"><label><input type="radio" name="rdo_table_style" class="rdo" value="style" /> <strong class="s_disabled" style="cursor:pointer;">@table.detail.style</strong></label></dt>',"\t\t\t<dd>",'\t\t\t\t<span class="g_style"><span class="td_style style1"></span><button type="button" name="btn_table_style" class="bg btn btn_down_arrow2">'+Trex._I18N.g("btn_down_arrow2","펼치기")+"</button></span>",'\t\t\t\t<ul class="td_style_option" style="display:none;">','\t\t\t\t\t#{for:items}<li><span class="td_style #{text}" data-style="#{style}">#{text}</span></li>#{/for:items}',"\t\t\t\t</ul>","\t\t\t</dd>","\t\t</dl>",'\t\t<div class="custom_block"></div>','\t\t<div class="style_block"></div>',"\t</div>",'\t<div class="layer_bottom">','\t\t<button type="button" name="btn_detail_ok" class="btn btn_ok">@table.detail.ok</button>','\t\t<button type="button" name="btn_detail_cancel" class="btn btn_cancel">@table.detail.cancel</button>',"\t<div>"].join("")),Trex.Table.ContextMenu=Trex.Class.create({initialize:function(a,b,c){this._initializedId=c.initializedId?c.initializedId:"",this.config=c,this.menus=TrexConfig.getContextMenu("table").options,this.editor=a,this.canvas=b.canvas,this.tableSelect=b,this.elContextMenu=document.getElementById("tx_contextmenu_div"+this._initializedId),this.elEditorBlockUI=document.getElementById("tx_editor_blockui"+this._initializedId),this.generateContextMenu(),this.observeEvent(),this.elPopup={CellSplit:_NULL,CellProp:_NULL,TableProp:_NULL},_WIN.context=this},generateContextMenu:function(){var a,b,c,d=$(this.elContextMenu).find("ul");$.each(this.menus,function(e,f){a=$('<li class="tx-contextmenu '+("sepa"==f.title?"sepa":"menu")+'"></li>');var g=null;"sepa"!=f.title&&$tx.msie&&document.documentMode<8&&(g=$('<a href="javascript:;" class="tx-contextmenu_a"></a>'),a.append(g)),"sepa"!=f.title&&(b=$('<div class="ts-contextmenu-icon'+(f.icon," "+f.icon)+'"></div>'),c=$("<span>"+f.title+"</span>"),a.data("eventname",f.eventname).data("popupname",f.popup),(g||a).append(b).append(c),f.check&&a.addClass("select"==f.check?"check1":"select_rows"==f.check?"check3":"select_cols"==f.check?"check4":"cell_paste"==f.check?"check5":"check2")),$(d).append(a)})},createColorPallete:function(a,b,c,d,e){var f=new Trex.Menu.ColorPallete({el:a,thumbs:Trex.__CONFIG_COMMON.thumbs,colorInputHidden:c});return f.setCommand(b),f},showContextMenu:function(a){var b=$(this.canvas.elContainer).offset().top-$(this.editor.getWrapper()).offset().top,c=$(this.canvas.elContainer).offset().left-$(this.editor.getWrapper()).offset().left,d=$(this.canvas.elContainer).width(),e=$(this.canvas.elContainer).height(),f=a.clientX+5,g=a.clientY+5,h=g+b,i=f+c,j=$(this.elContextMenu).outerWidth(),k=$(this.elContextMenu).outerHeight(),l=j+f-d,m=k+g-e;m>0&&(h-=m),l>0&&(i-=j+10),h=h<0?0:h,i=i<0?0:i,this.elContextMenu.style.top=h.toPx(),this.elContextMenu.style.left=i.toPx();var n=$(this.elContextMenu).find(".check1"),o=$(this.elContextMenu).find(".check2"),p=$(this.elContextMenu).find(".check3"),q=$(this.elContextMenu).find(".check4"),r=$(this.elContextMenu).find(".check5");if(!this.tableSelect.getSelected().isValid()){if(null==this.tableSelect.currentTable)return;this.tableSelect.selectEnd(this.tableSelect.currentTd),this.tableSelect.applySelected()}if(this.tableSelect.getSelectedTdArr().length>1){$(n).removeClass("disable"),$(o).addClass("disable");var s=this.tableSelect.getSelectedTrArr(!1).selectedTr;$(p)[s.length>1?"removeClass":"addClass"]("disable"),$(q)[s.length>0&&s[0].cells.length>1?"removeClass":"addClass"]("disable")}else $(n).addClass("disable"),$(o).removeClass("disable"),$(p).addClass("disable"),$(q).addClass("disable");var t=Trex.Table.CellCopy.instance;$(r)[t&&t.hasCell()?"removeClass":"addClass"]("disable"),$tx.show(this.elContextMenu)},hideContextMenu:function(){$tx.hide(this.elContextMenu)},showPopup:function(a){this.elPopup[a]||(this.elPopup[a]=this.generatePopupHtml(a)),$tx.show(this.elEditorBlockUI);var b=$(this.canvas.elContainer),c=$(this.elPopup[a]),d=b.outerWidth(),e=b.outerHeight(),f=c.outerWidth(),g=c.outerHeight(),h=Math.ceil(d/2)-Math.ceil(f/2)+b.position().left,i=Math.ceil(e/2)-Math.ceil(g/2)+b.position().top;c.css({top:i,left:h}),this.hideContextMenu(),$tx.show(this.elPopup[a])},hidePopup:function(a){$tx.hide(this.elEditorBlockUI),a?$tx.hide(this.elPopup[a]):$.each(this.elPopup,function(a,b){b!=_NULL&&$tx.hide(this)}),Editor.focus()},observeEvent:function(){var a=this;this.canvas.observeJob(Trex.Ev.__CANVAS_CONTEXTMENU_SHOW,function(b){var c=$tx.findElement(b,"table"),d=$tx.findElement(b,"img");d&&d.tagName&&"img"==d.tagName.toLowerCase()||(c.tagName&&"table"==c.tagName.toLowerCase()?(a.showContextMenu(b),$tx.stop(b)):a.tableSelect.onmousedown($tx.element(b),b))}),$(this.elContextMenu).find("li").on("mousedown",function(a){a.preventDefault()}).on("click",function(b){if(!$(this).hasClass("disable")){if($(this).data("popupname"))return a.showPopup($(this).data("popupname")),void b.preventDefault();var c=$(this).data("eventname"),d=a.canvas.getProcessor();d.table[c]?d.table[c]():a[c]&&a[c](),b.preventDefault()}}),$(this.elEditorBlockUI).on("mousedown",function(a){return!1})},generatePopupHtml:function(a){var b,c;c=a.toLowerCase(),b=document.getElementById(c+"_wrap"+this._initializedId);var d={};if("cellattr"!=c&&"tableattr"!=c||(d.line=[{class:"line1",style:"solid"},{class:"line2",style:"dotted"},{class:"line3",style:"double"}]),"tableattr"==c){d.items=[];for(var e=1;e<=45;e++)d.items.push({text:"style"+e,style:e})}return Trex.MarkupTemplate.get("contextmenu.table.popup."+c).evaluateToDom(d,b),this.popupObserveEvent(b,a),b},popupObserveEvent:function(a,b){var c=this,d=$(a).find(".btn_ok"),e=$(a).find(".btn_cancel");if("CellSplit"==b){var f=$(a).find("input[name=split_type]:eq(0)"),g=$(a).find("input[name=split_type]:eq(1)"),h=$(a).find("input[name=split_row]"),i=$(a).find("input[name=split_col]"),j=$(a).find("button.btn_up_arrow:eq(0)"),k=$(a).find("button.btn_down_arrow:eq(0)"),l=$(a).find("button.btn_up_arrow:eq(1)"),m=$(a).find("button.btn_down_arrow:eq(1)"),n=function(){f.click(),h.val(2),i.val(2)},o=function(a){return isNaN(a)?(alert(Trex._I18N.g("num_validation","입력된 값이 숫자가 아닙니다. 2~10 사이로 입력해주세요")),!1):!(a<2||a>10)||(alert(Trex._I18N.g("num_validation_2-10","2~10 사이로 입력해주세요")),!1)};f.on("click",function(){h.removeClass("disable").prop("readOnly",!1),i.addClass("disable").prop("readOnly",!0),j.prop("disabled",!1),k.prop("disabled",!1),l.prop("disabled",!0),m.prop("disabled",!0)}),g.on("click",function(){h.addClass("disable").prop("readOnly",!0),i.removeClass("disable").prop("readOnly",!1),j.prop("disabled",!0),k.prop("disabled",!0),l.prop("disabled",!1),m.prop("disabled",!1)}),j.on("click",function(){var a=parseInt(h.val())+1;o(a)&&h.val(a)}),k.on("click",function(){var a=parseInt(h.val())-1;o(a)&&h.val(a)}),l.on("click",function(){var a=parseInt(i.val())+1;o(a)&&i.val(a)}),m.on("click",function(){var a=parseInt(i.val())-1;o(a)&&i.val(a)}),n(),d.on("click",function(){var a=f.prop("checked")?"row":"col",d="row"==a?h.val():i.val();if(o(d)){c.splitCells(a,parseInt(d)),c.hidePopup(b);var e=c.tableSelect.currentTd;c.tableSelect.reset(),n(),c.canvas.history.saveHistory(),$tx.msie&&e&&c.canvas.getProcessor().selectFirstText(e)}}),e.on("click",function(){c.hidePopup(b);var a=c.tableSelect.currentTd;c.tableSelect.reset(),n(),$tx.msie&&a&&c.canvas.getProcessor().selectFirstText(a)})}if("CellAttr"==b){var p=c;!function(){function f(a,b){var c=V.borderStyle=b?a:V.borderStyle^a;C[0!=(c&W.T)?"addClass":"removeClass"]("on"),D[0!=(c&W.M)?"addClass":"removeClass"]("on"),E[0!=(c&W.B)?"addClass":"removeClass"]("on"),F[0!=(c&W.L)?"addClass":"removeClass"]("on"),G[0!=(c&W.C)?"addClass":"removeClass"]("on"),H[0!=(c&W.R)?"addClass":"removeClass"]("on");var d="1px solid #666666",e="1px solid #c7c7c7";I.css("border-top",0!=(c&W.T)?d:e),J.css("border-bottom",0!=(c&W.M)?d:e),K.css("border-top",0!=(c&W.M)?d:e),K.css("border-bottom",0!=(c&W.B)?d:e),L.css("border-left",0!=(c&W.L)?d:e),M.css("border-right",0!=(c&W.C)?d:e),N.css("border-left",0!=(c&W.C)?d:e),N.css("border-right",0!=(c&W.R)?d:e)}function g(){V={lineStyle:"solid",lineWidth:"",borderStyle:0},f(W.T|W.M|W.B|W.L|W.C|W.R,!0)}function h(a){a!=v&&p.cellPallete_c&&p.cellPallete_c.hide(),a!=r&&p.linePallete_c&&p.linePallete_c.hide(),a!=k&&($(k).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(l.get(0))),a!=O&&($(O).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(P.get(0))),a!=Q&&($(Q).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(R.get(0)))}function i(){""==V.lineWidth||"0"==V.lineWidth||V.lineColor?""!=V.lineWidth&&"0"!=V.lineWidth||(V.lineColor="",q.val(V.lineColor)):(V.lineColor="#ccc",q.val(V.lineColor)),V.lineColor?s.css("background",V.lineColor):s.css("background","#dfeef9")}function j(){""==V.lineColor||V.lineWidth?""==V.lineColor&&"0"!=V.lineWidth&&(V.lineWidth="",m.val(V.lineWidth)):(V.lineWidth="1",m.val(V.lineWidth))}var k=$(a).find("button[name=btn_border_style]"),l=$(k).closest("dd").find("ul:eq(0)"),m=$(a).find("input[name=txt_border_line]"),n=$(a).find("button[name=btn_line_up]"),o=$(a).find("button[name=btn_line_down]"),q=$(a).find("input[name=txt_border_color]"),r=$(q).next(),s=$(r).find("span"),t=$(r).next(),u=$(a).find("input[name=txt_cell_bg]"),v=$(u).next(),w=$(v).find("span"),x=$(v).next(),y=$(a).find("button[name=btn_border1]"),z=$(a).find("button[name=btn_border2]"),A=$(a).find("button[name=btn_border3]"),B=$(a).find("button[name=btn_border4]"),C=$(a).find("button[name=btn_border_top]"),D=$(a).find("button[name=btn_border_middle]"),E=$(a).find("button[name=btn_border_bottom]"),F=$(a).find("button[name=btn_border_left]"),G=$(a).find("button[name=btn_border_center]"),H=$(a).find("button[name=btn_border_right]"),I=$(a).find(".view_border td.top"),J=$(a).find(".view_border td.middle"),K=$(a).find(".view_border td.bottom"),L=$(a).find(".view_border td.left"),M=$(a).find(".view_border td.center"),N=$(a).find(".view_border td.right"),O=$(a).find("button[name=btn_text_align]"),P=$(O).closest("dd").find("ul:eq(0)"),Q=$(a).find("button[name=btn_vertical_align]"),R=$(Q).closest("dd").find("ul:eq(0)"),S=$(a).find("input[name=txt_cell_padding]"),T=$(a).find("button[name=btn_cell_padding_up]"),U=$(a).find("button[name=btn_cell_padding_down]"),V=null,W={T:1,M:2,B:4,L:8,C:16,R:32};g();var X=function(){$(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(l.get(0));var a=k.closest("span");a.find(".line_style").remove(),a.prepend('<span class="line_style line1"></span>'),V.lineStyle="solid",m.get(0).value="",q.get(0).value="",s.css("background","#dfeef9"),u.val(""),w.css("background","#dfeef9"),a=O.closest("span"),a.find(".align_text").remove(),a.prepend('<span class="align_text"></span>'),a=Q.closest("span"),a.find(".align_text").remove(),a.prepend('<span class="align_text"></span>'),S.get(0).value="",g()},Y={calculate:function(a,b){var c="line"==a?V.lineWidth?V.lineWidth:0:"padding"==a?V.padding?V.padding:0:"",d="line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"padding"==a?Trex.Menu.Table.MAX_PADDING:"";return c=parseInt(c),isNaN(c)&&(c=1),c+b>d||c+b<0?("line"!=a&&"padding"!=a&&alert(TXMSG("@table.alert")),c):(c+=b,c<0&&(c=0),c.toString())},getValidValue:function(a,b,c,d){var e="row"==a?Trex.Menu.Table.MAX_ROW:"col"==a?Trex.Menu.Table.MAX_COL:"line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"padding"==a?Trex.Menu.Table.MAX_PADDING:"";return isNaN(b)?c:((b<0||b>e)&&(b=b>e?e:c,d&&(d.value=b),alert(Trex._I18N.g("number.alert","1",e.toString(),"1 이상 "+e+" 이하의 숫자만 입력 가능합니다."))),b)},validColor:function(a,b,c){var d=b.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return d===_NULL||b.length>8?c:(d[1].length,"#"+d[1].toLowerCase())}};k.on("click",function(){return h(k),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.ltie8&&"true"!=$(l).data("ltie8")&&($(l).data("dd",$(this).closest("dd")),$(".cell_prop",a).append(l),l.css("top","30px"),l.css("right","10px"),$(l).data("ltie8","true")),$tx.show(l.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(l.get(0))),!1}),k.closest("span").on("click",function(){k.click()}),l.find("li").on("click",function(a){var b=null;b=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_line:eq(0)"):$(this).closest("dd").find(".g_line:eq(0)");var c=$(this).attr("class"),d=$(this).data("style");b.find(".line_style").hasClass(c)||(b.find(".line_style").remove(),b.prepend('<span class="line_style '+c+'"></span>')),V.lineStyle=d,k.click(),a.preventDefault()}),m.on("blur",function(){this.value=V.lineWidth=Y.getValidValue("line",this.value,"",this),i()}),m.on("keyup",function(){this.value=V.lineWidth=Y.getValidValue("line",this.value,"",this),i()}),n.on("click",function(){m.get(0).value=V.lineWidth=Y.calculate("line",1),i()}),o.on("click",function(){m.get(0).value=V.lineWidth=Y.calculate("line",-1),i()}),q.on("blur",function(){this.value=V.lineColor=Y.validColor("line",this.value,""),""==this.value?s.css("background","#dfeef9"):s.css("background",this.value),j()}),r.on("click",function(){return h(r),p.linePallete_c==_NULL&&($tx.ltie8&&($(".cell_prop",a).append(t),$(t).css("top","80px"),$(t).css("right","10px")),p.linePallete_c=p.createColorPallete(t.get(0),function(a){a=a.toLowerCase(),V.lineColor=a,q.val(a),""==a?s.css("background","#dfeef9"):s.css("background",a),j()},!1)),$tx.hide(l.get(0)),p.cellPallete_c&&p.cellPallete_c.hide(),p.linePallete_c.toggle(),p.linePallete_c.remainColor(q.val()),!1}),u.on("blur",function(){this.value=V.cellColor=Y.validColor("cell",this.value,""),""==this.value?w.css("background","#dfeef9"):w.css("background",this.value)}),v.on("click",function(){return h(v),p.cellPallete_c==_NULL&&($tx.ltie8&&($(".cell_prop",a).append(x),$(x).css("top","105px"),$(x).css("right","10px")),p.cellPallete_c=p.createColorPallete(x.get(0),function(a){a=a.toLowerCase(),V.cellColor=a,u.val(a),""==a?w.css("background","#dfeef9"):w.css("background",a)},!1)),$tx.hide(l.get(0)),p.linePallete_c&&p.linePallete_c.hide(),p.cellPallete_c.toggle(),p.cellPallete_c.remainColor(u.val()),!1}),y.on("click",function(){return f(0,!0),!1}),z.on("click",function(){return f(W.T|W.M|W.B|W.L|W.C|W.R,!0),!1}),A.on("click",function(){return f(W.T|W.B|W.L|W.R,!0),!1}),B.on("click",function(){return f(W.M|W.C,!0),!1}),C.on("click",function(){return f(W.T),!1}),D.on("click",function(){return f(W.M),!1}),E.on("click",function(){return f(W.B),!1}),F.on("click",function(){return f(W.L),!1}),G.on("click",function(){return f(W.C),!1}),H.on("click",function(){return f(W.R),!1}),O.on("click",function(){return h(O),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.ltie8&&"true"!=$(P).data("ltie8")&&($(P).data("dd",$(this).closest("dd")),$(".cell_prop",a).append(P),P.css("top","231px"),P.css("right","10px"),$(P).data("ltie8","true")),$tx.show(P.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(P.get(0))),!1}),O.closest("span").on("click",function(){O.click()}),P.find("li").on("click",function(){var a=null;a=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_align:eq(0)"):$(this).closest("dd").find(".g_align:eq(0)");var b=$(this).html(),c=$(this).data("style");a.find(".align_text").remove(),a.prepend('<span class="align_text">'+b+"</span>"),V.textAlign=c,O.click()}),Q.on("click",function(){return h(Q),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.ltie8&&"true"!=$(R).data("ltie8")&&($(R).data("dd",$(this).closest("dd")),$(".cell_prop",a).append(R),R.css("top","255px"),R.css("right","10px"),$(R).data("ltie8","true")),$tx.show(R.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(R.get(0))),!1}),Q.closest("span").on("click",function(){Q.click()}),R.find("li").on("click",function(){var a=null;a=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_align:eq(0)"):$(this).closest("dd").find(".g_align:eq(0)");var b=$(this).html(),c=$(this).data("style");a.find(".align_text").remove(),a.prepend('<span class="align_text">'+b+"</span>"),V.verticalAlign=c,Q.click()}),S.on("blur",function(){this.value=V.padding=Y.getValidValue("padding",this.value,"",this)}),S.on("keyup",function(){this.value=V.padding=Y.getValidValue("padding",this.value,"",this)}),T.on("click",function(){S.get(0).value=V.padding=Y.calculate("padding",1)}),U.on("click",function(){S.get(0).value=V.padding=Y.calculate("padding",-1)}),X(),d.on("click",function(){function a(a,b,c,f){var g;if("top"==a||"bottom"==a){if((g=b+("top"==a?-1:c.rowSpan-0))<0)return;var i=h[g];if(!i)return;for(var j=c.index,k=c.index-0+c.colSpan;j<k;j++){var l=i.cells[j];l&&l.colSpan+j-1<=d&&f.push(l.cell)}}else if("left"==a||"right"==a){if((g=b)<0)return;var i=h[g];if(!i)return;var m=c.index+("left"==a?-1:c.colSpan-0);if(m<0||m>d)return;for(var j=0,k=c.rowSpan;j<k;j++){var n=h[g+j];if(!n)break;var l=n.cells[m];l&&l.rowSpan+j+g-1<=e&&f.push(l.cell)}}}var d,e,f=p.tableSelect.getSelectedTrArr(!0),g=f.selectedTr,h=f.allTr;d=g.length>0?g[0].cells[0].index+g[0].cells.length-1:0,e=(g[0]||{index:0}).index+g.length-1;var i={_BT:{"border-bottom":[],"border-top":[]},_BM:{"border-bottom":[],"border-top":[]},_BB:{"border-top":[],"border-bottom":[]},_BL:{"border-right":[],"border-left":[]},_BC:{"border-right":[],"border-left":[]},_BR:{"border-left":[],"border-right":[]}},j=V.borderStyle!=(W.T|W.M|W.B|W.L|W.C|W.R)||""!=V.lineWidth,k=[],l=null;g.length;for(var m=0,n=g.length-1;m<=n;m++){var o=g[m],q=null,r=0;l=o.index,r=o.cells[o.cells.length-1].index;for(var s=0;s<o.cells.length;s++){var t=o.cells[s];t.cell&&(V.cellColor&&$(t.cell.cell).css("background",V.cellColor),V.textAlign&&$(t.cell.cell).css("text-align",V.textAlign),V.verticalAlign&&$(t.cell.cell).css("vertical-align",V.verticalAlign),V.padding&&$(t.cell.cell).css("padding",V.padding+"px")),j&&(0==m&&t.cell&&(i._BT["border-top"].push(t.cell.cell),a("top",o.index,t.cell,i._BT["border-bottom"])),0!=m&&t.cell&&(i._BM["border-top"].push(t.cell.cell),a("top",o.index,t.cell,i._BM["border-bottom"])),0==s&&t.cell&&(i._BL["border-left"].push(t.cell.cell),a("left",o.index,t.cell,i._BL["border-right"])),0!=s&&t.cell&&(i._BC["border-left"].push(t.cell.cell),a("left",o.index,t.cell,i._BC["border-right"])),t.cell&&(q=k[s]=t.cell))}j&&q&&q.cell&&q.index-0+q.colSpan-1==r&&(i._BR["border-right"].push(q.cell),a("right",o.index,q,i._BR["border-left"]))}if(j&&k)for(var u=0;u<k.length;u++){var t=k[u];t.cell&&t.rowIndex-0+t.rowSpan-1==l&&(i._BB["border-bottom"].push(t.cell),a("bottom",l,t,i._BB["border-top"]))}var v={_BT:W.T,_BM:W.M,_BB:W.B,_BL:W.L,_BC:W.C,_BR:W.R};for(var w in i){var x="";if(0!=(V.borderStyle&v[w])&&""!=V.lineWidth?x="0"==V.lineWidth?"0px":V.lineWidth+"px "+V.lineStyle+" "+V.lineColor:0==V.borderStyle?x="0px":0==(V.borderStyle&v[w])&&""==V.lineWidth&&(x="0px"),""!=x)for(var y in i[w])for(var z=0;z<i[w][y].length;z++)$(i[w][y][z]).css(y,x)}c.hidePopup(b);var A=c.tableSelect.currentTd;c.tableSelect.reset(),c.canvas.history.saveHistory(),X(),$tx.msie&&A&&c.canvas.getProcessor().selectFirstText(A)}),e.on("click",function(){c.hidePopup(b);var a=c.tableSelect.currentTd;c.tableSelect.reset(),X(),$tx.msie&&a&&c.canvas.getProcessor().selectFirstText(a)})}()}if("TableAttr"==b){var p=c;!function(){function f(){A={}}function g(a){a!=y&&z.hide(),a!=k&&($(k).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(l.get(0))),a!=v&&p.cellPallete_t&&p.cellPallete_t.hide(),a!=r&&p.linePallete_t&&p.linePallete_t.hide()}function h(){""==A.lineWidth||"0"==A.lineWidth||A.lineColor?""!=A.lineWidth&&"0"!=A.lineWidth||(A.lineColor="",q.val(A.lineColor)):(A.lineColor="#ccc",q.val(A.lineColor)),A.lineColor?s.css("background",A.lineColor):s.css("background","#dfeef9")}function i(){""==A.lineColor||A.lineWidth?""==A.lineColor&&"0"!=A.lineWidth&&(A.lineWidth="",m.val(A.lineWidth)):(A.lineWidth="1",m.val(A.lineWidth))}var j=$(a).find("input[type=radio]"),k=$(a).find("button[name=btn_border_style]"),l=$(k).closest("dd").find("ul:eq(0)"),m=$(a).find("input[name=txt_border_line]"),n=$(a).find("button[name=btn_line_up]"),o=$(a).find("button[name=btn_line_down]"),q=$(a).find("input[name=txt_border_color]"),r=$(q).next(),s=$(r).find("span"),t=$(r).next(),u=$(a).find("input[name=txt_cell_bg]"),v=$(u).next(),w=$(v).find("span"),x=$(v).next(),y=$(a).find("button[name=btn_table_style]"),z=$(y).closest("dd").find("ul:eq(0)"),A=null;f();var B=function(){f(),j.get(0).checked=!0,j.eq(0).next().removeClass("s_disabled"),j.eq(1).next().addClass("s_disabled"),$(a).find(".custom_block").hide(),$(a).find(".style_block").show();var b="#fff",c=1,d="#ccc";b="",c="",d="",A.cellColor=b,A.lineWidth=c,A.lineColor=d,A.lineStyle="solid",u.val(b),u.closest("dd").find("span").css("background",b||"#dfeef9"),m.val(c),q.val(d),q.closest("dd").find("span").css("background",d||"#dfeef9");var e=$(z).closest("dd").find(".g_style:eq(0)");e.find(".td_style").remove(),e.prepend('<span class="td_style style1"></span>'),A.tableStyle="1"},C={calculate:function(a,b){var c="line"==a?A.lineWidth?A.lineWidth:0:"",d="line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"";return c=parseInt(c),isNaN(c)&&(c=1),c+b>d||c+b<0?("line"!=a&&"padding"!=a&&alert(TXMSG("@table.alert")),c):(c+=b,c<0&&(c=0),c.toString())},getValidValue:function(a,b,c,d){var e="line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"";return isNaN(b)?c:((b<0||b>e)&&(b=b>e?e:c,d&&(d.value=b),alert(Trex._I18N.g("number.alert","1",e.toString(),"1 이상 "+e+" 이하의 숫자만 입력 가능합니다."))),b)},validColor:function(a,b,c){var d=b.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return d===_NULL||b.length>8?c:(d[1].length,"#"+d[1].toLowerCase())}};j.on("click",function(){"custom"==this.value?($(this).next().removeClass("s_disabled"),j.eq(1).next().addClass("s_disabled"),$(a).find(".custom_block").hide(),$(a).find(".style_block").show()):($(this).next().removeClass("s_disabled"),j.eq(0).next().addClass("s_disabled"),$(a).find(".custom_block").show(),$(a).find(".style_block").hide()),g(null)}),k.on("click",function(){return g(k),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.ltie8&&"true"!=$(l).data("ltie8")&&($(l).data("dd",$(this).closest("dd")),$(".cell_prop",a).append(l),l.css("top","58px"),l.css("right","10px"),$(l).data("ltie8","true")),$tx.show(l.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(l.get(0))),!1}),k.closest("span").on("click",function(){k.click()}),l.find("li").on("click",function(a){var b=null;b=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_line:eq(0)"):$(this).closest("dd").find(".g_line:eq(0)");var c=$(this).attr("class"),d=$(this).data("style");b.find(".line_style").hasClass(c)||(b.find(".line_style").remove(),b.prepend('<span class="line_style '+c+'"></span>')),A.lineStyle=d,k.click(),a.preventDefault()}),m.on("blur",function(){this.value=A.lineWidth=C.getValidValue("line",this.value,"",this),h()}),m.on("keyup",function(){this.value=A.lineWidth=C.getValidValue("line",this.value,"",this),h()}),n.on("click",function(){m.get(0).value=A.lineWidth=C.calculate("line",1),h()}),o.on("click",function(){m.get(0).value=A.lineWidth=C.calculate("line",-1),h()}),q.on("blur",function(){this.value=A.lineColor=C.validColor("line",this.value,""),""==this.value?s.css("background","#dfeef9"):s.css("background",this.value),i()}),r.on("click",function(){return g(r),p.linePallete_t==_NULL&&($tx.ltie8&&($(".cell_prop",a).append(t),$(t).css("top","105px"),$(t).css("right","10px")),p.linePallete_t=p.createColorPallete(t.get(0),function(a){a=a.toLowerCase(),A.lineColor=a,q.val(a),""==a?s.css("background","#dfeef9"):s.css("background",a),i()},!1)),$tx.hide(l.get(0)),p.cellPallete_t&&p.cellPallete_t.hide(),
p.linePallete_t.toggle(),p.linePallete_t.remainColor(q.val()),!1}),u.on("blur",function(){this.value=A.cellColor=C.validColor("cell",this.value,""),""==this.value?w.css("background","#dfeef9"):w.css("background",this.value)}),v.on("click",function(){return g(v),p.cellPallete_t==_NULL&&($tx.ltie8&&($(".cell_prop",a).append(x),$(x).css("top","135px"),$(x).css("right","10px")),p.cellPallete_t=p.createColorPallete(x.get(0),function(a){a=a.toLowerCase(),A.cellColor=a,u.val(a),""==a?w.css("background","#dfeef9"):w.css("background",a)},!1)),$tx.hide(l.get(0)),p.linePallete_t&&p.linePallete_t.hide(),p.cellPallete_t.toggle(),p.cellPallete_t.remainColor(u.val()),!1}),y.on("click",function(){return g(y),$(this).hasClass("btn_down_arrow2")?($(this).removeClass("btn_down_arrow2").addClass("btn_up_arrow2"),$tx.ltie8&&"true"!=$(z).data("ltie8")&&($(z).data("dd",$(this).closest("dd")),$(".cell_prop",a).append(z),z.css("bottom","50px"),$(z).data("ltie8","true")),z.show()):($(this).removeClass("btn_up_arrow2").addClass("btn_down_arrow2"),z.hide()),!1}),y.closest("span").on("click",function(){y.click()}),z.find("span").on("click",function(){var a=null;a=$tx.ltie8?$(this).closest("ul").data("dd").find(".g_style:eq(0)"):$(this).closest("dd").find(".g_style:eq(0)");var b=$(this).text(),c=$(this).data("style");a.find(".td_style").hasClass(b)||(a.find(".td_style").remove(),a.prepend('<span class="td_style '+b+'"></span>')),A.tableStyle=c,y.click()}),B(),d.on("click",function(){var d=p.tableSelect.getSelectedTrArr(!0),e=(d.selectedTr,d.allTr),f=p.tableSelect.currentTable;if("custom"==$(a).find("input[type=radio]:checked").val()){A.lineStyle||(A.lineStyle="solid");var h={};if("0"==A.lineWidth?h.border="0":null!=A.lineWidth&&""!=A.lineWidth&&(h.border=A.lineWidth+"px "+A.lineStyle+" "+(A.lineColor||"#ccc")),A.cellColor&&(h.background=A.cellColor),h.border||h.background)for(var i=0,j=e.length-1;i<=j;i++)for(var k=e[i],l=0;l<k.cells.length;l++){var m=k.cells[l],n=null;m&&(n=m.cell),n&&$(n).css(h)}}else p.tableTemplateLoader||(p.tableTemplateLoader=new Trex.Table.TemplateLoader),p.tableTemplateLoader.getTemplate(A.tableStyle,function(a){a.apply(f)});g(),c.hidePopup(b);var o=c.tableSelect.currentTd;c.tableSelect.reset(),c.canvas.history.saveHistory(),B(),$tx.msie&&o&&c.canvas.getProcessor().selectFirstText(o)}),e.on("click",function(){g(),c.hidePopup(b);var a=c.tableSelect.currentTd;c.tableSelect.reset(),B(),$tx.msie&&a&&c.canvas.getProcessor().selectFirstText(a)})}()}},splitCells:function(a,b){var c=this.tableSelect.getIndexer(),d=this.tableSelect.currentTd,e=$(this.tableSelect.currentTd).closest("tr").get(0),f=this.tableSelect.currentTable,g=$(d).clone(),h=this.tableSelect.getSelected(),i=_NULL,j=_NULL,k=_NULL,l=_NULL,m=this;Trex.TableUtil.emptyTd(g.get(0));var n=function(a){$(d).width(Math.floor($(d).width()/d.colSpan));for(var b=1;b<a;b++){2==d.colSpan?$tx.ltie8?$(d)[0].colSpan=1:d.removeAttribute("colspan"):d.colSpan--;var c=$(d).clone();$tx.ltie8?$(c)[0].colSpan=1:c.removeAttr("colspan"),$(d).after(c)}};if("row"==a){j=d.rowSpan,l=b-j,$tx.ltie8?$(g)[0].rowSpan=1:g.removeAttr("rowspan");for(var o=1;o<b;o++){j=d.rowSpan;var p;if(!(j>1)){!function(a,b){var d,e,f;e=m.tableSelect.getSelected().bottom,i=c.indexData[e],$.each(i,function(){var b=$(this).get(0);if(d==b)return!0;if(!$(this).hasClass(m.tableSelect.SELECTED_CLASS_NAME)){var c=b.rowSpan;b.rowSpan=c+a}d=b});for(var h=0;h<a;h++)if($tx.msie&&$tx.msie_docmode<=8){var j=c.table.insertRow(e+h+1),k=j.insertCell(0);k.style.cssText=g[0].style.cssText,k.style.height=b+"px"}else{var l=g.clone().height(b),n=$("<tr></tr>").append(l);f=c.table.rows[e+h],$(f).after(n)}}(l,24),$tx.ltie8?$(d)[0].rowSpan=1:$(d).removeAttr("rowspan");break}var q=f.rows[e.rowIndex+j-1];if(0==q.cells.length){$(g).appendTo(q).height(24),2==d.rowSpan?$tx.ltie8?$(d)[0].rowSpan=1:d.removeAttribute("rowspan"):d.rowSpan--;var r=$(d).height()-24;$(d).height(r<24?24:r)}else{for(var s=0;s<q.cells.length&&(p=q.cells[s],!($(q.cells[s]).position().left>$(d).position().left));s++);var t=g.clone();$(t).height($(p).height()),$(p).before(t),2==d.rowSpan?$tx.ltie8?$(d)[0].rowSpan=1:d.removeAttribute("rowspan"):d.rowSpan--;var u=$(t).height(),r=$(d).height()-u;$(d).height(r<24?u:r)}}}else k=d.colSpan,l=b-k,b<=k?n(b):(k>1&&n(k),function(a){i=c.getTdArr(new Trex.TableUtil.Boundary({top:0,right:h.left,bottom:c.getRowSize()-1,left:h.left})),$(d).width(Math.floor($(d).width()/(a+1))),$.each(i,function(){for(var b=1;b<=a;b++)this!=d?this.colSpan++:$(d).after($(d).clone())})}(l))},sameWidth:function(){this.tableSelect.currentTable&&(this.tableSelect.currentTable.style.breakWord="break-all");for(var a=this.tableSelect.getSelectedTrArr(!0),b=a.allTr,c=a.selectedTr,d=0,e=c[0].cells,f=0;f<e.length;f++){var g=e[f].cell;g&&(d+=$(g.cell).width())}for(var h=e[0].cell.index,i=e[e.length-1].cell.index,j=0,f=0;f<e.length;f++)e[f].cell&&(j+=e[f].cell.cColSpan-0);for(var k=Math.round(d/j),l=0;l<b.length;l++)for(var m=b[l].cells,n=h;n<=i;n++)if(m[n]){var o=m[n].cColSpan;$(m[n].cell).width(o*k)}this.hideContextMenu();var p=this.tableSelect.currentTd;$tx.msie&&$tx.msie_docmode<=8&&p&&this.canvas.getProcessor().selectFirstText(p)},sameHeight:function(){this.tableSelect.currentTable&&(this.tableSelect.currentTable.style.breakWord="break-all");for(var a=this.tableSelect.getSelectedTrArr(!0),b=a.allTr,c=a.selectedTr,d=0,e=c,f=0;f<e.length;f++){var g=e[f].cells[0].cell;g&&(d+=$(g.cell).height())}var h=e[0].index,i=e[e.length-1].index,j=i-h+1,k=Math.round(d/j);k<20&&(k=20);for(var l=h;l<=i;l++)for(var m=b[l].cells,n=0;n<m.length;n++)m[n]&&$(m[n].cell).height(m[n].rowSpan*k);this.hideContextMenu();var o=this.tableSelect.currentTd;$tx.msie&&$tx.msie_docmode<=8&&o&&this.canvas.getProcessor().selectFirstText(o)}}),Trex.Table.Selector=Trex.Class.create({SELECTED_CLASS_NAME:"tx_table_selected_cell",SELECTED_CSS_TEXT:"{background:#e9eeff !important}",initialize:function(a,b){this.canvas=a.getCanvas(),this.wysiwygPanel=this.canvas.getPanel(Trex.Canvas.__WYSIWYG_MODE),this.htmlBody=this.getHtmlBody(),this.isDragging=_FALSE,this.currentTable=_NULL,this.currentTd=_NULL,this.paintedTdArr=[],this.startCellBoundary=new Trex.TableUtil.Boundary,this.endCellBoundary=this.startCellBoundary,this.selectedBoundary=new Trex.TableUtil.Boundary,this.tableIndexer=_NULL,this.tableContextMenu=new Trex.Table.ContextMenu(a,this,b),this.applyCss();var c=new Trex.Class.create({$mixins:[Trex.I.KeyObservable],initialize:function(){}});this.tableKeyObserver=new c,this.observeEvent()},hideContextMenu:function(){this.tableContextMenu.hideContextMenu()},getHtmlBody:function(){var a;return a=this.wysiwygPanel.getDocument(),a.body},applyCss:function(){var a;a=this.wysiwygPanel.getDocument(),$tx.applyCSSText(a,"."+this.SELECTED_CLASS_NAME+this.SELECTED_CSS_TEXT)},observeEvent:function(){function a(a){var b,c;return d.canvas.config.readonly===_FALSE&&(c=Trex.TableUtil.getClosestByTagNames(["td","th"],a),isTxInfo=$tom.find(c,".txc-info"),c&&!isTxInfo&&(b=c)),b}function b(a){if($tx.webkit){var b=d.canvas.getProcessor().getRange();b[a?"setEndBefore":"setEndAfter"](d.currentTable),b.collapse(!1),goog.dom.Range.createFromBrowserRange(b).select()}}function c(b){var c=d.canvas.getProcessor().getRange();c.collapse(!1),c=c.startContainer,c.nodeType===goog.dom.NodeType.TEXT&&(c=c.parentElement),b=a(b);var e=!0,f=a(c);return f!==b&&(e=$(b).closest("table").get(0)===$(f).closest("table").get(0)),e}var d;d=this,$tx.webkit&&(this.tableKeyObserver.observeKey({keyCode:38},function(e){var f,g;f=d.canvas.getProcessor().getNode();var h=d.canvas.getProcessor().getRange();f||(f=h.startContainer);var i=$tom.find(f,"%paragraph");if(i&&"TD"!=i.tagName&&"TH"!=i.tagName&&i.previousElementSibling)return!1;if(i&&("TD"==i.tagName||"TH"==i.tagName)&&$(i).find("p, li, dd, dt, h1, h2, h3, h4, h5, td, th, h6, div, caption").length>1)return!1;if(h&&h.startContainer){var j=h.startContainer;if(!j.tagName||"TD"!=j.tagName&&"TH"!=j.tagName)for(var k=j.previousSibling,l=100;null!=k;){if(k.tagName&&"BR"==k.tagName&&k.nextSibling)return!1;if(1==k.nodeType){var m=$(k).find("br");if(1==m.length&&m[0].nextSibling)return!1;if(m.length>1)return!1}if(--l<0)break;k=k.previousSibling}else{var m=$(j).find("br");if(1==m.length&&m[0].nextSibling)return!1;if(m.length>1)return!1}}(g=a(f))&&c(g)&&($tx.stop(e),setTimeout(function(){d.currentTable||d.setTable(g);var a=d.tableIndexer.getBoundary(g);g=d.tableIndexer.getTd(a.top-1,a.left),g?Trex.TableUtil.collapseLastCaret(d.wysiwygPanel,g):b(!0)},0))}),this.tableKeyObserver.observeKey({keyCode:40},function(e){var f,g;f=d.canvas.getProcessor().getNode();var h=d.canvas.getProcessor().getRange();f||(f=h.endContainer);var i=$tom.find(f,"%paragraph");if(i&&"TD"!=i.tagName&&"TH"!=i.tagName&&i.nextElementSibling)return!1;if(i&&("TD"==i.tagName||"TH"==i.tagName)&&$(i).find("p, li, dd, dt, h1, h2, h3, h4, h5, h6, td, th, div, caption").length>1)return!1;if(h&&h.endContainer){var j=h.endContainer;if(!j.tagName||"TD"!=j.tagName&&"TH"!=j.tagName)for(var k=j.nextSibling,l=100;null!=k;){if(k.tagName&&"BR"==k.tagName&&k.nextSibling)return!1;if(1==k.nodeType){var m=$(k).find("br");if(1==m.length&&m[0].nextSibling)return!1;if(m.length>1)return!1}if(--l<0)break;k=k.nextSibling}else{var m=$(j).find("br");if(1==m.length&&m[0].nextSibling)return!1;if(m.length>1)return!1}}(g=a(f))&&c(g)&&($tx.stop(e),setTimeout(function(){d.currentTable||d.setTable(g);var a=d.tableIndexer.getBoundary(g);g=d.tableIndexer.getTd(a.bottom+1,a.left),g?Trex.TableUtil.collapseCaret(d.wysiwygPanel,g):b(!1)},0))})),this.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEDOWN,function(a){var b;b=$tx.element(a),d.onmousedown(b,a)}),$tx.observe(this.htmlBody,"mousemove",function(a){var b;b=$tx.element(a),d.onmousemove(b)}),this.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEUP,function(a){d.onmouseup()});var e;try{e=_WIN.top;e.document}catch(a){e=_WIN}$tx.observe(e,"mouseup",function(a){d.onmouseup()}),this.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_KEYDOWN,function(a){d.isDragging?($tx.stop(a),d.reset()):d.onkeydown(a.ctrlKey,a.keyCode,a)}),this.canvas.observeJob(Trex.Ev.__CANVAS_DATA_INITIALIZE,function(a){a===Trex.Canvas.__WYSIWYG_MODE&&d.clearSelected()})},onmousedown:function(a,b){var c,d;if($tx.isRightClick(b)&&(c=Trex.TableUtil.getClosestByTagNames(["td","th"],a),$(c).hasClass(this.SELECTED_CLASS_NAME)))return void $tx.stop(b);this.reset(),this.canvas.config.readonly===_FALSE&&(c||(c=Trex.TableUtil.getClosestByTagNames(["td","th"],a)),d=$tom.find(c,".txc-info"),c&&!d&&(this.selectStart(c),this.turnOnDragging()))},onmousemove:function(a){if(this.isDragging){var b,c;b=Trex.TableUtil.getClosestByTagNames(["td","th"],a),b?Trex.TableUtil.getClosestByTagNames(["table"],b)===this.currentTable&&b!==this.currentTd&&(this.selectEnd(b),this.applySelected(),Trex.TableUtil.collapseCaret(this.wysiwygPanel,a)):(c=this.endCellBoundary===this.startCellBoundary,this.currentTd&&c&&(this.selectEnd(this.currentTd),this.applySelected(),Trex.TableUtil.collapseCaret(this.wysiwygPanel,a)))}},onmouseup:function(){this.isDragging&&this.turnOffDragging()},onkeydown:function(a,b,c){var d,e,f;if(a===_FALSE)if("none"==this.tableContextMenu.elEditorBlockUI.style.display){if(this.tableKeyObserver.fireKeys(c,!0),b===$tx.KEY_DELETE)for(d=this.getSelectedTdArr(),e=d.length,f=0;f<e;f+=1)Trex.TableUtil.emptyTd(d[f]);this.reset()}else $tx.stop(c),b==$tx.KEY_ESC&&(this.tableContextMenu.hidePopup(),this.reset());else{if(67==b){var g=Trex.Table.CellCopy.instance;g&&g.copy(this)&&$tx.stop(c)}try{67!=b&&86!=b||!this.currentTable||this.reset()}catch(c){}}},setTable:function(a){this.currentTable=Trex.TableUtil.getClosestByTagNames(["table"],a),this.tableIndexer=new Trex.TableUtil.Indexer(this.currentTable)},selectStart:function(a){this.currentTable=Trex.TableUtil.getClosestByTagNames(["table"],a),this.tableIndexer=new Trex.TableUtil.Indexer(this.currentTable),this.startCellBoundary=this.tableIndexer.getBoundary(a),this.endCellBoundary=this.startCellBoundary,this.currentTd=a},selectEnd:function(a){this.endCellBoundary=this.tableIndexer.getBoundary(a),this.currentTd=a},applySelected:function(){this.calculateSelectedBoundary(),this.extendSelectedBoundary(),this.paint()},calculateSelectedBoundary:function(){this.selectedBoundary=new Trex.TableUtil.Boundary,this.selectedBoundary.merge(this.startCellBoundary),this.selectedBoundary.merge(this.endCellBoundary)},extendSelectedBoundary:function(){var a;for(a=this.selectedBoundary.isValid();a;)a=this.oneTimeExtendBoundary()},oneTimeExtendBoundary:function(){var a,b,c,d;for(a=this.tableIndexer.getTdArr(this.selectedBoundary),c=a.length,b=0;b<c;b+=1)if(d=this.tableIndexer.getBoundary(a[b]),this.selectedBoundary.merge(d))return _TRUE;return _FALSE},paint:function(){var a,b;a=this.tableIndexer.getTdArr(this.selectedBoundary),b=Array.prototype.without.apply(this.paintedTdArr,a),this.paintSelected(a),this.eraseSelected(b)},paintSelected:function(a){var b;b=this,this.paintedTdArr=[],a.each(function(a){$tx.addClassName(a,b.SELECTED_CLASS_NAME),b.paintedTdArr.push(a)})},eraseSelected:function(a){this.removeClassName(a),this.paintedTdArr=Array.prototype.without.apply(this.paintedTdArr,a)},removeClassName:function(a){var b;b=this,a.each(function(a){$tx.removeClassName(a,b.SELECTED_CLASS_NAME),""===a.className&&a.removeAttribute("class")===_FALSE&&a.removeAttribute("className")})},clearSelected:function(){var a;try{a=this.paintedTdArr}catch(b){a=$tom.collectAll(this.htmlBody,"."+this.SELECTED_CLASS_NAME)}this.removeClassName(a),this.paintedTdArr=[]},resetBoundary:function(){this.startCellBoundary=new Trex.TableUtil.Boundary,this.endCellBoundary=this.startCellBoundary,this.selectedBoundary=new Trex.TableUtil.Boundary},turnOnDragging:function(){this.isDragging=_TRUE},turnOffDragging:function(){this.isDragging=_FALSE},resetDragging:function(){this.isDragging=_FALSE,this.currentTable=_NULL,this.currentTd=_NULL},isDuringSelection:function(){return this.isDragging},getIndexer:function(){return this.tableIndexer},getSelected:function(){return this.selectedBoundary},getSelectedTdArr:function(){return this.selectedBoundary.isValid()?this.tableIndexer.getTdArr(this.selectedBoundary):[]},getSelectedTrArr:function(a){return this.selectedBoundary.isValid()?this.tableIndexer.getTrArr(this.selectedBoundary,a):{selectedTr:null,allTr:null}},selectByBoundary:function(a){this.resetBoundary(),this.selectedBoundary=a,this.paint()},selectByTd:function(a,b){this.selectStart(a),this.selectEnd(b),this.applySelected()},reset:function(){this.clearSelected(),this.resetBoundary(),this.resetDragging(),this.reloadIndexer(),this.hideContextMenu()},reloadIndexer:function(){this.tableIndexer&&this.tableIndexer.reload()},getSizeOfSelected:function(){var a,b,c,d,e;return a=this.getSelectedTdArr(),0<a.length?(b=a[0],c=a[a.length-1],d=$tom.getPosition(b),e=$tom.getPosition(c),{width:e.x+e.width-d.x,height:e.y+e.height-d.y}):{width:0,height:0}}}),Trex.Table.CellCopy=Trex.Class.create({initialize:function(a,b,c){var d;d=a.getCanvas(),this.wysiwygPanel=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),this.selectedCells=null,this.tableInsert=c},copy:function(a){a.reloadIndexer();var b=a.getSelectedTrArr(!0),c=b.allTr,d=b.selectedTr,e=this.selectedCells=$.extend(!0,[],d),f=null,g=!1;if(e.length>0){var h=a.currentTable,i=$("<table></table>");i[0].style.cssText=h.style.cssText||"",i[0].style.width="",i[0].style.height="";var j=i[0].style.cssText||"";g="collapse"==i[0].style.borderCollapse,i=null,f=$('<div><br><br><table style="'+j+'"'+(h&&h.border?' border="'+h.border+'"':"")+(h&&h.cellSpacing?' cellSpacing="'+h.border+'"':"")+(h&&h.cellPadding?' border="'+h.cellPadding+'"':"")+"><tbody></tbody></table><br><br></div>")}for(var k=0;k<e.length;k++){var l=e[k],m=$("<tr></tr>");$("tbody",f).append(m);for(var n=0;n<l.cells.length;n++){var o=l.cells[n];if(o.cell&&o.cell.cell){o.cell.cell=$(o.cell.cell).clone().removeClass("tx_table_selected_cell")[0];var p=o.cell.cell;try{if(0==k&&g){var q=o.cell.rowIndex-1;if(q>=0){var r=c[q],s=r&&r.cells[o.cell.index];s=s&&s.cell,s&&s.style.borderBottom&&(p.style.borderTop=s.style.borderBottom)}}if(0==n&&g){var q=o.cell.index-1;if(q>=0){var r=c[o.cell.rowIndex],s=r&&r.cells[q];s=s&&s.cell,s&&s.style.borderRight&&(p.style.borderLeft=s.style.borderRight)}}p.setAttribute("style",p.style.cssText)}catch(a){}m.append(p)}}}if(a.hideContextMenu(),e.length>0){if(window.getSelection&&($tx.msie&&$tx.msie_ver>10||$tx.chrome)){var t=$('<div style="top:-5000px;left:-5000px;opacity:0"></div>');t.append(f),$(document.body).append(t);var u=$("table",t)[0],v=window.getSelection();v.removeAllRanges();var w=document.createRange();return w.selectNode(u),v.addRange(w),document.execCommand("copy"),t.remove(),!0}return!1}return this.selectedCells=null,!1},paste:function(a){function b(a,b,c){var d=!1;if(b.colSpan>1){var e=b.colSpan-1;if(e>0){$tx.ltie8?b.cell.colSpan=1:$(b.cell).removeAttr("colspan"),b.colSpan=1,$(b.cell).removeAttr("width"),b.cell.style.width="";for(var f=$(b.cell).clone(),g=0;g<e;g++){var h=f.clone();$(b.cell).after(h),a.cells[c+1+g]={},$.extend(a.cells[c+1+g],b),a.cells[c+1+g].cell=h[0]}}d=!0}return d}a.reloadIndexer();var c=this.selectedCells,d=a.getSelectedTrArr(!0),e=(d.selectedTr,d.allTr),f=a.getSelected(),g=c.length,h=c[0].cells.length,i=f.top,j=f.left,k=f.top+g-1,l=f.left+h-1,m=f.top+g-e.length,n=f.left+h-e[0].cells.length,o=a.getIndexer();if(m>0){var p=e.length-1,q=o.getTdArr(new Trex.TableUtil.Boundary({top:p,right:o.getColSize()-1,bottom:p,left:0})),r=o.getTdArrHasTop(p);this.tableInsert.addRow(o.table,m,p+1,q,r)}if(n>0){var s=o.getColSize()-1,q=o.getTdArr(new Trex.TableUtil.Boundary({top:0,right:s,bottom:o.getRowSize()-1,left:s})),r=o.getTdArrHasLeft(s);this.tableInsert.addCol(n,q,r,this.tableInsert.COL_DIRECTION.LEFT)}a.reloadIndexer(),e=a.getSelectedTrArr(!0).allTr;for(var t=o.getColSize(),u=!1,v=i;v<=k;v++)for(var w=e[v],x=j;x<=l;x++){var y=w.cells[x],z=null,A=0,B=null,C=null;if(null==y||null==y.cell){for(var D=0,E=v-1;E>=0&&(D++,!(z=e[E].cells[x]));E--);A=z.rowSpan-D,z.cell.rowSpan=z.rowSpan=D,1==z.cell.rowSpan&&($tx.ltie8?z.cell.rowSpan=1:$(z.cell).removeAttr("rowspan")),$(z.cell).removeAttr("height"),z.cell.style.height="",B=$(z.cell).clone(),Trex.TableUtil.emptyTd(B.get(0)),$tx.ltie8?$(B)[0].rowSpan=1:B.removeAttr("rowspan"),B.removeAttr("height"),$(B)[0].style.height="",w.cells[x]={},$.extend(w.cells[x],z),y=w.cells[x],y.rowSpan=1,y.cell=B[0];for(var F=x+1;F<t&&!(C=w.cells[F]&&w.cells[F].cell||null);F++);C?$(C).before(B):$(B).appendTo($("tr",o.table)[v])}else(A=y.rowSpan)>1&&($tx.ltie8?y.cell.rowSpan=1:$(y.cell).removeAttr("rowspan"),y.rowSpan=1,$(y.cell).removeAttr("height"),y.cell.style.height="",B=$(y.cell).clone(),B.removeAttr("height"),$(B)[0].style.height="",Trex.TableUtil.emptyTd(B.get(0)));for(var G=1;G<A;G++){for(var H=e[v+G],F=x+1;F<t&&!(C=H.cells[F]&&H.cells[F].cell||null);F++);var I=$(B).clone();H.cells[x]={},$.extend(H.cells[x],y);var J=H.cells[x];J.cell=I[0],C?$(C).before(I):$(I).appendTo($("tr",o.table)[v+G]),b(H,J,x),u=!0}b(w,y,x)&&(u=!0)}u&&(a.reloadIndexer(),e=a.getSelectedTrArr(!0).allTr);for(var K=a.tableIndexer.indexData,L="collapse"==o.table.style.borderCollapse,v=i;v<=k;v++)for(var M=c[v-i],N=e[v],O=K[v],x=j;x<=l;x++){var P=M.cells[x-j];P=P&&P.cell||null;var Q=N.cells[x];if(P){if(P.colSpan>1||P.rowSpan>1){P.colSpan>1&&(Q.cell.colSpan=P.colSpan),P.rowSpan>1&&(Q.cell.rowSpan=P.rowSpan);for(var R=x;R<x+P.colSpan;R++)for(var S=v;S<v+P.rowSpan;S++)if(S!=v||R!=x){var T=e[S],U=T.cells[R];if(U&&U.cell){var V=U.cell.parentElement;if($tom.remove(U.cell),O[R]=Q.cell,V&&V.cells&&0==V.cells.length){for(var W=0;W<O.length;W++)O[W]&&(O[W].rowSpan||1)>1&&(O[W].rowSpan=O[W].rowSpan-1,1!=O[W].rowSpan||$tx.ltie8||O[W].removeAttribute("rowspan")),O[W]&&(O[W].colSpan||1)>1&&(W+=O[W].colSpan-1);$tom.remove(V)}}}}if(Q.cell.innerHTML=P.cell.innerHTML,$.extend(!1,Q.cell.style,P.cell.style),Q.cell.width=P.cell.width,Q.cell.height=P.cell.height,Q.cell.align=P.cell.align,v==i&&L){var X=Q.cell.style.borderTop,V=v>0?e[v-1]:null,Y=V&&V.cells[x];X&&"currentColor"!=X&&Y&&Y.cell&&(Y.cell.style.borderBottom=X)}if(x==j&&L){var Z=Q.cell.style.borderLeft,Y=x>0?N.cells[x-1]:null;Z&&"currentColor"!=Z&&Y&&Y.cell&&(Y.cell.style.borderRight=X)}}}a.hideContextMenu()},hasCell:function(){return null!=this.selectedCells}}),Trex.Table.CellCopy.instance=null,Trex.Table.CellCopy.build=function(a,b,c){return Trex.Table.CellCopy.instance||(Trex.Table.CellCopy.instance=new Trex.Table.CellCopy(a,b,c)),Trex.Table.CellCopy.instance},TrexMessage.addMsg({"@table.merge.confirm":Trex._I18N.g("table.merge.confirm","셀을 병합하면 맨 위쪽 셀에 있는 값만 남고 나머지 값은 잃게 됩니다."),"@table.merge.more.select.cells":Trex._I18N.g("table.merge.more.select.cells","두 개 이상의 셀을 선택해주세요.")}),Trex.Table.Merge=Trex.Class.create({initialize:function(a){var b;b=a.getCanvas(),this.wysiwygPanel=b.getPanel(Trex.Canvas.__WYSIWYG_MODE)},merge:function(a){var b,c,d;if(a.reloadIndexer(),b=a.getSelectedTdArr(),1<b.length){if(this.isExistContents(b,1)&&confirm(TXMSG("@table.merge.confirm"))==_FALSE)return;d=a.getSizeOfSelected(),c=b[0],this._removeRowCount=0,this.deleteCellForMerge(b,a),this.extendCellForMerge(c,a,d),this._removeRowCount=null,a.reset(),Trex.TableUtil.collapseCaret(this.wysiwygPanel,c)}else alert(TXMSG("@table.merge.more.select.cells"))},isExistContents:function(a,b){b=b||0;for(var c=_FALSE,d=b,e=a.length;d<e;d++){var f=a[d]||"",g=f.innerHTML.trim().toLowerCase().replace(/(&nbsp;|\s)/g,""),h="<p></p>"==g,i="<p><br></p>"==g,j=""==g;if(!(h||i||j)){c=_TRUE;break}}return c},deleteCellForMerge:function(a,b){var c,d,e,f;c=a[0].innerHTML,f=a.length;var g=b.tableIndexer.indexData;for(e=1;e<f;e+=1){d=c.replace(Trex.__WORD_JOINER_REGEXP,"").trim(),""!==d&&"&nbsp;"!==d&&"<p></p>"!=d&&"<p><br></p>"!=d||(c=a[e].innerHTML);var h=a[e].parentElement;if($tom.remove(a[e]),h&&h.cells&&0==h.cells.length){for(var i=h.rowIndex,j=g[i],k=0;k<j.length;k++)j[k]&&(j[k].rowSpan||1)>1&&(j[k].rowSpan=j[k].rowSpan-1,1!=j[k].rowSpan||$tx.ltie8||j[k].removeAttribute("rowspan")),j[k]&&(j[k].colSpan||1)>1&&(k+=j[k].colSpan-1);$tom.remove(h),this._removeRowCount++}}a[0].innerHTML=c},extendCellForMerge:function(a,b,c){var d;d=b.getSelected(),a.colSpan=d.right-d.left+1;var e=d.bottom-d.top+1-this._removeRowCount;e<1&&(e=1),a.rowSpan=e,1!=a.rowSpan||$tx.ltie8||a.removeAttribute("rowspan"),1!=a.colSpan||$tx.ltie8||a.removeAttribute("colspan"),a.style.width&&$tom.setWidth(a,c.width+"px"),a.style.height&&$tom.setHeight(a,c.height+"px")},resetMerge:function(a){var b,c;a.reloadIndexer(),b=this.splitCol(a),a.reloadIndexer(),c=this.splitRow(a),b===_FALSE&&c===_FALSE?alert(Trex._I18N.g("resetMerge_error","이미 합쳐진 셀만 분할 가능합니다.")):(a.reloadIndexer(),a.hideContextMenu())},splitCol:function(a){var b,c,d,e,f,g;if(b=_FALSE,c=a.getSelectedTdArr(),0<(f=c.length))for(e=0;e<f;e+=1)d=c[e],g=this.splitTdByColSpan(d),b=b||g;return b},splitRow:function(a){var b,c,d,e,f,g;if(b=_FALSE,c=a.getSelectedTdArr(),0<(f=c.length))for(e=0;e<f;e+=1)d=c[e],g=this.splitTdByRowSpan(d),b=b||g;return b},splitTdByColSpan:function(a){var b,c,d;for(b=a.colSpan-1,d=0<b,Trex.TableUtil.splitWidthByColSpan(a),a.colSpan=1;0<b;)c=Trex.TableUtil.cloneNodeForEmptyTd(a),$tom.insertNext(c,a),b-=1;return d},splitTdByRowSpan:function(a){var b,c;for(c=a.rowSpan-1,b=0<c,Trex.TableUtil.splitHeightByRowSpan(a);0<c;)this.splitTdOneByOne(a),c-=1;return b},splitTdOneByOne:function(a){var b,c,d;b=this.getTrForInsert(a),c=this.getTdForInsert(a,b),d=Trex.TableUtil.cloneNodeForEmptyTd(a),d.rowSpan=1,a.rowSpan-=1,c?$tom.insertAt(d,c):$tom.append(b,d)},getTrForInsert:function(a){var b,c,d;for(d=$tom.parent(a),c=a.rowSpan-1,b=0;b<c;b+=1)d=$tom.next(d,"tr");return d},getTdForInsert:function(a,b){var c,d,e,f,g,h,i,j;for(c=Trex.TableUtil.getTableIndexerFromTd(a),d=c.getBoundary(a),e=d.left,f=b.cells,g=f.length,h=0;h<g;h+=1)if(i=f[h],j=c.getBoundary(i),e<=j.left)return i;return _NULL}}),Trex.Table.Insert=Trex.Class.create({COL_DIRECTION:{LEFT:"left",RIGHT:"right"},initialize:function(a){var b;b=a.getCanvas(),this.wysiwygPanel=b.getPanel(Trex.Canvas.__WYSIWYG_MODE)},insertRowAbove:function(a){var b,c;if(a.reloadIndexer(),b=a.getSelected(),b.isValid()){c=a.getIndexer(),this.insertRowAboveByBoundary(b,c);var d=a.currentTd;a.reset(),$tx.msie&&$tx.msie_docmode<=8&&d&&this.wysiwygPanel.processor.selectFirstText(d)}},insertRowAboveByBoundary:function(a,b){var c,d,e,f,g;c=b.table,d=1,e=a.top,f=b.getTdArr(new Trex.TableUtil.Boundary({top:a.top,right:b.getColSize()-1,bottom:a.top,left:0})),g=b.getTdArrHasTop(a.top),this.addRow(c,d,e,f,g)},addRow:function(a,b,c,d,e){var f,g,h;for(f=function(a){var b;e.contains(a)?(b=Trex.TableUtil.cloneNodeForEmptyTd(a),Trex.TableUtil.splitHeightByRowSpan(b),b.rowSpan=1,$(b).removeClass("tx_table_selected_cell"),h.appendChild(b)):a.rowSpan+=1},g=0;g<b;g+=1)h=a.insertRow(c),d.each(f)},insertRowBelow:function(a){var b,c;if(a.reloadIndexer(),b=a.getSelected(),b.isValid()){c=a.getIndexer(),this.insertRowBelowByBoundary(b,c);var d=a.currentTd;a.reset(),$tx.msie&&$tx.msie_docmode<=8&&d&&this.wysiwygPanel.processor.selectFirstText(d)}},insertRowBelowByBoundary:function(a,b){var c,d,e,f,g;c=b.table,d=1,e=a.bottom+1,f=b.getTdArr(new Trex.TableUtil.Boundary({top:a.bottom,right:b.getColSize()-1,bottom:a.bottom,left:0})),g=b.getTdArrHasBottom(a.bottom),this.addRow(c,d,e,f,g)},insertColLeft:function(a){var b,c;if(a.reloadIndexer(),b=a.getSelected(),b.isValid()){c=a.getIndexer(),this.insertColLeftByBoundary(b,c);var d=a.currentTd;a.reset(),$tx.msie&&$tx.msie_docmode<=8&&d&&this.wysiwygPanel.processor.selectFirstText(d)}},insertColLeftByBoundary:function(a,b){var c,d,e;c=1,d=b.getTdArr(new Trex.TableUtil.Boundary({top:0,right:a.left,bottom:b.getRowSize()-1,left:a.left})),e=b.getTdArrHasLeft(a.left),this.addCol(c,d,e,this.COL_DIRECTION.LEFT)},addCol:function(a,b,c,d){var e,f,g;for(e=this,f=function(a){var b;c.contains(a)?(b=Trex.TableUtil.cloneNodeForEmptyTd(a),Trex.TableUtil.splitWidthByColSpan(b),b.colSpan=1,$(b).removeClass("tx_table_selected_cell"),d===e.COL_DIRECTION.LEFT?$tom.insertAt(b,a):$tom.insertNext(b,a)):a.colSpan+=1},g=0;g<a;g+=1)b.each(f)},insertColRight:function(a){var b,c;if(a.reloadIndexer(),b=a.getSelected(),b.isValid()){c=a.getIndexer(),this.insertColRightByBoundary(b,c);var d=a.currentTd;a.reset(),$tx.msie&&$tx.msie_docmode<=8&&d&&this.wysiwygPanel.processor.selectFirstText(d)}},insertColRightByBoundary:function(a,b){var c,d,e;c=1,d=b.getTdArr(new Trex.TableUtil.Boundary({top:0,right:a.right,bottom:b.getRowSize()-1,left:a.right})),e=b.getTdArrHasRight(a.right),this.addCol(c,d,e,this.COL_DIRECTION.RIGHT)}}),Trex.Table.Delete=Trex.Class.create({initialize:function(a){var b;b=a.getCanvas(),this.wysiwygPanel=b.getPanel(Trex.Canvas.__WYSIWYG_MODE)},deleteRow:function(a){var b;if(b=a.getSelected(),b.isValid()){if($tx.msie)try{this.wysiwygPanel.wysiwygDoc.getSelection().removeAllRanges()}catch(a){}if(this.deleteSelectedRow(a),a.reset(),$tx.msie){var c=a.getIndexer();b.bottom=b.top,b.right=b.left=0,c.indexData[b.top]||(b.bottom=b.top=b.top-1);var d=null;try{d=c.getTdArr(b)[0]}catch(a){}d&&this.wysiwygPanel.processor.selectFirstText(d)}this.deleteEmptyTableByTableSelector(a)}},deleteTable:function(a){var b,c;b=a.getIndexer(),c=b.table;var d=c.previousSibling||c.parentNode;a.reset(),$tom.remove(c),d&&this.wysiwygPanel.processor.selectLastText(d)},deleteSelectedRow:function(a){var b,c,d,e,f,g;b=a.getSelected(),d=a.getIndexer(),c=d.getTdArr(b);for(var h=[],i=0;i<c.length;i++)for(g=c[i],b=d.getBoundary(g),e=b.top,f=b.bottom,e;e<=f;e++)h.contains(e)||(this.deleteRowProc(d,g,e),h.push(e));h.contains(0)&&this.drawTopBorder(a)},deleteRowProc:function(a,b,c){var d,e,f,g;d=this.getTdArrByRowIndex(a,c),g=$tom.parent(b);for(var h=0;h<d.length;h++)e=d[h],f=$tom.parent(e),1<e.rowSpan?(2==e.rowSpan?$tx.ltie8?$(e)[0].rowSpan=1:e.removeAttribute("rowspan"):e.rowSpan--,a.getBoundary(e),this.reduceHeight(e,b),f==g&&this.shiftRowOfTd(e,a)):($tom.remove(e),0==f.children.length&&$tom.remove(f))},reduceHeight:function(a,b){$(a).height($(a).height()-$(b).height())},deleteRowOneByOne:function(a){var b,c,d,e;for(d=a.getSelected(),b=d.top,c=d.bottom-d.top+1;0<c;)a.reloadIndexer(),e=a.getIndexer(),this.deleteRowByIndex(e,b),c-=1;0===b&&this.drawTopBorder(a)},drawTopBorder:function(a){var b,c,d,e,f;for(a.reloadIndexer(),b=a.getIndexer(),c=b.getTdArrHasTop(0),d=c.length,e=0;e<d;e+=1)f=c[e],""!==f.style.borderTop&&"none"!==f.style.borderTop&&"currentColor"!==f.style.borderTop||""===f.style.borderBottom||(f.style.borderTop=f.style.borderBottom)},deleteRowByIndex:function(a,b){var c,d,e,f;c=this.getTdArrByRowIndex(a,b),d=this.getTdArrByHasTop(a,b),0<(e=d.length)&&(f=$tom.parent(c[0]),this.deleteTdInDeleteRow(c,d,f,a),$tom.remove(f))},getTdArrByRowIndex:function(a,b){return a.getTdArr(new Trex.TableUtil.Boundary({top:b,right:a.getColSize()-1,bottom:b,left:0}))},getTdArrByHasTop:function(a,b){return a.getTdArrHasTop(b)},deleteTdInDeleteRow:function(a,b,c,d){var e,f,g;for(e=a.length,f=0;f<e;f+=1)g=a[f],1<g.rowSpan?(2==g.rowSpan?$tx.ltie8?$(g)[0].rowSpan=1:g.removeAttribute("rowspan"):g.rowSpan--,this.reduceHeightAsRow(g,c),b.contains(g)&&this.shiftRowOfTd(g,d)):$tom.remove(g)},reduceHeightAsRow:function(a,b){var c,d;a.style.height&&(c=parseInt(a.style.height,10),0<(d=c-b.offsetHeight)&&$tom.setStyles(a,{height:d+"px"},_TRUE))},shiftRowOfTd:function(a,b){var c,d,e;c=$tom.parent(a),d=$tom.next(c,"tr"),e=this.getTdForInsert(a,d,b),e?$tom.insertAt(a,e):$tom.append(d,a)},getTdForInsert:function(a,b,c){var d,e,f,g,h,i,j;for(d=c.getBoundary(a),e=d.left,f=b.cells,g=f.length,h=0;h<g;h+=1)if(i=f[h],j=c.getBoundary(i),e<=j.left)return i;return _NULL},deleteEmptyTableByTableSelector:function(a){var b,c,d;b=a.getIndexer(),c=b.table,c&&(d=c.previousSibling||c.parentNode),c&&(c.rows&&0===c.rows.length||c.cells&&0===c.cells.length||!c.cells&&b&&b.indexData&&0===b.indexData.length)&&($tom.remove(c),d&&this.wysiwygPanel.processor.selectLastText(d))},deleteCol:function(a){var b;if(b=a.getSelected(),b.isValid()){if($tx.msie)try{this.wysiwygPanel.wysiwygDoc.getSelection().removeAllRanges()}catch(a){}if(this.deleteColOneByOne(a),a.reset(),$tx.msie){var c=a.getIndexer();b.bottom=b.top,b.right=b.left;var d=null;try{var e=c.getTdArr(b);d=e[0]}catch(a){}if(!d)try{b.right=b.left=b.left-1;var e=c.getTdArr(b);d=e[0]}catch(a){}d&&this.wysiwygPanel.processor.selectFirstText(d)}this.deleteEmptyTableByTableSelector(a)}},deleteColOneByOne:function(a){var b,c,d,e;for(d=a.getSelected(),b=d.left,c=d.right-d.left+1;0<c;)a.reloadIndexer(),e=a.getIndexer(),this.deleteColByIndex(e,b),c-=1;0===b&&this.drawLeftBorder(a)},drawLeftBorder:function(a){var b,c,d,e,f;for(a.reloadIndexer(),b=a.getIndexer(),c=b.getTdArrHasLeft(0),d=c.length,e=0;e<d;e+=1)f=c[e],""!==f.style.borderLeft&&"none"!==f.style.borderLeft&&"currentColor"!==f.style.borderLeft||""===f.style.borderRight||(f.style.borderLeft=f.style.borderRight)},deleteColByIndex:function(a,b){var c,d,e,f;for(c=this.getTdArrByColIndex(a,b),d=c.length,e=0;e<d;e+=1)f=c[e],1<f.colSpan?2==f.colSpan?$tx.ltie8?$(f)[0].colSpan=1:f.removeAttribute("colspan"):f.colSpan--:$tom.remove(f)},getTdArrByColIndex:function(a,b){return a.getTdArr(new Trex.TableUtil.Boundary({top:0,right:b,bottom:a.getRowSize()-1,left:b}))}}),Trex.Table.Border=Trex.Class.create({$const:{BORDER_STYLE:"1px solid #ccc"},initialize:function(a,b){var c;c=a.getCanvas(),this.wysiwygPanel=c.getPanel(Trex.Canvas.__WYSIWYG_MODE),this.borderRange="all",this.borderColor="#4174D9",this.tableSelect=_NULL,this.selectedBoundary=_NULL},setBorderRange:function(a){this.borderRange=a},setTableSelect:function(a){this.tableSelect=a,this.selectedBoundary=a.getSelected()},changeTopBorderStyle:function(a,b,c){var d,e,f,g={},h=this.selectedBoundary,i=this.tableSelect.getIndexer();0==h.top?(d="borderTop"+b,f=new Trex.TableUtil.Boundary({top:h.top,bottom:h.top,left:h.left,right:h.right})):(d="borderBottom"+b,f=new Trex.TableUtil.Boundary({top:h.top-1,bottom:h.top-1,left:h.left,right:h.right})),e=i.getTdArr(f),g[d]=c
;for(var j=0;j<e.length;j++)$tx.setStyle(e[j],g)},changeBottomBorderStyle:function(a,b,c){var d,e,f,g={},h=this.selectedBoundary,i=this.tableSelect.getIndexer();d="borderBottom"+b,f=new Trex.TableUtil.Boundary({top:h.bottom,bottom:h.bottom,left:h.left,right:h.right}),e=i.getTdArr(f),g[d]=c;for(var j=0;j<e.length;j++)$tx.setStyle(e[j],g)},changeLeftBorderStyle:function(a,b,c){var d,e,f,g={},h=this.selectedBoundary,i=this.tableSelect.getIndexer();0==h.left?(d="borderLeft"+b,f=new Trex.TableUtil.Boundary({top:h.top,bottom:h.bottom,left:h.left,right:h.left})):(d="borderRight"+b,f=new Trex.TableUtil.Boundary({top:h.top,bottom:h.bottom,left:h.left-1,right:h.left-1})),e=i.getTdArr(f),g[d]=c;for(var j=0;j<e.length;j++)$tx.setStyle(e[j],g)},changeRightBorderStyle:function(a,b,c){var d,e,f,g={},h=this.selectedBoundary,i=this.tableSelect.getIndexer();d="borderRight"+b,f=new Trex.TableUtil.Boundary({top:h.top,bottom:h.bottom,left:h.right,right:h.right}),e=i.getTdArr(f),g[d]=c;for(var j=0;j<e.length;j++)$tx.setStyle(e[j],g)},changeInBorderStyle:function(a,b,c){var d,e,f,g,h,i,j={},k={},l=this.selectedBoundary,m=this.tableSelect.getIndexer();f="borderBottom"+b,h=new Trex.TableUtil.Boundary({top:l.top,bottom:l.bottom-1,left:l.left,right:l.right}),d=m.getTdArr(h),j[f]=c;for(var n=0;n<d.length;n++)$tx.setStyle(d[n],j);g="borderRight"+b,i=new Trex.TableUtil.Boundary({top:l.top,bottom:l.bottom,left:l.left,right:l.right-1}),e=m.getTdArr(i),k[g]=c;for(var n=0;n<e.length;n++)$tx.setStyle(e[n],k)},changeOutBorderStyle:function(a,b,c){this.changeTopBorderStyle(a,b,c),this.changeBottomBorderStyle(a,b,c),this.changeLeftBorderStyle(a,b,c),this.changeRightBorderStyle(a,b,c)},changeNoneBorderStyle:function(a,b,c){},changeBorderStyle:function(a,b,c){switch(this.borderRange){case"top":this.changeTopBorderStyle(a,b,c);break;case"bottom":this.changeBottomBorderStyle(a,b,c);break;case"left":this.changeLeftBorderStyle(a,b,c);break;case"right":this.changeRightBorderStyle(a,b,c);break;case"in":this.changeInBorderStyle(a,b,c);break;case"out":this.changeOutBorderStyle(a,b,c);break;case"all":case"none":this.changeInBorderStyle(a,b,c),this.changeOutBorderStyle(a,b,c)}},changeBorderColor:function(a,b){b!=_NULL&&(this.borderColor=b),this.changeBorderStyle(a,"Color",this.borderColor)},changeBorderType:function(a,b){this.changeBorderStyle(a,"Style",b),this.changeBorderColor(a)},changeBorderHeight:function(a,b){var c=b.toPx();this.changeBorderStyle(a,"Width",c),this.changeBorderColor(a)}}),function(){Trex.Table.TemplateLoader=Trex.Class.create({initialize:function(){this.templateList=_NULL},getTemplate:function(b,c){if(!isNaN(b))if(this.templateList)c(new a(this.templateList[b]));else{var d=this;this.loadTemplate(function(e){d.templateList=e,c(new a(d.templateList[b]))})}},loadTemplate:function(a){var b=this.getJSBasePath()+"trex/modules/table/async/template_data"+(Trex._JS_MIN?".min":"")+".js";"development"==EditorJSLoader.getOption("environment")&&(b+="?dummy="+(new Date).getTime()),EditorJSLoader.asyncLoadModule({url:TrexConfig.getUrl(b),callback:function(){var b=getTableTemplateList();a(b)}})},getJSBasePath:function(){var a;try{a=EditorJSLoader.getJSBasePath("editor.js")}catch(b){a=EditorJSLoader.getJSBasePath()}return a}});var a=Trex.Class.create({initialize:function(a){this.templateData=a},apply:function(a){for(var b=new Trex.Tool.Table.TableCellMatrixer(a),c=b.getTdMatrix(),d=this,e=0;e<c.length;e++)for(var f=0;f<c[e].length;f++)d.setCellStyle(c[e][f],{isEvenRow:e%2==1,isFirstRow:0==e,isLastRow:e==c.length-1,isFirstCol:0==f,isLastCol:f==c[e].length-1})},setCellStyle:function(a,b){var c=this.templateData,d=Object.extend({},c.common);Object.extend(d,b.isEvenRow?c.evenRow:c.oddRow),Object.extend(d,b.isFirstRow?c.firstRow:b.isLastRow?c.lastRow:{}),Object.extend(d,b.isLastCol?c.lastCol:{}),Object.extend(d,b.isFirstCol?c.firstCol:{}),txlib.setStyle(a,d)}})}(),Trex.module("page up & down",function(a,b,c,d,e){d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(a){function b(){c()}function c(){function a(a){window.scrollTo(c,b)}var b=(_WIN.pageYOffset||_DOC.documentElement.scrollTop)-(_DOC.documentElement.clientTop||0),c=(_WIN.pageXOffset||_DOC.documentElement.scrollLeft)-(_DOC.documentElement.clientLeft||0);$tx.observe(_WIN,"scroll",a),setTimeout(function(){$tx.stopObserving(_WIN,"scroll",a)},30)}$tx.observe(a,"keydown",function(a){/^(33|34)$/.test(a.keyCode)&&b()})})}),Trex.module("table resize dragger",function(a,b,c,d){d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){function a(a){return Math.min.apply(Math,a)}function b(){d.history.saveHistory()}var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),C=B.getDocument(),D=B.getWindow(),E=C.body,F=$tom.collect(d.wysiwygEl,".tx-table-col-resize-dragger"),G=$tom.collect(d.wysiwygEl,".tx-table-row-resize-dragger"),H=_FALSE,I=_FALSE,J=_FALSE,K={TOP:"EDGE_TOP",BOTTOM:"EDGE_BOTTOM",LEFT:"EDGE_LEFT",RIGHT:"EDGE_RIGHT",NONE:"NONE",TABLE_LEFT:"TABLE_LEFT",TABLE_LEFT:"TABLE_TOP"},L=K.NONE,M=function(){H=_FALSE,I=J=_FALSE,o=_NULL,p=_NULL,e=f=_NULL,g=h=_NULL,t=s=u=_NULL,v=w=x=_NULL,q=r=0,l=m=n=0,i=j=k=0},N=function(){if(e=$tom.find(o,"table"),e.style.breakWord="break-all",e==_NULL)return _NULL;if(L==K.TABLE_TOP||L==K.TABLE_LEFT)return _NULL;switch(H=_TRUE,l=e.offsetWidth,L!=K.NONE&&($tx.stop(A),ia()),L){case K.LEFT:O(),Y();break;case K.RIGHT:P(),Y();break;case K.TOP:Q(),da();break;case K.BOTTOM:R(),da()}},O=function(){var a=new Trex.TableUtil.Indexer(e),b=a.getBoundary(o);b.left>0&&(s=a.getTdArrHasRight(b.left-1),t=a.getTdArrHasLeft(b.left))},P=function(){var a=new Trex.TableUtil.Indexer(e),b=a.getBoundary(o),c=a.getColSize();s=a.getTdArrHasRight(b.right),b.right<c-1&&(t=a.getTdArrHasLeft(b.right+1))},Q=function(){var a=new Trex.TableUtil.Indexer(e),b=a.getBoundary(o);u=a.getTdArrHasBottom(b.top-1)},R=function(){var a=new Trex.TableUtil.Indexer(e),b=a.getBoundary(o);u=a.getTdArrHasTop(b.bottom)},S=function(){switch(L){case K.LEFT:case K.RIGHT:ba();break;case K.TOP:case K.BOTTOM:fa()}},T=function(a){if(L==K.TABLE_TOP||L==K.TABLE_LEFT){try{L=K.NONE,ia();var b=$tom.find(o,"table"),c=E.createControlRange();c.add(b),c.select()}catch(a){}return $tx.stop(a),_NULL}},U=function(){H?(p=X(),V()):W()},V=function(){switch(L){case K.LEFT:case K.RIGHT:Z();break;case K.TOP:case K.BOTTOM:ea()}},W=function(){var a=$tom.find($tx.element(A),"td"),b=$tom.find(a,".txc-info");a&&!b?(o=a,L=ha(o),ia()):(L=K.NONE,ia())},X=function(){var a=_NULL;switch(L){case K.LEFT:case K.RIGHT:a=F;break;case K.TOP:case K.BOTTOM:a=G}return a},Y=function(){H=_TRUE,J=_FALSE,v=[],w=[];var b=0;if(s){for(b=0;b<s.length;b++)v.push(s[b].offsetWidth);for(i=a(v),b=0;b<s.length;b++)if(i==v[b]){g=s[b];break}}if(t){for(b=0;b<t.length;b++)w.push(t[b].offsetWidth);for(j=a(w),b=0;b<t.length;b++)if(j==w[b]){h=t[b];break}}m=$tx.getCoordsTarget(p).left},Z=function(){if(H){J=_TRUE;var a,b=parseInt(y-$tom.getScrollLeft(C)-m);g&&h&&(a=$(g,b)),g&&h==_NULL&&(a=_(g,b)),g==_NULL&&h&&(a=aa(h,b)),a&&$tx.setStyle(p,{left:a.toPx()})}},$=function(a,b){var c,d,e,f,g;return c=i+j,d=i+b,e=j-b,f=$tx.getCoordsTarget(a),d>=20&&e>=20?g=y-$tom.getScrollLeft(C):d<=20?(d=20,e=c-d,g=f.left-$tom.getScrollLeft(C)+d):e<=20&&(e=20,d=c-e,g=f.left-$tom.getScrollLeft(C)+d),q=d-i,g},_=function(a,b){var c,d,e;return c=i+b,d=$tx.getCoordsTarget(a),c<20&&(c=20),e=d.left-$tom.getScrollLeft(C)+c,q=c-i,e},aa=function(a,b){var c,d,e;return c=j-b,d=$tx.getCoordsTarget(a),c<20&&(c=20),e=d.left+c,q=j-c,e},ba=function(){ca(),M(),W(),b()},ca=function(){var a;if(s)for(a=0;a<s.length;a++)s[a].style.width=(v[a]+q).toPx();if(t)for(a=0;a<t.length;a++)t[a].style.width=(w[a]-q).toPx();s&&t==_NULL&&la()},da=function(){if(H=_TRUE,I=_FALSE,k=o.offsetHeight,x=[],u){var b;for(b=0;b<u.length;b++)x.push(parseInt(u[b].offsetHeight));for(k=a(x),b=0;b<u.length;b++)k==x[b]&&(f=u[b])}n=$tx.getCoordsTarget(p).top},ea=function(){if(H){I=_TRUE;var a=z-$tom.getScrollTop(C)-n,b=k+parseInt(a),c=$tx.getCoordsTarget(f),d=_NULL;b<0?(b=0,d=c.top+b-$tom.getScrollTop(C)):d=z-$tom.getScrollTop(C),d&&$tx.setStyle(p,{top:d.toPx()}),r=b-k}},fa=function(){I&&ga(),M(),W(),b()},ga=function(){if(u){try{if(u[0]){var a=u[0].parentNode;a&&"TR"==a.nodeName&&(a.style.height="",a.removeAttribute("height"));var b=null;b=a.parentNode,b&&"TABLE"!=b.nodeName&&(b=b.parentNode),b&&"TABLE"==b.nodeName&&b.style.height&&(b.style.height=b.offsetHeight+r+"px")}}catch(a){}for(var c=0;c<u.length;c++){var d=x[c]+r;d<0&&(d=20),u[c].style.height=d.toPx()}}};!function(){var a=C.createElement("div");E.appendChild(a),a.style.width=a.style.paddingLeft="1px",c=2===a.offsetWidth,E.removeChild(a)}();var ha=function(a){var b,d=K.NONE;if("getBoundingClientRect"in document.documentElement)try{var e=a.ownerDocument,f=e.documentElement,g=e.body,h=a.getBoundingClientRect(),i=$tom.getWindow(e),j=f.clientTop||g.clientTop||0,k=f.clientLeft||g.clientLeft||0,l=i.pageYOffset||c&&f.scrollTop||g.scrollTop,m=i.pageXOffset||c&&f.scrollLeft||g.scrollLeft,n=h.top+l-j,o=h.left+m-k;b={top:n,left:o,bottom:n+a.offsetHeight,right:o+a.offsetWidth}}catch(a){b=_NULL}return b||(b=$tx.getCoordsTarget(a)),y-b.left<5&&0!=a.cellIndex?d=K.LEFT:$tx.msie&&y-b.left<5&&0==a.cellIndex?d=K.TABLE_LEFT:b.right-5<y?d=K.RIGHT:z-b.top<5&&0!=a.parentNode.rowIndex?d=K.TOP:$tx.msie&&z-b.top<5&&0==a.parentNode.rowIndex?d=K.TABLE_TOP:b.bottom-5<z&&(d=K.BOTTOM),d},ia=function(){d.query(function(a){if(a.table)switch((a.table.isDuringSelection()||d.config.readonly)&&(L=K.NONE),L){case K.LEFT:case K.RIGHT:case K.TABLE_LEFT:$tx.hide(G),$tx.show(F),ja(F),p=F;break;case K.TOP:case K.BOTTOM:case K.TABLE_TOP:$tx.hide(F),$tx.show(G),ka(G),p=G;break;case K.NONE:$tx.hide(F),$tx.hide(G)}})},ja=function(a){if(a!=_NULL){var b;$tx.setStyle(a,{cursor:L==K.TABLE_LEFT?"move":"col-resize"}),H?(b=$tx.getCoordsTarget(a).left,$tx.setStyle(a,{width:"2px",height:B.el.clientHeight.toPx(),border:"1px dotted #81aFFC",background:"",left:b.toPx()}),$tx.setOpacity(F,1)):(b=y-$tom.getScrollLeft(C),$tx.setStyle(a,{width:"2px",height:B.el.clientHeight.toPx(),border:"",background:"#fff",left:b.toPx()}),$tx.setOpacity(F,0))}},ka=function(a){if(a!=_NULL){var b=_NULL;$tx.setStyle(a,{cursor:L==K.TABLE_TOP?"move":"row-resize"}),H?(b=$tx.getCoordsTarget(a).top,$tx.setStyle(a,{height:"2px",border:"1px dotted #81aFFC",background:"",top:b.toPx(),width:B.el.clientWidth-2+"px"}),$tx.setOpacity(G,1)):(b=z-$tom.getScrollTop(C),$tx.setStyle(a,{height:"2px",border:"",background:"#fff",top:b.toPx(),width:B.el.clientWidth-2+"px"}),$tx.setOpacity(G,0))}},la=function(){var a=0;l&&(a=parseInt(l)+q,e.width=a.toPx(),e.style.width=a.toPx())},ma=function(a){A=a,y=oa(A),z=pa(A)},na=function(a){A=a,y=oa(A)-$tx.getCoords(d.wysiwygEl).left+C.body.scrollLeft,z=pa(A)-$tx.getCoords(d.wysiwygEl).top+C.body.scrollTop},oa=function(a){var b=0;return a=a||D.event,a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+C.body.scrollLeft+C.documentElement.scrollLeft),b},pa=function(a){var b=0;return a=a||D.event,a.pageY?b=a.pageY:a.clientY&&(b=a.clientY+C.body.scrollTop+C.documentElement.scrollTop),b};M(),function(){$tx.observe(_DOC.body,"mouseup",function(a){ma(a),S()}),$tx.msie?($tx.observe(E,"mousemove",function(a){ma(a),U()}),$tx.observe(E,"mouseup",function(a){ma(a),S()})):($tx.observe(D,"mousemove",function(a){ma(a),U()}),$tx.observe(D,"mouseup",function(a){ma(a),S()})),$tx.safari&&$tx.observe(_DOC.body,"mousemove",function(a){H&&(na(a),U())}),$tx.observe(F,"mousedown",function(a){ma(a),N()}),$tx.observe(G,"mousedown",function(a){ma(a),N()}),$tx.msie&&$tx.observe(G,"click",function(a){T(a)})}()})}),Trex.module("image contextmenu",function(a,b,c,d,e){d.observeJob(Trex.Ev.__IFRAME_LOAD_COMPLETE,function(){var c=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),f=c.getDocument(),g=(c.getWindow(),f.body,null);!function(){g=new Trex.Image.ContextMenu(a,b,d,e)}()})}),TrexConfig.addContextMenu("image",{options:[{label:"image",title:Trex._I18N.g("image.property.title","이미지 속성"),icon:"imageinfo",popup:"imageInfo"},{label:"image_edit",title:Trex._I18N.g("image_editor.title","이미지 편집"),icon:"image_editor",popup:"imageEditor"},{label:"image_delete",title:Trex._I18N.g("image.delete","이미지 삭제"),icon:"image_delete",eventname:"Delete"}]}),Trex.Image={},Trex.Image.EDIT_TARGET={},Trex.Image.ContextMenu=Trex.Class.create({initialize:function(a,b,c,d){var e=this;a.config.imageEditorPath||TrexConfig.getContextMenu("image").options.splice(1,1),this._initializedId=d.initializedId?d.initializedId:"",this.config=d,this.menus=TrexConfig.getContextMenu("image").options,this.editor=a,this.canvas=c,this.toolbar=b,this.elContextMenu=document.getElementById("tx_image_contextmenu_div"+this._initializedId),this.imageInfo=new Trex.Image.ImageInfo(a,b,c,d,"property"),this.imageEditor={showPopup:function(a){var b="_IE_"+(new Date).getTime().toString(16);Trex.Image.EDIT_TARGET[b]=a,e.editor.getSidebar().getAttacher("image_edit").execute("instance="+e.editor.kEditor.instanceId+"&_TI="+b)}},this.generateContextMenu(),this.observeEvent()},generateContextMenu:function(){var a,b,c,d=$(this.elContextMenu).find("ul");$.each(this.menus,function(e,f){a=$('<li class="tx-contextmenu '+("sepa"==f.title?"sepa":"menu")+'"></li>');var g=null;"sepa"!=f.title&&$tx.msie&&document.documentMode<8&&(g=$('<a href="javascript:;" class="tx-contextmenu_a"></a>'),a.append(g)),"sepa"!=f.title&&(b=$('<div class="ts-contextmenu-icon'+(f.icon," "+f.icon)+'"></div>'),c=$("<span>"+f.title+"</span>"),a.data("eventname",f.eventname).data("popupname",f.popup),(g||a).append(b).append(c),f.check&&a.addClass("select"==f.check?"check1":"select_rows"==f.check?"check3":"select_cols"==f.check?"check4":"check2")),$(d).append(a)})},showContextMenu:function(a,b){this.currentTarget=b;var c=$(this.editor.getWrapper()).offset().top,d=$(this.editor.getWrapper()).offset().left,e=$(this.canvas.elContainer).offset().top-c,f=$(this.canvas.elContainer).offset().left-d,g=$(this.canvas.elContainer).width(),h=$(this.canvas.elContainer).height(),i=a.clientX+5,j=a.clientY+5,k=j+e,l=i+f,m=$(this.elContextMenu).outerWidth(),n=$(this.elContextMenu).outerHeight(),o=m+i-g,p=n+j-h;p>0&&(k-=p),o>0&&(l-=m+10),k=k<0?0:k,l=l<0?0:l,this.elContextMenu.style.top=k.toPx(),this.elContextMenu.style.left=l.toPx();var q=$(".image_editor",this.elContextMenu).closest("li"),r=this.currentTarget.src;-1==r.search(/^data:/i)&&-1==r.toLowerCase().indexOf(document.location.hostname)?q.hide():q.show(),$tx.show(this.elContextMenu),$tx.stop(a)},hideContextMenu:function(){$tx.hide(this.elContextMenu)},observeEvent:function(){var a=this;this.canvas.observeJob(Trex.Ev.__CANVAS_CONTEXTMENU_SHOW,function(b){var c=$tx.findElement(b,"img");c.tagName&&"img"==c.tagName.toLowerCase()&&(a.showContextMenu(b,c),$tx.stop(b))}),this.canvas.observeJob(Trex.Ev.__CANVAS_PANEL_MOUSEDOWN,function(b){a.hideContextMenu()}),this.toolbar.observeJob(Trex.Ev.__TOOL_CLICK,function(b){a.hideContextMenu()}),$(this.elContextMenu).find("li").on("click",function(b){if(!$(this).hasClass("disable"))return $(this).data("popupname")?(a.showPopup($(this).data("popupname")),void b.preventDefault()):$(this).data("eventname")?(a["exec"+$(this).data("eventname")](),void b.preventDefault()):void b.preventDefault()})},showPopup:function(a){this[a]&&(this.hideContextMenu(),this[a].showPopup(this.currentTarget))},execDelete:function(){$(this.currentTarget).remove(),this.hideContextMenu(),this.canvas.history.saveHistory()}}),Trex.MarkupTemplate.add("image.property",['<div class="layer_top">',"#{title}","</div>",'<div class="tx-menu-inner">','    <div style="position:absolute;top:-2000px;left:-2000px;width:10px;height:10px;overflow:hidden;"><canvas class="tmp_canvas" width="1" height="1"></canvas></div>','<div style="position:absolute;top:-2000px;left:-2000px;width:10px;height:10px;overflow:hidden;"><img src="" class="tmp_img"></div>',"    <dl>",'        #{if:preview==true}<dd class="prev_image" style="text-align:left;border:1px solid #e0e0e0;/*margin-top:10px;*/padding:5px;overflow:hidden;"><img class="prev_img" src="" style="max-width:90%;max-height:100px;"></dd>#{/if:preview}',"        #{if:pasteTypeRadio==true}",'\t\t <dd class="imageInfo paste_type"><label style="padding-right:10px;">'+Trex._I18N.g("image.paste.title2","붙여넣기")+"</label>",'       <label class="paste_type paste_type_html"><input type="radio" name="paste_type" value="html" checked>'+Trex._I18N.g("image.paste.html_min","HTML")+"</label>",'       <label class="paste_type paste_type_image"><input type="radio" name="paste_type" value="image">'+Trex._I18N.g("image.paste.image_min","이미지")+"</label>",'       <label class="paste_type paste_type_text"><input type="radio" name="paste_type" value="plain">'+Trex._I18N.g("image.paste.plain_min","텍스트")+"</label>","       </dd>","        #{/if:pasteTypeRadio}",'\t\t <dd class="imageInfo imageAlign#{if:pasteTypeRadio==true} t_l#{/if:pasteTypeRadio}"><label>'+Trex._I18N.g("image.width","너비")+'</label><span class="g_select"><input type="text" name="txt_img_width" class="txt txt_sel txt_img_width" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_width_up">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_width_down">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span>",'\t\t <label class="inner">'+Trex._I18N.g("image.height","높이")+'</label><span class="g_select"><input type="text" name="txt_img_height" class="txt txt_sel txt_img_height" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_height_up">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_height_down">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span>",'\t\t    <label class="etc" style="margin-right:5px!important;float:right;line-height:25px;"><input type="checkbox" name="ratio" class="chk_img_ratio" style="vertical-align:middle;">'+Trex._I18N.g("image.ratio","비율유지")+"</label>","        #{if:pasteTypeRadio==true}",'        <div class="disabled_area"></div>',"        #{/if:pasteTypeRadio}","       </dd>",'\t\t <dd class="imageInfo" style="text-align:right;">','           <button type="button" name="btn_reset" class="btn btn_ok custom btn_reset" style="margin-right:5px;min-width:63px;">'+Trex._I18N.g("image.origin_size","원본크기")+"</button>","        #{if:pasteTypeRadio==true}",'        <div class="disabled_area"></div>',"        #{/if:pasteTypeRadio}","        </dd>",'\t\t<dd class="imageInfo line t_l">',"           <label>"+Trex._I18N.g("table.detail.border_style","테두리 스타일")+'</label><span class="g_line"><span class="line_style line1"></span><button type="button" name="btn_border_style" class="bg btn btn_down_arrow1">'+Trex._I18N.g("btn_down_arrow1","펼치기")+"</button></span>",'\t\t\t<ul class="line_style_option" style="display:none;">','\t\t\t#{for:line}<li class="#{class}" data-style="#{style}"><a href="javascript:;"></a></li>#{/for:line}',"\t\t\t</ul>",'           <label class="inner">'+Trex._I18N.g("table.detail.border_line","테두리 두께")+'</label><span class="g_select"><input type="text" name="txt_border_line" class="txt txt_sel" /><button type="button" name="btn_line_up" class="bg btn btn_up_arrow btn_border_up">'+Trex._I18N.g("btn_up_arrow","추가")+'</button><button type="button" name="btn_line_down" class="bg btn btn_down_arrow btn_border_down">'+Trex._I18N.g("btn_down_arrow","삭제")+"</button></span>","        #{if:pasteTypeRadio==true}",'        <div class="disabled_area"></div>',"        #{/if:pasteTypeRadio}","\t\t</dd>",'\t\t<dd class="imageInfo line">',"           <label>"+Trex._I18N.g("table.detail.border_color","테두리 색")+'</label><input type="text" name="txt_border_color" class="txt txt_color" /><a href="#" class="btn_color"><span style="background:#dfeef9"></span></a>','\t\t\t<div class="tx-colorpallete" unselectable="on" style="display:none;z-index:18000;"></div>',"        #{if:pasteTypeRadio==true}",'        <div class="disabled_area"></div>',"        #{/if:pasteTypeRadio}","\t\t</dd>",'\t\t<dd class="imageInfo quality t_l">','           <label><input type="checkbox" name="quality" class="img_jpeg_quality"><span>'+Trex._I18N.g("image.jpeg_quality","JPEG 품질")+"</span></label>",'           <span class="ijqp_wrap" style="display:none;">: <input type="text" name="quality_p" class="img_jpeg_quality_percent" size=3 value="70"><span>%</span></span>','\t\t\t<span class="image_size_wrap">'+Trex._I18N.g("image.size","Size")+':<span class="image_size">-</span></span>',"        #{if:pasteTypeRadio==true}",'        <div class="disabled_area"></div>',"        #{/if:pasteTypeRadio}","\t\t</dd>","    </dl>","</div>",'<div class="layer_bottom">','\t<button type="button" class="btn btn_ok">'+TXMSG("@table.popup.ok")+"</button>",'   <span class="btn_paste_title" style="display:none;">'+Trex._I18N.g("image.paste.title","붙여넣기 : ")+"</span>",'\t<button type="button" class="btn btn_img" style="display:none;">'+Trex._I18N.g("image.paste.image_min","이미지")+"</button>",'\t<button type="button" class="btn btn_html" style="display:none;">'+Trex._I18N.g("image.paste.html_min","HTML")+"</button>",'\t<button type="button" class="btn btn_plain" style="display:none;">'+Trex._I18N.g("image.paste.plain_min","텍스트")+"</button>",'\t<button type="button" class="btn btn_cancel">'+TXMSG("@table.popup.cancel")+"</button>",'   #{if:preview!=true}<label style="right: 10px; bottom: 5px; position: absolute;"><input type="checkbox" name="layer_opacity" class="chk_layer_opacity">'+Trex._I18N.g("image.layer.opacity","창 흐리게")+"</label>#{/if:preview}","<div>"].join("")),Trex.Image.ImageInfo=Trex.Class.create({initialize:function(a,b,c,d,e){this._initializedId=d.initializedId?d.initializedId:"",this.config=d,this.editor=a,this.canvas=c,this.toolbar=b,this.infotype=e,this.elWrapper=document.getElementById("image_"+e+"_wrap"+this._initializedId),this.elEditorBlockUI=document.getElementById("tx_editor_blockui"+this._initializedId),this._keditor=KEditor.get(this._initializedId),this._isInit=!1},_init:function(){function a(){j._origin={width:this.width,height:this.height},"property"!=j.infotype&&(j.elImgWidth.value=j._origin.width,j.elImgHeight.value=j._origin.height,j.elImgRatio.checked=!0),j._img_tmp.width=j.elImgWidth.value,j._img_tmp.height=j.elImgHeight.value,d(j._origin_file_size)}function b(){}function c(){if(j.tmp_canvas){if(!j.elJpegQ.checked)return void d(j._origin_file_size);j.img_size.innerHTML="-";var a=j._img_tmp,b=a.width,c=a.height,e=j.ctx,f=j.tmp_canvas;f.width=b,f.height=c,e.clearRect(0,0,b,c),e.drawImage(a,0,0,b,c);var g=(j.elJpegQP.value||70)/100,h=f.toDataURL("image/jpeg",g);e.clearRect(0,0,b,c),f.width=1,f.height=1,e.restore(),j.currentElem&&(j.currentElem.src=h),d(.75*h.split(",")[1].length),h="",h=null}}function d(a){var b=j._keditor.config.imageLimitSize||0;null!=a?(j.applyImageSize=a,j.img_size_wrap.style.display="",j.img_size.innerHTML=Trex._getDisplayFileSize(a),$(j.img_size)[0==b||b>a?"removeClass":"addClass"]("limit")):(j.applyImageSize=null,j.img_size_wrap.style.display="none",j.img_size.innerHTML="-",$(j.img_size).removeClass("limit"))}function e(a,b){var d=j.elImgRatio.checked,e=parseInt(a,0),f=parseInt(b,0);e=isNaN(e)?"":e,f=isNaN(f)?"":f,d&&j._origin?(j._img_tmp.removeAttribute("width"),j._img_tmp.removeAttribute("height"),j._img_tmp.style.width="",j._img_tmp.style.height="",null!=a&&(j._img_tmp.style.width=parseInt(a,10)+"px",j._img_tmp.width=a),null!=b&&(j._img_tmp.style.height=parseInt(b,10)+"px",j._img_tmp.height=b),e=j._img_tmp.width,f=j._img_tmp.height):(null==a&&(e=null),null==b&&(f=null)),null!=e&&(j.elImgWidth.value=e),null!=f&&(j.elImgHeight.value=f),e=j.elImgWidth.value,f=j.elImgHeight.value,j.currentElem&&(j.currentElem.width=e,j.currentElem.style.width=e+"px",j.currentElem.height=f,j.currentElem.style.height=f+"px"),j._img&&(d?j._img.removeAttribute("width"):j._img.width=e,j._img.height=f),c()}function f(){j.currentElem&&(j.currentElem.style.border=j._getBorderStyle()),j._img&&(j._img.style.border=j._getBorderStyle())}function g(){var a={width:j.elImgWidth.value,height:j.elImgHeight.value,border:j._getBorderStyle()};if(j.elJpegQ.checked){var b=(j.elJpegQP.value||70)/100;a.src=j.tmp_canvas.toDataURL("image/jpeg",b)}return a}var h={};h.line=[{class:"line1",style:"solid"},{class:"line2",style:"dotted"},{class:"line3",style:"double"}],h.title="paste"==this.infotype?Trex._I18N.g("image.paste.popup.title","붙여넣기 옵션"):Trex._I18N.g("image.property.title","이미지 속성"),h.preview="paste"==this.infotype,this.pasteTypeRadio=h.pasteTypeRadio="paste"==this.infotype&&!0,Trex.MarkupTemplate.get("image.property").evaluateToDom(h,this.elWrapper);var i=this.elWrapper;this.elImgWidth=$tom.collect(i,".txt_img_width"),this.elImgHeight=$tom.collect(i,".txt_img_height"),this.elImgRatio=$tom.collect(i,".chk_img_ratio"),this.elOpacity=$tom.collect(i,".chk_layer_opacity"),this.elReset=$tom.collect(i,".btn_reset"),this.tmp_canvas=$tom.collect(i,".tmp_canvas"),this.img_size_wrap=$tom.collect(i,".image_size_wrap"),this.img_size=$tom.collect(i,".image_size"),this.elJpegQ=$tom.collect(i,".img_jpeg_quality"),this.elJpegQP=$tom.collect(i,".img_jpeg_quality_percent"),this.elJpegQWrap=$tom.collect(i,".ijqp_wrap"),this.qualityWrap=$tom.collect(i,".quality"),this.JPEG_Q_MIN=50,this.JPEG_Q_MAX=100;try{this.tmp_canvas.toDataURL("image/jpeg",0),this.ctx=this.tmp_canvas.getContext("2d"),this.ctx.save()}catch(a){this.tmp_canvas=null,this.ctx=null}null!=this.tmp_canvas&&(window.atob||window.Blob)||(this.tmp_canvas=null,this.ctx=null,this.qualityWrap.style.display="none");var j=this;this._origin=null,this._prevInfo=null,this._img_tmp=$tom.collect(i,".tmp_img"),this._img=$tom.collect(i,".prev_img"),this._img_dd=$tom.collect(i,".prev_image"),this._img_tmp.onload=a,this._img_tmp.onerror=b,$tx.observe(this.elJpegQ,"click",function(){this.checked?(j.elJpegQWrap.style.display="",c()):(j.elJpegQWrap.style.display="none",j.currentElem&&(j.currentElem.src=j._originImage.src),d(j._origin_file_size))}),$tx.observe(this.elJpegQP,"keyup",function(){if(""!=this.value){var a=parseInt(this.value,10);isNaN(a)?this.value="":a>j.JPEG_Q_MAX?this.value=j.JPEG_Q_MAX:this.value=a,""==!this.value&&this.value>=j.JPEG_Q_MIN&&this.value<=j.JPEG_Q_MAX&&c()}}),$tx.observe(this.elJpegQP,"blur",function(){(""==this.value||this.value<j.JPEG_Q_MIN)&&(this.value=j.JPEG_Q_MIN,c())});var k=$tom.collect(i,".btn_width_up"),l=$tom.collect(i,".btn_width_down"),m=$tom.collect(i,".btn_height_up"),n=$tom.collect(i,".btn_height_down");$tx.observe(this.elImgWidth,"blur",function(){e(this.value,null)}),$tx.observe(this.elImgWidth,"keyup",function(){this.value=parseInt(this.value,10),e(this.value,null)}),$tx.observe(this.elImgRatio,"click",function(){this.checked&&j.elImgHeight.value&&e(null,j.elImgHeight.value)}),$tx.observe(this.elReset,"click",function(){e(j._origin?j._origin.width:"",j._origin?j._origin.height:"")}),$tx.observe(k,"click",function(){j.elImgWidth.value=(j.elImgWidth.value||0)-0+1,e(j.elImgWidth.value,null)}),$tx.observe(l,"click",function(){var a=(j.elImgWidth.value||0)-1;a=a<0?0:a,j.elImgWidth.value=a,e(j.elImgWidth.value,null)}),$tx.observe(this.elImgHeight,"blur",function(){e(null,this.value)}),$tx.observe(this.elImgHeight,"keyup",function(){e(null,this.value)}),$tx.observe(m,"click",function(){j.elImgHeight.value=(j.elImgHeight.value||0)-0+1,e(null,j.elImgHeight.value)}),$tx.observe(n,"click",function(){var a=(j.elImgHeight.value||0)-1;a=a<0?0:a,j.elImgHeight.value=a,e(null,j.elImgHeight.value)}),this.btn_border_style=$("button[name=btn_border_style]",i),this.border_list=$(".line_style_option",i),this.txt_border_line=$("input[name=txt_border_line]",i),this.btn_line_up=$(".btn_border_up",i),this.btn_line_dn=$(".btn_border_down",i),this.txt_border_color=$("input[name=txt_border_color]",i),this.btn_line_color=$(".btn_color",i),this.span_line_color=$(".btn_color span",i),this.line_color_pal=$(".tx-colorpallete",i),this.g_line=$(".line .g_line",i),this._line={};var o=$("li",this.border_list);this.border_style_map={solid:o[0],dotted:o[1],double:o[2]},this._getBorderStyle=function(){var a=j._line;return a.color&&a.width&&a.style?a.width+"px "+a.style+" "+a.color:""},this._closeSubLayer=function(a){a!=j.btn_line_color&&j.linePallete_c&&j.linePallete_c.hide(),a!=j.btn_border_style&&($(j.btn_border_style).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(j.border_list.get(0)))};var p={calculate:function(a,b){var c="line"==a?j._line.width?j._line.width:0:"",d="line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"";return c=parseInt(c),isNaN(c)&&(c=1),c+b>d||c+b<0?("line"!=a&&"padding"!=a&&alert(TXMSG("@table.alert")),c):(c+=b,c<0&&(c=0),c.toString())},getValidValue:function(a,b,c,d){var e="row"==a?Trex.Menu.Table.MAX_ROW:"col"==a?Trex.Menu.Table.MAX_COL:"line"==a?Trex.Menu.Table.MAX_LINE_WIDTH:"padding"==a?Trex.Menu.Table.MAX_PADDING:"";return isNaN(b)?c:((b<0||b>e)&&(b=b>e?e:c,d&&(d.value=b),alert(Trex._I18N.g("number.alert","1",e.toString(),"1 이상 "+e+" 이하의 숫자만 입력 가능합니다."))),b)},validColor:function(a,b,c){var d=b.match(/#?([0-9a-f]{6}|[0-9a-f]{3})/i);return d===_NULL||b.length>8?c:(d[1].length,"#"+d[1].toLowerCase())}};this.btn_border_style.on("click",function(){return j._closeSubLayer(j.btn_border_style),$(this).hasClass("btn_down_arrow1")?($(this).removeClass("btn_down_arrow1").addClass("btn_up_arrow1"),$tx.show(j.border_list.get(0))):($(this).removeClass("btn_up_arrow1").addClass("btn_down_arrow1"),$tx.hide(j.border_list.get(0))),!1}),this.btn_border_style.closest("span").on("click",function(){j.btn_border_style.click()}),this._setBorderList=function(a){var b=$(j.g_line),c=$(a).attr("class"),d=$(a).data("style");b.find(".line_style").hasClass(c)||(b.find(".line_style").remove(),b.prepend('<span class="line_style '+c+'"></span>')),j._line.style=d},this.border_list.find("li").on("click",function(a){j._setBorderList(this),j.btn_border_style.click(),f(),a.preventDefault()}),this.setLineColor=function(){""==j._line.width||"0"==j._line.width||j._line.color?""==j._line.width||j._line.width:(j._line.color="#ccc",j.txt_border_color.val(j._line.color)),j._line.color?j.span_line_color.css("background",j._line.color):j.span_line_color.css("background","#dfeef9"),f()},this.setLineWidth=function(){""==j._line.color||j._line.width?""==j._line.color&&j._line.width:(j._line.width="1",j.txt_border_line.val(j._line.width)),f()},this.txt_border_line.on("blur",function(){this.value=j._line.width=p.getValidValue("line",this.value,"",this),j.setLineColor()}),this.txt_border_line.on("keyup",function(){this.value=j._line.width=p.getValidValue("line",this.value,"",this),j.setLineColor()}),this.btn_line_up.on("click",function(){j.txt_border_line.get(0).value=j._line.width=p.calculate("line",1),j.setLineColor()}),this.btn_line_dn.on("click",function(){j.txt_border_line.get(0).value=j._line.width=p.calculate("line",-1),j.setLineColor()}),this.txt_border_color.on("blur",function(){this.value=j._line.color=p.validColor("line",this.value,""),""==this.value?j.span_line_color.css("background","#dfeef9"):j.span_line_color.css("background",this.value),j.setLineWidth()}),this.btn_line_color.on("click",function(){return j._closeSubLayer(j.btn_line_color),j.linePallete_c==_NULL&&($tx.ltie8&&($(".tx-image-property",i).append(j.line_color_pal),$(j.line_color_pal).css("top","80px"),$(j.line_color_pal).css("right","10px")),j.linePallete_c=j.createColorPallete(j.line_color_pal.get(0),function(a){a=a.toLowerCase(),j._line.color=a,j.txt_border_color.val(a),""==a?j.span_line_color.css("background","#dfeef9"):j.span_line_color.css("background",a),j.setLineWidth()},!1)),$tx.hide(j.border_list.get(0)),j.linePallete_c.toggle(),j.linePallete_c.remainColor(j.txt_border_color.val()),!1}),this.elOpacity&&$tx.observe(this.elOpacity,"click",function(){this.checked?($tx.addClassName(j.elWrapper,"opacity8"),$tx.addClassName(j.elEditorBlockUI,"opacity1")):($tx.removeClassName(j.elWrapper,"opacity8"),$tx.removeClassName(j.elEditorBlockUI,"opacity1"))}),
this.btn_OK=$tom.collect(i,".layer_bottom .btn_ok"),this.btn_CANCEL=$tom.collect(i,".layer_bottom .btn_cancel"),this.btn_paste_title=$tom.collect(i,".layer_bottom .btn_paste_title"),this.btn_IMG=$tom.collect(i,".layer_bottom .btn_img"),this.btn_HTML=$tom.collect(i,".layer_bottom .btn_html"),this.btn_PLAIN=$tom.collect(i,".layer_bottom .btn_plain"),this.radio_HTML=$tom.collect(i,".paste_type_html"),this.radio_IMG=$tom.collect(i,".paste_type_image"),this.radio_TEXT=$tom.collect(i,".paste_type_text"),this.disabled_wrap=$(".disabled_area",i),this.paste_radio=$("dd.paste_type input",i),$tx.observe(this.btn_OK,"click",function(a){this.pasteTypeRadio?(j.canvas.focus(),this.paste_radio[0]&&this.paste_radio[0].checked?this.callback.html(this._htmlcode):this.paste_radio[1]&&this.paste_radio[1].checked?this.callback.image(g()):this.paste_radio[2]&&this.paste_radio[2].checked&&this.callback.plain(this._plaincode)):"property"!=this.infotype&&this.callback&&this.callback.image?this.callback.image(g()):this.callback&&this.callback(),"property"==j.infotype&&j.canvas.history.saveHistory(),this.clearLayer(),this.hidePopup(),$tx.stop(a)}.bind(this)),$tx.observe(this.btn_IMG,"click",function(a){this.callback&&this.callback.image&&this.callback.image(g()),this.clearLayer(),this.hidePopup(),$tx.stop(a)}.bind(this)),$tx.observe(this.btn_HTML,"click",function(a){this.callback&&this.callback.html&&this.callback.html(this._htmlcode),this.clearLayer(),this.hidePopup(),$tx.stop(a)}.bind(this)),$tx.observe(this.btn_PLAIN,"click",function(a){this.callback&&this.callback.plain&&this.callback.plain(this._plaincode),this.clearLayer(),this.hidePopup(),$tx.stop(a)}.bind(this)),this.paste_radio.on("click",function(a){j._closeSubLayer(null),j.disabled_wrap["image"==this.value?"hide":"show"]();var b=a.originalEvent,c=this;return setTimeout(function(){c.checked=!0},0),$tx.stop(b),!1}),$tx.observe(this.btn_CANCEL,"click",function(a){if(j.currentElem&&j._originImage){var b=j.currentElem,c=j._originImage;c.src&&(b.src=c.src),c.width?b.width=c.width:b.removeAttribute("width"),c.height?b.height=c.height:b.removeAttribute("height"),b.style.width=c.style.width,b.style.height=c.style.height,b.style.border=c.style.border}this.clearLayer(),this.hidePopup(),$tx.stop(a)}.bind(this)),"paste"!=this.infotype||this.pasteTypeRadio||(this.btn_CANCEL.style.marginLeft="20px"),this._isInit=!0},_setAlign:function(a){var b=this,c=$tom.collect(this.elWrapper,".imageAlign .g_align"),d=$(".align_text",c),e=$(a).html(),f=$(a).data("style");d.html(e),b._align=f,b._img_parent&&(b._img_parent.style.textAlign=b._align),b._img_dd&&(b._img_dd.style.textAlign=b._align)},observeEvent:function(){$(this.elEditorBlockUI).on("mousedown",function(a){return!1})},hidePopup:function(){$tx.hide(this.elEditorBlockUI),$tx.hide(this.elWrapper),this.callback=null,this._originImage=null,$tx.removeClassName(this.elWrapper,"opacity8"),$tx.removeClassName(this.elEditorBlockUI,"opacity1"),this.elOpacity&&(this.elOpacity.checked=!1)},clearLayer:function(){var a=this;a._img_tmp.src="",a._img_tmp.removeAttribute("width"),a._img_tmp.removeAttribute("height"),a._img_tmp.style.width="",a._img_tmp.style.height="",a._img&&(a._img.src="",a._img.removeAttribute("width"),a._img.removeAttribute("height"),a._img.style.width="",a._img.style.height="",a._img.style.border=""),a._clearLayer=!0},showPopup:function(a,b,c,d,e,f){var g=this;if(g._htmlcode=d,g._plaincode=e?e.replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/\n/g,"<br>"):"",g.currentElem=a,g.callback=b,$tx.show(g.elEditorBlockUI),g._isInit||g._init(),this._clearLayer||this.clearLayer(),this._clearLayer=!1,g._origin=null,g._line={color:"",width:"",style:"solid"},g.txt_border_color.val(g._line.color),g.span_line_color.css("background","#dfeef9"),g.txt_border_line.val(g._line.width),g._setBorderList($("li",g.border_list)[0]),g._origin_file_size=f,"property"==this.infotype){g._img_parent=$tom.find(a,"%paragraph");g._originImage={src:a.src,width:a.width,height:a.height,style:{width:a.style.width,height:a.style.height,border:a.style.border}};try{-1!=g._originImage.src.search(/^data:/i)&&null==f&&(g._origin_file_size=.75*g._originImage.src.split(",")[1].length)}catch(a){}g.elImgWidth.value=parseInt(g._originImage.style.width||g._originImage.width,10),g.elImgHeight.value=parseInt(g._originImage.style.height||g._originImage.height,10),g.elImgRatio.checked=!0;var h=a.style.borderWidth;null!=h&&(h=parseInt(h,10)),null==h||isNaN(h)||(g._line.width=h,g.txt_border_line.val(h));var i=a.style.borderColor,j=/rgb\s*\(\s*(\d+)\s*,\s*(\d+),\s*(\d+)\s*\)\s*/i;if(i){if(-1!=i.search(j)){var k=i.match(j);k&&(i="#",i+=("00"+parseInt(k[1],10).toString(16)).substr(-2),i+=("00"+parseInt(k[2],10).toString(16)).substr(-2),i+=("00"+parseInt(k[3],10).toString(16)).substr(-2))}g._line.color=i,g.txt_border_color.val(g._line.color),g.span_line_color.css("background",g._line.color)}var l=a.style.borderStyle;l&&g.border_style_map[l]&&(g._line.style=l,g._setBorderList(g.border_style_map[l])),-1==g._originImage.src.search(/^data:/i)&&-1==g._originImage.src.toLowerCase().indexOf(document.location.hostname)?g.qualityWrap.style.display="none":this.tmp_canvas&&(g.qualityWrap.style.display="")}else g._originImage=null,g.elImgRatio.checked=!0,g.pasteTypeRadio?(g.btn_OK.style.display="",g.paste_radio[0].checked=!0,c&&d?(g.radio_HTML.style.display="",g.radio_IMG.style.display="",g.radio_TEXT.style.display=e?"":"none",g.disabled_wrap.show()):(g.paste_radio[1].checked=!0,g.radio_HTML.style.display="none",g.radio_IMG.style.display="",g.radio_TEXT.style.display="none",g.disabled_wrap.hide())):c&&d?(g.btn_paste_title&&(g.btn_paste_title.style.display=""),g.btn_IMG.style.display="",g.btn_HTML.style.display="",g.btn_PLAIN.style.display=e?"":"none",g.btn_OK.style.display="none"):(g.btn_paste_title&&(g.btn_paste_title.style.display="none"),g.btn_IMG.style.display="none",g.btn_HTML.style.display="none",g.btn_PLAIN.style.display="none",g.btn_OK.style.display="");g.elJpegQ.checked=!1,g.elJpegQP.value="70",g.elJpegQWrap.style.display="none",g.img_size.innerHTML="-",g._closeSubLayer(null);var m=$(g.canvas.elContainer),n=$(g.elWrapper),o=m.outerWidth(),p=m.outerHeight(),q=n.outerWidth(),r=n.outerHeight(),s=Math.ceil(o/2)-Math.ceil(q/2)+m.position().left,t=Math.ceil(p/2)-Math.ceil(r/2)+m.position().top;n.css({top:t,left:s}),$tx.show(g.elWrapper),"property"==this.infotype?g._img_tmp.src=a.src:(g._img&&(g._img.src=c.src),g._img_tmp.src=c.src)},createColorPallete:function(a,b,c,d,e){var f=new Trex.Menu.ColorPallete({el:a,thumbs:Trex.__CONFIG_COMMON.thumbs,colorInputHidden:c});return f.setCommand(b),f}}),TrexConfig.add({canvas:{exitEditor:{desc:Trex._I18N.g("exitEditor_desc","에디터 영역 : 에디터 영역에서 빠져 나오시려면 Shift+ESC키를 누르세요"),hotKey:{shiftKey:!0,keyCode:27},nextElement:null}}},null),Trex.module("exit Editor",function(a,b,c,d,e){function f(a){return!("none"==$tx.getStyle(a,"display")||"hidden"==$tx.getStyle(a,"visibility")||"input"===a.tagName.toLowerCase()&&"hidden"==a.type||"a"===a.tagName.toLowerCase()&&""==(a.href||"").trim()||a.offsetLeft<=0)}function g(a){try{if(j.nextElement)return void j.nextElement.focus();var b=i,c="button,a,input,select,object",e=null,g=null;do{var h=$tom.nextContent(b,"#element");$tom.kindOf(h,c)?e=h:(g=$tom.descendants(h,c),e=g.find(f)),e&&(f(e)||(e=null)),b=h}while(!e&&b);e?e.focus():d.getProcessor().blur()}catch(a){d.getProcessor().blur()}}var h=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),i=h.el,j=e.canvas.exitEditor;d.observeKey(j.hotKey,function(a){$tx.stop(a),g(a)})}),TrexConfig.addTool("translate",{disabledonmobile:_TRUE,wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),Trex.Tool.Translate=Trex.Class.create({$const:{__Identity:"translate"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){var b,c,d=a.getCanvas(),e=d.getPanel(Trex.Canvas.__WYSIWYG_MODE),f=e.getDocument(),g=f.parentWindow||f.defaultView,h=null,i=g.getSelection||g.document.getSelection;if(i){var j=i();b=j+"",h=j.getRangeAt(0);var k=h.cloneContents(),l=document.createElement("div");l.appendChild(k),c=l.innerHTML;var m=$("<div></div>");$tx.msie?(m.html(c.replace(/<div/gi,"<span").replace(/<\/div>/gi,"</span>").replace(/><br\/?></gi,"><")),$("p",m).css({display:"inline"})):m.html(c.replace(/<p/gi,"<div").replace(/<\/p>/gi,"</div>")),b=m[0].innerText||m[0].textContent||b}else g.document.selection&&(h=g.document.selection.createRange().text,b=h.text,c=h.htmlText);var n=d.getProcessor().getSelectionRange(d);d.translateFn(b,c,function(a){a&&(d.focus(),d.execute(function(b){b.pasteHtml(a,d,n)}))},h)})}}),TrexConfig.addTool("cleanup",{wysiwygonly:_TRUE,sync:_FALSE,status:_FALSE}),Trex.Tool.Cleanup=Trex.Class.create({$const:{__Identity:"cleanup"},$extend:Trex.Tool,oninitialized:function(){var a=this.editor;this.weave.bind(this)(new Trex.Button(this.buttonCfg),_NULL,function(){if(confirm(Trex._I18N.g("cleanup.confirm","Tag를 정리합니다.\n시간이 오래 걸릴 수 있습니다\n실행하시겠습니까?"))){var b=a.getCanvas(),c=b.getPanel(Trex.Canvas.__WYSIWYG_MODE),d=c.getDocument(),e=window.document,f=e.createElement("div");e.body.appendChild(f),f.className="cleanupProgress",f.innerHTML='<div class="bg"></div><div class="icon"></div><div class="desc"><span>'+Trex._I18N.g("cleanup.desc","Tag를 정리중 입니다. 시간이 오래 걸릴 수 있습니다. 잠시만 기다려 주세요.")+"</span></div>",setTimeout(function(){var c=d.body.innerHTML;d.body.innerHTML="",c=Trex.KEditor.cleanupHTML(c),d.body.innerHTML=c,b.history.saveHistory(),$(f).remove(),a.showCleanupBtn(!1)},500)}})}}),"undefined"!=typeof Editor&&(Editor.version="3.0.07");try{EditorJSLoader.readyState="complete",EditorJSLoader.finish()}catch(a){}