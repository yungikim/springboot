/* kmslab_editor 3.0.1 */

function ImageUploader(){}function CryptoLib(){}ImageUploader.DISABLED=!1,ImageUploader.IS_DEPLOYED=!1,ImageUploader.ADD_POST_DATA=!1,ImageUploader.KWH_FORM_ACTION="http://localhost:16081",ImageUploader.KWH_NM="K-Portal_Web_Editor",ImageUploader.DPI=100,ImageUploader.deploy=function(a){var b=navigator.userAgent,c=b.toLowerCase();if(c.indexOf("mobile")>-1||c.indexOf("android")>-1||c.indexOf("iphone")>-1||c.indexOf("ipad")>-1||c.indexOf("blackberry")>-1||c.indexOf("opera mini")>-1||c.indexOf("iemobile")>-1)return void(ImageUploader.DISABLED=!0);ImageUploader.IS_DEPLOYED||(ImageUploader.IS_DEPLOYED=ImageUploader.setKWebHelper(a))},ImageUploader.isLoadComplete=function(){return!ImageUploader.DISABLED&&ImageUploader.IS_DEPLOYED},ImageUploader.getClipboardData=function(){var a={};return ImageUploader.sendJsonData("getClipboardInfo",a)},ImageUploader.setKWebHelperObj=function(a){return{nm:ImageUploader.KWH_NM,data:a}},ImageUploader.setKWebHelper=function(editor){var _l=document.location,_hostname=_l.hostname,_protocol=_l.protocol,_domain=_hostname&&"local.k-portal.co.kr"==_hostname?"https://www.kmslab.com":_protocol+"//"+_hostname,_port="https"==_protocol?"443":"80",_action="string"!=typeof editor.config.imageUploadPath?editor.config.imageUploadPath("paste"):editor.config.imageUploadPath,kwh_data={domain:_domain,port:_port,action:_action.replace(_domain,"").replace("https://www.kmslab.com","")},data=ImageUploader.sendJsonData("set",kwh_data);try{var json=eval("("+data+")")}catch(a){return!1}"number"==typeof json.dpiinfo&&(this.DPI=json.dpiinfo);var _fList=json.fontlist;if("object"==typeof _fList&&_fList.length>0)try{localStorage.setItem("fontlist",JSON.stringify(_fList))}catch(a){}else try{localStorage.removeItem("fontlist")}catch(a){}var _config=editor.config,_kwhVersion=_config.kwhVersion;if(void 0!=_kwhVersion){var kwebhelperBtn=$("#tx_kwebhelper"+_config.instanceId||"").find("a.tx-icon");_kwhVersion!=json.version&&(kwebhelperBtn.addClass("tx-newversion"),kwebhelperBtn.attr("title",Trex._I18N.g("tx_kwebhelper_newversion","새로운 버전의 KWebHelper를 다시 설치해주세요.")))}return"FAILURE"!=json.result||!$tx.os_win&&!$tx.os_mac||(void 0!=editor.config.kwhAutoPopup&&editor.config.kwhAutoPopup&&ImageUploader.openSetupPage(editor),!1)},ImageUploader.openSetupPage=function(a){var b=a.config.language||"ko",c=document.location,d=c.protocol+"//"+c.host+a.config.kwhInstallPath+"/setup_"+("ko"==b?b:"en")+".html";parent?parent.$("<a />",{href:d,target:"_kWebHelper"})[0].click():$("<a />",{href:d,target:"_kWebHelper"})[0].click()},ImageUploader.sendJsonData=function(a,b){switch(a){case"getClipboardInfo":case"resetUploadInfo":var c={req:a};break;case"set":var c={req:a,data:b,option:{dpiinfo:!0,fontlist:!0}};break;default:var c={req:a,data:b}}var d="",e=ImageUploader.setKWebHelperObj(c),f=CryptoLib.aes256Encode(JSON.stringify(e)),g=new FormData;g.append("json",f);var h=$.ajax({url:ImageUploader.KWH_FORM_ACTION,type:"POST",async:!1,beforeSend:function(a){setTimeout(function(){h&&4!=h.readyState&&h.abort()},3e4)},contentType:!1,processData:!1,cache:!1,data:g,crossDomain:!0,dataType:"text"}).done(function(b){var c=CryptoLib.aes256Decode(b);""==c&&(c=b),d="addUploadFileInfo"==a?"["+c+"]":c}).fail(function(a,b,c){d='{"result":"FAILURE", "message":"'+c+'","code":"'+a.status+'"}'});return d},ImageUploader.uploadImage=function(a,b){var c={},d=!1;if($.each($("img",b),function(b,e){var f=null;try{f=e.src}catch(a){f=null}f&&a._checkUploadImage(f)&&(null==c[e.src]&&(c[e.src]=[]),c[e.src].push(e),d=!0)}),!d)return null;var e={},f={};for(var g in c){var h=filePath=g,i=null;-1!=h.search(/^(?:file:\/\/\/|[a-zA-Z]:)/)?(filePath=decodeURIComponent(filePath),filePath=filePath.replace("file:///","").replace("\\","/")):filePath=decodeURIComponent(filePath).split("?")[0],i=filePath,-1!=i.lastIndexOf("/")&&(i=i.substring(i.lastIndexOf("/")+1)),i=-1!=i.lastIndexOf(".")?i.substring(i.lastIndexOf(".")+1):"gif";var j=a._getUploadImageInfo("","",i,"control"),k=(j.cid,-1!=filePath.lastIndexOf("/")?filePath.substring(filePath.lastIndexOf("/")+1):filePath),l=[],m={};"domino"==j.type&&(l.push({__Click:"0"}),l.push({"%%PostCharset":"UTF-8"}),l.push({Body:""}));for(var n in j.postdata){var o={};o[n]=j.postdata[n],l.push(o)}ImageUploader.ADD_POST_DATA||ImageUploader.sendJsonData("addPostdata",l),ImageUploader.ADD_POST_DATA=!0;var p=c[g],q=p[0].className?p[0].className:"";e[k]=p,m.filename=k,m.filepath=filePath,m.size=q;var r=ImageUploader.sendJsonData("addUploadFileInfo",m);j.uploadedImage=f,j.uploadImageById=e,a._parseUploadResponse(r,j,"KWebHelper")}var s={uploadedImage:f,uploadId:e};for(var n in s.uploadedImage){var t=s.uploadId[n];if(null!=t)for(var u=0;u<t.length;u++)t[u].src=s.uploadedImage[n]}return b},ImageUploader.uploadImage_async=function(a,b,c,d){var e=[],f={},g=!1,h=!1,i=$("<div>"+b+"</div>");if($.each($("img",i),function(b,c){var d=null;try{d=c.src}catch(a){d=null}d&&a._checkUploadImage(d)&&(null==f[c.src]&&(f[c.src]=[]),f[c.src].push(c),g=!0)}),!g){var j=a.editor.getCanvas(),b=i.html();return b=Trex.KEditor.cleanupHTML(b),b=Trex.KEditor.inlineStyle(c,b,a.config.removeStyleProps),void j.execute(function(a){a.pasteHtml(b,j,d)})}var k={},l={},m=0;for(var n in f){m+=1,"png"==n.substring(n.lastIndexOf(".")+1)&&(h=!0);var o=function(b){var c=$.Deferred(),d=filePath=b,e=null;-1!=d.search(/^(?:file:\/\/\/|[a-zA-Z]:)/)?(filePath=decodeURIComponent(filePath),filePath=filePath.replace("file:///","").replace("\\","/")):filePath=decodeURIComponent(filePath).split("?")[0],e=filePath,-1!=e.lastIndexOf("/")&&(e=e.substring(e.lastIndexOf("/")+1)),e=-1!=e.lastIndexOf(".")?e.substring(e.lastIndexOf(".")+1):"gif";var g=a._getUploadImageInfo("","",e,"control"),h=-1!=filePath.lastIndexOf("/")?filePath.substring(filePath.lastIndexOf("/")+1):filePath,i=[],j={};"domino"==g.type&&(i.push({__Click:"0"}),i.push({"%%PostCharset":"UTF-8"}),i.push({Body:""}));for(var m in g.postdata){var n={};n[m]=g.postdata[m],i.push(n)}ImageUploader.ADD_POST_DATA||ImageUploader.sendJsonData("addPostdata",i),ImageUploader.ADD_POST_DATA=!0;var o=f[b],p=o[0].className?o[0].className:"";k[h]=o,j.filename=h,j.filepath=filePath,j.size=p;var q={req:"addUploadFileInfo",data:j},r=ImageUploader.setKWebHelperObj(q),s=CryptoLib.aes256Encode(JSON.stringify(r)),t=new FormData;return t.append("json",s),$.ajax({url:ImageUploader.KWH_FORM_ACTION,type:"POST",async:!0,timeout:3e4,contentType:!1,processData:!1,cache:!1,data:t,crossDomain:!0,dataType:"text"}).done(function(b){var d=CryptoLib.aes256Decode(b);""==d&&(d=b),uploadResult="["+d+"]",g.uploadedImage=l,g.uploadImageById=k,a._parseUploadResponse(uploadResult,g,"KWebHelper"),c.resolve(d)}).fail(function(a,b,d){uploadResult='{"result":"FAILURE", "message":"'+d+'","code":"'+a.status+'"}',c.reject(uploadResult)}),c.promise()}(n).then(function(a){JSON.parse(a);return $.Deferred().resolve()},function(a,b){return $.Deferred().resolve()});e.push(o)}$.when.apply($,e).always(function(){var b={uploadedImage:l,uploadId:k};for(var e in b.uploadedImage){var f=b.uploadId[e],g=ImageUploader.DPI/100;if(null!=f)for(var j=0;j<f.length;j++)f[j].removeAttribute("id"),1==g||0!=h||$tx.os_mac||(f[j].width=parseInt(f[j].width/g),f[j].height=parseInt(f[j].height/g)),f[j].src=b.uploadedImage[e]}var m=a.editor.getCanvas(),n=i.html();n=Trex.KEditor.cleanupHTML(n),n=Trex.KEditor.inlineStyle(c,n,a.config.removeStyleProps),m.execute(function(a){a.pasteHtml(n,m,d)})})},CryptoLib.aes256Encode=function(a){return CryptoJS.AES.encrypt(a,CryptoJS.enc.Hex.parse("6b6d736c61626b706f7274616c776562656469746f7233373431363238333239"),{iv:CryptoJS.enc.Utf8.parse(""),padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC}).toString()},CryptoLib.aes256Decode=function(a){return CryptoJS.AES.decrypt(a,CryptoJS.enc.Hex.parse("6b6d736c61626b706f7274616c776562656469746f7233373431363238333239"),{iv:CryptoJS.enc.Utf8.parse(""),padding:CryptoJS.pad.Pkcs7,mode:CryptoJS.mode.CBC}).toString(CryptoJS.enc.Utf8)},CryptoLib.base64Encode=function(a){var b=CryptoJS.enc.Utf8.parse(a);return CryptoJS.enc.Base64.stringify(b)},CryptoLib.base64Decode=function(a){return CryptoJS.enc.Base64.parse(a).toString(CryptoJS.enc.Utf8)},CryptoLib.randomString=function(a){for(var b="abcdefghijklmnopqrstuvwxyz",c="",d=0;d<a;d++)c+=b.charAt(Math.floor(Math.random()*b.length));return c};